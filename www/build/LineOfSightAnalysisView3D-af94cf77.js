import { y as y$1, e, d as d$1, n as n$4, m as m$1, ay as w, aa as i$1, t as t$3, r as r$1, s as s$4, z as r$3, a$ as n$8, aL as h, aM as O$3, ax as j$3, bA as d$6, v as n$9, ag as c$1, H as l$5, as as o } from './cast-3d5be210.js';
import { n as n$7, j as j$4 } from './Collection-a38e0489.js';
import { n as n$5, a6 as e$1, b as r$2, z, q, u as u$1, g as t$4, x as x$2, e as e$2, U, a1 as J } from './mathUtils-559a53d9.js';
import { C as C$1, a as n$b } from './LineVisualElement-0571b2ba.js';
import { l as l$1 } from './Color-25ce730a.js';
import './geometry-2f332a26.js';
import { l as l$3, f as f$1, u as u$5 } from './LineOfSightAnalysisTarget-7891143a.js';
import { u as u$2 } from './Handles-54afc0a7.js';
import { l as l$4, w as w$2, U as U$1, a as a$2, h as h$1 } from './reactiveUtils-bd6fe823.js';
import { c } from './HandleOwner-fe336959.js';
import { u as un, z as zn } from './projection-fbd5d346.js';
import { F, j as j$2, D } from './aaBoundingRect-5e1a4e52.js';
import { m as m$2, l as l$2, p as p$1, d as d$4 } from './sphere-4710475c.js';
import { d as d$5, u as u$3, f as f$2 } from './elevationInfoUtils-d6676eee.js';
import { d as d$2 } from './screenUtils-31d073db.js';
import { t as t$2 } from './vectorStacks-3fa8ee55.js';
import { O as O$2 } from './dehydratedFeatures-7b45465d.js';
import { aY as s$3, b5 as n$6, b6 as r, b7 as d$3, b8 as w$1, b9 as V$1, T as T$1 } from './SceneView-ed3703c9.js';
import { x as x$1, s as t$1, q as i$2 } from './viewpointUtils-4c294048.js';
import { a as a$1 } from './projectionUtils-5ca56a63.js';
import { Q, L as L$1 } from './Scheduler-ed7a36dc.js';
import { j as j$1 } from './Point-edff2a11.js';
import { l as l$6, v as v$1 } from './lineSegment-99193ade.js';
import { x as x$3 } from './commonProperties-fca3036e.js';
import { w as w$3, t as te$1, a as a$3, p as p$2, c as c$2, m as m$3 } from './analysisViewUtils-869adced.js';
import { X as u$4, a3 as t$5, a4 as n$a } from './DefaultUI-a0db5719.js';
import { _ as _$2, S } from './PointVisualElement-0396d7c0.js';
import { e as e$3 } from './mat4f64-ef2c1a38.js';
import './Promise-d2759b2e.js';
import './mat4-d5df0e58.js';
import './DefaultVertexAttributeLayouts-664d07a8.js';
import './vec2f64-2956001b.js';
import './context-util-5ae1bf7b.js';
import './enums-4770f29d.js';
import './FramebufferObject-bfb23fd2.js';
import './Texture-f189b7ba.js';
import './VertexElementDescriptor-3b53aa99.js';
import './OrderIndependentTransparency-b8c8f539.js';
import './request-ac4d8bfb.js';
import './objectResourceUtils-e575a410.js';
import './devEnvironmentUtils-cb76d69b.js';
import './mat3-eb8de168.js';
import './quatf64-06b7eadd.js';
import './aaBoundingBox-b312516d.js';
import './Extent-f27111e1.js';
import './BufferView-a9ba6e5d.js';
import './vec2-4f9a494f.js';
import './vec33-241a09d2.js';
import './DefaultMaterial_COLOR_GAMMA-ba792f7e.js';
import './types-4487be8c.js';
import './asyncUtils-96c00c9e.js';
import './compilerUtils-d149ad5f.js';
import './Version-44ff489f.js';
import './quat-43e08490.js';
import './Util-73f4ac53.js';
import './vec4f64-011248e0.js';
import './VertexAttribute-ef09ced9.js';
import './assets-99f5c3ee.js';
import './ViewingMode-4a1cffad.js';
import './InterleavedLayout-fe763b01.js';
import './vec3f32-03e33744.js';
import './utils-eafc976f.js';
import './doublePrecisionUtils-5c7a1f3b.js';
import './jsonUtils-f3f35e7f.js';
import './colorUtils-5009883d.js';
import './_commonjsHelpers-8dd5c177.js';
import './Polyline-dcdb3782.js';
import './Clonable-533c7a05.js';
import './JSONSupport-dce2c67b.js';
import './persistable-5b051b1c.js';
import './multiOriginJSONSupportUtils-917e4f3f.js';
import './uuid-ac104993.js';
import './persistableUrlUtils-5dcd6081.js';
import './unitUtils-a0a11e54.js';
import './zscale-0befeff4.js';
import './byteSizeEstimations-5d50d6ff.js';
import './quantizationUtils-65995723.js';
import './Field-2973a5cf.js';
import './enumeration-6695a859.js';
import './fieldType-eb0b42e4.js';
import './Viewpoint-e3d4029a.js';
import './Cyclical-922b1741.js';
import './Graphic-93f45ded.js';
import './PopupTemplate-b459951f.js';
import './fieldUtils-240a3b99.js';
import './number-c5a37d3e.js';
import './ActionToggle-a5849e6f.js';
import './Identifiable-d9658370.js';
import './symbols-ab3e849a.js';
import './CIMSymbol-15bdb580.js';
import './Symbol-573a64f6.js';
import './opacityUtils-dcd94f00.js';
import './collectionUtils-302901c0.js';
import './Portal-5df9f5a7.js';
import './jsxFactory-4cd653a4.js';
import './intl-54ccdc89.js';
import './messages-5e9a4a9e.js';
import './index-f980186a.js';
import './workers-c7a27acb.js';
import './GraphicsCollection-851bdafb.js';
import './HeightModelInfo-12951268.js';
import './scaleUtils-c3d4b164.js';
import './layerUtils-160a1a44.js';
import './ElevationSampler-86027644.js';
import './TileInfo-3c9e9a6a.js';
import './frustum-95850b85.js';
import './vec2f32-23e4a539.js';
import './EdgeProcessingWorker-87151cf6.js';
import './deduplicate-3951315a.js';
import './RenderingContext-f60b1ec5.js';
import './ProgramCache-0964dba1.js';
import './Program-634dbdbe.js';
import './floatRGBA-64e5bf11.js';
import './labelFormatUtils-d19cf46d.js';
import './labelUtils-824fc88a.js';
import './featureConversionUtils-3f60eb15.js';
import './OptimizedFeature-a0dba562.js';
import './OptimizedFeatureSet-261a115b.js';
import './earcut-4e6b97b1.js';
import './UniqueValueRenderer-bb66af10.js';
import './ColorStop-64c57e35.js';
import './diffUtils-6436a697.js';
import './colorRamps-e3d9340f.js';
import './sizeVariableUtils-5330814d.js';
import './jsonUtils-a25e8eb8.js';
import './styleUtils-d2332fad.js';
import './MeshComponent-b778671b.js';
import './screenshotUtils-af7d4bfe.js';
import './Octree-38bc90df.js';
import './MemCache-04cdd0cd.js';
import './utils-2bda91e5.js';
import './ItemCache-1f62ab56.js';
import './utils-8133dc40.js';
import './callExpressionWithFeature-cfe9aa0a.js';
import './projection-a57f78d7.js';
import './geometryServiceUtils-b4e25893.js';
import './project-248cf8a5.js';
import './utils-d801fb7f.js';
import './CollectionFlattener-9ce72729.js';
import './aliasOf-bdfe6662.js';
import './RefreshableLayer-496830b9.js';
import './LercDecoder-0b4fb3f9.js';
import './VectorTile-93124859.js';
import './enums-33a95ace.js';
import './config-5446e136.js';
import './TiledDisplayObject-2082c8d9.js';
import './DisplayObject-f25c6d04.js';
import './TileKey-97254206.js';
import './I3SBinaryReader-1f7e5bc9.js';
import './Query-1f6c7e43.js';
import './TimeExtent-66b53603.js';
import './GoTo-929e809f.js';
import './Feature-d7b2670c.js';
import './executeQueryJSON-cbafa4d9.js';
import './query-993c240b.js';
import './normalizeUtils-d37dc597.js';
import './pbfQueryUtils-266d53dd.js';
import './pbf-bac0c6a4.js';
import './queryZScale-127601ac.js';
import './FeatureSet-1b85367a.js';
import './TopFeaturesQuery-babc7c57.js';
import './utils-112c7fa0.js';
import './jsonUtils-e7c7add9.js';
import './DictionaryLoader-d0d1b4ff.js';
import './LRUCache-5f25d277.js';
import './heatmapUtils-d302cc7f.js';
import './widget-a58988b6.js';
import './vmEvent-c5708c9c.js';
import './themeUtils-b1f4a2e4.js';
import './languageUtils-d37e9fbb.js';
import './number-3228daf9.js';
import './FeatureLayer-6922c890.js';
import './MultiOriginJSONSupport-281c1c62.js';
import './sql-817bbae7.js';
import './Layer-569a1fc8.js';
import './APIKeyMixin-04df9c0f.js';
import './ArcGISService-848d76dd.js';
import './arcgisLayerUrl-a268a370.js';
import './BlendLayer-7884099a.js';
import './CustomParametersMixin-f702935f.js';
import './labelingInfo-6e0c44d1.js';
import './LabelClass-936eaa93.js';
import './defaultsJSON-5fb6161d.js';
import './OperationalLayer-e04486e0.js';
import './OrderedLayer-d02e1d58.js';
import './PortalLayer-e61e1a42.js';
import './PortalItem-fa114dd2.js';
import './ScaleRangeLayer-f9a9951f.js';
import './TemporalLayer-6cfc496a.js';
import './TimeInfo-0c128ef4.js';
import './FeatureType-691faa46.js';
import './fieldProperties-fa42dff4.js';
import './FieldsIndex-ea481e79.js';
import './LayerFloorInfo-b83a3647.js';
import './versionUtils-55e187fe.js';
import './styleUtils-106413c0.js';
import './popupUtils-883a107f.js';
import './symbolUtils-7f5a2832.js';
import './colorUtils-e0bbe79f.js';
import './mat2d-677a80fe.js';
import './Map-3fa127ca.js';
import './Basemap-bccaf827.js';
import './loadAll-0acccebb.js';
import './writeUtils-ab23132f.js';
import './TablesMixin-6752cfb1.js';
import './heightModelInfoUtils-4737da37.js';
import './capabilities-cb32c85a.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let s$2=class extends y$1{constructor(o){super(o),this.innerWidth=2,this.outerWidth=8,this.visibleInnerColor=new l$1([3,252,111,1]),this.visibleOuterColor=new l$1([3,252,111,.15]),this.occludedInnerColor=new l$1([252,3,69,1]),this.occludedOuterColor=new l$1([252,3,69,.1]),this.undefinedInnerColor=new l$1([255,255,255,1]),this.undefinedOuterColor=new l$1([127,127,127,.2]);}};e([d$1({type:Number})],s$2.prototype,"innerWidth",void 0),e([d$1({type:Number})],s$2.prototype,"outerWidth",void 0),e([d$1({type:l$1})],s$2.prototype,"visibleInnerColor",void 0),e([d$1({type:l$1})],s$2.prototype,"visibleOuterColor",void 0),e([d$1({type:l$1})],s$2.prototype,"occludedInnerColor",void 0),e([d$1({type:l$1})],s$2.prototype,"occludedOuterColor",void 0),e([d$1({type:l$1})],s$2.prototype,"undefinedInnerColor",void 0),e([d$1({type:l$1})],s$2.prototype,"undefinedOuterColor",void 0),s$2=e([n$4("esri.views.3d.analysis.LineOfSight.LineOfSightConfiguration")],s$2);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let s$1=class extends y$1{constructor(o){super(o),this.target=null,this.intersectedGraphic=null,this.intersectedLocation=null,this.elevationAlignedTargetLocation=null,this.visible=void 0;}};e([d$1()],s$1.prototype,"target",void 0),e([d$1()],s$1.prototype,"intersectedGraphic",void 0),e([d$1()],s$1.prototype,"intersectedLocation",void 0),e([d$1()],s$1.prototype,"elevationAlignedTargetLocation",void 0),e([d$1({type:Boolean})],s$1.prototype,"visible",void 0),s$1=e([n$4("esri.views.3d.analysis.LineOfSightAnalysisResult")],s$1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let i=class extends y$1{constructor(t){super(t),this.elevationAlignedTargetLocation=null,this.inputPoints={isValid:!1,observer:n$5(),observerSurfaceNormal:null,observerFeatureId:null,target:n$5(),targetSurfaceNormal:null,targetFeatureId:null,observerAdjusted:n$5(),targetAdjusted:n$5()},this.computationResult={start:n$5(),end:n$5(),intersection:n$5(),isValid:!1,isTargetVisible:!1},this.result=null;}notifyResultChanged(){this.notifyChange("computationResult");}notifyInputPointsChanged(){this.notifyChange("inputPoints");}};e([d$1()],i.prototype,"target",void 0),e([d$1()],i.prototype,"elevationAlignedTargetLocation",void 0),e([d$1()],i.prototype,"inputPoints",void 0),e([d$1()],i.prototype,"computationResult",void 0),e([d$1()],i.prototype,"result",void 0),i=e([n$4("esri.views.3d.analysis.LineOfSight.LineOfSightComputation")],i);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var a;let n$3=a=class extends y$1{constructor(r){super(r);}clone(){return new a({type:this.type,id:m$1(this.id),point:m$1(this.point),normal:m$1(this.normal),ray:m$1(this.ray),graphic:this.graphic})}equals(r){return this.type===r.type&&this.id===r.id&&w(this.point,r.point)&&i$1(this.normal,r.normal)&&m$2(this.ray,r.ray)&&this.graphic===r.graphic}};e([d$1()],n$3.prototype,"type",void 0),e([d$1({constructOnly:!0})],n$3.prototype,"id",void 0),e([d$1({constructOnly:!0})],n$3.prototype,"point",void 0),e([d$1({constructOnly:!0})],n$3.prototype,"normal",void 0),e([d$1({constructOnly:!0})],n$3.prototype,"graphic",void 0),e([d$1({constructOnly:!0})],n$3.prototype,"ray",void 0),n$3=a=e([n$4("esri.views.3d.analysis.LineOfSight.LineOfSightIntersectionResult")],n$3);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let O$1=class extends y$1{constructor(e){super(e),this._terrainIntersectionOptionsLayerUids=new Set(["terrain"]);}initialize(){this.intersector=x$1(this.view.state.viewingMode),this.intersector.options.hud=!1,this.intersector.options.store=t$1.MIN;}getScreenPointIntersection(e){const r=d$2(e,t$2.get()),t=s$3(this.view.state.camera,r,M);return this._getRayIntersection(t)}_getRayIntersection(e,r$2){if(t$3(e)||t$3(this.view.sceneIntersectionHelper))return null;this.intersector.options.store=t$1.MIN,this.view.sceneIntersectionHelper.intersectToolIntersectorRay(e,this.intersector,r$2);const o=this.intersector.results.min;if(!o.getIntersectionPoint(H$1))return null;const i=this.view.renderCoordsHelper.fromRenderCoords(H$1,this.view.spatialReference),n=e$1(o.normal);if(n$6(o))return new n$3({type:i$2.OBJECT,id:`${o.target.layerUid}/${o.target.nodeIndex}/${o.target.componentIndex}`,point:i,normal:n,ray:l$2(e),graphic:null});if(r(o))return new n$3({type:i$2.TERRAIN,id:o.target.lij.slice(),point:i,normal:n,ray:l$2(e),graphic:null});const c=d$3(o,this.view);if(r$1(c)){const r=c.layer,t=c.sourceLayer;let s;if(t)if("scene"===t.type)s=O$2(c,t.objectIdField);else s=c.uid;else s=c.uid;return new n$3({type:i$2.OBJECT,id:`${r.uid}/${s}`,point:i,normal:n,ray:l$2(e),graphic:c})}return null}updateFromGroundIntersection(e,r,t){const o=H$1,i=L,n=T,m=_$1,u=x;r$2(i,e),this.view.renderCoordsHelper.worldUpAtPosition(i,n),z(n,n);const h=this.view.basemapTerrain.elevationBounds,f=this.view.renderCoordsHelper.getAltitude(i),g=h?Math.abs(h.max-h.min):100,I=f>0?1:-1;q(m,n,I*(g+Math.abs(r))),u$1(o,i,m),p$1(o,i,M);const j=this._getRayIntersection(M,{include:this._terrainIntersectionOptionsLayerUids});return r$1(j)&&r$1(j.point)?(this.view.renderCoordsHelper.toRenderCoords(j.point,u),q(m,n,I*r),u$1(t,u,m),t$4(j.normal)):(r$2(t,e),null)}};e([d$1()],O$1.prototype,"view",void 0),e([d$1()],O$1.prototype,"intersector",void 0),O$1=e([n$4("esri.views.3d.analysis.LineOfSight.LineOfSightRayIntersector")],O$1);const H$1=n$5(),L=n$5(),T=n$5(),_$1=n$5(),x=n$5(),M=d$4();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const X=s$4.getLogger("esri.views.3d.analysis.LineOfSight.LineOfSightController");let Y=class extends(n$7.EventedMixin(y$1)){constructor(e){super(e),this.updateOnCameraChange=!0,this._effectiveObserverElevationMode="absolute-height",this._observerFeatureId=null,this._updatingHandles=new c,this._frameTask=Q,this._handles=new u$2,this._computationHandles=new u$2,this._externalObserverUpdate=!0;}initialize(){const e=this.view.resourceController?.scheduler;this._frameTask=e?e.registerTask(L$1.LINE_OF_SIGHT_TOOL):Q,this._intersector=new O$1({view:this.view}),this._handles.add([this._connectObserver(),this._connectComputations(),this._connectTargets()]);}destroy(){this._handles.destroy(),this._computationHandles.destroy(),this._computations.removeAll(),this._updatingHandles.destroy();}get updating(){return this._frameTask.updating||this._updatingHandles.updating}get priority(){return this._frameTask.priority}set priority(e){this._frameTask.priority=e;}get _computations(){return this.analysisViewData.computations}get _elevationAlignedObserverPositionRenderSpace(){return this.analysisViewData.observerEngineLocation}set _elevationAlignedObserverPositionRenderSpace(e){this.analysisViewData.observerEngineLocation=e;}get _screenPixelSize(){return this.view.state.camera.computeScreenPixelSizeAt(this._elevationAlignedObserverPositionRenderSpace)}getLineOfSightComputationDependencies(e){const{inputPoints:t}=e;return {inputPoints:t}}_computeResult(e){const t=e.computation,{inputPoints:o,computationResult:i}=t,{observerAdjusted:n,targetAdjusted:r}=o,{start:s,end:a}=i;r$2(s,n),r$2(a,r);this._canCompute(t)?this._computeIntersection(e):this._interpolateIntersection(e),t.notifyResultChanged(),this.emit("result-changed",{target:e.computation.target,result:t.result});}_updateAdjustedPointsFromFeatures(e){const o=this.view,{sceneIntersectionHelper:i}=o,{inputPoints:n}=e,{observerAdjusted:r,observerFeatureId:s,targetFeatureId:a,targetAdjusted:c}=n;if(t$3(s)&&t$3(a))return;const p=x$2(r,c),d=this._intersector.intersector,h=p$1(n.observer,n.target,te);d.options.store=t$1.ALL,i.intersectToolIntersectorRay(h,d);let g=null,v=null,m=null,f=null;for(const _ of d.results.all){const e=d$3(_,this.view);if(t$3(e)||t$3(_.distanceInRenderSpace))continue;const i=l$3(e);t$3(i)||(r$1(s)&&i===s&&(t$3(g)&&(g=this._getFeatureDistanceThreshold(_,o,p)),_.distanceInRenderSpace<g&&(m=_)),r$1(a)&&i===a&&(t$3(v)&&(v=this._getFeatureDistanceThreshold(_,o,p)),t$3(f)&&_.distanceInRenderSpace<p&&p-_.distanceInRenderSpace<v&&(f=_)));}r$1(m)&&m.getIntersectionPoint(r)&&(n.observerSurfaceNormal=m.getTransformedNormal(n$5())),r$1(f)&&f.getIntersectionPoint(c)&&(n.targetSurfaceNormal=f.getTransformedNormal(n$5()));}_getFeatureDistanceThreshold(e,t,o){if(w$1(e)){const i=V$1(e,t);if(r$1(i))return Math.min(i*ie,o)}return 1e-5*o}_adjustStartEndPositions(e){const t=this._screenPixelSize,o=this.view,{inputPoints:i}=e,{observer:n,observerSurfaceNormal:r,target:s,targetSurfaceNormal:a,observerAdjusted:c,targetAdjusted:l}=i,p=ee;r$2(c,n),r$2(l,s),this._updateAdjustedPointsFromFeatures(e),r$1(r)?r$2(p,r):e$2(p,l,c);const d=t;z(p,p),q(p,p,Math.min(d,1)),u$1(c,c,p),r$1(a)?r$2(p,a):e$2(p,c,l);const h=o.state.camera.computeScreenPixelSizeAt(l);z(p,p),q(p,p,Math.min(h,1)),u$1(l,l,p);}_computeIntersection({computation:e,interpolationInfo:t}){const{view:o}=this,{sceneIntersectionHelper:i,renderCoordsHelper:n}=o;if(t$3(i))return;const r=this._intersector.intersector,{computationResult:s,inputPoints:a}=e,{observer:c,target:p}=a,{start:d,end:h}=s,g=p$1(d,h,te);r.options.store=t$1.MIN,i.intersectToolIntersectorRay(g,r);const v=r.results.min,m=s.intersection,f=ee;let _=!0;if(r$1(v)&&v.getIntersectionPoint(m)){r$2(t.originalIntersection,m),r$2(t.originalObserver,d),r$2(t.originalTarget,h),n.fromRenderCoords(m,f,o.spatialReference);const e=1-U(h,p)/U(d,p);_=U(c,m)>=e*U(c,p);}const b=new j$1(f,o.spatialReference);{const{result:t,target:i}=e;r$1(t)?(t.target=i,t.intersectedGraphic=_?null:d$3(v,o),t.intersectedLocation=_?null:b,t.visible=_):e.result=new s$1({target:i,elevationAlignedTargetLocation:e.elevationAlignedTargetLocation,intersectedGraphic:_?null:d$3(v,o),intersectedLocation:_?null:b,visible:_});}s.isValid=a.isValid=!0,s.isTargetVisible=_;}_interpolateIntersection({computation:e,interpolationInfo:t}){const{computationResult:o,inputPoints:i}=e,{start:n,end:r,intersection:s}=o,{originalIntersection:a,originalObserver:c,originalTarget:l}=t;if(r$2(s,a),i.isValid){const e=ee,t=U(c,a)/U(c,l);J(e,n,c),q(e,e,1-t),u$1(s,s,e),J(e,r,l),q(e,e,t),u$1(s,s,e),o.isValid=!0;}else e.result=null,o.isValid=!1,o.isTargetVisible=!1;}_canCompute(e){const t=this.analysisViewData.elevationAlignedObserver,o=this.view.frustum;if(t$3(t)||t$3(e.elevationAlignedTargetLocation)||t$3(o))return !1;const{observerAdjusted:i,targetAdjusted:n}=e.inputPoints,r=o.intersectsPoint(i),s=o.intersectsPoint(n);return r&&s}_onObserverPositionChange(e,o,i,n,r){if(this._externalObserverUpdate=r,t$3(e))return this.analysisViewData.elevationAlignedObserver=null,void(this._observerFeatureId=null);if(t$3(o))return a$1(this.analysis,e.spatialReference,X),void(this.analysisViewData.elevationAlignedObserver=null);const s=this._getEffectiveElevationInfo(o,i),{absoluteZ:a,elevation:c}=d$5(o.x,o.y,o.z,this.view.spatialReference,this.view,s),u=o.clone();u.z=a,this._effectiveObserverElevationMode=s.mode,this.analysisViewData.elevationAlignedObserver=u;const p=n$5();this.view.renderCoordsHelper.toRenderCoords(u,p),this._elevationAlignedObserverPositionRenderSpace=p,this._observerGroundOffsetRenderSpace=a-c,this._observerFeatureId=l$3(n),this.priority=L$1.LINE_OF_SIGHT_TOOL_INTERACTIVE;}_onObserverRenderSpacePositionChangeForComputation(e,t,o,i,n){const{inputPoints:r}=e;switch(r$2(r.observer,t),r.observerFeatureId=n,r.observerSurfaceNormal=null,i){case"on-the-ground":case"relative-to-ground":{const e=this._intersector.updateFromGroundIntersection(r.observer,o,r.observer);t$3(r.observerFeatureId)&&(r.observerSurfaceNormal=e);}}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=L$1.LINE_OF_SIGHT_TOOL_INTERACTIVE;}_onTargetPositionChange(e,o,i,n,r,s=!0){const a=e.inputPoints;if(s&&(a.isValid=!1),t$3(i))return r$1(o)&&a$1(this.analysis,o.spatialReference,X),e.elevationAlignedTargetLocation=null,void e.notifyInputPointsChanged();const c=this._getEffectiveElevationInfo(i,n),{absoluteZ:p,elevation:d}=d$5(i.x,i.y,i.z,this.view.spatialReference,this.view,c),h=i.clone();switch(h.z=p,e.elevationAlignedTargetLocation=h,this.view.renderCoordsHelper.toRenderCoords(e.elevationAlignedTargetLocation,a.target),a.targetFeatureId=l$3(r),a.targetSurfaceNormal=null,c.mode){case"on-the-ground":case"relative-to-ground":{const e=this._intersector.updateFromGroundIntersection(a.target,p-d,a.target);t$3(a.targetFeatureId)&&(a.targetSurfaceNormal=e);}}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=L$1.LINE_OF_SIGHT_TOOL_INTERACTIVE;}_connectComputationToTarget(e){return r$3([l$4((()=>({computation:e,targetPosition:e.target.position,targetElevationInfo:e.target.elevationInfo,targetFeatureInfo:e.target.feature,projectedTargetPosition:un(e.target.position,this.view.spatialReference)})),(({computation:e,targetPosition:t,targetElevationInfo:o,targetFeatureInfo:i,projectedTargetPosition:n})=>{r$1(n.pending)?this._updatingHandles.addPromise(n.pending):this._onTargetPositionChange(e,t,n.geometry,o,i);}),w$2)])}_connectComputationToObserver(e){return l$4((()=>({computation:e,observer:this.analysisViewData.elevationAlignedObserver})),(({computation:e})=>{this._externalObserverUpdate&&(e.inputPoints.isValid=!1,e.notifyInputPointsChanged());}),w$2)}_connectComputationToRenderSpaceObserver(e){return l$4((()=>({computation:e,observer:this._elevationAlignedObserverPositionRenderSpace,observerGroundOffset:this._observerGroundOffsetRenderSpace,observerElevationMode:this._effectiveObserverElevationMode,observerFeatureId:this._observerFeatureId})),(({computation:e,observer:t,observerGroundOffset:o,observerElevationMode:i,observerFeatureId:n})=>{this._onObserverRenderSpacePositionChangeForComputation(e,t,o,i,n);}),w$2)}_connectComputationToCamera(e){return l$4((()=>({camera:this.view.state.camera,isDirty:this._isCameraDirty})),(({isDirty:t})=>{!this.updateOnCameraChange||e.inputPoints.isValid&&!t||e.notifyInputPointsChanged();}),U$1)}_connectComputationToSlicePlane(e){return l$4((()=>this.view.slicePlane),(()=>{e.inputPoints.isValid=!1,e.notifyInputPointsChanged();}))}_connectComputationToElevation(e){const t=(o,i)=>{const n=this.analysis.observer,r=e.target;let s=null,a=null,c=null,p=null,d=null,h=null;if(r$1(n)&&r$1(n.position)){const e=un(n.position,this.view.spatialReference);if(r$1(e.pending))return this._updatingHandles.addPromise(e.pending),void e.pending.finally((()=>t(o,i)));s=e.geometry,a=n.elevationInfo,c=n.feature;}if(r$1(r.position)){const e=un(r.position,this.view.spatialReference);if(r$1(e.pending))return this._updatingHandles.addPromise(e.pending),void e.pending.finally((()=>t(o,i)));p=e.geometry,d=r.elevationInfo,h=r.feature;}t$3(s)&&t$3(p)||(zn(o,i,oe,this.view.spatialReference),r$1(s)&&F(oe,s)&&this._onObserverPositionChange(r$1(n)?n.position:null,s,a,c,!1),r$1(p)&&F(oe,p)&&this._onTargetPositionChange(e,r.position,p,d,h,!1),r$1(s)&&r$1(p)&&j$2(oe,s,p)&&e.notifyInputPointsChanged());};return this.view.elevationProvider.on("elevation-change",(e=>t(e.extent,e.spatialReference)))}_connectComputationToTask(e){let t=n$8;const o={computation:e,interpolationInfo:{originalIntersection:n$5(),originalObserver:n$5(),originalTarget:n$5()}};return r$3([l$4((()=>this.getLineOfSightComputationDependencies(e)),(()=>{t=h(t),t=O$3((async e=>{await j$3(this._frameTask.schedule((()=>this._computeResult(o)),e));}));}),{sync:!0,initial:!0,equals:d$6}),n$9((()=>t=h(t)))])}_connectComputation(e){const t=this._computationHandles;t.has(e)||t.add([this._connectComputationToTarget(e),this._connectComputationToObserver(e),this._connectComputationToRenderSpaceObserver(e),this._connectComputationToCamera(e),this._connectComputationToSlicePlane(e),this._connectComputationToElevation(e),this._connectComputationToTask(e)],e);}_disconnectComputation(e){this._computationHandles.remove(e);}_onComputationCollectionChange({added:e,removed:t}){for(const o of t)this._disconnectComputation(o);for(const o of e)this._connectComputation(o);}_onTargetCollectionChange({added:e,removed:t}){for(const o of t)this._removeTarget(o);for(const o of e)this._addTarget(o);}_onCursorTargetChange(e,t){r$1(t)&&this._removeTarget(t),r$1(e)&&this._addTarget(e);}_addTarget(e){this._computations.some((t=>t.target===e))||this._computations.add(new i({target:e}));}_removeTarget(e){const t=this._computations.findIndex((t=>t.target===e));this._computations.removeAt(t);}_connectObserver(){return r$3([l$4((()=>({observerPosition:r$1(this.analysis.observer)?this.analysis.observer.position:null,projectedObserverPosition:un(r$1(this.analysis.observer)?this.analysis.observer.position:null,this.view.spatialReference),observerElevationInfo:r$1(this.analysis.observer)?this.analysis.observer.elevationInfo:null,observerFeatureInfo:r$1(this.analysis.observer)?this.analysis.observer.feature:null})),(({observerPosition:e,projectedObserverPosition:t,observerElevationInfo:o,observerFeatureInfo:i})=>{r$1(t.pending)?this._updatingHandles.addPromise(t.pending):this._onObserverPositionChange(e,t.geometry,o,i,!0);}),w$2)])}_connectComputations(){return a$2((()=>this._computations),"change",(e=>this._onComputationCollectionChange(e)),{onListenerAdd:e=>{for(const t of e)this._connectComputation(t);},onListenerRemove:e=>{for(const t of e)this._disconnectComputation(t);},sync:!0})}_connectTargets(){return r$3([this._updatingHandles.addOnCollectionChange((()=>this.analysis.targets),(e=>this._onTargetCollectionChange(e)),{initial:!0,final:!0}),l$4((()=>this.analysisViewData.cursorTarget),((e,t)=>{this._onCursorTargetChange(e,t);}))])}get _isCameraDirty(){const e=this.analysisViewData.elevationAlignedObserver,{view:t}=this,{renderCoordsHelper:o}=t;if(t$3(e)||t$3(o))return !1;const i=ee;o.toRenderCoords(e,i);const n=t.state.camera.computeScreenPixelSizeAt(i);return Math.abs((n-this._screenPixelSize)/this._screenPixelSize)>$}_getEffectiveElevationInfo(e,t){return e.hasZ?c$1(t,{mode:"absolute-height",offset:0}):{mode:"on-the-ground",offset:0}}};e([d$1({constructOnly:!0})],Y.prototype,"analysis",void 0),e([d$1({constructOnly:!0})],Y.prototype,"analysisViewData",void 0),e([d$1({constructOnly:!0})],Y.prototype,"view",void 0),e([d$1()],Y.prototype,"updating",null),e([d$1()],Y.prototype,"priority",null),e([d$1()],Y.prototype,"updateOnCameraChange",void 0),e([d$1()],Y.prototype,"_computations",null),e([d$1()],Y.prototype,"_elevationAlignedObserverPositionRenderSpace",null),e([d$1()],Y.prototype,"_observerGroundOffsetRenderSpace",void 0),e([d$1()],Y.prototype,"_effectiveObserverElevationMode",void 0),e([d$1()],Y.prototype,"_observerFeatureId",void 0),e([d$1()],Y.prototype,"_screenPixelSize",null),e([d$1({readOnly:!0})],Y.prototype,"_updatingHandles",void 0),e([d$1()],Y.prototype,"_frameTask",void 0),e([d$1()],Y.prototype,"_isCameraDirty",null),Y=e([n$4("esri.views.3d.analysis.LineOfSight.LineOfSightController")],Y);const $=.1,ee=n$5(),te=d$4(),oe=D(),ie=.05;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let s=class extends y$1{constructor(e){super(e),this.enabled=!0,this.glowColor=new l$1([255,127,0]),this.glowWidth=8,this.innerColor=new l$1([255,255,255]),this.innerWidth=.75,this.globalAlpha=.75;}};e([d$1({type:Boolean})],s.prototype,"enabled",void 0),e([d$1({type:l$1})],s.prototype,"glowColor",void 0),e([d$1({type:Number})],s.prototype,"glowWidth",void 0),e([d$1({type:l$1})],s.prototype,"innerColor",void 0),e([d$1({type:Number})],s.prototype,"innerWidth",void 0),e([d$1({type:Number})],s.prototype,"globalAlpha",void 0),s=e([n$4("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightLaserLineConfiguration")],s);let p=class extends y$1{constructor(e){super(e),this.size=.5,this.color=new l$1([255,127,0,.75]);}};e([d$1({type:Number})],p.prototype,"size",void 0),e([d$1({type:l$1})],p.prototype,"color",void 0),p=e([n$4("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightObserverConfiguration")],p);let n$2=class extends y$1{constructor(e){super(e),this.size=.5,this.visibleColor=new l$1([3,252,111,.75]),this.occludedColor=new l$1([252,3,69,.75]),this.undefinedColor=new l$1([127,127,127,.75]);}};e([d$1({type:Number})],n$2.prototype,"size",void 0),e([d$1({type:l$1})],n$2.prototype,"visibleColor",void 0),e([d$1({type:l$1})],n$2.prototype,"occludedColor",void 0),e([d$1({type:l$1})],n$2.prototype,"undefinedColor",void 0),n$2=e([n$4("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTargetConfiguration")],n$2);class l extends y$1{constructor(e){super(e),this.innerWidth=2,this.outerWidth=8,this.visibleInnerColor=new l$1([3,252,111,1]),this.visibleOuterColor=new l$1([3,252,111,.15]),this.occludedInnerColor=new l$1([252,3,69,1]),this.occludedOuterColor=new l$1([252,3,69,.1]),this.undefinedInnerColor=new l$1([255,255,255,1]),this.undefinedOuterColor=new l$1([127,127,127,.2]);}}e([d$1({type:Number})],l.prototype,"innerWidth",void 0),e([d$1({type:Number})],l.prototype,"outerWidth",void 0),e([d$1({type:l$1})],l.prototype,"visibleInnerColor",void 0),e([d$1({type:l$1})],l.prototype,"visibleOuterColor",void 0),e([d$1({type:l$1})],l.prototype,"occludedInnerColor",void 0),e([d$1({type:l$1})],l.prototype,"occludedOuterColor",void 0),e([d$1({type:l$1})],l.prototype,"undefinedInnerColor",void 0),e([d$1({type:l$1})],l.prototype,"undefinedOuterColor",void 0);let d=class extends y$1{constructor(e){super(e),this.laserLine=new s,this.observer=new p,this.target=new n$2,this.lineOfSight=new l;}};e([d$1({type:s})],d.prototype,"laserLine",void 0),e([d$1({type:p})],d.prototype,"observer",void 0),e([d$1({type:n$2})],d.prototype,"target",void 0),e([d$1({type:l})],d.prototype,"lineOfSight",void 0),d=e([n$4("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightToolConfiguration")],d);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function t(o,t=u$3(o)){return "on-the-ground"!==t.mode&&!(t$3(o.geometry)||!o.geometry.hasZ)}function n$1(e,r){let t=null;const n=e.events.on("grab-changed",(n=>{r$1(t)&&(t.remove(),t=null),"start"===n.action?(t=e.disableDisplay(),r&&r(n)):r&&r(n);}));return {remove(){r$1(t)&&t.remove(),n.remove();}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function m(t,r,s){return {geometry:T$1.createSphereGeometry(t,32,32),material:w$3(l$1.toUnitRGBA(r)),stateMask:s}}function n(o){const t=[];return o.customColor1&&t.push(m(o.size,o.customColor1,u$4.Custom1)),o.customColor2&&t.push(m(o.size,o.customColor2,u$4.Custom2)),o.customColor3&&t.push(m(o.size,o.customColor3,u$4.Custom3)),o.color&&t.push(m(o.size,o.color)),t}function u(o,e){const i=n(e),s=new te$1({view:o,renderObjects:i,elevationInfo:{mode:"absolute-height",offset:0}});return n$1(s),s}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var R;!function(e){e.Ready="ready",e.Creating="creating",e.Created="created";}(R||(R={}));const j=j$4.ofType(f$1),P=s$4.getLogger("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTool");let H=class extends a$3{constructor(e){super(e),this.preferManipulatorCursor=!0,this.removeIncompleteOnCancel=!1,this.configuration=new d,this.analysisViewData=null,this._laserlineVisualElement=null,this._grabbedManipulator=null,this._analysisHandles=new u$2,this._handles=new u$2,this._manipulatorHandles=new u$2,this._targetTrackerManipulator=null;}initialize(){this._intersector=new O$1({view:this.view}),this._handles.add(l$4((()=>this.state),(e=>{e===R.Created&&this.finishToolCreation();}),w$2)),this._observerManipulator=this._createObserverManipulator(),this._handles.add([l$4((()=>({...this.configuration.observer})),(()=>this._updateObserverManipulatorStyle()),U$1),l$4((()=>this.analysisViewData.elevationAlignedObserver),(e=>this._onObserverLocationChange(e)),w$2),l$4((()=>({...this.configuration.laserLine})),(()=>this._createVisualElements()),w$2),l$4((()=>this._laserLineRendererDependencies()),(e=>this._updateLaserLineRenderer(e))),this._connectComputations()]);}destroy(){this._handles=l$5(this._handles),this._manipulatorHandles=l$5(this._manipulatorHandles),this._analysisHandles=l$5(this._analysisHandles),this._observerManipulator=null,this._clearCursorTracker(),this._removeVisualElements(),this._intersector=null,this._set("analysis",null);}get state(){return this.active?r$1(this._grabbedManipulator)?R.Created:R.Creating:r$1(this.analysis.observer)&&r$1(this.analysis.observer.position)?R.Created:R.Ready}get cursor(){return this.active&&this._showTracker?"crosshair":null}get updating(){return !!r$1(this.analysisViewData)&&this.analysisViewData.updating}get _showTracker(){return this.active&&"mouse"===this._latestPointerMovePointerType}get _shouldRenderTracker(){return this._showTracker&&r$1(this.analysis.observer)&&r$1(this.analysis.observer.position)&&!this.hasFocusedManipulators}continue(){this.view.activeTool=this;}stop(){this.view.activeTool=null;}onEditableChange(){this.analysisViewData.editable=this.internallyEditable;}onInputEvent(e){switch(e.type){case"immediate-double-click":this._doubleClickHandler(e);break;case"key-down":this._keyDownHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);}}onInputEventAfter(e){if("immediate-click"===e.type)this._clickHandler(e);}onShow(){}onHide(){this._grabbedManipulator=null;}onDeactivate(){this._clearCursorTracker();}_connectComputations(){return a$2((()=>this.analysisViewData.computations),"change",(e=>this._onComputationsCollectionChange(e)),{onListenerAdd:e=>{for(const t of e)this._connectComputation(t);},onListenerRemove:e=>{for(const t of e)this._disconnectComputation(t);},sync:!0})}_onComputationsCollectionChange({added:e,removed:t}){for(const i of t)this._disconnectComputation(i);for(const i of e)this._connectComputation(i);}_connectComputation(e){if(this.destroyed)return void P.warn("Attempting to connect an analysis to a destroyed LineOfSight tool. Ignoring.");const t=this._analysisHandles;if(t.has(e))return;const i=this._createTargetManipulator(e.target);t$3(this._targetTrackerManipulator)&&i.metadata.target===this.analysisViewData.cursorTarget&&(this._targetTrackerManipulator=i,this._targetTrackerManipulator.available=!1,this._targetTrackerManipulator.interactive=!1,this._updateLaserLineRenderer()),t.add([l$4((()=>this._getLineOfSightManipulatorStateDependencies(e)),(()=>this._updateManipulatorState(i,e)),w$2),l$4((()=>e.elevationAlignedTargetLocation),(e=>this._onTargetLocationChange(e,i)),w$2)],e);}_disconnectComputation(e){if(this.destroyed)return void P.warn("Attempting to disconnect an analysis from a destroyed LineOfSight tool. Ignoring.");this._analysisHandles.remove(e);const t=this._getTargetManipulator(e.target);r$1(t)&&(this.manipulators.remove(t),this._manipulatorHandles.remove(t),r$1(this._targetTrackerManipulator)&&this._targetTrackerManipulator===t&&(this._targetTrackerManipulator=null));}_clearCursorTracker(){this.analysisViewData.cursorTarget=l$5(this.analysisViewData.cursorTarget);}_createManipulator(e,t,i){const r=u(this.view,e);return r.metadata=i,this._manipulatorHandles.add([t(r),r.events.on("grab-changed",(e=>this._manipulatorGrabChanged(r,e))),r.events.on("immediate-click",(e=>this._manipulatorClick(r,e)))],r),this.manipulators.add(r),r}_createTargetManipulator(e){const t=this.configuration,i={size:t.target.size,customColor1:t.target.visibleColor,customColor2:t.target.occludedColor,customColor3:t.target.undefinedColor,visible:!0},r={target:e,type:"target"},a=this._createManipulator(i,(e=>this._createTargetManipulatorDragPipeline(e)),r);return r$1(e.position)?a.elevationAlignedLocation=e.position:a.available=!1,a}_getTargetManipulator(e){let t=null;return this.manipulators.forEach((i=>{const r=i.manipulator;t$3(t)&&"target"===r.metadata.type&&r.metadata.target===e&&(t=r);})),t}_createObserverManipulator(){const e=this.configuration,t={size:e.observer.size,color:e.observer.color,visible:!0};return this._createManipulator(t,(e=>this._createObserverManipulatorDragPipeline(e)),{type:"observer",intersection:null})}_updateObserverManipulatorStyle(){const e=this._observerManipulator,t=this.configuration.observer,i={size:t.size,color:t.color,visible:e.available};e.renderObjects=n(i);}_screenToIntersection(){return e=>{const t=this._intersector.getScreenPointIntersection(e.screenEnd);return t$3(t)?null:{...e,intersection:t}}}_createTargetManipulatorDragPipeline(e){return p$2(e,((t,i,r)=>{i.next(this._screenToIntersection()).next(this._updateTargetDragStep(e)).next((()=>this._updateLaserLineRenderer())),r.next(this._cancelTargetDragStep(e.metadata.target)).next((()=>this._updateLaserLineRenderer()));}))}_createObserverManipulatorDragPipeline(e){return p$2(e,((e,t,i)=>{t.next(this._screenToIntersection()).next(this._updateObserverDragStep()).next((()=>this._updateLaserLineRenderer())),i.next(this._cancelObserverDragStep()).next((()=>this._updateLaserLineRenderer()));}))}_updateObserverDragStep(){return e=>(r$1(e.intersection.point)?(t$3(this.analysis.observer)&&(this.analysis.observer=new u$5),this._updateFromIntersection(this.analysis.observer,e.intersection)):this.analysis.observer=null,e)}_cancelObserverDragStep(){const e=r$1(this.analysis.observer)&&r$1(this.analysis.observer.position)?this.analysis.observer.clone():null;return t=>(this.analysis.observer=e,t)}_updateTargetDragStep(e){return t=>{this._updateFromIntersection(e.metadata.target,t.intersection);const i=t.intersection.point;return r$1(i)&&(e.elevationAlignedLocation=i),t}}_cancelTargetDragStep(e){const t=o(e.position,(e=>e.clone()));return i=>(e.position=t,i)}_manipulatorGrabChanged(e,t){switch(t.action){case"start":this._grabbedManipulator=e;break;case"end":this._grabbedManipulator===e&&(this._grabbedManipulator=null);}}_updateManipulatorState(e,t){const{isValid:i,isTargetVisible:r}=t.computationResult;e.state=i?r?u$4.Custom1:u$4.Custom2:u$4.Custom3;}_getLineOfSightManipulatorStateDependencies(e){const{isValid:t,isTargetVisible:i}=e.computationResult;return {isValid:t,isTargetVisible:i}}_laserLineRendererDependencies(){return {laserlineVisualElement:this._laserlineVisualElement,grabbedManipulator:this._grabbedManipulator,shouldRenderTracker:this._shouldRenderTracker,observerPosition:r$1(this.analysis.observer)?this.analysis.observer.position:null,visible:this.visible}}_updateLaserLineRenderer(e=this._laserLineRendererDependencies()){const{laserlineVisualElement:t,grabbedManipulator:i,shouldRenderTracker:r,observerPosition:a,visible:n}=e;if(t$3(t))return;const s=r$1(i)?i:r&&r$1(a)?this._targetTrackerManipulator:null;this.configuration.laserLine.enabled&&r$1(s)&&n?(t.visible=!0,t.heightManifoldTarget=s.renderLocation,s!==this._observerManipulator?t.lineVerticalPlaneSegment=l$6(this._observerManipulator.renderLocation,s.renderLocation,A):t.lineVerticalPlaneSegment=null):(t.visible=!1,t.heightManifoldTarget=null,t.lineVerticalPlaneSegment=null);}_createVisualElements(){const e=this.configuration.laserLine;this._removeVisualElements(),this._laserlineVisualElement=new _$2({view:this.view,attached:!0,visible:this.visible,style:{glowColor:l$1.toUnitRGB(e.glowColor),glowWidth:e.glowWidth,innerColor:l$1.toUnitRGB(e.innerColor),innerWidth:e.innerWidth,globalAlpha:e.globalAlpha}});}_removeVisualElements(){r$1(this._laserlineVisualElement)&&(this._laserlineVisualElement.destroy(),this._laserlineVisualElement=null);}_onObserverLocationChange(e){t$3(e)?this._observerManipulator.available=!1:(this._observerManipulator.metadata.intersection=null,this._observerManipulator.available=!0,this._observerManipulator.elevationAlignedLocation=e);}_onTargetLocationChange(e,t){r$1(e)?(t.elevationAlignedLocation=e,t!==this._targetTrackerManipulator&&(t.available=!0)):t.available=!1;}_addPointFromClickEvent(e){const t=this._intersector.getScreenPointIntersection(e);if(!t$3(t)&&!t$3(t.point))if(r$1(this.analysis.observer)&&r$1(this.analysis.observer.position)){this._clearCursorTracker();const e=new f$1;this._updateFromIntersection(e,t),this.analysis.targets.add(e);}else {const e=new u$5;this._updateFromIntersection(e,t),this.analysis.observer=e;}}_clickHandler(e){this.active&&e.button!==t$5.Right&&(this._addPointFromClickEvent(n$a(e)),e.stopPropagation());}_doubleClickHandler(e){this.active&&e.button!==t$5.Right&&(this.stop(),e.stopPropagation());}_keyDownHandler(e){this.active&&"Escape"===e.key&&(this.stop(),e.stopPropagation());}_pointerMoveHandler(e){if(this.hasFocusedManipulators)return;if(this._latestPointerMovePointerType=e.pointerType,this._updateLaserLineRenderer(),!this._showTracker||t$3(this.analysis.observer)||t$3(this.analysis.observer.position))return;const t=n$a(e),i=this._intersector.getScreenPointIntersection(t);r$1(i)&&r$1(i.point)&&(t$3(this.analysisViewData.cursorTarget)&&(this.analysisViewData.cursorTarget=new f$1),this._updateFromIntersection(this.analysisViewData.cursorTarget,i),this._updateLaserLineRenderer());}_updateFromIntersection(e,t){if(t$3(t.point))return e.position=null,e.elevationInfo=null,void(e.feature=null);switch(t.type){case i$2.OBJECT:if(r$1(t.graphic)){const i=t.graphic,r=u$3(i);"on-the-ground"===r.mode&&(r.mode="relative-to-ground",r.offset=0),e.elevationInfo=new x$3(r),e.feature=i;}else e.elevationInfo=null,e.feature=null;break;case i$2.TERRAIN:case i$2.I3S:e.elevationInfo=new x$3({mode:"on-the-ground"}),e.feature=null;break;default:e.elevationInfo=null,e.feature=null;}const i=t.point.clone();i.z=f$2(this.view,i,{mode:"absolute-height",offset:0},e.elevationInfo),e.position=i;}_manipulatorClick(e,t){if("observer"===e.metadata.type||e.grabbing||e.dragging||t.button!==t$5.Right||this.analysis.targets.length<=1)return;const{target:i}=e.metadata;this.analysis.targets.remove(i),t.stopPropagation();}get testInfo(){return {laserLineVisualElement:this._laserlineVisualElement}}};e([d$1({constructOnly:!0})],H.prototype,"view",void 0),e([d$1({constructOnly:!0})],H.prototype,"analysis",void 0),e([d$1({readOnly:!0})],H.prototype,"state",null),e([d$1({readOnly:!0})],H.prototype,"cursor",null),e([d$1({readOnly:!0})],H.prototype,"preferManipulatorCursor",void 0),e([d$1()],H.prototype,"removeIncompleteOnCancel",void 0),e([d$1({readOnly:!0})],H.prototype,"updating",null),e([d$1({type:d})],H.prototype,"configuration",void 0),e([d$1({constructOnly:!0})],H.prototype,"analysisViewData",void 0),e([d$1({readOnly:!0})],H.prototype,"_showTracker",null),e([d$1()],H.prototype,"_latestPointerMovePointerType",void 0),e([d$1()],H.prototype,"_shouldRenderTracker",null),e([d$1()],H.prototype,"_laserlineVisualElement",void 0),e([d$1()],H.prototype,"_grabbedManipulator",void 0),H=e([n$4("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTool")],H);const A=v$1();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let V=class extends y$1{constructor(i){super(i),this._lineOfSightVisualizations=[],this._computationHandles=new u$2;}initialize(){this.own(this._connectComputations()),this._createObserverVisualization();}destroy(){this._computationHandles=l$5(this._computationHandles),this._observerVisualElement=l$5(this._observerVisualElement);}get visible(){return this.analysisViewData.visible}get interactiveAndEditable(){return this.analysisViewData.interactive&&this.analysisViewData.editable}get testInfo(){return {visualizations:this._lineOfSightVisualizations}}get _configuration(){return this.analysisViewData.configuration}_createLineOfSightVisualization(){const i=this._configuration,t=this.view,o={view:t,attached:!0,width:i.outerWidth,innerWidth:i.innerWidth},n=l$1.toUnitRGBA(i.visibleOuterColor),s=l$1.toUnitRGBA(i.visibleInnerColor),r=l$1.toUnitRGBA(i.occludedOuterColor),a=l$1.toUnitRGBA(i.occludedInnerColor),l=l$1.toUnitRGBA(i.undefinedOuterColor),c=l$1.toUnitRGBA(i.undefinedInnerColor),u={visibleLineVisualElement:new C$1({...o,color:n,innerColor:s}),occludedLineVisualElement:new C$1({...o,color:r,innerColor:a}),undefinedLineVisualElement:new C$1({...o,color:l,innerColor:c}),targetVisualElement:new S({view:t,attached:!0,..._,size:8})};return this._lineOfSightVisualizations.push(u),u}_destroyLineOfSightVisualization(i){i.visibleLineVisualElement=l$5(i.visibleLineVisualElement),i.occludedLineVisualElement=l$5(i.occludedLineVisualElement),i.undefinedLineVisualElement=l$5(i.undefinedLineVisualElement),i.targetVisualElement=l$5(i.targetVisualElement),this._lineOfSightVisualizations.splice(this._lineOfSightVisualizations.indexOf(i),1);}_updateLineOfSightVisualization(i,t,o){const n=this._configuration,{computationResult:s,inputPoints:r}=i,{start:l,end:c,intersection:u,isValid:d,isTargetVisible:m}=s,{observer:h}=r,f=O;f[12]=h[0],f[13]=h[1],f[14]=h[2];const g=e$2(y,l,h),b=e$2(C,c,h),V=e$2(E,u,h),{visibleLineVisualElement:_,occludedLineVisualElement:L,undefinedLineVisualElement:A,targetVisualElement:w}=t,z=t$3(this.analysisViewData.elevationAlignedObserver)||t$3(i.elevationAlignedTargetLocation),S=this.visible&&!z;_.visible=S,L.visible=S,A.visible=S,w.visible=S,w.attached=!o.interactiveAndEditable,S&&(_.geometry=null,L.geometry=null,A.geometry=null,w.geometry=i.elevationAlignedTargetLocation,d?m?(_.geometry=[[e$1(g),e$1(b)]],_.transform=f,_.color=l$1.toUnitRGBA(n.visibleOuterColor),w.color=l$1.toUnitRGBA(n.visibleInnerColor)):(_.geometry=[[e$1(g),e$1(V)]],_.transform=f,_.color=l$1.toUnitRGBA(n.occludedOuterColor),L.geometry=[[e$1(V),e$1(b)]],L.transform=f,w.color=l$1.toUnitRGBA(n.occludedInnerColor)):(A.geometry=[[e$1(g),e$1(b)]],A.transform=f,w.color=l$1.toUnitRGBA(n.undefinedInnerColor)));}_getLineOfSightVisualizationDependencies(i){const{computationResult:e}=i,{occludedOuterColor:t,visibleOuterColor:o}=this._configuration;return {computationResult:e,occludedOuterColor:t,visibleOuterColor:o,visible:this.visible,interactiveAndEditable:this.interactiveAndEditable}}_connectComputation(i){const e=this._computationHandles;if(e.has(i))return;const t=this._createLineOfSightVisualization();e.add([l$4((()=>this._getLineOfSightVisualizationDependencies(i)),(e=>this._updateLineOfSightVisualization(i,t,e)),{sync:!0,initial:!0,equals:d$6}),n$9((()=>this._destroyLineOfSightVisualization(t)))],i);}_disconnectComputation(i){this._computationHandles.remove(i);}_connectComputations(){return a$2((()=>this.analysisViewData.computations),"change",(i=>this._onComputationsCollectionChange(i)),{sync:!0,onListenerAdd:i=>{for(const e of i)this._connectComputation(e);},onListenerRemove:i=>{for(const e of i)this._disconnectComputation(e);}})}_onComputationsCollectionChange({added:i,removed:e}){for(const t of e)this._disconnectComputation(t);for(const t of i)this._connectComputation(t);}_createObserverVisualization(){const i=l$1.toUnitRGBA(this._configuration.visibleInnerColor),t=new S({view:this.view,attached:!1,color:i,..._});this._observerVisualElement=t,this.own(l$4((()=>({observer:this.analysisViewData.elevationAlignedObserver,interactiveAndEditable:this.interactiveAndEditable,visible:this.visible})),(({observer:i,interactiveAndEditable:e,visible:o})=>{t$3(i)||e||!o?t.attached=!1:(t.geometry=i,this._observerVisualElement.attached=!0);}),h$1));}};e([d$1({constructOnly:!0})],V.prototype,"analysis",void 0),e([d$1({constructOnly:!0})],V.prototype,"analysisViewData",void 0),e([d$1({constructOnly:!0})],V.prototype,"view",void 0),e([d$1({readOnly:!0})],V.prototype,"visible",null),e([d$1()],V.prototype,"interactiveAndEditable",null),e([d$1()],V.prototype,"testInfo",null),e([d$1()],V.prototype,"_configuration",null),V=e([n$4("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],V);const _={size:6,pixelSnappingEnabled:!1,primitive:"circle",elevationInfo:{mode:"absolute-height",offset:0},outlineSize:0},y=n$5(),C=n$5(),E=n$5(),O=e$3();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let f=class extends(n$b(n$7.EventedMixin(y$1))){constructor(t){super(t),this.type="line-of-sight-view-3d",this.analysis=null,this.tool=null,this.computations=new j$4,this.elevationAlignedObserver=null,this.configuration=new s$2,this.observerEngineLocation=n$5(),this.cursorTarget=null,this.editable=!0;}initialize(){const t=this.view,i=this.analysis;this._analysisController=new Y({analysis:i,analysisViewData:this,view:t}),this._analysisVisualization=new V({analysis:i,analysisViewData:this,view:t}),this.own([this._analysisController.on("result-changed",(t=>{t.target!==this.cursorTarget&&this.emit("result-changed",t);})),c$2(this,H)]);}destroy(){m$3(this),this._analysisController=l$5(this._analysisController),this._analysisVisualization=l$5(this._analysisVisualization);}get results(){return this.computations.map((t=>t.result))}get priority(){return this._analysisController.priority}set priority(t){this._analysisController.priority=t;}get updating(){return r$1(this._analysisController)&&this._analysisController.updating}getResultForTarget(t){const i=this.computations.find((i=>i.target===t));return o(i,(t=>t.result))}get testInfo(){return {visualization:this._analysisVisualization,controller:this._analysisController}}};e([d$1({readOnly:!0})],f.prototype,"type",void 0),e([d$1({constructOnly:!0,nonNullable:!0})],f.prototype,"analysis",void 0),e([d$1()],f.prototype,"tool",void 0),e([d$1({readOnly:!0})],f.prototype,"results",null),e([d$1()],f.prototype,"priority",null),e([d$1()],f.prototype,"computations",void 0),e([d$1()],f.prototype,"elevationAlignedObserver",void 0),e([d$1()],f.prototype,"configuration",void 0),e([d$1()],f.prototype,"observerEngineLocation",void 0),e([d$1()],f.prototype,"cursorTarget",void 0),e([d$1()],f.prototype,"updating",null),e([d$1()],f.prototype,"editable",void 0),e([d$1()],f.prototype,"_analysisController",void 0),e([d$1()],f.prototype,"_analysisVisualization",void 0),f=e([n$4("esri.views.3d.analysis.LineOfSightAnalysisView3D")],f);const v=f;

export default v;
