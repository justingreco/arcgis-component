import { ay as w$1, e as e$1, d as d$1, I as s, V as a$1, n as n$2, c as a$2, h as e$5, r as r$2, s as s$2, t as t$7, y as y$1, aE as t$8, aR as p$3, H as l$6, aD as A$2, l as a$6 } from './cast-3d5be210.js';
import { n as n$4, C as C$2, a as n$a } from './LineVisualElement-0571b2ba.js';
import './geometry-2f332a26.js';
import { l as l$2 } from './Clonable-533c7a05.js';
import { s as s$1 } from './Cyclical-922b1741.js';
import { l as l$3 } from './JSONSupport-dce2c67b.js';
import { w as w$2 } from './persistable-5b051b1c.js';
import { j as j$2 } from './Point-edff2a11.js';
import { u as u$7 } from './Handles-54afc0a7.js';
import { l as l$5, j as j$3, U as U$1, w as w$3 } from './reactiveUtils-bd6fe823.js';
import { R as ps, D as D$2, S as $, G as G$2, T as ms, W as H$2, x as x$3, s as t$9, X } from './viewpointUtils-4c294048.js';
import { b as b$3 } from './Layer-569a1fc8.js';
import { E as E$3 } from './BuildingComponentSublayer-b0000040.js';
import { M as M$1, r, B as a$3, q as q$1, b as r$3, P as P$2, _, z as z$1, u as u$3, s as s$3, e as e$6, v as v$1, g as t$5, a as o$5, n as n$6, m as m$4, a1 as J$1, L as L$3 } from './mathUtils-559a53d9.js';
import { p as p$2, c as c$5, d as d$5, i as i$6 } from './screenUtils-31d073db.js';
import { m as m$1, R as R$2, i as i$5, u as u$5, b as b$2, r as r$4, c as c$4, I as I$2, p as p$6, q as q$3 } from './mat4-d5df0e58.js';
import { e as e$7 } from './mat4f64-ef2c1a38.js';
import { Q as Q$1 } from './quat-43e08490.js';
import { k as Rn } from './projection-fbd5d346.js';
import { i as i$4, n as n$7, d as d$4 } from './sphere-4710475c.js';
import { O as O$2, _ as _$1, q as q$2, W as W$2, p as p$5, Z } from './frustum-95850b85.js';
import { c as c$3, f as f$2, o as o$6, t as t$a } from './vectorStacks-3fa8ee55.js';
import { e as e$2, r as r$1, l as l$7 } from './vec4f64-011248e0.js';
import { n as n$8, a as a$4 } from './projectionUtils-5ca56a63.js';
import { k as k$1, t as te, a as a$5, p as p$4, O as O$3, c as c$6, m as m$5 } from './analysisViewUtils-869adced.js';
import { F as i$3, G as o$3, T as T$1, ba as u$4, aZ as m$2, bb as W$1, aS as H$1, x as x$2, bc as N$1, aY as s$4, aQ as r$5 } from './SceneView-ed3703c9.js';
import { a as i$2, P as d$2, n as n$3, J as e$3, p as o$1, l as t$1, g as e$4, h as o$2, E as E$1, t as t$2, a3 as d$3, j as t$3, aA as x$1, C as E$2, V as o$4, ah as t$4, aa as h$4, I as g$3, T as L$2 } from './objectResourceUtils-e575a410.js';
import { O as O$1 } from './VertexAttribute-ef09ced9.js';
import { R as R$1, I as I$1 } from './enums-4770f29d.js';
import { W, l as l$4, c as c$2, n as n$5 } from './OrderIndependentTransparency-b8c8f539.js';
import { m as m$3 } from './ImageMaterial-468fcf69.js';
import { a0 as t$6, X as u$6, a4 as n$9 } from './DefaultUI-a0db5719.js';
import { M as M$2 } from './Extent-f27111e1.js';
import { C as C$3 } from './dragEventPipeline3D-c2dc6030.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let c$1=class extends(l$2(l$3)){constructor(o){super(o),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10;}equals(o){return this.heading===o.heading&&this.tilt===o.tilt&&w$1(this.position,o.position)&&this.width===o.width&&this.height===o.height}};e$1([d$1({readOnly:!0,json:{read:!1,write:!0}})],c$1.prototype,"type",void 0),e$1([d$1({type:j$2}),w$2()],c$1.prototype,"position",void 0),e$1([d$1({type:Number,nonNullable:!0,range:{min:0,max:360}}),w$2(),s((o=>s$1.normalize(a$1(o),0,!0)))],c$1.prototype,"heading",void 0),e$1([d$1({type:Number,nonNullable:!0,range:{min:0,max:360}}),w$2(),s((o=>s$1.normalize(a$1(o),0,!0)))],c$1.prototype,"tilt",void 0),e$1([d$1({type:Number,nonNullable:!0}),w$2()],c$1.prototype,"width",void 0),e$1([d$1({type:Number,nonNullable:!0}),w$2()],c$1.prototype,"height",void 0),c$1=e$1([n$2("esri.analysis.SlicePlane")],c$1);const h$3=c$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const m=a$2("mac")?"Meta":"Control",a="Shift",f$1=2,h$2=1.15,e=1.15,i$1=1.1,p$1=2500,j$1=.02,n$1=Math.cos(M$1(45)),M=Math.cos(M$1(5)),k=.95,l$1=.3,u$2=.7,v=r(1,.5,0),b$1=2,x=1,C$1=e$2([...v,u$2]),S$1=[0,0,0,.04],U=e$2([...v,.5]),d=e$2([...v,1]),g$2=r$1(1,1,1,1),q=r$1(1,.8,.6,1),w=r$1(1,.93,.86,1),y=e$2([...v,1]),z=e$2([...v,1]),A$1=3,B=11,D$1=22.5,E=40,F=48,G$1=2.25,H=e$2([...v,1]),I=4,J=1,K=.3,L$1=6,N=4,O=12,P$1=40,Q=27,R=1600,T=.4;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function t(t){const g=new i$2;return g.extensions.add("GL_OES_standard_derivatives"),d$2(g,t),g.attributes.add(O$1.POSITION,"vec3"),g.attributes.add(O$1.UV0,"vec2"),g.varyings.add("vUV","vec2"),g.vertex.code.add(n$3`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),g.fragment.uniforms.add([new e$3("backgroundColor",(e=>e.backgroundColor)),new e$3("gridColor",(e=>e.gridColor)),new o$1("gridWidth",(e=>e.gridWidth))]),g.fragment.code.add(n$3`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),g}const g$1=Object.freeze(Object.defineProperty({__proto__:null,build:t},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class h$1 extends t$1{constructor(){super(...arguments),this.backgroundColor=r$1(1,0,0,.5),this.gridColor=r$1(0,1,0,.5),this.gridWidth=4;}}class u$1 extends e$4{initializeProgram(e){const r=u$1.shader.get().build(this.configuration);return new o$2(e.rctx,r,E$1)}initializePipeline(){return W({blending:l$4(R$1.ONE,R$1.ONE,R$1.ONE_MINUS_SRC_ALPHA,R$1.ONE_MINUS_SRC_ALPHA),depthTest:{func:I$1.LESS},colorWrite:c$2})}}u$1.shader=new t$2(g$1,(()=>import('./SlicePlaneMaterial.glsl-d894a183.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class f extends d$3{constructor(r){super(r,new h),this._config=new t$3;}intersect(r,e,t,i,o,n,s){return x$1(r,e,i,o,n,void 0,s)}createBufferWriter(){return new i$3(o$3)}requiresSlot(r){return r===E$2.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL}createGLMaterial(r){return r.output===o$4.Color?new p(r):null}getConfiguration(){return this._config}}class p extends t$4{constructor(r){super(r),this.ensureTechnique(u$1,null);}beginSlot(){return e$5(this.technique)}}class h extends h$1{constructor(){super(...arguments),this.renderOccluded=h$4.Occlude;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class l extends n$4{constructor(r){super(r),this._material=null,this._renderOccluded=h$4.OccludeAndTransparent,this._gridWidth=1,this._gridColor=r$1(1,0,0,1),this._backgroundColor=r$1(1,0,0,1),this.applyProps(r);}get renderOccluded(){return this._renderOccluded}set renderOccluded(r){r!==this._renderOccluded&&(this._renderOccluded=r,this._updateMaterial());}get gridWidth(){return this._gridWidth}set gridWidth(r){this._gridWidth!==r&&(this._gridWidth=r,this._updateMaterial());}get gridColor(){return this._gridColor}set gridColor(r){a$3(this._gridColor,r),this._updateMaterial();}get backgroundColor(){return this._backgroundColor}set backgroundColor(r){a$3(this._backgroundColor,r),this._updateMaterial();}createExternalResources(){this._material=new f(this.materialParameters);}destroyExternalResources(){this._material=null;}forEachExternalMaterial(e){r$2(this._material)&&e(this._material);}createGeometries(e){if(r$2(this._material)){const r=T$1.createSquareGeometry();e.addGeometry(r,this._material);}}get materialParameters(){return {backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){r$2(this._material)&&this._material.setParameters(this.materialParameters);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const Xe=s$2.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function Ye(e,t,r,i,n,o,s,a){return Ze(t,s.worldUpAtPosition(e,c$3.get()),n,o,a.basis1,a.basis2),q$1(a.basis1,a.basis1,r),q$1(a.basis2,a.basis2,i),r$3(a.origin,e),O$2(a.basis2,a.basis1,a.origin,a.plane),a}function Ze(e,t,r,i,n,o){const s=P$2(e,t),a=c$3.get(),c=c$3.get();switch(i===Pt.HORIZONTAL_OR_VERTICAL?Math.abs(s)>n$1?Pt.HORIZONTAL:Pt.VERTICAL:i){case Pt.VERTICAL:{const i=Math.abs(s)<=M?e:r.viewUp;_(a,i,t),r$3(c,t);break}case Pt.HORIZONTAL:_(a,r.viewUp,t),_(c,t,a);break;case Pt.TILTED:{const i=Math.abs(s)<=M?t:r.viewUp;_(a,i,e),_(c,e,a);break}}const l=_(c$3.get(),a,c);P$2(l,r.viewForward)>0&&q$1(c,c,-1),z$1(n,a),z$1(o,c);}function Be(e,t,r){const i=t.worldUpAtPosition(e.origin,c$3.get()),n=e.basis1,o=wt(e,i),s=Math.round(o/_t)*_t;return ps(e,s-o,n,r)}function We(e,t,r,i,n,o){const s=r$3(c$3.get(),n.origin);u$3(s,s,q$1(c$3.get(),n.basis1,e.direction[0]<0?1:-1)),u$3(s,s,q$1(c$3.get(),n.basis2,e.direction[1]<0?1:-1));const a=s$3(n.basis1),c=s$3(n.basis2),l=e$6(c$3.get(),r,s),u=e$6(c$3.get(),t,s);let d=0,m=0;if(lt(e)){const t=ct(n),r=ct(o);d=a-.5*e.direction[0]*P$2(n.basis1,u)/a,m=c-.5*e.direction[1]*P$2(n.basis2,u)/c;const i=r/t;d*=i,m*=i;}const p=d+.5*e.direction[0]*P$2(n.basis1,l)/a,g=m+.5*e.direction[1]*P$2(n.basis2,l)/c,f=q$1(c$3.get(),n.basis1,p/a),b=q$1(c$3.get(),n.basis2,g/c);(p<=0||st(o.origin,f,i)<=R)&&r$3(f,o.basis1),(g<=0||st(o.origin,b,i)<=R)&&r$3(b,o.basis2);const y=r$3(c$3.get(),s);return u$3(y,y,q$1(c$3.get(),f,e.direction[0]<0?-1:1)),u$3(y,y,q$1(c$3.get(),b,e.direction[1]<0?-1:1)),D$2(y,f,b,o)}function qe(e,t){return T*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function $e(e,t,r,i){const n=_(c$3.get(),t,r);return _(n,n,t),_$1(e,n,i)}function Je(e,t){return k$1(e.basis1,e.basis2,e.origin,t)}function Ke(e,t,r,i){const n=t.worldUpAtPosition(e.origin,c$3.get()),o=c$3.get();switch(r){case Lt.HEADING:r$3(o,n);break;case Lt.TILT:r$3(o,e.basis1);}return _$1(e.origin,o,i)}function Qe(e,t,r,i){const n=ot(r,nt.NEGATIVE_X),o=f$2.get();m$1(o,t,n.edge*Math.PI/2);const c=z$1(c$3.get(),n.basis);let l=q$1(c$3.get(),c,n.direction*i.computeScreenPixelSizeAt(n.position)*E);u$3(l,l,n.position);const u=i.projectToRenderScreen(l,p$2(c$3.get())),d=et(i,u);u$4(i,u,Ct),z$1(Ct.direction,Ct.direction);const m=c$3.get();!d&&$(r,Ct,m)&&(l=m),o[12]=0,o[13]=0,o[14]=0,e.modelTransform=o,e.renderLocation=t$5(l),d?e.state|=kt$1:e.state&=~kt$1;}function et(e,t){const[r,i,n,o]=e.viewport,s=Math.min(n,o)/16;let a=!0;return t[0]<r+s?(t[0]=r+s,a=!1):t[0]>r+n-s&&(t[0]=r+n-s,a=!1),t[1]<i+s?(t[1]=i+s,a=!1):t[1]>i+o-s&&(t[1]=i+o-s,a=!1),a}function tt(e,t,r,i){const n=s$3(i.basis1),o=s$3(i.basis2),s=at(i),a=ct(i),d=o$5(c$3.get(),0,0,0);u$3(d,q$1(c$3.get(),i.basis1,t.direction[0]),q$1(c$3.get(),i.basis2,t.direction[1])),u$3(d,i.origin,d);let m=0,p=1;if(lt(t))1===t.direction[0]&&-1===t.direction[1]?m=_t:1===t.direction[0]&&1===t.direction[1]?m=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(m=3*Math.PI/2),p=a;else {const e=0!==t.direction[0]?1:2;m=1===e?_t:0,p=(1===e?o:n)-s;}const g=R$2(f$2.get(),m);i$5(g,g,o$5(c$3.get(),p,p,p)),u$5(g,r,g),g[12]=0,g[13]=0,g[14]=0,e.modelTransform=g,e.renderLocation=d;}function rt(e,t,r,i){const n=i.worldUpAtPosition(r.origin,c$3.get()),o=ot(r,nt.POSITIVE_X),s=R$2(f$2.get(),o.edge*Math.PI/2);b$2(s,s,-wt(r,n)),u$5(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=o.position;}function it(e,t,r){const i=ot(r,nt.POSITIVE_Y),n=R$2(f$2.get(),i.edge*Math.PI/2);b$2(n,n,_t),u$5(n,t,n),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=i.position;}var nt;function ot(e,t){switch(t){case nt.POSITIVE_X:return {basis:e.basis1,direction:1,position:u$3(c$3.get(),e.origin,e.basis1),edge:t};case nt.POSITIVE_Y:return {basis:e.basis2,direction:1,position:u$3(c$3.get(),e.origin,e.basis2),edge:t};case nt.NEGATIVE_X:return {basis:e.basis1,direction:-1,position:e$6(c$3.get(),e.origin,e.basis1),edge:t};case nt.NEGATIVE_Y:return {basis:e.basis2,direction:-1,position:e$6(c$3.get(),e.origin,e.basis2),edge:t}}}function st(e,t,r){const i=r.projectToRenderScreen(u$3(c$3.get(),e,t),p$2(c$3.get())),n=r.projectToRenderScreen(e$6(c$3.get(),e,t),p$2(c$3.get()));return v$1(e$6(i,i,n))}function at(e){const t=s$3(e.basis1),r=s$3(e.basis2);return K*Math.min(t,r)}function ct(e){return at(e)}function lt(e){return 0!==e.direction[0]&&0!==e.direction[1]}function ut(e$1,t=Ut.CENTER_ON_ARROW){const r$1=t===Ut.CENTER_ON_CALLOUT?E:0,i=[r(r$1,0,-F/2),r(r$1,0,F/2)],n=ht(i,!0),o=(e$1,t)=>ft(i,i,{tubeRadius:A$1,tipRadius:B,tipLength:D$1,tubeFocusMultiplier:h$2,tipFocusMultiplier:e,padding:e$1,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t}),s=o(0,!1),a=o(G$1,!0),c=new m$2({color:g$2,cullFace:n$5.Back,renderOccluded:h$4.Opaque}),l=new m$2({color:q,cullFace:n$5.Back,renderOccluded:h$4.Opaque}),u=new m$2({color:w,cullFace:n$5.Back,renderOccluded:h$4.Opaque}),d=new m$2({color:z,transparent:!0,writeDepth:!1,cullFace:n$5.Front,renderOccluded:h$4.Transparent}),m=T$1.createPolylineGeometry([[r$1,0,0],[r$1-E,0,0]]),p=T$1.createPolylineGeometry([[r$1,0,0],[r$1-E,0,0]]),g=new W$1({color:y,renderOccluded:h$4.OccludeAndTransparent});return new te({view:e$1,renderObjects:[...s.normal.map((({part:e,geometry:t,transform:r})=>({geometry:t,material:"tip"===e?c:"cap"===e?l:u,transform:r,stateMask:t$6.Unfocused|Mt}))),...a.normal.map((({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:t$6.Unfocused|Mt}))),{geometry:m,material:g,stateMask:t$6.Unfocused|Mt|kt$1},...s.focused.map((({part:e,geometry:t,transform:r})=>({geometry:t,material:"tip"===e?c:"cap"===e?l:u,transform:r,stateMask:t$6.Focused|Mt}))),...a.focused.map((({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:t$6.Focused|Mt}))),{geometry:p,material:g,stateMask:t$6.Focused|Mt|kt$1}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[n]},collisionPriority:1,radius:B,state:Mt})}function dt(e,t){const r=new m$3({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:h$4.Opaque}),i=P$1,n=Q,o=n*i$1,s=e=>{const t=new Uint32Array([0,1,2,2,3,0]);return new g$3([[O$1.POSITION,{size:3,data:[i-e,-e,0,i+e,-e,0,i+e,e,0,i-e,e,0],exclusive:!0}],[O$1.UV0,{size:2,data:[0,0,1,0,1,1,0,1]}]],[[O$1.POSITION,t],[O$1.UV0,t]])},a=T$1.createPolylineGeometry([[0,0,0],[i-n,0,0]]),c=T$1.createPolylineGeometry([[0,0,0],[i-o,0,0]]),l=new W$1({color:d,renderOccluded:h$4.OccludeAndTransparent}),u=[{geometry:s(n),material:r,stateMask:t$6.Unfocused|Mt},{geometry:a,material:l,stateMask:t$6.Unfocused|Mt},{geometry:s(o),material:r,stateMask:t$6.Focused|Mt},{geometry:c,material:l,stateMask:t$6.Focused|Mt}];return new te({view:e,renderObjects:u,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[i,0,0]},collisionPriority:1,radius:n/2,state:Mt})}function mt(e){const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new C$2({view:e,attached:!0,color:C$1,width:x,writeDepthEnabled:!1,renderOccluded:h$4.OccludeAndTransparent,geometry:[t]})}function pt(e){return new l({view:e,attached:!0,backgroundColor:[...S$1],gridColor:U,gridWidth:4,renderOccluded:h$4.OccludeAndTransparent})}function gt(e,t){const r$1=lt(t),i=r$1?[r(1,0,0),r(0,0,0),r(0,1,0)]:[r(1,0,0),r(-1,0,0)],n=T$1.createPolylineGeometry(i),o=H,s=e=>new H$1({color:o,width:e,renderOccluded:h$4.OccludeAndTransparent}),a=()=>new W$1({color:o,renderOccluded:h$4.OccludeAndTransparent}),c=r$1?I:J,l=c*f$1,u=J,d=e=>e>1?s(e):a(),m=[{geometry:n,material:d(c),stateMask:t$6.Unfocused|Nt},{geometry:n,material:d(l),stateMask:t$6.Focused|Nt},{geometry:n,material:d(u),stateMask:vt}],p=new te({view:e,renderObjects:m,collisionType:{type:"line",paths:[i]},autoScaleRenderObjects:!1,worldSized:!0,radius:r$1?L$1:N});return p.state=Nt,p}function ft(e,t,r$1){const i=i=>{const n=(i?t:e).slice(0),s=e$6(c$3.get(),n[0],n[1]);z$1(s,s);const a=e$6(c$3.get(),n[n.length-1],n[n.length-2]);if(z$1(a,a),r$1.padding>0){const e=q$1(n$6(),a,-r$1.padding);if(n[n.length-1]=u$3(e,e,n[n.length-1]),r$1.bothEnds){const e=q$1(n$6(),s,-r$1.padding);n[0]=u$3(e,e,n[0]);}}const c=i?r$1.tipFocusMultiplier:1,d=r$1.tipLength*(r$1.focusTipLength?c:1),T=r$1.tipRadius*c,O=r$4(f$2.get());if(r$1.padding>0){const e=d/4,t=o$5(c$3.get(),0,e,0),i=1+r$1.padding/e;c$4(O,O,t),i$5(O,O,o$5(c$3.get(),i,i,i)),c$4(O,O,q$1(t,t,-1/i));}const y=r$4(e$7()),E=r(0,1,0),j=I$2(e$7(),Q$1(o$6.get(),E,a));j[12]=n[n.length-1][0],j[13]=n[n.length-1][1],j[14]=n[n.length-1][2],u$5(j,j,O);const M=[{part:"tube",geometry:bt(r$1.tubeRadius*(i?r$1.tubeFocusMultiplier:1)+r$1.padding,r$1.flat,n),transform:y}];let L,C;if(r$2(r$1.flat)?L=T$1.createExtrudedTriangle(d,T,T,r$1.flat.thickness):(L=T$1.createConeGeometry(d,T,24,!1,!1,!0),C=T$1.createConeGeometry(d,T,24,!1,!0,!1)),M.push({part:"tip",geometry:L,transform:j}),C&&M.push({part:"cap",geometry:C,transform:j}),r$1.bothEnds){const e=I$2(e$7(),Q$1(o$6.get(),E,s));e[12]=n[0][0],e[13]=n[0][1],e[14]=n[0][2],u$5(e,e,O),M.push({part:"tip",geometry:L,transform:e}),C&&M.push({part:"cap",geometry:C,transform:e});}return M};return {normal:i(!1),focused:i(!0)}}function bt(e,t,r){const i=[];if(r$2(t))i.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else {const t=12;for(let r=0;r<t;r++){const n=r/t*2*Math.PI;i.push([Math.cos(n)*e,Math.sin(n)*e]);}}return T$1.createPathExtrusionGeometry(i,r,[],[],!1)}function ht(e,t){const r=e$6(n$6(),e[e.length-1],e[e.length-2]);if(z$1(r,r),q$1(r,r,O),u$3(r,r,e[e.length-1]),t){const t=e$6(n$6(),e[0],e[1]);return z$1(t,t),q$1(t,t,O),u$3(t,t,e[0]),[t,...e,r]}return [...e,r]}function Tt(t,i,o,s=new h$3){if(t$7(t))return null;const{renderCoordsHelper:a}=i,c=a.fromRenderCoords(t.origin,i.spatialReference);if(t$7(c))return null;const l=Rn(c,o);if(t$7(l))return null;s.position=l;const u=a.worldUpAtPosition(t.origin,c$3.get()),d=a.worldBasisAtPosition(t.origin,n$7.Y,c$3.get()),m=2*s$3(t.basis1),p=2*s$3(t.basis2),g=x$2.renderUnitScaleFactor(i.spatialReference,o);return s.width=m*g,s.height=p*g,s.tilt=m$4(wt(t,u)),s.heading=m$4(It$1(t,u,d)),s}function Ot(e,t,r){if(t$7(e)||t$7(e.position))return null;const{spatialReference:i}=e.position,s=yt(jt(e,{renderCoordsHelper:t,spatialReference:i},r),t,i);return !e.position.hasZ&&r$2(s)&&(s.zmin=null,s.zmax=null),s}function yt(e,t,r){if(t$7(e))return null;const i=e.origin,o=c$3.get(),s=c$3.get(),a=c$3.get(),c=c$3.get();let l,u,d,m,p,g;u$3(o,i,e.basis1),u$3(o,o,e.basis2),u$3(s,i,e.basis1),J$1(s,s,e.basis2),J$1(a,i,e.basis1),J$1(a,a,e.basis2),J$1(c,i,e.basis1),u$3(c,c,e.basis2);for(const f of [o,s,a,c]){const e=t.fromRenderCoords(f,f,r);if(t$7(e))return null;l=null==l?e[0]:Math.min(l,e[0]),u=null==u?e[0]:Math.max(u,e[0]),d=null==d?e[1]:Math.min(d,e[1]),m=null==m?e[1]:Math.max(m,e[1]),p=null==p?e[2]:Math.min(p,e[2]),g=null==g?e[2]:Math.max(g,e[2]);}return new M$2({xmin:l,xmax:u,ymin:d,ymax:m,zmin:p,zmax:g,spatialReference:r})}function wt(e,t){return i$4(t,e.basis2,e.basis1)+_t}function It$1(e,t,r){return i$4(e.basis1,r,t)-_t}function Et$1(e,t,r,n,o,s,a=G$2()){return s.toRenderCoords(e,a.origin)?(s.worldBasisAtPosition(a.origin,n$7.X,a.basis1),s.worldBasisAtPosition(a.origin,n$7.Y,a.basis2),O$2(a.basis2,a.basis1,a.origin,a.plane),ps(a,-M$1(t),ms(a),a),ps(a,M$1(r),a.basis1,a),q$1(a.basis1,a.basis1,n/2),q$1(a.basis2,a.basis2,o/2),H$2(a),a):(Xe.error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function Rt$1(e,t){if(t$7(e)||t$7(e.position))return null;const r=n$8(e.position,t.spatialReference,t.elevationProvider);if(t$7(r))return null;const i=x$2.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),o=e.width*i,s=e.height*i;return {position:r,heading:e.heading,tilt:e.tilt,renderWidth:o,renderHeight:s}}function jt(e,t,r,i=G$2()){const o=Rt$1(e,t);return t$7(o)?null:At(o,t,r,i)}function At(e,t,r,i=G$2()){if(t$7(e))return null;const s=Et$1(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,i);return !r.tiltEnabled&&r$2(s)&&Be(s,t.renderCoordsHelper,s),s}!function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y";}(nt||(nt={}));const Mt=u$6.Custom1;var Lt,Pt;!function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT";}(Lt||(Lt={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED";}(Pt||(Pt={}));const kt$1=u$6.Custom2,Ct=d$4(),_t=Math.PI/2,Nt=u$6.Custom1,vt=u$6.Custom2;var Ut;function Vt(e){const t="building-scene-3d"===e.type?e:null;return r$2(t)}!function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW";}(Ut||(Ut={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const V=s$2.getLogger("esri.views.3d.analysis.Slice.SliceController");let g=class extends y$1{constructor(e){super(e),this._handles=new u$7,this._internalChange=!1,this._currentSlicePlane=null,this.state="ready";}get ready(){return "ready"===this.state}initialize(){this._handles.add(this.analysis.excludedLayers.on("before-add",(e=>{const i=e.item;null!=i&&(i instanceof b$3||i instanceof E$3)?i instanceof b$3&&N$1(i)?(V.error("excludedLayers",`Layer '${i.title}, id:${i.id}' of type '${i.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),e.preventDefault()):this.analysis.excludedLayers.includes(i)&&e.preventDefault():(V.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),e.preventDefault());}))),C(this.view,this),this._handles.add([l$5((()=>this.analysisViewData.plane),(()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews();}),{sync:!0}),l$5((()=>this.analysis.excludeGroundSurface),(()=>this._updateLayerViews()),{sync:!0}),this.analysis.excludedLayers.on("change",(()=>this._updateLayerViews())),l$5((()=>[this.analysisViewData.active,this.analysisViewData.visible]),(()=>{this._updateActiveController(),this._updateViewSlicePlane();}),{sync:!0}),l$5((()=>this._allLayerAndSubLayerViews),(()=>this._updateLayerViews()))]),this._handles.add([l$5((()=>this.analysis.shape),(()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane());}),{sync:!0})],"analysis"),this._set("state","ready"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane();}destroy(){"destroyed"!==this.state&&(this.analysisViewData.active&&(this.analysisViewData.active=!1,this.view.slicePlane=null),j(this.view,this),this._handles.destroy(),this.set("view",null),this._set("state","destroyed"));}async whenReady(){return await j$3((()=>this.ready)),this}get _allLayerAndSubLayerViews(){const e=this.view.allLayerViews.items;return e.concat(e.filter(Vt).flatMap((({sublayerViews:e})=>e.items)))}_updateBoundedPlaneFromSlicePlane(){const e=this.analysis.shape,i=this._currentSlicePlane;if(t$7(i)&&t$7(e)||r$2(i)&&r$2(e)&&e.equals(i))return;let t=null,a=null;if(r$2(e)&&r$2(e.position)){const i=e.position.spatialReference,s=Rt$1(e,this.view);t$7(s)&&a$4(this.analysis,i,V),t=At(s,this.view,{tiltEnabled:this.analysis.tiltEnabled},G$2()),r$2(t)&&(a={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height});}this._currentSlicePlane=a,this._internalChange=!0,this.analysisViewData.plane=t,this._internalChange=!1;}_updateSlicePlaneFromBoundedPlane(){const e=this.analysisViewData.plane,t=Tt(e,this.view,this.view.spatialReference,new h$3);let a=null;r$2(t)&&(a={heading:t.heading,tilt:t.tilt,position:t.position,width:t.width,height:t.height}),this._currentSlicePlane=a,this._internalChange=!0,this.analysis.shape=t,this._internalChange=!1,this._updateViewSlicePlane();}_updateActiveController(){if(b)return;const e=L(this.view);if(this.analysisViewData.active)r$2(e.activeController)&&e.activeController!==this?(b=!0,e.activeController.analysisViewData.active=!1,b=!1):r$2(e.activeController)&&e.activeController,this._updateLayerViews(),e.activeController=this;else {if(r$2(e.activeController)&&e.activeController!==this)return;r$2(e.activeController)&&e.activeController===this&&(e.activeController=null,this._updateLayerViews());}}_updateViewSlicePlane(){"ready"===this.state&&P(this.view);}_updateLayerViews(){const e=r$2(this.analysisViewData.plane)&&this.analysisViewData.visible&&this.analysisViewData.active,i=[],t=e=>{"layers"in e?e.layers.forEach(t):i.push(e);};this.analysis.excludedLayers.forEach(t),this.view.allLayerViews.forEach((t=>{t.destroyed||("slicePlaneEnabled"in t&&(t.slicePlaneEnabled=e&&!i.includes(t.layer)),"sublayerViews"in t&&t.sublayerViews.forEach((t=>{t.slicePlaneEnabled=e&&!i.includes(t.sublayer);})));})),null!=this.view.basemapTerrain&&(this.view.basemapTerrain.slicePlaneEnabled=e&&!this.analysis.excludeGroundSurface);}};e$1([d$1({readOnly:!0})],g.prototype,"state",void 0),e$1([d$1()],g.prototype,"view",void 0),e$1([d$1()],g.prototype,"analysis",void 0),e$1([d$1()],g.prototype,"analysisViewData",void 0),e$1([d$1()],g.prototype,"ready",null),e$1([d$1()],g.prototype,"_allLayerAndSubLayerViews",null),g=e$1([n$2("esri.views.3d.analysis.Slice.SliceController")],g);const S=new Map;let b=!1;function P(e){const i=L(e).activeController;r$2(i)&&r$2(i.analysisViewData.plane)&&i.analysisViewData.visible?e.slicePlane=i.analysisViewData.plane:e.slicePlane=null;}function C(e,i){S.has(e)||S.set(e,{all:[],activeController:null}),S.get(e).all.push(i);}function L(e){return S.get(e)}function j(e,i){if(!S.has(e))throw new Error("view expected in global slice register");const t=S.get(e),a=t.all.lastIndexOf(i);if(-1===a)throw new Error("controller expected in global slice register");t.all.splice(a,1),0===t.all.length&&S.delete(e);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const A="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC";

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const D="data:image/png;base64,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";

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const n={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};function o(r){return r.fromData(A,(()=>new L$2(A,n)))}function i(t){return t.fromData(D,(()=>new L$2(D,n)))}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var kt;let Et=kt=class extends a$5{constructor(t){super(t),this.clock=t$8,this._previewPlaneOpacity=1,this.removeIncompleteOnCancel=!1,this.layersMode="none",this.shiftManipulator=null,this.rotateHeadingManipulator=null,this.rotateTiltManipulator=null,this.resizeManipulators=null,this._handles=new u$7,this._viewHandles=new u$7,this._frameTask=null,this._pointerMoveTimerMs=p$1,this._prevPointerMoveTimeout=null,this._previewPlaneGridVisualElement=null,this._previewPlaneOutlineVisualElement=null,this._startPlane=G$2(),this._previewPlane=null,this._activeKeyModifiers={},this._lastCursorPosition=c$5(),this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._intersector=x$3(t.view.state.viewingMode),this._intersector.options.store=t$9.MIN;}initialize(){if(null==this.analysis)throw new Error("SliceTool requires valid analysis, but null was provided.");this.rotateHeadingImage=o(this.view.toolViewManager.textures),this.rotateTiltImage=i(this.view.toolViewManager.textures);const t=t=>{this._updateManipulatorsInteractive(t),t.grabbing||(r$2(this.analysisViewData.plane)&&X(this.analysisViewData.plane,this._startPlane),this.inputState=null);};this.shiftManipulator=ut(this.view),this.manipulators.add(this.shiftManipulator),this.shiftManipulator.events.on("grab-changed",(e=>{this._onShiftGrab(e),t(this.shiftManipulator);})),this._handles.add(this._createShiftDragPipeline(this.shiftManipulator)),this.rotateHeadingManipulator=dt(this.view,this.rotateHeadingImage.texture),this.manipulators.add(this.rotateHeadingManipulator),this.rotateHeadingManipulator.events.on("grab-changed",(e=>{this._onRotateHeadingGrab(e),t(this.rotateHeadingManipulator);})),this._handles.add(this._createRotateHeadingDragPipeline(this.rotateHeadingManipulator)),this.rotateTiltManipulator=dt(this.view,this.rotateTiltImage.texture),this.manipulators.add(this.rotateTiltManipulator),this.rotateTiltManipulator.events.on("grab-changed",(e=>{this._onRotateTiltGrab(e),t(this.rotateTiltManipulator);})),this._handles.add(this._createRotateTiltDragPipeline(this.rotateTiltManipulator)),this.resizeManipulators=this._resizeHandles.map(((e,i)=>{const a=gt(this.view,e);return a.events.on("grab-changed",(e=>{this._onResizeGrab(e,i),t(a);})),this._handles.add(this._createResizeDragPipeline(a)),a})),this.manipulators.addMany(this.resizeManipulators),this._previewPlaneGridVisualElement=pt(this.view),this._previewPlaneOutlineVisualElement=mt(this.view),this._previewPlaneOutlineVisualElement.width=b$1,this._handles.add(l$5((()=>this.analysisViewData.plane),(()=>this._updateManipulators()),U$1));const e=l$5((()=>this.state),(t=>{"sliced"===t&&this.finishToolCreation();}),w$3);this._handles.add([e,l$5((()=>this.view.state.camera),(()=>this._onCameraChange()))]);}destroy(){this.rotateHeadingImage=p$3(this.rotateHeadingImage),this.rotateTiltImage=p$3(this.rotateTiltImage),this._handles=l$6(this._handles),this._viewHandles=l$6(this._viewHandles),this._removeFrameTask(),this._clearPointerMoveTimeout(),this._previewPlaneOutlineVisualElement=l$6(this._previewPlaneOutlineVisualElement),this._previewPlaneGridVisualElement=l$6(this._previewPlaneGridVisualElement);}get state(){const t=!!this.analysisViewData.plane,e=!!this.inputState;return t?t&&e?"slicing":t&&!e?"sliced":"ready":"ready"}get cursor(){return this._isPlacingSlicePlane||"exclude"===this.layersMode?"crosshair":r$2(this._creatingPointerId)?"grabbing":null}set analysis(t){if(null==t)throw new Error("SliceTool requires valid analysis, but null was provided.");this._handles.remove("analysis"),this._set("analysis",t);}get inputState(){return this._get("inputState")}set inputState(t){this._set("inputState",t),this.analysisViewData.showGrid=r$2(t)&&"resize"===t.type,this._updateMaterials();}get _isPlacingSlicePlane(){return !this.inputState&&!this.analysisViewData.plane&&this.active}get _creatingPointerId(){return r$2(this.inputState)&&"shift"===this.inputState.type?this.inputState.creatingPointerId:null}enterExcludeLayerMode(){t$7(this.analysisViewData.plane)||(this._set("layersMode","exclude"),this.active||(this.view.activeTool=this));}exitExcludeLayerMode(){t$7(this.analysisViewData.plane)||(this._set("layersMode","none"),this.active&&(this.view.activeTool=null));}onDeactivate(){this._set("layersMode","none"),this._updatePreviewPlane(null);}onShow(){this._updateVisibility(!0);}onHide(){this._updateVisibility(!1);}_updateVisibility(t){this.shiftManipulator&&(this._updateManipulators(),t||this._clearPointerMoveTimeout());}onInputEvent(t){switch(t.type){case"pointer-drag":if(!Ht(t))return;this._isPlacingSlicePlane?this._onClickPlacePlane(t)&&t.stopPropagation():this._onPointerDrag(t)&&t.stopPropagation();break;case"pointer-move":this._onPointerMove(t);break;case"pointer-up":this._onPointerUp(t)&&t.stopPropagation();break;case"immediate-click":if(!Ht(t))return;this._onClickPlacePlane(t)&&t.stopPropagation();break;case"click":if(!Ht(t))return;this._onClickExcludeLayer(t)&&t.stopPropagation();break;case"drag":this.inputState&&t.stopPropagation();break;case"key-down":this._onKeyDown(t)&&t.stopPropagation();break;case"key-up":this._onKeyUp(t)&&t.stopPropagation();}}onEditableChange(){this.analysisViewData.editable=this.editable;}_onPointerDrag(t){const e=this.inputState;if(t.pointerId===this._creatingPointerId&&r$2(e)&&"shift"===e.type){const i=n$9(t);return this.shiftManipulator.events.emit("drag",{action:e.hasBeenDragged?"update":"start",pointerType:t.pointerType,start:i,screenPoint:i}),e.hasBeenDragged=!0,!0}return !1}_onPointerMove(t){this._lastCursorPosition.x=t.x,this._lastCursorPosition.y=t.y,this._resetPointerMoveTimeout(),"touch"!==t.pointerType&&this._updatePreviewPlane(n$9(t),this._activeKeyModifiers);}_onCameraChange(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),this._updateManipulators();}_onPointerUp(t){if(t.pointerId===this._creatingPointerId&&r$2(this.analysisViewData.plane)){const e=n$9(t);return this.shiftManipulator.events.emit("drag",{action:"end",start:e,screenPoint:e}),X(this.analysisViewData.plane,this._startPlane),this.inputState=null,!0}return !1}_onClickPlacePlane(t){if("exclude"===this.layersMode)return !1;if(this._isPlacingSlicePlane){const i=n$9(t),a=G$2();if(this._pickPlane(i,!1,this._activeKeyModifiers,a)){if(X(a,this._startPlane),this.analysis.shape=Tt(a,this.view,this.view.spatialReference,new h$3),"pointer-drag"===t.type){const e=this._calculatePickRay(i);this.inputState=St(e,t.pointerId,a.origin,a);}return !0}}return !1}_onClickExcludeLayer(t){return !("exclude"!==this.layersMode||!this.created)&&(this.view.hitTest(n$9(t)).then((t=>{if(t.results.length){const e=t.results[0],i="graphic"===e?.type&&e.graphic;if(i){const t=i.sourceLayer||i.layer;t&&this.analysis.excludedLayers.push(t);}}else t.ground.layer?this.analysis.excludedLayers.push(t.ground.layer):this.analysis.excludeGroundSurface=!0;})),this._set("layersMode","none"),this.active&&(this.view.activeTool=null),!0)}_onKeyDown(t){return (t.key===a||t.key===m)&&(this._activeKeyModifiers[t.key]=!0,r$2(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}_onKeyUp(t){return !(t.key!==a&&t.key!==m||!this._activeKeyModifiers[t.key])&&(delete this._activeKeyModifiers[t.key],r$2(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}_onShiftGrab(t){if("start"!==t.action||t$7(this.analysisViewData.plane))return;const e=this._calculatePickRay(t.screenPoint);X(this.analysisViewData.plane,this._startPlane),this.inputState=St(e,null,this.shiftManipulator.renderLocation,this.analysisViewData.plane);}_createShiftDragPipeline(t){return p$4(t,((t,e,i)=>{const a=this.inputState;if(t$7(a)||"shift"!==a.type)return;const s=r$2(this.analysisViewData.plane)?X(this.analysisViewData.plane,G$2()):null;e.next(C$3(this.view,a.shiftPlane)).next(this._shiftDragAdjustSensitivity(a)).next(this._shiftDragUpdatePlane(a)),i.next((()=>{r$2(s)&&this._updateBoundedPlane(s);}));}))}_shiftDragAdjustSensitivity(t){return e=>{if(t$7(this.analysisViewData.plane))return null;const i=.001,a=Math.min((1-Math.abs(P$2(ms(this.analysisViewData.plane),e.ray.direction)/s$3(e.ray.direction)))/i,1),s=-W$2(this._startPlane.plane,e.renderEnd),n=-W$2(this._startPlane.plane,t.startPoint);return t.depth=t.depth*(1-a)+s*a-n,e}}_shiftDragUpdatePlane(t){return ()=>{if(t$7(this.analysisViewData.plane))return;const e=r$3(c$3.get(),this._startPlane.origin),i=r$3(c$3.get(),ms(this._startPlane));q$1(i,i,-t.depth),u$3(i,i,e);const a=D$2(i,this.analysisViewData.plane.basis1,this.analysisViewData.plane.basis2,G$2());this._updateBoundedPlane(a);}}_onRotateHeadingGrab(t){if("start"!==t.action||t$7(this.analysisViewData.plane))return;const e=Ke(this.analysisViewData.plane,this.view.renderCoordsHelper,Lt.HEADING,p$5()),i=this._calculatePickRay(t.screenPoint),a=n$6();q$2(e,i,a)&&(X(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:e,startPoint:a});}_createRotateHeadingDragPipeline(t){return p$4(t,((t,e,i)=>{const a=this.inputState;if(t$7(a)||"rotate"!==a.type)return;const s=r$2(this.analysisViewData.plane)?X(this.analysisViewData.plane,G$2()):null;e.next(C$3(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdatePlaneFromRotate()),i.next((()=>{r$2(s)&&this._updateBoundedPlane(s);}));}))}_onRotateTiltGrab(t){if("start"!==t.action||t$7(this.analysisViewData.plane))return;const e=Ke(this.analysisViewData.plane,this.view.renderCoordsHelper,Lt.TILT,p$5()),i=this._calculatePickRay(t.screenPoint),a=n$6();q$2(e,i,a)&&(X(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:e,startPoint:a});}_createRotateTiltDragPipeline(t){return p$4(t,((t,e,i)=>{const a=this.inputState;if(t$7(a)||"rotate"!==a.type)return;const s=r$2(this.analysisViewData.plane)?X(this.analysisViewData.plane,G$2()):null;e.next(C$3(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdatePlaneFromRotate()),i.next((()=>{r$2(s)&&this._updateBoundedPlane(s);}));}))}_rotateDragRenderPlaneToRotate(t){return e=>{if(t$7(this.analysisViewData.plane))return null;const i=Z(t.rotatePlane),a=O$3(t.startPoint,e.renderEnd,this.analysisViewData.plane.origin,i);return {...e,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdatePlaneFromRotate(){return t=>{if(t$7(this.analysisViewData.plane))return;const e=p$6(f$2.get(),t.rotateAngle,t.rotateAxis);if(t$7(e))return;const i=L$3(c$3.get(),this._startPlane.basis1,e),a=L$3(c$3.get(),this._startPlane.basis2,e),s=D$2(this.analysisViewData.plane.origin,i,a,G$2());this._updateBoundedPlane(s);}}_onResizeGrab(t,e){if("start"!==t.action||t$7(this.analysisViewData.plane))return;const i=this._calculatePickRay(t.screenPoint),a=c$3.get();q$2(this.analysisViewData.plane.plane,i,a)&&(X(this.analysisViewData.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:e,startPoint:t$5(a)});}_createResizeDragPipeline(t){return p$4(t,((t,e,i)=>{const a=this.inputState;if(t$7(a)||"resize"!==a.type||t$7(this.analysisViewData.plane))return;const s=X(this.analysisViewData.plane,G$2());e.next(C$3(this.view,this.analysisViewData.plane.plane)).next(this._resizeDragUpdatePlane(a)),i.next((()=>{this._updateBoundedPlane(s);}));}))}_resizeDragUpdatePlane(t){return e=>{if(t$7(this.analysisViewData.plane))return;const i=this._resizeHandles[t.activeHandleIdx],a=We(i,t.startPoint,e.renderEnd,this.view.state.camera,this._startPlane,X(this.analysisViewData.plane));this._updateBoundedPlane(a);}}_updateBoundedPlane(t){const e=this.analysisViewData;if(!r$2(e))throw new Error("valid internal object expected");e.plane=t;}_updatePreviewPlane(t,e={}){let i=this._previewPlane;if(this._previewPlane=null,t$7(t))return this._removeFrameTask(),void this._updateManipulators();if(!this.analysisViewData.plane&&this.active){const a=r$2(i)?i:G$2();if(i=r$2(i)?X(i,xt):null,this._pickPlane(t,!0,e,a)){const t=k;let e=!1;r$2(i)&&(e=P$2(i.plane,a.plane)<t||P$2(z$1(c$3.get(),i.basis1),z$1(c$3.get(),a.basis1))<t),e&&(this._previewPlaneOpacity=0),this._previewPlane=a;}}r$2(this._previewPlane)&&t$7(this._frameTask)&&0===this._previewPlaneOpacity?this._frameTask=A$2({update:({deltaTime:t})=>{this._previewPlaneOpacity=Math.min(this._previewPlaneOpacity+t/(1e3*l$1),1),this._updateManipulators(),1===this._previewPlaneOpacity&&this._removeFrameTask();}}):t$7(this._previewPlane)&&r$2(this._frameTask)?this._removeFrameTask():r$2(this._previewPlane)&&this._updateManipulators();}_removeFrameTask(){this._frameTask=a$6(this._frameTask);}_calculatePickRay(t){const e=d$4(),i=d$5(t,It);return s$4(this.view.state.camera,i,e),z$1(e.direction,e.direction),e}_pickMinResult(t){const e=d$5(t,t$a.get());return this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(e,this._intersector),this._intersector.results.min}_pickPlane(t,e,i,a$1){const s=this._pickMinResult(t),n=c$3.get();if(!s.getIntersectionPoint(n))return !1;const r=s.getTransformedNormal(c$3.get()),l=this.view.state.camera;P$2(r,l.viewForward)>0&&q$1(r,r,-1);const o=qe(n,l),h=(e?1:-1)*o*j$1,p=q$1(c$3.get(),r,h);u$3(p,p,n);const u=this.analysis.tiltEnabled?Pt.TILTED:Pt.HORIZONTAL_OR_VERTICAL,c=i[a]?Pt.VERTICAL:i[m]?Pt.HORIZONTAL:u;return Ye(p,r,o,o,l,c,this.view.renderCoordsHelper,a$1),!0}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=a$6(this._prevPointerMoveTimeout);}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.shiftManipulator.state|=Mt,this.rotateHeadingManipulator.state|=Mt,this.rotateTiltManipulator.state|=Mt,this._prevPointerMoveTimeout=this.clock.setTimeout((()=>{this.shiftManipulator.state&=~Mt,this.rotateHeadingManipulator.state&=~Mt,this.rotateTiltManipulator.state&=~Mt;}),this._pointerMoveTimerMs);}_updateManipulators(){if(kt.disableEngineLayers)return;let t=null,e=!1;if(r$2(this.analysisViewData.plane))t=this.analysisViewData.plane,e=!1;else {if(!r$2(this._previewPlane))return this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach((t=>t.available=!1)),this._previewPlaneOutlineVisualElement.visible=!1,void(this._previewPlaneGridVisualElement.visible=!1);t=this._previewPlane,e=!0;}const i=Je(t,f$2.get());e?(this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach((t=>t.available=!1)),this._previewPlaneOutlineVisualElement.visible=!0,this._previewPlaneGridVisualElement.visible=!0):(this.shiftManipulator.available=!0,this.rotateHeadingManipulator.available=!0,this.rotateTiltManipulator.available=this.analysis.tiltEnabled,this.resizeManipulators.forEach((t=>t.available=!0)),Qe(this.shiftManipulator,i,t,this.view.state.camera),rt(this.rotateHeadingManipulator,i,t,this.view.renderCoordsHelper),it(this.rotateTiltManipulator,i,t),this.resizeManipulators.forEach(((e,a)=>tt(e,this._resizeHandles[a],i,t))),this._previewPlaneOutlineVisualElement.visible=!1,this._previewPlaneGridVisualElement.visible=!1);const a=o$5(c$3.get(),s$3(t.basis1),s$3(t.basis2),1),s=q$3(f$2.get(),a),n=u$5(s,i,s);this._previewPlaneOutlineVisualElement.transform=n,this._previewPlaneGridVisualElement.transform=n,this._updateMaterials();}_updateMaterials(){const t=[C$1[0],C$1[1],C$1[2],C$1[3]*this._previewPlaneOpacity];this._previewPlaneOutlineVisualElement.color=t;const e=[S$1[0],S$1[1],S$1[2],S$1[3]*this._previewPlaneOpacity],i=[0,0,0,0];this._previewPlaneGridVisualElement.backgroundColor=e,this._previewPlaneGridVisualElement.gridColor=i;}_updateManipulatorsInteractive(t){if(!t.grabbing)return this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,void this.resizeManipulators.forEach((t=>{t.interactive=!0;}));this.shiftManipulator.interactive=this.shiftManipulator===t,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===t,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===t,this.resizeManipulators.forEach((e=>{e.interactive=e===t;}));}testData(){return {plane:this.analysisViewData.plane,setPointerMoveTimerMs:t=>{this._pointerMoveTimerMs=t;}}}};function St(t,e,i,a){const s=$e(i,ms(a),t.direction,p$5()),n=n$6();return q$2(s,t,n)?{type:"shift",creatingPointerId:e,hasBeenDragged:!1,shiftPlane:s,depth:0,startPoint:n}:null}function Ht(t){return "mouse"!==t.pointerType||0===t.button}Et.disableEngineLayers=!1,e$1([d$1()],Et.prototype,"clock",void 0),e$1([d$1({constructOnly:!0})],Et.prototype,"view",void 0),e$1([d$1()],Et.prototype,"analysisViewData",void 0),e$1([d$1({readOnly:!0})],Et.prototype,"state",null),e$1([d$1({readOnly:!0})],Et.prototype,"cursor",null),e$1([d$1()],Et.prototype,"analysis",null),e$1([d$1()],Et.prototype,"removeIncompleteOnCancel",void 0),e$1([d$1({readOnly:!0})],Et.prototype,"layersMode",void 0),e$1([d$1({value:null})],Et.prototype,"inputState",null),e$1([d$1()],Et.prototype,"_isPlacingSlicePlane",null),e$1([d$1()],Et.prototype,"_creatingPointerId",null),Et=kt=e$1([n$2("esri.views.3d.analysis.Slice.SliceTool")],Et);const xt=G$2(),It=i$6(),Rt=Et;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let G=class extends y$1{constructor(e){super(e),this._handles=new u$7,this._gridVisualElement=null,this._outlineVisualElement=null,this.state="pending",this.showGrid=!1,this.preview=!0;}get ready(){return "ready"===this.state}initialize(){this._initialize();}async _initialize(){if("destroyed"===this.state||"ready"===this.state)return;await j$3((()=>this.view.ready));const e=this.analysisViewData;if(t$7(e))throw new Error("expected internal object to be valid");this._gridVisualElement=pt(this.view),this._outlineVisualElement=mt(this.view),this._handles.add([l$5((()=>({visible:r$2(e.plane)&&this.analysisViewData.visible,active:this.analysisViewData.active,preview:this.preview,showGrid:this.showGrid})),(e=>this._updateMaterials(e)),w$3),l$5((()=>e.plane),(e=>this._updatePlane(e)),w$3)],"internal"),this._set("state","ready");}destroy(){"destroyed"!==this.state&&"pending"!==this.state&&(this._handles.destroy(),this._gridVisualElement=l$6(this._gridVisualElement),this._outlineVisualElement=l$6(this._outlineVisualElement),this.set("view",null),this._set("state","destroyed"));}async whenReady(){await j$3((()=>this.view.ready));}_updatePlane(e){if(t$7(e))return;const t=o$5(c$3.get(),s$3(e.basis1),s$3(e.basis2),1),i=q$3(f$2.get(),t),r=Je(e,f$2.get()),o=u$5(i,r,i);this._outlineVisualElement.transform=o,this._gridVisualElement.transform=o;}_updateMaterials({visible:e,active:t,preview:i,showGrid:s}){this._outlineVisualElement.color=C$1,this._outlineVisualElement.width=i?b$1:x,this._outlineVisualElement.stipplePattern=t?null:r$5(5),this._gridVisualElement.backgroundColor=S$1,this._gridVisualElement.gridColor=s?U:l$7,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e;}};e$1([d$1({readOnly:!0})],G.prototype,"state",void 0),e$1([d$1()],G.prototype,"view",void 0),e$1([d$1()],G.prototype,"analysis",void 0),e$1([d$1()],G.prototype,"analysisViewData",void 0),e$1([d$1()],G.prototype,"ready",null),e$1([d$1()],G.prototype,"showGrid",void 0),e$1([d$1()],G.prototype,"preview",void 0),G=e$1([n$2("esri.views.3d.analysis.Slice.SliceVisualization")],G);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let c=class extends(n$a(y$1)){constructor(i){super(i),this.type="slice-view-3d",this.analysis=null,this.tool=null,this.analysisVisualization=null,this.analysisController=null,this.plane=null,this.active=!0,this.showGrid=!1;}initialize(){this.analysisVisualization=new G({view:this.view,analysis:this.analysis,analysisViewData:this}),this.analysisController=new g({view:this.view,analysis:this.analysis,analysisViewData:this}),this.own(c$6(this,Rt));}destroy(){m$5(this),this.analysisVisualization=l$6(this.analysisVisualization),this.analysisController=l$6(this.analysisController);}get editable(){return !this.analysisVisualization.preview}set editable(i){this.analysisVisualization.preview=!i;}async when(){return await this.analysisVisualization.whenReady(),await this.analysisController.whenReady(),this}get testData(){return {visualization:this.analysisVisualization,controller:this.analysisController,tool:e$5(this.tool)}}};e$1([d$1({readOnly:!0})],c.prototype,"type",void 0),e$1([d$1({constructOnly:!0,nonNullable:!0})],c.prototype,"analysis",void 0),e$1([d$1()],c.prototype,"tool",void 0),e$1([d$1()],c.prototype,"plane",void 0),e$1([d$1()],c.prototype,"active",void 0),e$1([d$1({aliasOf:"analysisVisualization.showGrid"})],c.prototype,"showGrid",void 0),e$1([d$1()],c.prototype,"editable",null),c=e$1([n$2("esri.views.3d.analysis.SliceAnalysisView3D")],c);const u=c;

const SliceAnalysisView3D = /*#__PURE__*/Object.freeze({
	__proto__: null,
	'default': u
});

export { SliceAnalysisView3D as S, t };
