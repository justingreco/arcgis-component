import { e, n, s, a as s$1, X as f$1, m as m$2, E, d as d$1, S as S$2, f as r$3, b as b$1, r as r$4, t as t$2, y as y$3, I as s$3 } from './cast-3d5be210.js';
import { s as s$2, x as x$1 } from './Basemap-bccaf827.js';
import { l as l$1 } from './Color-25ce730a.js';
import { j as j$2, n as n$4 } from './Collection-a38e0489.js';
import { n as n$1 } from './collectionUtils-302901c0.js';
import { o } from './compilerUtils-d149ad5f.js';
import { l, u } from './JSONSupport-dce2c67b.js';
import { m as m$1 } from './Portal-5df9f5a7.js';
import { n as n$2 } from './loadAll-0acccebb.js';
import { r as r$1 } from './Point-edff2a11.js';
import { r } from './enumeration-6695a859.js';
import { r as r$2, n as n$3 } from './opacityUtils-dcd94f00.js';
import { p as p$3 } from './CollectionFlattener-9ce72729.js';
import { F, y as y$1, Q } from './request-ac4d8bfb.js';
import { p as p$2, y as y$2, t as t$3 } from './TablesMixin-6752cfb1.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var t$1;let p$1=t$1=class extends l{constructor(o){super(o),this.type="none";}clone(){return new t$1({type:this.type})}};e([r({none:"none",stayAbove:"stay-above"})],p$1.prototype,"type",void 0),p$1=t$1=e([n("esri.ground.NavigationConstraint")],p$1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var w$1;const C=s.getLogger("esri.Ground");let S$1=w$1=class extends(u(m$1)){constructor(r){super(r),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new j$2;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,"elevation"!==r.type&&"base-elevation"!==r.type&&C.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`);},t=r=>{r.parent=null;};this.layers.on("after-add",(r=>e(r.item))),this.layers.on("after-remove",(r=>t(r.item)));}initialize(){this.when().catch((r=>{C.error("#load()","Failed to load ground",r);})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context);}destroy(){const r=this.layers.removeAll();for(const e of r)e.destroy();this.layers.destroy();}normalizeCtorArgs(r){return r&&"resourceInfo"in r&&(this._set("resourceInfo",r.resourceInfo),delete(r={...r}).resourceInfo),r}set layers(r){this._set("layers",n$1(r,this._get("layers")));}writeLayers(r,e,o$1,t){const i=[];r?(t={...t,layerContainerType:"ground"},r.forEach((r=>{if("write"in r){const e={};o(r)().write(e,t)&&i.push(e);}else t&&t.messages&&t.messages.push(new s$1("layer:unsupported",`Layers (${r.title}, ${r.id}) of type '${r.declaredClass}' cannot be persisted in the ground`,{layer:r}));})),e.layers=i):e.layers=i;}load(r){return this.addResolvingPromise(this._loadFromSource(r)),Promise.resolve(this)}loadAll(){return n$2(this,(r=>{r(this.layers);}))}async queryElevation(r,e){await this.load({signal:e?.signal});const{ElevationQuery:o}=await import('./ElevationQuery-d888eff2.js');f$1(e);const t=new o,s=this.layers.filter(L$2).toArray();return t.queryAll(s,r,e)}async createElevationSampler(r,e){await this.load({signal:e?.signal});const{ElevationQuery:o}=await import('./ElevationQuery-d888eff2.js');f$1(e);const t=new o,s=this.layers.filter(L$2).toArray();return t.createSamplerAll(s,r,e)}clone(){const r={opacity:this.opacity,surfaceColor:m$2(this.surfaceColor),navigationConstraint:m$2(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(r.loadStatus="loaded"),new w$1({resourceInfo:this.resourceInfo}).set(r)}read(r,e){this.resourceInfo||this._set("resourceInfo",{data:r,context:e}),super.read(r,e);}_loadFromSource(r){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,r):Promise.resolve(null)}_loadLayersFromJSON(r,e,o){const t=e&&e.origin||"web-scene",s=e&&e.portal||null,a=e&&e.url||null;return import('./layersCreator-b914b652.js').then((({populateOperationalLayers:e})=>{f$1(o);const i=[];if(r.layers&&Array.isArray(r.layers)){const o={context:{origin:t,url:a,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};i.push(e(this.layers,r.layers,o));}return E(i)})).then((()=>{}))}};function I$1(r){return r&&"createElevationSampler"in r}function L$2(r){return "elevation"===r.type||I$1(r)}e([d$1({json:{read:!1}})],S$1.prototype,"layers",null),e([r$1("layers")],S$1.prototype,"writeLayers",null),e([d$1({readOnly:!0})],S$1.prototype,"resourceInfo",void 0),e([d$1({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:S$2,read:{reader:r$2,source:"transparency"},write:{writer:(r,e)=>{e.transparency=n$3(r);},target:"transparency"}}})],S$1.prototype,"opacity",void 0),e([d$1({type:l$1,json:{type:[S$2],write:(r,e)=>{e.surfaceColor=r.toJSON().slice(0,3);}}})],S$1.prototype,"surfaceColor",void 0),e([d$1({type:p$1,json:{write:!0}})],S$1.prototype,"navigationConstraint",void 0),S$1=w$1=e([n("esri.Ground")],S$1);const A$1=S$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function i$1(i){return !!(i&&i.loaded&&"capabilities"in i&&i?.capabilities?.operations&&"supportsEditing"in i.capabilities.operations&&!0===i.capabilities.operations.supportsEditing)&&!("editingEnabled"in i&&!i.editingEnabled)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const f=s.getLogger("esri.support.basemapUtils");function p(){return {}}function y(e){for(const r in e){const a=e[r];!1===a?.destroyed&&a.destroy(),delete e[r];}}function m(a,t){let n;if("string"==typeof a){if(!(a in s$2)){const e=Object.entries(s$2).filter((([e,a])=>r$3.apiKey&&!a.classic||!r$3.apiKey&&a.classic&&!a.deprecated)).map((([e])=>`"${e}"`)).join(", ");return f.warn(`Unable to find basemap definition for: ${a}. Try one of these: ${e}`),null}t&&(n=t[a]),n||(n=x$1.fromId(a),t&&(t[a]=n));}else n=b$1(x$1,a);return n?.destroyed&&(f.warn("The provided basemap is already destroyed",{basemap:n}),n=null),n}function d(r,a=null){const t=m(r);if(!t)return null;const n=new x$1({id:t.id,title:t.title,baseLayers:t.baseLayers.slice(),referenceLayers:t.referenceLayers.slice()});return a&&(n.baseLayers=g(n.baseLayers,a.baseLayers),n.referenceLayers=g(n.referenceLayers,a.referenceLayers)),n.load().catch((()=>{})),n.portalItem=t.portalItem,n}function b(e){let r=null;const a=T(e),t=!a.baseLayers.length;for(const n in s$2){const e=M(a,q(s$2[n]),{mustMatchReferences:t});if("equal"===e){r=n;break}"base-layers-equal"===e&&(r=n);}return r}function L$1(e,r){if(e===r)return !0;return "equal"===M(T(e),T(r),{mustMatchReferences:!0})}function g(e,r){const t=new j$2;return e.forEach((e=>{const a=r.find((r=>$(j$1(e),j$1(r))))||e;t.includes(a)?t.push(e):t.push(a);})),t}function v(e){return !!e?.baseLayers.concat(e.referenceLayers).some(S)}function S(e){if(I(e.url))return !0;if("vector-tile"===e.type)for(const r in e.sourceNameToSource){if(I(e.sourceNameToSource[r]?.sourceUrl))return !0}return !1}function h(e,r){if(t$2(r)||t$2(e))return {spatialReference:null,updating:!1};if("not-loaded"===r.loadStatus)return r.load(),{spatialReference:null,updating:!0};if(r.spatialReference)return {spatialReference:r.spatialReference,updating:!1};if(0===r.baseLayers.length)return {spatialReference:null,updating:!1};const a=r.baseLayers.getItemAt(0);switch(a.loadStatus){case"not-loaded":a.load();case"loading":return {spatialReference:null,updating:!0};case"failed":return {spatialReference:null,updating:!1}}const t=(("supportedSpatialReferences"in a?a.supportedSpatialReferences:null)||["tileInfo"in a?a.tileInfo?.spatialReference:a.spatialReference]).filter(Boolean);return e.spatialReference?{spatialReference:t.find((r=>e.spatialReference.equals(r)))??t[0]??null,updating:!1}:{spatialReference:t[0],updating:!1}}const R=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function I(e){if(!e)return !1;const r=new y$1(Q(e));return R.test(r.authority)}function T(e){return e?!e.loaded&&e.resourceInfo?q(e.resourceInfo.data):{baseLayers:w(e.baseLayers),referenceLayers:w(e.referenceLayers)}:null}function w(e){return (j$2.isCollection(e)?e.toArray():e).map(j$1)}function j$1(e){return {type:e.type,url:A("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl),minScale:"minScale"in e&&null!=e.minScale?e.minScale:0,maxScale:"maxScale"in e&&null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visible||!!e.visible,sublayers:"map-image"!==e.type&&"wms"!==e.type||!r$4(e.sublayers)?void 0:e.sublayers?.map((e=>({id:e.id,visible:e.visible}))),activeLayerId:"wmts"===e.type?e.activeLayer?.id:void 0}}function q(e){return e?{baseLayers:x(e.baseMapLayers.filter((e=>!e.isReference))),referenceLayers:x(e.baseMapLayers.filter((e=>e.isReference)))}:null}function x(e){return e.map((e=>U(e)))}function U(e){let r;switch(e.layerType){case"VectorTileLayer":r="vector-tile";break;case"ArcGISTiledMapServiceLayer":r="tile";break;default:r="unknown";}return {type:r,url:A(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:null!=e.minScale?e.minScale:0,maxScale:null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visibility||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}function M(e,r,a){if(null!=e!=(null!=r))return "not-equal";if(!e)return "equal";if(!k(e.baseLayers,r.baseLayers))return "not-equal";return k(e.referenceLayers,r.referenceLayers)?"equal":a.mustMatchReferences?"not-equal":"base-layers-equal"}function k(e,r){if(e.length!==r.length)return !1;for(let a=0;a<e.length;a++)if(!$(e[a],r[a]))return !1;return !0}function $(e,r){if(e.type!==r.type||e.url!==r.url||e.minScale!==r.minScale||e.maxScale!==r.maxScale||e.visible!==r.visible||e.opacity!==r.opacity)return !1;if(r$4(e.activeLayerId)||r$4(r.activeLayerId))return e.activeLayerId===r.activeLayerId;if(r$4(e.sublayers)||r$4(r.sublayers)){if(t$2(e.sublayers)||t$2(r.sublayers)||e.sublayers.length!==r.sublayers.length)return !1;for(let a=0;a<e.sublayers.length;a++){const t=e.sublayers.at(a),n=r.sublayers.at(a);if(t.id!==n.id||t.visible!==n.visible)return !1}}return !0}function A(e){return e?F(e).replace(/^\s*https?:/i,"").toLowerCase():""}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const i=s.getLogger("esri.support.groundUtils"),t={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function a(r){let a=null;if("string"==typeof r)if(r in t){const o=t[r];a=new A$1({resourceInfo:{data:{layers:[o]}}});}else i.warn(`Unable to find ground definition for: ${r}. Try "world-elevation"`);else a=b$1(A$1,r);return a}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let j=class extends(p$2(y$2(n$4.EventedMixin(y$3)))){constructor(s){super(s),this.allLayers=new p$3({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:s=>"layers"in s?s.layers:null}),this.allTables=t$3(this),this.basemap=null,this.editableLayers=new p$3({getCollections:()=>[this.allLayers],itemFilterFunction:i$1}),this.ground=new A$1,this._basemapCache=p();}destroy(){this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.ground?.destroy(),this.basemap?.destroy(),y(this._basemapCache),this._basemapCache=null;}castBasemap(s){return m(s,this._basemapCache)}castGround(s){const e=a(s);return t$2(e)?this._get("ground"):e}findLayerById(s){return this.allLayers.find((e=>e.id===s))}findTableById(s){return this.allTables.find((e=>e.id===s))}};e([d$1({readOnly:!0,dependsOn:[]})],j.prototype,"allLayers",void 0),e([d$1({readOnly:!0})],j.prototype,"allTables",void 0),e([d$1({type:x$1})],j.prototype,"basemap",void 0),e([s$3("basemap")],j.prototype,"castBasemap",null),e([d$1({readOnly:!0})],j.prototype,"editableLayers",void 0),e([d$1({type:A$1,nonNullable:!0})],j.prototype,"ground",void 0),e([s$3("ground")],j.prototype,"castGround",null),j=e([n("esri.Map")],j);const L=j;

const _Map = /*#__PURE__*/Object.freeze({
	__proto__: null,
	'default': L
});

export { A$1 as A, L, S, _Map as _, d, h, m, v };
