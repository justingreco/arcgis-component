import { r as r$1, k as t$1, a0 as o$1, t as t$2, a as s$1 } from './cast-3d5be210.js';
import './geometry-2f332a26.js';
import { k as k$1 } from './Point-edff2a11.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var e;function n$1(e,n){return null===a$1(e,n)}function a$1(n,a){switch(n.type){case"range":{const r="range"in n?n.range[0]:n.minValue,u="range"in n?n.range[1]:n.maxValue;if(+a<r||+a>u)return e.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(null==n.codedValues||n.codedValues.every((e=>null==e||e.code!==a)))return e.INVALID_CODED_VALUE}return null}function r(e){if(!e||"range"!==e.type)return;return {min:"range"in e?e.range[0]:e.minValue,max:"range"in e?e.range[1]:e.maxValue}}!function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value";}(e||(e={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let t;function a(){return t||(t=(async()=>{const e=await import('./arcadeUtils-d51c63c3.js').then(function (n) { return n.t; });return {arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),t}const s=(e,r,t)=>o.create(e,r,t,null,["$feature"]),i=(e,r,t)=>o.create(e,r,t,null,["$feature","$view"]),c$1=i,n=(e,r,t,a)=>o.create(e,r,t,a,["$feature","$view"]);class o{constructor(e,r,t,a,s,i,c,n){this.script=e,this.evaluate=s;const o=Array.isArray(c)?c:c.fields;this.fields=o,this._syntaxTree=a,this._arcade=r,this._arcadeDictionary=t,this._arcadeFeature=i,this._spatialReference=n,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale");}static async create(t,s,i,c,n,l){const{arcade:u,Feature:p,Dictionary:y}=await a(),f=k$1.fromJSON(s),m=u.parseScript(t,l),h=n.reduce(((e,r)=>({...e,[r]:null})),{});let d=null;r$1(c)&&(d=new y(c),d.immutable=!0,h.$config=null);const _=u.scriptUsesGeometryEngine(m)&&u.enableGeometrySupport(),F=u.scriptUsesFeatureSet(m)&&u.enableFeatureSetSupport(),w=u.scriptIsAsync(m)&&u.enableAsyncSupport(),S={vars:h,spatialReference:f,useAsync:!!w},b=new y;b.immutable=!1,b.setField("scale",0);const $=u.compileScript(m,S),x=e=>("$view"in e&&e.$view&&(b.setField("scale",e.$view.scale),e.$view=b),d&&(e.$config=d),$({vars:e,spatialReference:f}));return await Promise.all([_,F,w]),new o(t,u,y,m,x,new p,i,f)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(e){return this._arcade.referencesMember(this._syntaxTree,e)}referencesFunction(e){return this._arcade.referencesFunction(this._syntaxTree,e)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const u=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],f=["field","normalizationField"];function c(e,n){if(null!=e&&null!=n)for(const i of Array.isArray(e)?e:[e])if(d(u,i,n),"visualVariables"in i&&i.visualVariables)for(const e of i.visualVariables)d(f,e,n);}function d(e,n,i){if(e)for(const o of e){const e=t$1(o,n),l=e&&"function"!=typeof e&&i.get(e);l&&o$1(o,l.name,n);}}function m(e,n){if(null!=e&&n?.fields.length)if("startField"in e){const i=n.get(e.startField),t=n.get(e.endField);e.startField=i&&i.name||null,e.endField=t&&t.name||null;}else {const i=n.get(e.startTimeField),t=n.get(e.endTimeField);e.startTimeField=i&&i.name||null,e.endTimeField=t&&t.name||null;}}const p=new Set;function y(e,n){return e&&n?(p.clear(),g(p,e,n),Array.from(p).sort()):[]}function g(e,n,i){if(i)if(n?.fields?.length)if(i.includes("*"))for(const{name:t}of n.fields)e.add(t);else for(const t of i)F(e,n,t);else {if(i.includes("*"))return e.clear(),void e.add("*");for(const n of i)e.add(n);}}function F(e,n,i){if("string"==typeof i)if(n){const t=n.get(i);t&&e.add(t.name);}else e.add(i);}function I(e,i){return t$2(i)||t$2(e)?[]:i.includes("*")?e.fields.map((e=>e.name)):i}function x(e,n,i=1){if(!n||!e)return [];if(n.includes("*"))return ["*"];const t=y(e,n);return t.length/e.fields.length>=i?["*"]:t}async function b(e,n,i){if(!i)return;const{arcadeUtils:t}=await a(),r=t.extractFieldNames(i,n?.fields?.map((e=>e.name)));for(const o of r)F(e,n,o);}async function T(n,i,t){if(t&&"1=1"!==t){const r=(await import('./WhereClause-ae6d22ff.js')).WhereClause.create(t,i);if(!r.isStandardized)throw new s$1("fieldUtils:collectFilterFields","Where clause is not standardized",{where:t});g(n,i,r.fieldNames);}}function h({displayField:e,fields:n}){return e||(n&&n.length?S(n,"name-or-title")||S(n,"unique-identifier")||S(n,"type-or-category")||w(n):null)}function w(e){for(const n of e){if(!n||!n.name)continue;const e=n.name.toLowerCase();if(e.includes("name")||e.includes("title"))return n.name}return null}function S(e,n){for(const i of e)if(i&&i.valueType&&i.valueType===n)return i.name;return null}async function v(e){if(!e)return [];const n=new Set;return await A(n,e),Array.from(n).sort()}async function A(e,n){if(!n)return;const i=t$1("elevationInfo.featureExpressionInfo",n);return i?i.collectRequiredFields(e,n.fieldsIndex):void 0}async function E(e,n,i){i.outStatistic.onStatisticValueExpression?b(e,n,i.outStatistic.onStatisticValueExpression):e.add(i.outStatistic.onStatisticField);}async function N(e,n,i){if(!n||!i||!("fields"in i))return;const t=[];if(i.popupTemplate?.expressionInfos&&t.push(...i.popupTemplate.expressionInfos.map((i=>b(e,n.fieldsIndex,i.expression)))),Array.isArray(i.popupTemplate?.content)){const r=i.popupTemplate.content;for(const i of r)"expression"===i.type&&i.expressionInfo&&t.push(b(e,n.fieldsIndex,i.expressionInfo.expression));}i.fields&&t.push(...i.fields.map((i=>E(e,n.fieldsIndex,i)))),await Promise.all(t);}async function V(e,n,t){n&&(n.timeInfo&&r$1(t)&&t.timeExtent&&g(e,n.fieldsIndex,[n.timeInfo.startField,n.timeInfo.endField]),n.floorInfo&&g(e,n.fieldsIndex,[n.floorInfo.floorField]),r$1(t)&&r$1(t.where)&&await T(e,n.fieldsIndex,t.where));}async function _(e,n,i){n&&i&&await Promise.all(i.map((i=>D(e,n,i))));}async function D(e,n,i){n&&i&&(i.valueExpression?await b(e,n.fieldsIndex,i.valueExpression):i.field&&F(e,n.fieldsIndex,i.field));}async function $(e){if(!e)return [];const n="timeInfo"in e&&e.timeInfo;return n?y(e.fieldsIndex,[e.trackIdField,n.startField,n.endField]):[]}function L(e){if(!e)return [];const n="editFieldsInfo"in e&&e.editFieldsInfo;return n?y(e.fieldsIndex,[n&&n.creatorField,n&&n.creationDateField,n&&n.editorField,n&&n.editDateField]):[]}function O(e){if(!e)return [];const n=e.geometryFieldsInfo;return n?y(e.fieldsIndex,[n.shapeAreaField,n.shapeLengthField]):[]}async function U(e){if(!e)return [];const n=new Set;return await j(n,e),Array.from(n).sort()}async function j(e,n){const{labelingInfo:i,fieldsIndex:t}=n;i&&i.length&&await Promise.all(i.map((n=>z(e,t,n))));}async function z(e,n,i){if(!i)return;const t=i.getLabelExpression(),r=i.where;if("arcade"===t.type)await b(e,n,t.expression);else {const i=t.expression.match(/{[^}]*}/g);i&&i.forEach((i=>{F(e,n,i.slice(1,-1));}));}await T(e,n,r);}function P(e){const n=e.defaultValue;return void 0!==n&&Y(e,n)?n:e.nullable?null:void 0}function k(e){return "number"==typeof e&&!isNaN(e)&&isFinite(e)}function C(e){return null===e||k(e)}const R="isInteger"in Number?Number.isInteger:e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e;function G(e){return null===e||R(e)}function W(e){return null!=e&&"string"==typeof e}function q(e){return null===e||W(e)}function M(){return !0}function Y(e,n){let i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=e.nullable?G:R;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?C:k;break;case"string":case"esriFieldTypeString":i=e.nullable?q:W;break;default:i=M;}return 1===arguments.length?i:i(n)}const J=["integer","small-integer","single","double"],X=new Set([...J,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function B(e){return null!=e&&X.has(e.type)}function H(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)}function K(e){return null!=e&&("date"===e.type||"esriFieldTypeDate"===e.type)}function Q(e,n){return null===ie(e,n)}var Z,ee;function ne(e){return null==e||"number"==typeof e&&isNaN(e)?null:e}function ie(e,n){return e.nullable&&null===n?null:B(e)&&!te(e.type,Number(n))?Z.OUT_OF_RANGE:Y(e,n)?e.domain?a$1(e.domain,n):null:ee.INVALID_TYPE}function te(e,n){const i="string"==typeof e?oe(e):e;return !!i&&(i.isInteger?R(n)&&n>=i.min&&n<=i.max:n>=i.min&&n<=i.max)}function re(e){const n=r(e.domain);return n||(B(e)?oe(e.type):void 0)}function oe(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return se;case"esriFieldTypeInteger":case"integer":return ae;case"esriFieldTypeSingle":case"single":return ue;case"esriFieldTypeDouble":case"double":return fe}}function le(e){if(!k(e))return null;if(R(e)){if(e>=se.min&&e<=se.max)return "esriFieldTypeSmallInteger";if(e>=ae.min&&e<=ae.max)return "esriFieldTypeInteger"}return e>=ue.min&&e<=ue.max?"esriFieldTypeSingle":"esriFieldTypeDouble"}!function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range";}(Z||(Z={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type";}(ee||(ee={}));const se={min:-32768,max:32767,isInteger:!0},ae={min:-2147483648,max:2147483647,isInteger:!0},ue={min:-34e37,max:12e37,isInteger:!1},fe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function ce(e$1,n,i){switch(e$1){case e.INVALID_CODED_VALUE:return `Value ${i} is not in the coded domain - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;case e.VALUE_OUT_OF_RANGE:return `Value ${i} is out of the range of valid values - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;case ee.INVALID_TYPE:return `Value ${i} is not a valid value for the field type - field: ${n.name}, type: ${n.type}, nullable: ${n.nullable}`;case Z.OUT_OF_RANGE:{const{min:e,max:t}=oe(n.type);return `Value ${i} is out of range for the number type - field: ${n.name}, type: ${n.type}, value range is ${e} to ${t}`}}}function de(e,n){return !me(e,n,null)}function me(e,n,t){if(!n||!n.attributes||!e){if(r$1(t))for(const n of e)t.add(n);return !0}const r=n.attributes;let o=!1;for(const l of e)if(!(l in r)){if(o=!0,!r$1(t))break;t.add(l);}return o}async function pe(e,n){const i=new Set;for(const t of n)await b(i,e.fieldsIndex,t);return Array.from(i).sort()}function ye(e){return ["raster.itempixelvalue","raster.servicepixelvalue"].some((n=>e.toLowerCase().startsWith(n)))}

export { A, B, F, H, I, J, K, L, N, P, V, _, a, b, c, ye as d, de as e, ne as f, g, h, i, ie as j, ce as k, j as l, m, n, o, me as p, s, y };
