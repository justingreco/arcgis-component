import { r as r$W, h as e$X, t as t$V, a as s$16, s as s$17, ag as c$$, e as e$Y, d as d$R, n as n$18, y as y$F, aQ as D$o, x as m$L, aM as O$I, O as v$N, l as a$W, H as l$N, aL as h$T, w as p$V, I as s$19, Q as N$p, m as m$N, aR as p$X, aS as s$1a, c as a$12, J as g$T, aN as n$1e, aT as u$Y, X as f$V, at as E$I, L as L$F, aU as t$13, aV as r$14, aA as n$1l, aF as n$1m, aW as y$I, aX as A$G, aY as l$Z, aC as u$13, R as e$1e, M as e$1f, as as o$1m, aZ as n$1s, ak as m$V, $ as w$D, a_ as t$1i, a$ as n$1v, U as k$F, _ as d$12, A as v$X, b0 as u$1a, aI as U$y, aD as A$L, b1 as F$v, aw as A$N, v as n$1A, aa as i$1n, b2 as s$1v, b3 as n$1C, b4 as M$z, E as E$Q, ah as x$Q, b5 as d$16, b6 as u$1e, b7 as f$19, b8 as s$1y, aO as e$1x, b9 as h$19, ba as c$1s, bb as F$x, b as b$L, z as r$1r, aG as t$1u, u as r$1s } from './cast-3d5be210.js';
import { u as u$1b, d as d$14 } from './Viewpoint-e3d4029a.js';
import { d as d$_ } from './geometry-2f332a26.js';
import { g as g$Y } from './Graphic-93f45ded.js';
import { n as n$17, j as j$F, E as E$R } from './Collection-a38e0489.js';
import { b as e$1z } from './jsxFactory-4cd653a4.js';
import { f as f$R, l as l$M, U as U$s, a as a$Z, h as h$V, w as w$x, j as j$O } from './reactiveUtils-bd6fe823.js';
import { i as i$12, x as x$J, p as p$_, d as d$V, u as u$12, e as e$1j, c as c$1n, s as s$1w } from './screenUtils-31d073db.js';
import { c as c$1t } from './workers-c7a27acb.js';
import { a as o$W, n as n$16, P as P$u, b as r$V, z as z$s, _ as _$v, M as M$t, T as p$U, V as x$F, W as j$E, X as y$E, o as o$X, m as m$M, r as r$X, s as s$1b, Z as s$1c, $ as I$z, a0 as G$l, q as q$p, e as e$15, A as A$C, u as u$W, L as L$E, v as v$P, x as x$H, g as t$12, H as H$n, h as l$U, c as b$D, O as O$K, B as a$15, F as F$t, Q as D$r, a1 as J$g, a2 as Z$h, a3 as X$b, a4 as b$E, w as w$z, p as p$$, k as j$I, a5 as f$_, D as r$17, G as l$X, l as l$$, a6 as e$1d, a7 as a$1f, a8 as c$1k, t as t$1k, a9 as N$s, aa as g$$, d as o$1q, E as s$1u, ab as i$1m, y as u$1d, S as S$M, Y as Y$f, ac as f$1a, ad as m$$, ae as l$1a, af as G$r, ag as V$t, j as j$S } from './mathUtils-559a53d9.js';
import { a as a$1r } from './GraphicsCollection-851bdafb.js';
import { v as v$$ } from './HeightModelInfo-12951268.js';
import { C as Ce$1, j as jn, P as Pn, U as Un, q as qn, H as Hn, z as zn, n as ne$b, d as dn, A as An, B as Bn, I as In, S as Sn, R as Re$1, b as bn, r as rn } from './projection-fbd5d346.js';
import { u as u$T, f as f$P, D as D$s, z as z$u, s as s$1k, l as l$Y, h as h$_, E as E$L, M as M$w, a as a$1e, m as m$Y, p as p$17, o as o$1r, d as d$13, K as K$j, b as b$J, q as q$t, c as c$1p, I as I$B, U as U$A, R as R$z, k as k$G, y as y$J, g as g$15 } from './aaBoundingRect-5e1a4e52.js';
import { V as Vs, D as D$n, p as p$W, b as a$X, y as y$G, d as a$11, m as m$Q, e as n$1h, f as m$R, x as x$K, Z as Z$i, h as h$W, G as G$n, X as X$c, g as cs, l as ls, t as t$1b, j as a$1b, k as i$18, o as t$1c, q as i$1e, s as t$1g, U as U$v, u as p$18, v as he$d, B as B$v, $ as $$k, w as ue$f, z as ee$8, A as ge$9, C as xe$3, E as g$10, F as fe$c, Y as Y$e, H as ce$f, _ as _$D, I as je$1, c as pe$d, J as A$M, K as c$1o, L as s$1t, r as r$1f, M as re$7, N as fs, O as i$1s, P as u$1h, Q as z$w } from './viewpointUtils-4c294048.js';
import { n as n$15, h as h$U, f as f$T, Q as Q$j, F as F$s, u as u$Z, m as m$P, p as p$Z, r as r$12, b as b$C, l as l$S, A as A$F, o as o$15, c as c$17, E as E$N, x as x$N, s as s$1q, i as i$1f, C as C$C, v as v$_ } from './mat4-d5df0e58.js';
import { p as p$T, O as O$H, z as z$t } from './unitUtils-a0a11e54.js';
import { k as k$z, P as P$v, c as s$15, i as f$O, l as c$_, s as s$18, A as A$E, g as g$11, j as j$P, u as u$1c, T as T$H, t as t$1r, e as e$1s } from './Point-edff2a11.js';
import { t as tt$8, L as L$B, n as n$14, a as a$_, j as j$G, U as U$u, w as w$y, B as B$r, T as T$D, $ as $$j, d as d$U, f as f$W, _ as _$x, G as G$o, E as E$K, O as O$M, C as C$A, i as i$1l, b as k$H } from './sphere-4710475c.js';
import { i as i$1t } from './scaleUtils-c3d4b164.js';
import { s as s$1s, f as f$15, t as t$1m, i as i$1o, r as r$1q, n as n$1K } from './layerUtils-160a1a44.js';
import { n as n$1j, i as i$13, t as t$14, F as r$16, c as i$14, s as s$1g, I as o$16, a as t$17, u as u$_, f as n$1k, o as o$17, h as a$18, j as s$1i, k as c$18, l as e$1b, m as g$V, J as o$1s, K as i$1j, U as U$B, L as r$1l, M as e$1u, _ as _$F, w as w$H, p as g$18, q as p$1f, r as G$s, N as n$1J, A as o$1A, B as r$1o, C as i$1u } from './DefaultUI-a0db5719.js';
import { u as u$U } from './Handles-54afc0a7.js';
import { M as M$u, f as f$Q } from './Extent-f27111e1.js';
import { h as h$S } from './ElevationSampler-86027644.js';
import { S as S$E } from './TileInfo-3c9e9a6a.js';
import { l as l$O, a as a$1p, o as o$1B } from './ViewingMode-4a1cffad.js';
import { d as d$S, c as c$14 } from './HandleOwner-fe336959.js';
import { b as U$t, p as p$Y, _ as _$w, q as q$q, c as x$I, W as W$i, Z as Z$g, k as k$A, H as H$o, i as i$11, s as s$1f, T as T$E, L as L$G, P as P$x, l as l$10, d as j$J, e as k$C, f as p$13, g as b$I, I as I$A, h as L$J, m as P$z, n as a$1j, o as p$16, a as U$x, r as h$15, v as v$Y, O as O$O, A as A$K, Q as Q$l, t as g$12, u as j$R, w as g$14 } from './frustum-95850b85.js';
import { l as l$T } from './Color-25ce730a.js';
import { n as n$1a, r as r$Z, e as e$1a, l as l$W, t as t$1a, _ as _$y } from './vec4f64-011248e0.js';
import { r as r$Y, m as m$S, a as a$16, S as S$F, l as l$11, s as s$1n, A as A$J, b as b$G, o as o$1l, j as j$K, x as x$L, v as v$U, H as H$q, _ as _$C, q as q$s } from './vec2-4f9a494f.js';
import { n as n$1b, f as f$S, r as r$13, i as i$16, t as t$1l, e as e$1m } from './vec2f64-2956001b.js';
import { e as e$10, t as t$11, r as r$1a, o as o$1g } from './mat4f64-ef2c1a38.js';
import { n as n$19, i as i$Z, a as i$_, d as d$T, o as o$Y, e as e$Z, b as e$_, c as a$Y, f as e$$, g as e$11, h as o$Z, E as E$E, t as t$W, j as t$X, k as e$12, u as u$V, A as A$B, l as t$Y, m as a$$, p as o$_, s as s$1d, q as e$14, r as a$10, v as m$O, w as l$Q, x as t$Z, y as o$$, z as o$10, B as c$11, C as E$G, D as e$17, F as o$11, G as r$10, H as o$12, I as g$S, J as e$19, K as A$D, L as n$1g, M as i$10, N as c$15, O as c$19, P as d$W, Q as c$1a, R as f$Y, S as i$15, T as L$H, U as u$$, V as o$19, W as s$1j, X as t$18, Y as e$1c, Z as o$1a, _ as o$1b, $ as t$19, a0 as o$1c, a1 as a$19, a2 as i$17, a3 as d$X, a4 as o$1d, a5 as f$Z, a6 as d$Y, a7 as L$I, a8 as h$Y, a9 as o$1e, aa as h$Z, ab as p$10, ac as B$s, ad as g$X, ae as d$Z, af as r$19, ag as e$1g, ah as t$1d, ai as o$1h, aj as e$1h, ak as n$1q, al as e$1i, am as o$1k, an as f$11, ao as s$1m, ap as m$U, aq as l$14, ar as P$y, as as i$1b, at as v$S, au as c$1d, av as n$1r, aw as t$1f, ax as c$1e, ay as r$1c, az as h$10, aA as x$M, aB as p$12, aC as R$w, aD as e$1k, aE as E$O, aF as n$1u, aG as o$1n, aH as B$u, aI as U$w, aJ as _$B, aK as J$i, aL as v$W, aM as o$1o, aN as m$X, aO as a$1h, aP as e$1l, aQ as c$1l, aR as i$1i, aS as O$N, aT as w$E, aU as r$1h, aV as n$1z, aW as e$1n, aX as V$s, aY as A$Q, aZ as w$F, a_ as A$R, a$ as f$17, b0 as r$1i, b1 as o$1u, b2 as o$1v, b3 as t$1o, b4 as r$1k, b5 as N$u, b6 as e$1q, b7 as i$1p, b8 as i$1q, b9 as e$1r, ba as F$w, bb as n$1E, bc as a$1m, bd as m$10, be as t$1p, bf as t$1q, bg as p$1d, bh as d$17, bi as m$11, bj as h$18, bk as u$1f, bl as t$1s, bm as o$1x, bn as c$1q, bo as n$1G, bp as g$16, bq as g$17, br as c$1r, bs as W$j, bt as e$1v, bu as i$1r, bv as a$1n } from './objectResourceUtils-e575a410.js';
import { O as O$J } from './VertexAttribute-ef09ced9.js';
import { R as R$u, I as I$y, E as E$F, Y as Y$d, M as M$v, P as P$w, G as G$m, D as D$q, L as L$C, F as F$r, V as V$q, _ as _$z, C as C$B, B as B$x, U as U$C, T as T$I } from './enums-4770f29d.js';
import { W as W$h, l as l$P, c as c$10, s as s$1e, r as r$11, a as c$12, t as t$10, O as O$L, b as a$1a, E as E$J, u as u$11, A as A$I, o as o$1j, i as i$1a, d as c$1c, e as l$13, S as S$H, f as f$12, g as i$1c, _ as _$A, n as n$1t, h as l$18, C as C$z, j as o$1p, k as h$14, m as t$1n, p as a$1l, q as e$1y, D as D$u } from './OrderIndependentTransparency-b8c8f539.js';
import { v as v$O, y as y$H, x as x$G, B as B$w, S as S$L } from './quat-43e08490.js';
import { b as e$13, e as e$16 } from './quatf64-06b7eadd.js';
import { r as r$_, c as c$16, f as f$X } from './vectorStacks-3fa8ee55.js';
import { a as a$13, o as o$14, j as j$L, u as u$18, p as p$1c, f as f$18 } from './mat3-eb8de168.js';
import { t as t$_, n as n$1p } from './vec2f32-23e4a539.js';
import { r as r$$, a as a$14, n as n$1c, t as t$$, e as e$1o } from './vec3f32-03e33744.js';
import { D as D$p, n as n$1d, f as f$U, c as c$13, R as R$v, E as E$H, u as u$14, r as r$1n } from './FramebufferObject-bfb23fd2.js';
import { L as L$D, N as N$q, Q as Q$k, w as w$C, A as A$O } from './Scheduler-ed7a36dc.js';
import { o as o$13, y as y$K, A as A$S, a as o$1z, f as f$1b, D as D$t, e as e$1w, u as u$1g, T as T$J, d as d$18, w as w$G } from './EdgeProcessingWorker-87151cf6.js';
import { T as T$C } from './InterleavedLayout-fe763b01.js';
import { l as l$R, g as g$W, h as h$$, u as u$16, c as c$1m, n as n$1w, S as S$I } from './DefaultMaterial_COLOR_GAMMA-ba792f7e.js';
import { e as e$18, i as i$$, g as g$U, l as l$V, k as k$B, m as m$T, M as M$x, f as f$13, s as s$1o, u as u$15, h as h$11 } from './Util-73f4ac53.js';
import { u as u$X } from './Texture-f189b7ba.js';
import { n as n$1f, a as a$1o } from './assets-99f5c3ee.js';
import { n as n$1i } from './compilerUtils-d149ad5f.js';
import { r as r$15, i as i$1k } from './Cyclical-922b1741.js';
import { j as j$H, a as u$10, c as c$1b, f as f$$, l as l$16, p as p$14, L as L$K, V as V$u } from './utils-eafc976f.js';
import { t as t$15, a as t$16, s as s$1h, b as a$17, h as h$X, c as s$1x, y as y$L } from './RenderingContext-f60b1ec5.js';
import { o as o$18, r as r$1m } from './floatRGBA-64e5bf11.js';
import { n as n$1o, a as a$1g } from './asyncUtils-96c00c9e.js';
import { v as v$Q, J as J$h, w as w$B } from './dehydratedFeatures-7b45465d.js';
import { createLabelFunction as p$15 } from './labelFormatUtils-d19cf46d.js';
import { o as d$$, q as i$19, r as o$1i, s as j$M, t as c$1j, u as t$1j, e as h$17, v as S$J, w as j$Q, b as S$K, z as f$16 } from './symbols-ab3e849a.js';
import { S as S$G, z as z$v, a as a$1d, q as q$r, w as w$A, B as B$t, p as p$11, V as V$p, E as E$M, A as A$H, H as H$p, f as f$10, l as l$12, G as G$p, M as M$y, R as R$x, c as c$1g, h as h$12, g as g$_, F as F$u, u as u$19, N as N$t, v as v$Z } from './aaBoundingBox-b312516d.js';
import { l as l$_, s as s$1l, b as o$1f, v as v$R, a as m$Z } from './Polyline-dcdb3782.js';
import { r as r$18, n as n$1n, a as m$W } from './commonProperties-fca3036e.js';
import { a as a$1c, i as i$1g } from './fieldUtils-240a3b99.js';
import { r as r$1b, o as o$1t } from './byteSizeEstimations-5d50d6ff.js';
import { t as te$8 } from './featureConversionUtils-3f60eb15.js';
import { x as x$O } from './earcut-4e6b97b1.js';
import { T as T$F, i as i$1h, u as u$17, b as b$H, l as l$19, h as h$13, c as c$1i, d as d$11, x as x$P, a as a$1i } from './BufferView-a9ba6e5d.js';
import { t as t$1h, r as r$1d, e as e$1t } from './vec33-241a09d2.js';
import { a as N$r } from './UniqueValueRenderer-bb66af10.js';
import { l as l$17, c as c$1f, a as c$1h, f as f$14 } from './MeshComponent-b778671b.js';
import { t as t$1e } from './ProgramCache-0964dba1.js';
import { G as G$q } from './Octree-38bc90df.js';
import { b as b$F, l as l$15, k as k$D, v as v$T } from './lineSegment-99193ade.js';
import { s as s$1p, i as i$1d, h as h$16, r as r$1g } from './MemCache-04cdd0cd.js';
import { n as nt$5, I as It$1, U as U$z } from './request-ac4d8bfb.js';
import { g as g$Z } from './utils-2bda91e5.js';
import { s as s$1r } from './callExpressionWithFeature-cfe9aa0a.js';
import { d as d$10 } from './CIMSymbol-15bdb580.js';
import { R as R$y, v as v$V, j as j$N, V as V$r, k as k$E } from './projection-a57f78d7.js';
import { r as r$1e, E as E$P, g as g$13, A as A$P, d as d$15, O as O$P, _ as _$E, T as T$G, n as n$1F } from './DefaultVertexAttributeLayouts-664d07a8.js';
import { getGeometryServiceURL as n$1x } from './geometryServiceUtils-b4e25893.js';
import { a as a$1k, n as n$1y } from './project-248cf8a5.js';
import { p as p$19 } from './CollectionFlattener-9ce72729.js';
import { o as o$1w } from './aliasOf-bdfe6662.js';
import { p as p$1b } from './RefreshableLayer-496830b9.js';
import { n as n$1B, a as n$1H } from './LercDecoder-0b4fb3f9.js';
import { m as m$_, p as p$1a } from './VectorTile-93124859.js';
import { n as n$1D, r as r$1j, I as I$C, e as e$1p } from './I3SBinaryReader-1f7e5bc9.js';
import { b as b$K } from './Query-1f6c7e43.js';
import { o as o$1y, n as n$1I } from './context-util-5ae1bf7b.js';
import { m as m$12, p as p$1e, r as r$1p, l as l$1b, a as a$1q, y as y$M } from './screenshotUtils-af7d4bfe.js';
import { t as t$1t } from './GoTo-929e809f.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function h$R(t){const{value:n,operations:e}=t;return {operations:e,value:e.create(n)}}function j$D(t,n,e){return t.operations.setExtent(t.value,n,e.value),e}function d$Q(t){return {operations:t,value:t.create()}}function A$A(t,n,e=d$Q(t)){return e.operations=t,t.copy(n,e.value),e}function k$y(t){return A$A(tt$8,L$B(0,0,0,p$T(t).radius))}const x$E=2**50;function y$D(){return A$A(Vs,D$n([0,0,0],[x$E,0,0],[0,x$E,0]))}function P$t(t,n){return B$q.operations=t,B$q.value=n,B$q}function R$t(t,n,e){return t.operations.axisAt(t.value,n,n$14.Z,e)}function S$D(t,n,e,o){return t.operations.axisAt(t.value,n,e,o)}function b$B(t,n,e){return t.operations.intersectRay(t.value,n,e)}function C$y(t,n){return t.operations.intersectRay(t.value,n,null)}function E$D(t,n,e){return t.operations.closestPoint(t.value,n,e)}function g$R(t,n,e){return t.operations.intersectRayClosestSilhouette(t.value,n,e)}function G$k(t,n,e){return t.operations.closestPointOnSilhouette(t.value,n,e)}function O$G(t,n){return t.operations.distanceToSilhouette(t.value,n)}function T$B(t,n){return t.operations.altitudeAt(t.value,n)}function Z$f(t,n,e,o){return t.operations.setAltitudeAt(t.value,n,e,o)}function q$o(e,o,r,u){return o!==u&&n$15(u,o),o$W(z$r,u[12],u[13],u[14]),Z$f(e,z$r,r,z$r),u[12]=z$r[0],u[13]=z$r[1],u[14]=z$r[2],u}function w$w(t,n,e){return t.operations.elevate(t.value,n,e.value)}const z$r=n$16(),B$q={operations:null,value:null};function D$m(t,n,o,r,u){return u[0]=P$u(t,n),u[1]=P$u(t,o),u[2]=P$u(t,r),u}function F$q(t,n,e,i,a){r$V(e,t),r$V(I$x,n),z$s(I$x,I$x),_$v(i,I$x,e),_$v(a,i,e);}function H$m(t,n){return t?O$H(n):n.isGeographic?k$z.PlateCarree:n}const I$x=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const v$M=12;class M$s{constructor(e){const i=M$s.checkUnsupported(e);if(r$W(i))throw i;const t=e$X(e);this.spatialReference=t.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=Ce$1(this.spatialReference)||P$v(this.spatialReference)||s$15(this.spatialReference),this.origin=[t.origin.x,t.origin.y],this.pixelSize=t.size[0],this.dpi=t.dpi;const s=t.lods.reduce(((e,i,t)=>(i.level<e.min&&(e.min=i.level,e.minIndex=t),e.max=Math.max(e.max,i.level),e)),{min:1/0,minIndex:0,max:-1/0}),l=t.lods[s.minIndex],o=2**l.level;let a=l.resolution*o,c=l.scale*o;this.levels=new Array(s.max+1);for(let r=0;r<this.levels.length;r++)this.levels[r]={resolution:a,scale:c,tileSize:[a*t.size[0],a*t.size[1]]},a/=2,c/=2;}clone(){return new M$s(this.toTileInfo())}toTileInfo(){return new S$E({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(((e,i)=>({level:i,scale:e.scale,resolution:e.resolution})))})}getExtent(e,i,t,s){const r=this.levels[e],l=r.tileSize[0],n=r.tileSize[1];s[0]=this.origin[0]+t*l,s[2]=this.origin[0]+(t+1)*l,s[3]=this.origin[1]-i*n,s[1]=this.origin[1]-(i+1)*n;}convertExtentToRadians(e,t){this._isWebMercator?(t[0]=f$O(e[0]),t[1]=c$_(e[1]),t[2]=f$O(e[2]),t[3]=c$_(e[3])):this._isGCS&&(t[0]=M$t(e[0]),t[1]=M$t(e[1]),t[2]=M$t(e[2]),t[3]=M$t(e[3]));}getExtentGeometry(e,i,t,s=new M$u){return this.getExtent(e,i,t,w$v),s.spatialReference=this.spatialReference,s.xmin=w$v[0],s.ymin=w$v[1],s.xmax=w$v[2],s.ymax=w$v[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(null==e)return !1;let i=!1;for(;this.levels.length<=e;){const e=this.levels[this.levels.length-1],t=e.resolution/2;this.levels.push({resolution:t,scale:e.scale/2,tileSize:[t*this.pixelSize,t*this.pixelSize]}),i=!0;}return i}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1);}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof M$s)){if(M$s.checkUnsupported(e))return !1;e=new M$s(e);}if(!e.spatialReference.equals(this.spatialReference))return !1;if(e.pixelSize!==this.pixelSize)return !1;const i=Math.min(this.levels.length,e.levels.length)-1,s=this.levels[i].resolution;let r=.5*s;if(!p$U(e.origin[0],this.origin[0],r)||!p$U(e.origin[1],this.origin[1],r))return !1;return r=.5*s/2**i/this.pixelSize*v$M,p$U(s,e.levels[i].resolution,r)}rootTilesInExtent(e,i=null,t=1/0){const s=new Array,n=this.levels[0].tileSize;if(t$V(e)||0===n[0]||0===n[1])return s;M$s.computeRowColExtent(e,n,this.origin,w$v);let o=w$v[1],a=w$v[3],h=w$v[0],c=w$v[2];const m=c-h,u=a-o;if(m*u>t){const e=Math.floor(Math.sqrt(t));u>e&&(o=o+Math.floor(.5*u)-Math.floor(.5*e),a=o+e),m>e&&(h=h+Math.floor(.5*m)-Math.floor(.5*e),c=h+e);}for(let r=o;r<a;r++)for(let e=h;e<c;e++)s.push([0,r,e]);return r$W(i)&&(i[0]=this.origin[0]+h*n[0],i[1]=this.origin[1]-a*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,i,t,s){const r=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+r-t[0])/i[0])),s[2]=Math.max(0,Math.ceil((e[2]-r-t[0])/i[0])),s[1]=Math.max(0,Math.floor((t[1]-e[3]+r)/i[1])),s[3]=Math.max(0,Math.ceil((t[1]-e[1]-r)/i[1]));}static isPowerOfTwo(e){const i=e.lods,t=i[0].resolution*2**i[0].level;return !i.some((e=>!x$F(e.resolution,t/2**e.level)))}static hasGapInLevels(e){const i=e.lods.map((e=>e.level));i.sort(((e,i)=>e-i));for(let t=1;t<i.length;t++)if(i[t]!==i[0]+t)return !0;return !1}static tileSizeSupported(e){const i=e.size[1];return i===e.size[0]&&0==(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(e){const i=e.origin;return e.lods.some((e=>null!=e.origin&&(e.origin[0]!==i.x||e.origin[1]!==i.y)))}static getMissingTileInfoError(){return new s$16("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(i){return t$V(i)?d$P():i.lods.length<1?new s$16("tilingscheme:generic","Tiling scheme must have at least one level"):M$s.isPowerOfTwo(i)?M$s.hasGapInLevels(i)?new s$16("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):M$s.tileSizeSupported(i)?M$s.hasOriginPerLODs(i)?new s$16("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new s$16("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new s$16("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,i){const t=e[2]-e[0],s=e[3]-e[1],r=z$t(i),l=1.2*Math.max(t,s),n=256,a=96,h=.0254,c=new M$s(new S$E({size:[n,n],origin:{x:e[0]-.5*(l-t),y:e[3]+.5*(l-s)},lods:[{level:0,resolution:l/n,scale:1/(n/a*h/(l*r))}],spatialReference:i}));return c.ensureMaxLod(20),c}static makeWebMercatorAuxiliarySphere(e){const i=new M$s(M$s.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(e),i}static makeGCSWithTileSize(e,i=256,t=16){const s=256/i,r=new M$s(new S$E({size:[i,i],origin:{x:-180,y:90,spatialReference:e},spatialReference:e,lods:[{level:0,resolution:.703125*s,scale:295497598.570834*s}]}));return r.ensureMaxLod(t),r}get test(){return {isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function d$P(){return new s$16("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}M$s.WebMercatorAuxiliarySphereTileInfo=new S$E({size:[256,256],origin:{x:-20037508.342787,y:20037508.342787,spatialReference:k$z.WebMercator},spatialReference:k$z.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527.591555}]}),M$s.WebMercatorAuxiliarySphere=M$s.makeWebMercatorAuxiliarySphere(19);const w$v=u$T();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const o$V=!1,t$U=64,I$w=512,e$W=2.5,C$x=j$E(y$E/10),n$13=4,r$U=4,E$C=A=>A<4?3:r$U,s$14=u$T();M$s.WebMercatorAuxiliarySphere.getExtent(0,0,0,s$14);const T$A=u$T([-180,-90,180,90]),a$V="Cannot extend surface to encompass all layers because it would result in too many root tiles.",u$S="Surface extent is too large for tile resolution at level 0.",H$l=8,V$o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC";

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const u$R=s$17.getLogger("esri.views.support.GroundViewElevationSampler");let d$O=class extends n$17.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=C$x;}initialize(){this.view.basemapTerrain.on("elevation-change",(()=>this.emit("changed",{})));}get extent(){const e=this.view.basemapTerrain;if(t$V(e.extent)||!e.spatialReference)return null;const t=f$P(e.extent,e.spatialReference);return t.zmin=e.elevationBounds.min,t.zmax=e.elevationBounds.max,t}elevationAt(e,t){if(t$V(this.extent)||!f$Q(this.extent,e,t)){const o=r$W(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return u$R.warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${o})`),this.noDataValue}return c$$(this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return h$S(e.clone(),this)}};e$Y([d$R({readOnly:!0})],d$O.prototype,"demResolution",void 0),e$Y([d$R({readOnly:!0})],d$O.prototype,"extent",null),e$Y([d$R({readOnly:!0})],d$O.prototype,"noDataValue",void 0),e$Y([d$R({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],d$O.prototype,"spatialReference",void 0),e$Y([d$R({constructOnly:!0})],d$O.prototype,"view",void 0),d$O=e$Y([n$18("esri.views.support.GroundViewElevationSampler")],d$O);const v$L=d$O;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let d$N=class extends y$F{constructor(e){super(e),this.handles=new u$U,this.view=null,this.layerViews=new j$F;}initialize(){this.handles.add(f$R((()=>this.view?.map?.ground),(e=>e.load()))),this.handles.add(this.layerViews.on("after-changes",(()=>this._layerViewsAfterChangesHandler())));}destroy(){this._set("view",null),this.handles&&(this.handles.destroy(),this.handles=null);}get elevationSampler(){return this.view?"2d"===this.view.type?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new v$L({view:this.view}):null:null}get updating(){return !this.suspended&&this.layerViews.some((e=>e.updating))}get suspended(){return !this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.handles.remove("updating"),this.handles.add(this.layerViews.map((e=>l$M((()=>e.updating),(()=>this._updateUpdating()),U$s))).toArray(),"updating"),this._updateUpdating();}_updateUpdating(){this.notifyChange("updating");}};e$Y([d$R({readOnly:!0})],d$N.prototype,"elevationSampler",null),e$Y([d$R({type:Boolean,readOnly:!0})],d$N.prototype,"updating",null),e$Y([d$R({constructOnly:!0})],d$N.prototype,"view",void 0),e$Y([d$R({type:j$F,readOnly:!0})],d$N.prototype,"layerViews",void 0),e$Y([d$R({readOnly:!0})],d$N.prototype,"suspended",null),d$N=e$Y([n$18("esri.views.GroundView")],d$N);const h$Q=d$N;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const i$Y=()=>import('./TileLayerView3D-d7fad297.js'),s$13=()=>import('./ElevationLayerView3D-9cd9732c.js'),t$T={"base-dynamic":()=>import('./BaseDynamicLayerView3D-af260155.js'),"base-elevation":s$13,"base-tile":i$Y,"bing-maps":i$Y,"building-scene":()=>import('./BuildingSceneLayerView3D-bfc33d92.js'),csv:()=>import('./CSVLayerView3D-a987d9e1.js'),elevation:s$13,feature:()=>import('./FeatureLayerView3D-e173f0d9.js'),geojson:()=>import('./GeoJSONLayerView3D-5d6b535e.js'),graphics:()=>import('./GraphicsLayerView3D-a4598a68.js'),group:()=>import('./GroupLayerView-77ad596e.js'),imagery:()=>import('./ImageryLayerView3D-eac777cb.js'),"integrated-mesh":()=>import('./IntegratedMeshLayerView3D-02ac527a.js'),"line-of-sight":()=>import('./LineOfSightLayerView3D-77b74c34.js'),"map-image":()=>import('./MapImageLayerView3D-fa8fdc8a.js'),media:()=>import('./MediaLayerView3D-2ed22d88.js'),"ogc-feature":()=>import('./OGCFeatureLayerView3D-6e28fadd.js'),"open-street-map":i$Y,"point-cloud":()=>import('./PointCloudLayerView3D-6774d23f.js').then(function (n) { return n.P; }),voxel:()=>import('./VoxelLayerView3D-854f00b1.js'),route:()=>import('./RouteLayerView3D-69559695.js'),scene:e=>null==e.profile||"mesh-pyramids"===e.profile?import('./SceneLayerView3D-64fda296.js'):import('./SceneLayerGraphicsView3D-c1adcb4f.js'),stream:()=>import('./StreamLayerView3D-bf5938d9.js'),tile:i$Y,"imagery-tile":()=>import('./ImageryTileLayerView3D-d982b2fc.js'),"vector-tile":()=>import('./VectorTileLayerView3D-0118ea51.js'),wcs:()=>import('./ImageryTileLayerView3D-d982b2fc.js'),"web-tile":i$Y,wfs:()=>import('./WFSLayerView3D-f6bf9b2f.js'),wms:()=>import('./WMSLayerView3D-b3534090.js'),wmts:()=>import('./WMTSLayerView3D-dbe27d2d.js'),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function o$U(r){const a=r.declaredClass?r.declaredClass.slice(r.declaredClass.lastIndexOf(".")+1):"Unknown",i=a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new s$16(`${i}:view-not-supported`,`${a} is not supported in 3D`)}const l$L={hasLayerViewModule:e=>r$W(t$T[e.type]),importLayerView:e=>{const r=t$T[e.type];if(t$V(r))throw o$U(e);return r(e)}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const p$S=s$17.getLogger("esri.views.3d.analysis.AnalysisViewManager3D"),V$n="analyses-owner-handles";var A$z,v$K;!function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED";}(A$z||(A$z={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED";}(v$K||(v$K={}));let g$Q=class extends d$S{constructor(e){super(e),this._allAnalysisViews=new j$F,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=D$o(),this._analysisModules={"area-measurement":{module:null},dimensioning:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}};}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(m$L("AnalysisViewManager was destroyed"));}attach(){this._connectOwners(),this._attachedToViewResolver.resolve();}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(m$L()),this._attachedToViewResolver=D$o(),this._attachedToViewResolver.promise.catch((()=>{}));}get updating(){return !this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some((e=>e.updating))}get testInfo(){return {allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const s=this._items.get(e);if(t$V(s)||s.state.list===v$K.REMOVED){throw new s$16("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e})}return s.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),V$n);}_disconnectOwners(){this.handles.remove(V$n),this._update(),this._creatingViewCount=0;}_connectAnalysesCollection(e){for(const t of e)this._addAnalysis(t);const s=e.on("after-add",(e=>this._addAnalysis(e.item))),i=e.on("after-remove",(e=>this._removeAnalysis(e.item)));return {remove:()=>{s.remove(),i.remove();for(const s of e)this._removeAnalysis(s);}}}_addAnalysis(e){const s=this._items.get(e);if(null==s){const s={state:{view:A$z.PENDING,list:v$K.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,s),s.createAnalysisViewTask=O$I((e=>this._createAnalysisViewPromise(s,e)));}else s.state.list=v$K.ADDED;}_removeAnalysis(e){const s=this._items.get(e);null!=s?(s.state.list=v$K.REMOVED,this._scheduleUpdate()):p$S.error("Trying to remove analysis which was not added");}_scheduleUpdate(){r$W(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=v$N((()=>this._update())));}_update(){this._scheduledUpdateHandle=a$W(this._scheduledUpdateHandle),this._items.forEach((e=>{if(e.state.list===v$K.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case A$z.PENDING:e.createAnalysisViewTask=h$T(e.createAnalysisViewTask);break;case A$z.CREATED:r$W(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=l$N(e.view),e.createAnalysisViewTask=null);}}));}async _createAnalysisViewPromise(e,s){const i=e.analysis,t=i.type,a=this._analysisModules[t];if(this._creatingViewCount+=1,t$V(a.module))try{a.module=await this._loadAnalysisModule(t);}catch(r){throw this._creatingViewCount-=1,r}if(p$V(s))throw this._creatingViewCount-=1,m$L("AnalysisView creation aborted");const o=new a.module.default({analysis:i,view:this.view});try{await o.when();}catch(r){throw this._creatingViewCount-=1,r}if(p$V(s))throw this._creatingViewCount-=1,o.destroy(),m$L("AnalysisView creation aborted");return e.view=o,e.state.view=A$z.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return import('./AreaMeasurementAnalysisView3D-8c686cae.js').then(function (n) { return n.A; });case"dimensioning":return import('./DimensioningAnalysisView3D-c2c2dfcd.js').then(function (n) { return n.D; });case"direct-line-measurement":return import('./DirectLineMeasurementAnalysisView3D-ce7776ec.js').then(function (n) { return n.D; });case"line-of-sight":return import('./LineOfSightAnalysisView3D-af94cf77.js');case"slice":return import('./SliceAnalysisView3D-bc767f41.js').then(function (n) { return n.S; })}}};e$Y([d$R()],g$Q.prototype,"updating",null),e$Y([d$R({constructOnly:!0})],g$Q.prototype,"view",void 0),e$Y([d$R()],g$Q.prototype,"_allAnalysisViews",void 0),e$Y([d$R()],g$Q.prototype,"_creatingViewCount",void 0),g$Q=e$Y([n$18("esri.views.3d.analysis.AnalysisViewManager3D")],g$Q);const D$l=g$Q;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const c$Z=s$17.getLogger("esri.views.3d.state.Constraints");let p$R=class extends y$F{constructor(t){super(t),this.collision=new f$N,this.distance=1/0,this.minimumPoiDistance=4;}get altitude(){return this.mode===l$O.Local?null:this._get("altitude")||null}set altitude(t){this.mode!==l$O.Local?this._set("altitude",t):c$Z.warn("Altitude constraint is ignored in local scenes");}clampAltitude(t){return this.altitude?o$X(t,this.altitude.min,this.altitude.max):t}clampTilt(t,e){if(!this.tilt)return e;const i=this.tilt(t);return o$X(e,i.min,i.max)}clampDistance(t){return Math.min(t,this.distance)}createDefaultTilt(){return this.mode===l$O.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(t){return (e,i=y$C)=>(i.min=h$P.min,i.max=t,i)}_createDefaultTiltLocal(){const t=this.collision.enabled?U$t([[4e3,h$P.max],[1e4,M$t(88)],[6e6,M$t(88)]]):()=>h$P.max;return (e,i=y$C)=>(i.min=h$P.min,i.max=t(e),i)}_createDefaultTiltGlobal(){const t=this.collision.enabled?U$t([[4e3,h$P.max],[5e4,M$t(88)],[6e6,M$t(88)],[2e7,h$P.min]]):U$t([[3e5,h$P.max],[3e6,M$t(88)],[6e6,M$t(88)],[2e7,h$P.min]]);return (e,i=y$C)=>(i.min=h$P.min,i.max=t(e),i)}};function u$Q(t){return {min:-2e5,max:4*t.radius}}e$Y([d$R()],p$R.prototype,"altitude",null),e$Y([d$R({readOnly:!0})],p$R.prototype,"collision",void 0),e$Y([d$R()],p$R.prototype,"distance",void 0),e$Y([d$R({readOnly:!0})],p$R.prototype,"minimumPoiDistance",void 0),e$Y([d$R()],p$R.prototype,"tilt",void 0),e$Y([d$R({constructOnly:!0})],p$R.prototype,"mode",void 0),p$R=e$Y([n$18("esri.views.3d.state.Constraints")],p$R);const d$M=u$Q(s$18),h$P={min:M$t(.5),max:M$t(179.5)},y$C={min:0,max:0};let f$N=class extends y$F{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5;}};e$Y([d$R({type:Boolean})],f$N.prototype,"enabled",void 0),e$Y([d$R({type:Number})],f$N.prototype,"elevationMargin",void 0),f$N=e$Y([n$18("esri.views.3d.state.Constraints.CollisionConstraint")],f$N);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let p$Q=class extends y$F{constructor(){super(...arguments),this.min=d$M.min,this.max=d$M.max;}};e$Y([d$R({type:Number})],p$Q.prototype,"min",void 0),e$Y([d$R({type:Number})],p$Q.prototype,"max",void 0),p$Q=e$Y([n$18("esri.views.3d.constraints.AltitudeConstraint")],p$Q);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let o$T=class extends y$F{constructor(){super(...arguments),this.mode="auto";}get near(){return this._get("near")}set near(t){this._set("near",t),t>=this._get("far")&&(this.far=t+1e-9),this.mode="manual";}castNear(t){return Math.max(1e-8,t)}get far(){return this._get("far")}set far(t){this._set("far",t),t<=this._get("near")&&(this.near=t-1e-9),this.mode="manual";}castFar(t){return Math.max(1e-8,t)}autoUpdate(t,r){"auto"===this.mode&&(this._get("near")!==t&&this._set("near",t),this._get("far")!==r&&this._set("far",r));}};e$Y([d$R({type:Number,value:1e-8})],o$T.prototype,"near",null),e$Y([s$19("near")],o$T.prototype,"castNear",null),e$Y([d$R({type:Number,value:1e-8})],o$T.prototype,"far",null),e$Y([s$19("far")],o$T.prototype,"castFar",null),e$Y([d$R({type:["auto","manual"]})],o$T.prototype,"mode",void 0),o$T=e$Y([n$18("esri.views.3d.constraints.ClipDistanceConstraint")],o$T);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const c$Y={min:m$M(h$P.min),max:m$M(h$P.max)};let p$P=class extends y$F{constructor(){super(...arguments),this.mode="auto";}get max(){return this._get("max")}set max(t){this._set("max",t),this.mode="manual";}castMax(t){return o$X(t,c$Y.min,c$Y.max)}autoUpdate(t){"auto"===this.mode&&this._get("max")!==t&&this._set("max",t);}};e$Y([d$R({type:["auto","manual"]})],p$P.prototype,"mode",void 0),e$Y([d$R({type:Number,value:c$Y.max})],p$P.prototype,"max",null),e$Y([s$19("max")],p$P.prototype,"castMax",null),p$P=e$Y([n$18("esri.views.3d.constraints.TiltConstraint")],p$P);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let c$X=class extends y$F{constructor(){super(...arguments),this.tilt=new p$P,this.altitude=new p$Q,this.clipDistance=new o$T;}};e$Y([d$R({type:p$P})],c$X.prototype,"tilt",void 0),e$Y([d$R({type:p$Q})],c$X.prototype,"altitude",void 0),e$Y([d$R({type:o$T})],c$X.prototype,"clipDistance",void 0),c$X=e$Y([n$18("esri.views.3d.constraints.Constraints")],c$X);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var s$12;let a$U=s$12=class extends(n$17.EventedMixin(p$W)){constructor(e){super(e),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const t=(new Date).getFullYear(),o=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",o),this._set("date",o);}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new s$12(e.cloneConstructProperties())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e);}set date(e){null!=e&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())));}autoUpdate(e,t){const o=s$12.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let n=null;null!=e&&(this.positionTimezoneInfo.autoUpdated=!0,n=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime())));const i=s$12.calculateTimezoneOffset(this.positionTimezoneInfo);if(o!==i&&(r$T.target=this,r$T.timezoneOffset=i,this.emit("timezone-will-change",r$T)),null!=e)return n!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new s$12({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return null!=e.date&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}};e$Y([d$R({type:Boolean})],a$U.prototype,"cameraTrackingEnabled",void 0),e$Y([d$R({type:Boolean})],a$U.prototype,"ambientOcclusionEnabled",void 0),e$Y([d$R({type:Boolean})],a$U.prototype,"waterReflectionEnabled",void 0),e$Y([d$R({type:Date})],a$U.prototype,"defaultDate",null),e$Y([d$R({type:Date})],a$U.prototype,"date",null),a$U=s$12=e$Y([n$18("esri.views.3d.environment.SunLighting")],a$U),function(e){function t({hours:e,minutes:t,seconds:o}){return Math.round(e+t/60+o/3600)}e.calculateTimezoneOffset=t;}(a$U||(a$U={}));const r$T={target:null,timezoneOffset:0},l$K=a$U;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var n$12;let i$X=n$12=class extends(n$17.EventedMixin(a$X)){constructor(e){super(e),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1;}clone(){return new n$12({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled})}static fromWebsceneLighting(e){return new n$12(e.cloneConstructProperties())}cloneWithWebsceneLighting(e){const t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}};e$Y([d$R({type:Boolean})],i$X.prototype,"ambientOcclusionEnabled",void 0),e$Y([d$R({type:Boolean})],i$X.prototype,"waterReflectionEnabled",void 0),i$X=n$12=e$Y([n$18("esri.views.3d.environment.VirtualLighting")],i$X);const c$W=i$X;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const i$W={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:l$K,virtual:c$W}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var t$S;let i$V=t$S=class extends y$F{set quality(r){["low","high"].includes(r)&&this._set("quality",r);}clone(){return new t$S({quality:this.quality})}};e$Y([d$R({type:["low","high"],value:"low"})],i$V.prototype,"quality",null),i$V=t$S=e$Y([n$18("esri.views.3d.environment.SceneViewAtmosphere")],i$V);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var m$K;let u$P=m$K=class extends y$G{constructor(t){super(t),this.atmosphere=new i$V,this.lighting=new l$K;}static fromWebsceneEnvironment(t){const i=t.cloneConstructProperties();return new m$K({...i,lighting:"virtual"===i.lighting.type?c$W.fromWebsceneLighting(i.lighting):l$K.fromWebsceneLighting(i.lighting)})}castLighting(t){return this._convertLighting(t)}applyLighting(t){this.lighting=this._convertLighting(t);}_convertLighting(t){return t?t instanceof l$K||t instanceof c$W?t:t instanceof p$W?this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(t):new l$K(t.cloneConstructProperties()):t instanceof a$X?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(t):new c$W(t.cloneConstructProperties()):N$p(i$W,t):new l$K}clone(){return new m$K({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:m$N(this.background)})}cloneWithWebsceneEnvironment(t){return new m$K({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:m$N(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){return "sun"===t.lighting.type?this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(t.lighting):l$K.fromWebsceneLighting(t.lighting):"virtual"===t.lighting.type?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(t.lighting):c$W.fromWebsceneLighting(t.lighting):l$K.fromWebsceneLighting(t.lighting)}};e$Y([d$R({type:i$V,json:{read:!1},nonNullable:!0})],u$P.prototype,"atmosphere",void 0),e$Y([d$R({nonNullable:!0})],u$P.prototype,"lighting",void 0),e$Y([s$19("lighting")],u$P.prototype,"castLighting",null),u$P=m$K=e$Y([n$18("esri.views.3d.environment.SceneViewEnvironment")],u$P);const b$A=u$P;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function t$R(e){const t=1e5,n=1e6;return Math.min(1,Math.max(0,(e-t)/(n-t)))}const n$11=1e4,o$S=r$X(5802e-9,13558e-9,331e-7),c$V=3,r$S=r$X(65e-8*c$V,1881e-9*c$V,85e-9*c$V),s$11=3996e-9,a$T=.085,f$M=1e5;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function e$V(e){e.fragment.code.add(n$19`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class o$R extends i$Z{constructor(r){super(r,"vec2");}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class o$Q extends i$Z{constructor(r){super(r,"vec3");}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class o$P extends i$Z{constructor(r){super(r,"vec4");}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class r$R extends i$Z{constructor(o){super(o,"float");}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$10 extends i$Z{constructor(r){super(r,"sampler2D");}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function v$J(t){const v=new i$_;v.attributes.add(O$J.POSITION,"vec2"),v.include(d$T,{textureCoordinateType:o$Y.Default}),v.varyings.add("worldRay","vec3"),v.varyings.add("eyeDir","vec3");const{vertex:x,fragment:D}=v;return x.uniforms.add([new e$Z("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new e$Z("inverseViewMatrix",((t,a)=>h$U(y$B,a.camera.viewMatrix)))]),x.code.add(n$19`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),D.uniforms.add([new e$_("lightingMainDirection",((e,t)=>t.lighting.lightingMainDirection)),new o$R("radii"),new r$R("scaleHeight"),new o$Q("cameraPosition"),new o$P("heightParameters"),new r$R("innerFadeDistance"),new r$R("altitudeFade"),new s$10("depthTex"),new o$Q("betaRayleigh"),new o$Q("betaCombined"),new r$R("betaMie"),new r$R("hazeStrength")]),v.include(e$V),t.haze&&(D.include(a$Y),D.uniforms.add(new e$$("nearFar",((e,t)=>t.camera.nearFar)))),D.code.add(n$19`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),D.code.add(n$19`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),D.code.add(n$19`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),D.code.add(n$19`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?n$19`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?n$19``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":n$19`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.05968310365 * mumu;

      ${t.haze?n$19`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:n$19`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?n$19`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:n$19`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${t.haze?n$19`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:n$19`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":n$19`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `),v}const y$B=e$10(),x$D=Object.freeze(Object.defineProperty({__proto__:null,build:v$J},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class g$P extends e$11{initializeProgram(e){const r=g$P.shader.get().build(this.configuration);return new o$Z(e.rctx,r,E$E)}initializePipeline(){return this.configuration.haze?W$h({blending:l$P(R$u.ONE,R$u.ZERO,R$u.ONE_MINUS_SRC_COLOR,R$u.ONE),colorWrite:c$10}):W$h({blending:l$P(R$u.SRC_ALPHA,R$u.ONE,R$u.ONE_MINUS_SRC_ALPHA,R$u.ONE_MINUS_SRC_ALPHA),depthTest:{func:I$y.LEQUAL},colorWrite:c$10})}}g$P.shader=new t$W(x$D,(()=>import('./ChapmanAtmosphere.glsl-ce158505.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$$ extends t$X{constructor(){super(...arguments),this.haze=!1;}}e$Y([e$12()],s$$.prototype,"haze",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class C$w{constructor(e){this._view=e,this.type="realistic",this.canRender=!0,this._cameraPosition=n$16(),this._heightParameters=n$1a(),this._betasRayleigh=n$16(),this._betasCombined=n$16(),this._scaleHeight=0,this._radii=n$1b(),this._cameraHeight=0,this._cameraHeightSq=0,this._cAtmosphere=0,this._innerFadeDistance=0,this._altitudeFade=0,this._lowerElevationBoundRadius=0,this._lowerBoundEarthRadius=s$18.radius,this._hazeStrength=1,this._darkenHaze=!1,this._updateRadius(s$18.radius);}destroy(){this._atmosphereTechnique=p$X(this._atmosphereTechnique),this._atmosphereHazeTechnique=p$X(this._atmosphereHazeTechnique),this._vao=s$1a(this._vao),this._handles=l$N(this._handles);}when(){return Promise.resolve()}initializeRenderContext(t){const i=t.renderContext.rctx,s=this._handles=new u$U,a=this._view.basemapTerrain;r$W(a.rootTiles)&&this._updateElevation({spatialReference:a.spatialReference,tile:a.rootTiles[0],extent:a.rootTiles[0].extent,context:"ground"}),s.add(a$Z((()=>this._view.basemapTerrain),"elevation-change",(e=>this._updateElevation(e)),{onListenerAdd:()=>this._updateElevation()})),s.add(a$Z((()=>this._view.basemapTerrain),"elevation-bounds-change",(()=>this._updateVisibleElevationBounds())));const r=new s$$;r.haze=!1,this._atmosphereTechnique=t.shaderTechniqueRepository.acquire(g$P,r),r.haze=!0,this._atmosphereHazeTechnique=t.shaderTechniqueRepository.acquire(g$P,r),this._vao=u$V(i,A$B),this._scaleHeight=a$T*f$M,o$W(this._betasRayleigh,o$S[0],o$S[1],o$S[2]),o$W(this._betasCombined,o$S[0]+r$S[0],o$S[1]+r$S[1],o$S[2]+r$S[2]);}render(e){this._render(e,this._atmosphereTechnique,e.offscreenRenderingHelper.depthTexture);}renderHaze(e,t){this._darkenHaze=t,this._render(e,this._atmosphereHazeTechnique,e.offscreenRenderingHelper.linearDepthTexture);}_render(e,t,i){this._update(e.bindParameters.camera);const s=e.rctx.bindTechnique(t,P$s,e.bindParameters);e.offscreenRenderingHelper.renderDepthDetached((()=>{s.bindTexture("depthTex",i),this._renderCommon(t.program,e);}));}_renderCommon(e,t){if(t$V(this._vao))return;const i=t.rctx;e.setUniform4fv("heightParameters",this._heightParameters),e.setUniform3fv("cameraPosition",this._cameraPosition),e.setUniform2fv("radii",this._radii),e.setUniform1f("scaleHeight",this._scaleHeight),e.setUniform1f("betaMie",s$11),e.setUniform3fv("betaRayleigh",this._betasRayleigh),e.setUniform3fv("betaCombined",this._betasCombined),e.setUniform1f("innerFadeDistance",this._innerFadeDistance),e.setUniform1f("altitudeFade",this._altitudeFade),e.setUniform1f("hazeStrength",this._hazeStrength),i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(E$F.TRIANGLE_STRIP,0,4);}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateElevation(e){const t=e?e.tile:c$$(this._view.basemapTerrain.rootTiles,[null])[0];if(t$V(t)||0!==t.level)return;const i=this._adjustRadiusForTesselation(s$18.radius+t.elevationBounds[0]);i!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=i,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds());}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(s$18.radius+this._view.basemapTerrain.elevationBounds.min);(this._lowerBoundEarthRadius<0||e<this._lowerBoundEarthRadius)&&this._updateRadius(e);}_updateRadius(e){this._lowerBoundEarthRadius=e,r$Y(this._radii,e,e+f$M),this._innerFadeDistance=2*Math.sqrt((2*e-n$11)*n$11);}_update(e){if(t$V(e))return;this._cameraHeight=s$1b(e.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*this._radii[1];const s=Math.min(1,Math.max(0,(this._cameraHeight-this._radii[0])/f$M));this._heightParameters=r$Z(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,s),r$V(this._cameraPosition,e.eye),this._altitudeFade=t$R(this._cameraHeight-this._lowerBoundEarthRadius),this._hazeStrength=this._darkenHaze?s$1c(.6,1,I$z(9500,10500,this._cameraHeight-s$18.radius)):1;}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}}const P$s=new t$Y;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function i$U(n=x$C){return [n[0],n[1],n[2],n[3]]}function a$S(n,t,r,u){return j$C(n,t,r,u,r$_.get())}function m$J(n,t){return j$C(n[0],n[1],n[2],t,r$_.get())}function p$O(n,t=i$U()){return j$C(n[0],n[1],n[2],n[3],t)}function j$C(n,t,r,u,o=i$U()){return o[0]=n,o[1]=t,o[2]=r,o[3]=u,o}function g$O(n,t,r=i$U()){return r$V(r,n),r[3]=t,r}function k$x(n,t,r=i$U()){return _$v(r,n,t),z$s(r,r),r[3]=a$_(n,t),r}function h$O(u,o,c=i$U()){return v$O(S$C,v$I(u),q$n(u)),v$O(b$z,v$I(o),q$n(o)),y$H(S$C,b$z,S$C),l$J(c,x$G(v$I(c),S$C))}function v$I(n){return n}function q$n(n){return n[3]}function l$J(n,t){return n[3]=t,n}const x$C=[0,0,1,0],S$C=e$13(),b$z=e$13();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class r$Q{constructor(){this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=n$16(),this.parallax={anchorPointClouds:n$16(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:e$10()},this.parallaxNew={anchorPointClouds:n$16(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:e$10()},this.crossFade={enabled:!1,factor:0,distanceThresholdFactor:.3},this.fadeInOut={stage:o$O.FINISHED,factor:0,distanceThresholdFactor:.6},this.fadeIn={stage:s$_.FINISHED,factor:0,distanceThresholdFactor:2},this.fadeInOutHeight={stage:e$U.FINISHED,factor:-1};}}var s$_,o$O,e$U;!function(t){t[t.FINISHED=0]="FINISHED",t[t.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",t[t.FADE_IN=2]="FADE_IN";}(s$_||(s$_={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.FADE_OUT=1]="FADE_OUT",t[t.SWITCH=2]="SWITCH",t[t.FADE_IN=3]="FADE_IN";}(o$O||(o$O={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.HEIGHT_FADE=1]="HEIGHT_FADE";}(e$U||(e$U={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$Z extends i$Z{constructor(e,s){super(e,"samplerCube",a$$.Pass,((r,o,t)=>r.bindTexture(e,s(o,t))));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function v$H(r){const v=r.fragment;v.uniforms.add([new e$Z("rotationMatrixClouds",((o,t)=>t.clouds.parallax.transform)),new e$Z("rotationMatrixCloudsCrossFade",((o,t)=>t.clouds.parallaxNew.transform)),new e$_("anchorPosition",((o,t)=>t.clouds.parallax.anchorPointClouds)),new e$_("anchorPositionCrossFade",((o,t)=>t.clouds.parallaxNew.anchorPointClouds)),new e$$("cloudVariables",((o,r)=>r$W(r.clouds.data)?r$Y(h$N,r.clouds.data.coverage,r.clouds.data.absorption):f$S)),new o$_("cloudsHeight",((o,t)=>t.clouds.parallax.cloudsHeight)),new o$_("radiusCurvatureCorrectionFactor",((o,t)=>t.clouds.parallax.radiusCurvatureCorrectionFactor)),new o$_("totalFadeInOut",((t,a)=>a.clouds.fadeInOut.stage===o$O.FINISHED?a.clouds.fadeInOutHeight.factor+Math.max(o$X(a.clouds.fadeIn.factor,0,1)):a.clouds.fadeInOutHeight.factor+Math.max(o$X(a.clouds.fadeInOut.factor,0,1)))),new o$_("crossFadeAnchorFactor",((t,a)=>o$X(a.clouds.crossFade.factor,0,1))),new s$Z("cubeMap",((o,a)=>r$W(a.clouds.data)?a.clouds.data.cubeMap.colorTexture:null)),new s$1d("crossFade",((o,t)=>t.clouds.crossFade.enabled))]),v.constants.add("planetRadius","float",s$18.radius),v.code.add(n$19`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),v.code.add(n$19`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),v.code.add(n$19`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),v.uniforms.add([new e$_("lightingMainDirection",((o,t)=>t.lighting.lightingMainDirection)),new e$_("lightingMainIntensity",((o,t)=>t.lighting.mainLight.intensity))]),v.code.add(n$19`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),v.code.add(n$19`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`),v.code.add(n$19`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),v.code.add(n$19`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),v.code.add(n$19`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`);}const h$N=n$1b();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function u$O(){const r=new i$_;r.attributes.add(O$J.POSITION,"vec2"),r.varyings.add("worldRay","vec3");const{vertex:u,fragment:f}=r;return u.uniforms.add([new e$Z("inverseProjectionMatrix",((e,r)=>r.camera.inverseProjectionMatrix)),new e$Z("inverseViewMatrix",((r,i)=>h$U(v$G,i.camera.viewMatrix)))]),u.code.add(n$19`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),f.include(e$14),f.include(a$10),r.include(m$O,{pbrMode:l$Q.Disabled,lightingSphericalHarmonicsOrder:2}),r.include(t$Z),r.include(e$V),r.include(o$$,{isGround:!1}),r.include(v$H,{instancedDoublePrecision:!1,isGround:!1}),f.uniforms.add([new e$_("cameraPosition",((e,r)=>r.camera.eye))]),f.code.add(n$19`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),r}const v$G=e$10(),f$L=Object.freeze(Object.defineProperty({__proto__:null,build:u$O},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class u$N extends e$11{constructor(e){super(e,null,(()=>this.destroy()));}initializeProgram(e){const r=u$N.shader.get().build();return new o$Z(e.rctx,r,E$E)}initializePipeline(){return W$h({blending:s$1e(R$u.ONE,R$u.SRC_ALPHA),depthTest:{func:I$y.LEQUAL},colorWrite:c$10})}}u$N.shader=new t$W(f$L,(()=>import('./CloudsComposition.glsl-a056284c.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function n$10(n){return r$W(n)&&r$W(n.cubeMap)&&n.coverage>0}function e$T(n){return r$W(n)&&!n.running}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let j$B=class extends y$F{constructor(t){super(t),this._technique=new u$N(t),this._vao=u$V(t.rctx);}destroy(){this._technique=p$X(this._technique),this._vao=s$1a(this._vao);}render(t,a){const e=t.bindParameters.clouds;if(t$V(this._vao)||t$V(e.data))return;if(!this._technique.compiled)return void this.requestRender();this._setParallaxParameters(e,t.bindParameters.camera.eye,a);const s=t.rctx.bindTechnique(this._technique,L$A,t.bindParameters);t.rctx.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),t.rctx.drawArrays(E$F.TRIANGLE_STRIP,0,4),k$w(e)&&this.requestRender();}_setFadeInStage(t,a){const e=performance.now(),s=t.parallax.anchorPointClouds;t.fadeIn.stage===s$_.FINISHED&&(t.fadeIn.factor=1,r$V(s,v$F),t.fadeIn.stage=s$_.CHANGE_ANCHOR,t.crossFade.enabled=!1,t.fadeInOut.stage=o$O.FINISHED);const o=G$j(t,a);t.fadeIn.stage===s$_.CHANGE_ANCHOR&&o&&e$T(t.data)&&(r$V(s,v$F),t.fadeIn.stage=s$_.FADE_IN,t.startTime=e),t.fadeIn.factor>0&&t.fadeIn.stage===s$_.FADE_IN&&(t.fadeIn.factor=1-(e-t.startTime)/y$A),t.fadeIn.factor<=0&&t.fadeIn.stage===s$_.FADE_IN&&(t.fadeIn.stage=s$_.FINISHED,t.fadeIn.factor=0);}_setCrossFadingStage(t){const a=performance.now(),{crossFade:e}=t,s=t.parallax.anchorPointClouds;t.crossFade.enabled||(r$V(t.parallaxNew.anchorPointClouds,v$F),t.startTime=a,e.factor=0,t.crossFade.enabled=!0),e.factor<1&&t.crossFade.enabled&&(e.factor=(a-t.startTime)/q$m),e.factor>=1&&t.crossFade.enabled&&(t.crossFade.enabled=!1,e.factor=1,r$V(s,t.parallaxNew.anchorPointClouds));}_setFadeInOutStage(t,a){const e=performance.now(),{fadeInOut:s,crossFade:o}=t;s.stage===o$O.FINISHED&&(t.startTime=e,s.factor=0,s.stage=o$O.FADE_OUT),s.factor<1&&s.stage===o$O.FADE_OUT&&(s.factor=(e-t.startTime)/R$s),s.factor>=1&&s.stage===o$O.FADE_OUT&&(s.factor=1,r$V(t.parallax.anchorPointClouds,v$F)),s.factor>=1&&s.stage===o$O.FADE_OUT&&G$j(t,a)&&(s.factor=1,s.stage=o$O.SWITCH,t.crossFade.enabled=!1,o.factor=1),e$T(t.data)&&s.stage===o$O.SWITCH&&(t.startTime=e,s.factor=1,s.stage=o$O.FADE_IN,r$V(t.parallax.anchorPointClouds,v$F),t.crossFade.enabled=!1,o.factor=1),s.factor>0&&s.stage===o$O.FADE_IN&&(s.factor=1-(e-t.startTime)/y$A),s.factor<=0&&s.stage===o$O.FADE_IN&&(s.stage=o$O.FINISHED,s.factor=0);}_setFadeInOutHeight(t,a){const s=performance.now(),o=t.fadeInOutHeight,r=(s-(o.stage===e$U.FINISHED?s:t.startTimeHeightFade))/U$r;o.factor+=a?-r:r,t.startTimeHeightFade=s,o.factor=o$X(o.factor,0,1),o.stage=e$U.HEIGHT_FADE;}_setParallaxParameters(t,a,e){const{parallax:s}=t;t.fadeInOutHeight.factor<0&&(t.fadeInOutHeight.factor=s$1b(a)-this.planetRadius>a$11?1:0),z$s(v$F,a),q$p(v$F,v$F,this.planetRadius),0===s.anchorPointClouds[0]&&0===s.anchorPointClouds[1]&&0===s.anchorPointClouds[2]&&r$V(s.anchorPointClouds,v$F);const o=s$1b(e$15(w$u,s.anchorPointClouds,v$F));let r=!0;o>t.fadeIn.distanceThresholdFactor*s.cloudsHeight||t.fadeIn.stage!==s$_.FINISHED?this._setFadeInStage(t,a):o>t.fadeInOut.distanceThresholdFactor*s.cloudsHeight||t.fadeInOut.stage!==o$O.FINISHED?this._setFadeInOutStage(t,a):o>t.crossFade.distanceThresholdFactor*s.cloudsHeight&&!e||t.crossFade.enabled?this._setCrossFadingStage(t):r=!1;const n=s$1b(a),c=n-this.planetRadius;if((c>1.7*a$11||c<-a$11)&&t.fadeInOutHeight.factor<1?t.fadeInOutHeight.factor=1:(c>a$11||c<-.35*a$11)&&t.fadeInOutHeight.factor<1?this._setFadeInOutHeight(t,!1):c<a$11&&c>-.35*a$11&&t.fadeInOutHeight.factor>0?this._setFadeInOutHeight(t,!0):t.fadeInOutHeight.stage=e$U.FINISHED,s.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(n*n-this.planetRadius*this.planetRadius,0))/n,k$x(A$y,s.anchorPointClouds,x$B),s.transform=e$10(),f$T(s.transform,s.transform,x$B[3],v$I(x$B)),r){const{parallaxNew:a}=t;k$x(A$y,a.anchorPointClouds,x$B),a.transform=e$10(),f$T(a.transform,a.transform,x$B[3],v$I(x$B));}r$V(t.cameraPositionLastFrame,a);}};e$Y([d$R({constructOnly:!0})],j$B.prototype,"rctx",void 0),e$Y([d$R({constructOnly:!0})],j$B.prototype,"viewingMode",void 0),e$Y([d$R({constructOnly:!0})],j$B.prototype,"planetRadius",void 0),e$Y([d$R({constructOnly:!0})],j$B.prototype,"requestRender",void 0),j$B=e$Y([n$18("esri.views.3d.environment.CloudsComposition")],j$B);const A$y=r$X(0,0,1),x$B=i$U(),v$F=n$16(),w$u=n$16(),y$A=500,R$s=250,q$m=500,U$r=500;function k$w(t){return t.crossFade.enabled||t.fadeInOut.stage!==o$O.FINISHED||t.fadeIn.stage!==s$_.FINISHED||t.fadeInOutHeight.stage!==e$U.FINISHED}function G$j(t,a){return G$l(t.cameraPositionLastFrame,a)}const L$A=new t$Y;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var t$Q;!function(e){e[e.SIXTEEN=0]="SIXTEEN",e[e.HUNDRED=1]="HUNDRED",e[e.TWOHUNDRED=2]="TWOHUNDRED",e[e.COUNT=3]="COUNT";}(t$Q||(t$Q={}));class r$P extends t$X{constructor(){super(...arguments),this.steps=t$Q.SIXTEEN;}}e$Y([e$12({count:t$Q.COUNT})],r$P.prototype,"steps",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const o$N=a$12("esri-mobile")?64:128,r$O=o$N/128,t$P=Math.ceil(Math.sqrt(o$N)),s$Y=(o$N+2)*t$P,i$T=1e5,a$R=128,c$U=s$Y/1560;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function o$M(o,t=!0){o.attributes.add(O$J.POSITION,"vec2"),t&&o.varyings.add("uv","vec2"),o.vertex.code.add(n$19`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?n$19`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class p$N extends t$Y{constructor(){super(...arguments),this.viewMatrix=e$16();}}function g$N(t){const c=new i$_;return c.include(o$M,!1),c.fragment.uniforms.add(new r$R("cloudRadius")),c.fragment.uniforms.add(new r$R("halfCubeMapSize")),c.fragment.uniforms.add(new r$R("power")),c.fragment.uniforms.add(new r$R("sigmaE")),c.fragment.uniforms.add(new r$R("density")),c.fragment.uniforms.add(new r$R("cloudSize")),c.fragment.uniforms.add(new r$R("detailSize")),c.fragment.uniforms.add(new r$R("smoothness")),c.fragment.uniforms.add(new r$R("cloudHeight")),c.fragment.uniforms.add(new r$R("coverage")),c.fragment.uniforms.add(new o$10("view",(t=>t.viewMatrix))),c.fragment.uniforms.add(new s$10("cloudShapeTexture")),c.fragment.code.add(n$19`
    const int STEPS = ${t.steps===t$Q.SIXTEEN?n$19`16`:t.steps===t$Q.HUNDRED?n$19`100`:n$19`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),c.fragment.code.add(n$19`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${n$19.float(s$Y)};
      const float dataWidth = ${n$19.float(s$Y)};
      const float tileRows = ${n$19.float(t$P)};
      const vec3 atlasDimensions = vec3(${n$19.float(o$N)}, ${n$19.float(o$N)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${n$19.float(r$O)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${n$19.float(c$U)} * p) / ${n$19.float(s$Y)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),c.fragment.code.add(n$19`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),c.fragment.code.add(n$19`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),c.fragment.code.add("\n    vec3 multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation = 1.0;\n      float contribution = 1.0;\n      float phaseAttenuation = 1.0;\n      vec3 luminance = vec3(0);\n\n      for (int i = 0; i < 4; i++) {\n        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *= 0.2;\n        contribution *= 0.6;\n        phaseAttenuation *= 0.5;\n      }\n\n      return luminance;\n    }"),c.fragment.code.add(n$19`vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
vec3 beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),c.fragment.code.add(n$19`vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return vec3(0);
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
vec3 color = vec3(0.0);
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
vec3 luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
color += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return color;
}`),c.fragment.code.add(n$19`void main() {
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
if (hitsPlanet) {
gl_FragColor = vec4(vec3(0), 1);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
float totalTransmittance = 1.0;
vec3 sunDirection = normalize(vec3(0, 0, 1));
vec3 col = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;
gl_FragColor = vec4(col, totalTransmittance);
}`),c}const h$M=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:p$N,build:g$N},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$X{constructor(i,s,t,e,n,o,h,r,c=.5){this.coverage=i,this.density=s,this.absorption=t,this.cloudSize=e,this.detailSize=n,this.smoothness=o,this.cloudHeight=h,this.raymarchingStepType=r,this.median=c;}}const t$O={sunny:new s$X([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],t$Q.SIXTEEN),cloudy:new s$X([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],t$Q.TWOHUNDRED,.6),rainy:new s$X([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],t$Q.TWOHUNDRED,.4),snowy:new s$X([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],t$Q.HUNDRED,.65),foggy:new s$X([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],t$Q.SIXTEEN)};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class g$M extends e$11{constructor(e,r){super(e,r,(()=>this.destroy()));}initializeProgram(e){const r=g$M.shader.get().build(this.configuration);return new o$Z(e.rctx,r,E$E)}initializePipeline(){return W$h({blending:l$P(R$u.ONE,R$u.ONE,R$u.ZERO,R$u.ZERO),depthTest:{func:I$y.LEQUAL},colorWrite:c$10})}}g$M.shader=new t$W(h$M,(()=>import('./Clouds.glsl-f95c15f6.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var t$N;!function(e){e[e.Full=0]="Full",e[e.WeatherMap=1]="WeatherMap",e[e.COUNT=2]="COUNT";}(t$N||(t$N={}));class s$W extends t$X{constructor(){super(...arguments),this.mode=t$N.Full;}}e$Y([e$12({count:t$N.COUNT})],s$W.prototype,"mode",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function p$M(p){const c=new i$_;if(c.include(o$M,!1),c.fragment.code.add(n$19`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),c.fragment.uniforms.add(new o$R("weatherTile")),p.mode===t$N.Full){const e=2,t=8;c.fragment.code.add(n$19`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${n$19.float(t$P)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${n$19.float(t)});

      float worley0 = worley(p, ${n$19.float(e)} * 2.0);
      float worley1 = worley(p, ${n$19.float(e)} * 8.0);
      float worley2 = worley(p, ${n$19.float(e)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${n$19.float(e)});
      float worley1 = worley(p, ${n$19.float(e)} * 2.0);
      float worley2 = worley(p, ${n$19.float(e)} * 4.0);
      float worley3 = worley(p, ${n$19.float(e)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `);}return c.fragment.code.add(n$19`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${n$19.float(a$R)});

      // Get global coordinates of p
      p += weatherTile * ${n$19.float(a$R)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${n$19.float(i$T)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),c.fragment.code.add(n$19`void main() {`),p.mode===t$N.Full&&c.fragment.code.add(n$19`
        float padWidth = 1.0;
        float paddedSize = ${n$19.float(o$N)} + 2.0 * padWidth;
        float tileCount = ${n$19.float(t$P)} * ${n$19.float(t$P)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${n$19.float(o$N)};
          }

          if (startPadY) {
            pixel.y += ${n$19.float(o$N)};
          }

          if (endPadX) {
            pixel.x -= ${n$19.float(o$N)};
          }

          if (endPadY) {
            pixel.y -= ${n$19.float(o$N)};
          }

          uv = vec2(pixel.xy / ${n$19.float(o$N)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${n$19.float(o$N)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${n$19.float(t$P)} * ${n$19.float(t$P)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${n$19.float(t$P)} * ${n$19.float(t$P)});
        p = p_;
        p.z /= (${n$19.float(t$P)} * ${n$19.float(t$P)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),c.fragment.code.add(n$19`
      vec2 mapUV = ${n$19.float(a$R)} * (gl_FragCoord.xy / ${n$19.float(s$Y)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${p.mode===t$N.Full?n$19`gl_FragColor.ba = vec2(0.0, map);`:n$19`gl_FragColor = vec4(map);`};
    }
  `),c}const c$T=Object.freeze(Object.defineProperty({__proto__:null,build:p$M},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class c$S extends e$11{initializeProgram(e){const r=c$S.shader.get().build(this.configuration);return new o$Z(e.rctx,r,E$E)}initializePipeline(){return W$h({blending:this.configuration.mode===t$N.Full?s$1e(R$u.ONE,R$u.ZERO):l$P(R$u.ZERO,R$u.ONE,R$u.ONE,R$u.ZERO),depthTest:{func:I$y.ALWAYS},colorWrite:c$10})}}c$S.shader=new t$W(c$T,(()=>import('./NoiseTextureAtlas.glsl-e80ce18a.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class x$A extends y$F{constructor(e){let t;super(e),this._weatherTile=t$_(0,0),this._needsRender=!0,this._frameBuffer=new D$p(e.context.renderContext.rctx,{colorTarget:Y$d.TEXTURE,width:s$Y,height:s$Y},{target:M$v.TEXTURE_2D,pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,wrapMode:D$q.CLAMP_TO_EDGE,samplingMode:L$C.LINEAR,hasMipmap:!1,width:s$Y,height:s$Y}),this._vao=u$V(e.context.renderContext.rctx),this._shaderTechniqueRepository=e.context.shaderTechniqueRepository,this._ensureRendered=()=>(r$W(t)?r$W(this.weatherMapTechnique)&&this.weatherMapTechnique.compiled&&this._needsRender&&(t=this._render(e.context.renderContext.rctx,t$N.WeatherMap)):r$W(this.fullTechnique)&&this.fullTechnique.compiled&&(t=this._render(e.context.renderContext.rctx,t$N.Full)),t);}get textureAtlas(){return this._ensureRendered()}_setDirty(){this._needsRender=!0;}updateWeatherMap(e){this._weatherTile[0]===e[0]&&this._weatherTile[1]===e[1]||(this._weatherTile=e,this._setDirty());}destroy(){this._fullTechnique=p$X(this._fullTechnique),this._weatherMapTechnique=p$X(this._weatherMapTechnique),this._frameBuffer=s$1a(this._frameBuffer),this._vao=s$1a(this._vao);}get fullTechnique(){if(t$V(this._fullTechnique)){const e=new s$W;e.mode=t$N.Full,this._fullTechnique=this._shaderTechniqueRepository.acquire(c$S,e);}return this._fullTechnique}get weatherMapTechnique(){if(t$V(this._weatherMapTechnique)){const e=new s$W;e.mode=t$N.WeatherMap,this._weatherMapTechnique=this._shaderTechniqueRepository.acquire(c$S,e);}return this._weatherMapTechnique}_render(e,t){if(t$V(this._vao)||t$V(this._frameBuffer))return null;const r=t===t$N.Full?this.fullTechnique:this.weatherMapTechnique;if(t$V(r))return null;const i=e.getViewport();e.setViewport(0,0,s$Y,s$Y),e.bindFramebuffer(this._frameBuffer);const s=e.bindTechnique(r);return s.setUniform2f("weatherTile",this._weatherTile[0],this._weatherTile[1]),e.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),e.gl.drawArrays(e.gl.TRIANGLE_STRIP,0,4),e.setViewport(i.x,i.y,i.width,i.height),this._needsRender=!1,this._frameBuffer.colorTexture}}e$Y([d$R({constructOnly:!0})],x$A.prototype,"context",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function a$Q(a){a.include(a$Y),a.uniforms.add([new c$11("geometryDepthTexture",((e,r)=>r.multipassGeometry.linearDepthTexture)),new e$$("nearFar",((e,r)=>r.camera.nearFar))]),a.code.add(n$19`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`);}class s$V{constructor(){this.enabled=!1;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function n$$(e,n){const c=e.fragment.uniforms;c.add(new e$$("nearFar",((e,o)=>o.camera.nearFar))),c.add(new c$11("depthMap",((e,o)=>o.linearDepthTexture))),c.add(new e$Z("view",((e,o)=>o.ssr.camera.viewMatrix))),c.add(new e$Z("proj",((e,o)=>o.ssr.camera.projectionMatrix))),c.add(new o$_("invResolutionHeight",((e,o)=>1/o.ssr.camera.height))),c.add(new c$11("lastFrameColorMap",((e,o)=>o.ssr.lastFrameColorTexture))),c.add(new e$Z("reprojectionMatrix",((e,o)=>o.ssr.reprojectionMatrix))),e.fragment.include(a$Y),e.fragment.code.add(n$19`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${n.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `);}class c$R{constructor(){this.reprojectionMatrix=e$10();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class h$L{constructor(h,n,l){this.shadowMap=h,this.ssaoHelper=n,this.slicePlane=l,this.slot=E$G.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this._inverseViewport=n$1b(),this.lighting=new e$17,this.ssr=new c$R,this.multipassTerrain=new o$11,this.multipassGeometry=new s$V,this.clouds=new r$Q,this.overlays=[];}get camera(){return this._camera}set camera(s){this._camera=this.ssr.camera=s,this._inverseViewport[0]=1/s.fullViewport[2],this._inverseViewport[1]=1/s.fullViewport[3];}get inverseViewport(){return this._inverseViewport}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let I$v=class extends y$F{constructor(e){super(e),this._frameTask=null,this._handles=new u$U,this._cubeMapSize=a$12("esri-mobile")?1024:2048,this._techniques=[],this._techniqueConfiguration=new r$P,this._bindParameters=new h$L(null,null,null),this._drawParameters=new p$N,this._weatherTile=t$_(0,0),this._weatherTileCount=128,this.coverage=s$1c(G$i.coverage[0],G$i.coverage[1],.5),this.density=s$1c(G$i.density[0],G$i.density[1],.5),this.absorption=s$1c(G$i.absorption[0],G$i.absorption[1],.5),this.cloudSize=s$1c(G$i.cloudSize[0],G$i.cloudSize[1],.5),this.detailSize=s$1c(G$i.detailSize[0],G$i.detailSize[1],.5),this.smoothness=s$1c(G$i.smoothness[0],G$i.smoothness[1],.5),this.cloudHeight=s$1c(G$i.cloudHeight[0],G$i.cloudHeight[1],.5),this.raymarchingStepType=G$i.raymarchingStepType,this._cloudRadius=0,this._viewMatrix=e$10(),this._cameraPositionLastFrame=n$16(),this.running=!1;}_getTechnique(e){const t=this._techniques[e];return t||(this._techniqueConfiguration.steps=e,this._techniques[e]=new g$M({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[e])}_getWeatherTile(){const e=this.view.camera.position.latitude,t=this.view.camera.position.longitude;let i=t$_((e+90)/180,(t+180)/360);const s=Math.floor(this._weatherTileCount*Math.abs(2*i[0]-1));i=t$_(Math.floor(2*this._weatherTileCount*i[0]),Math.floor(4*(this._weatherTileCount-s)*i[1]));let r=0,n=0;if(r$W(this.view.environment)&&"sun"===this.view.environment.lighting.type&&r$W(this.view.environment.lighting.date)){const e=new Date(this.view.environment.lighting.date);e.setUTCHours(this.view.environment.lighting.date.getUTCHours()+this.view.environment.lighting.displayUTCOffset),r=31*e.getUTCMonth()+e.getUTCDate(),n=e.getUTCFullYear();}return i[0]=(i[0]+r)%(2*this._weatherTileCount),i[1]=(i[1]+n%100)%(4*this._weatherTileCount),i}initialize(){this._vao=u$V(this.context.renderContext.rctx);const e=p$T(this.view.spatialReference);this._cloudRadius=.5*e.radius,this.setDirty(),this._weatherTile=this._getWeatherTile(),this._frameTask=this.view.resourceController.scheduler.registerTask(L$D.CLOUDS_GENERATOR,this),this._handles.add(this._frameTask),this._handles.add(l$M((()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingStepType]),(()=>this.setDirty()),h$V));}destroy(){this._handles.destroy(),this._techniques.forEach((e=>p$X(e))),this._techniques=null,this._frameBufferCube=s$1a(this._frameBufferCube),this._vao=s$1a(this._vao),this._noiseTexture=l$N(this._noiseTexture);}_ensureNoiseTexture(){if(t$V(this._noiseTexture)){const e=this.context;this._noiseTexture=new x$A({context:e}),this._noiseTexture.updateWeatherMap(this._weatherTile);}return this._noiseTexture.textureAtlas}ensureWeatherTile(){const e=this._getWeatherTile();r$W(this._noiseTexture)&&r$W(this.context)&&this._noiseTexture.updateWeatherMap(e),e[0]===this._weatherTile[0]&&e[1]===this._weatherTile[1]||(this._weatherTile=e,this.setDirty());}get frameBufferCube(){if(t$V(this._frameBufferCube)){const e={target:M$v.TEXTURE_CUBE_MAP,pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,wrapMode:D$q.CLAMP_TO_EDGE,samplingMode:L$C.LINEAR,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize};this._frameBufferCube=new D$p(this.context.renderContext.rctx,{colorTarget:Y$d.CUBEMAP,width:this._cubeMapSize,height:this._cubeMapSize},e);}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}isFading(e){return e.crossFade.enabled||e.fadeInOut.stage===o$O.FADE_OUT||e.fadeInOutHeight.stage!==e$U.FINISHED}applyPreset(e,t){const i=e.median,s=e=>{const s=s$1c(e[0],e[1],i);return t<.5?s$1c(e[0],s,2*t):s$1c(s,e[1],2*(t-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingStepType=e.raymarchingStepType;}setDirty(){this.running=!0;}runTask(e){if(0===this.coverage||t$V(this._vao))return void(this.running=!1);const t=this._getTechnique(this.raymarchingStepType);if(!t.compiled)return;if(!G$l(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye)||this.isFading(this.context.renderContext.bindParameters.clouds))return void r$V(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye);this.ensureWeatherTile();const i=this._ensureNoiseTexture();if(t$V(i))return;const s=this.context.renderContext.rctx,o=s.bindTechnique(t),n=1+this.absorption,a=s$1c(35,120,this.absorption);o.bindTexture("cloudShapeTexture",i),o.setUniform1f("cloudRadius",this._cloudRadius),o.setUniform1f("halfCubeMapSize",.5*this._cubeMapSize),o.setUniform1f("power",a),o.setUniform1f("sigmaE",n),o.setUniform1f("density",s$1c(0,.3,this.density)),o.setUniform1f("cloudSize",s$1c(0,.02,Math.max(.01,1-this.cloudSize))),o.setUniform1f("detailSize",s$1c(0,.2,Math.max(.01,1-this.detailSize))),o.setUniform1f("smoothness",s$1c(0,.5,1-this.smoothness)),o.setUniform1f("cloudHeight",s$1c(0,1500,this.cloudHeight)),o.setUniform1f("coverage",this.coverage),s.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao);const h=s.getViewport();s.setViewport(0,0,this._cubeMapSize,this._cubeMapSize),s.bindFramebuffer(this.frameBufferCube);for(let r=0;r<5;r++){const e=N$o[r],t=L$z[r];Q$j(this._viewMatrix,W$g,e,t),a$13(this._drawParameters.viewMatrix,this._viewMatrix);const i=M$v.TEXTURE_CUBE_MAP_POSITIVE_X+r;this.frameBufferCube.setColorTextureTarget(i),o.bindDraw(this._drawParameters,this._bindParameters),s.gl.drawArrays(s.gl.TRIANGLE_STRIP,0,4),s.gl.flush();}this.running=!1,s.setViewport(h.x,h.y,h.width,h.height),this.requestRender(),e.madeProgress();}};e$Y([d$R({constructOnly:!0})],I$v.prototype,"context",void 0),e$Y([d$R({constructOnly:!0})],I$v.prototype,"view",void 0),e$Y([d$R({constructOnly:!0})],I$v.prototype,"requestRender",void 0),e$Y([d$R()],I$v.prototype,"_frameTask",void 0),e$Y([d$R()],I$v.prototype,"coverage",void 0),e$Y([d$R()],I$v.prototype,"density",void 0),e$Y([d$R()],I$v.prototype,"absorption",void 0),e$Y([d$R()],I$v.prototype,"cloudSize",void 0),e$Y([d$R()],I$v.prototype,"detailSize",void 0),e$Y([d$R()],I$v.prototype,"smoothness",void 0),e$Y([d$R()],I$v.prototype,"cloudHeight",void 0),e$Y([d$R()],I$v.prototype,"raymarchingStepType",void 0),e$Y([d$R()],I$v.prototype,"running",void 0),I$v=e$Y([n$18("esri.views.3d.environment.CloudsGenerator")],I$v);const N$o=[r$$(1,0,0),r$$(-1,0,0),r$$(0,1,0),r$$(0,-1,0),r$$(0,0,1)],L$z=[r$$(0,1,0),r$$(0,1,0),r$$(0,0,-1),r$$(0,0,1),r$$(0,1,0)],W$g=a$14(),G$i=t$O.sunny;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function g$L(r){const g=new i$_;g.attributes.add(O$J.POSITION,"vec2"),g.include(d$T,{textureCoordinateType:o$Y.Default}),g.varyings.add("worldRay","vec3"),g.varyings.add("eyeDir","vec3");const{vertex:u,fragment:w}=g;return u.uniforms.add([new e$Z("inverseProjectionMatrix",((e,r)=>r.camera.inverseProjectionMatrix)),new e$Z("inverseViewMatrix",((r,a)=>h$U(v$E,a.camera.viewMatrix)))]),u.code.add(n$19`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),w.uniforms.add(new r$R("atmosphereC")),w.uniforms.add(new o$Q("cameraPosition")),w.uniforms.add(new e$$("nearFar",((e,r)=>r.camera.nearFar))),w.uniforms.add(new s$10("depthTex")),w.uniforms.add(new r$R("fogStrength")),w.uniforms.add(new r$R("fogAmount")),w.uniforms.add(new o$Q("fogColor")),g.include(e$V),w.include(a$Y),w.code.add(n$19`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),w.code.add(n$19`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),w.code.add(n$19`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${r.haze?n$19`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),g}const v$E=e$10(),u$M=Object.freeze(Object.defineProperty({__proto__:null,build:g$L},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class h$K extends e$11{initializeProgram(e){const r=h$K.shader.get().build(this.configuration);return new o$Z(e.rctx,r,E$E)}initializePipeline(){return this.configuration.haze?W$h({blending:l$P(R$u.ONE,R$u.ZERO,R$u.ONE_MINUS_SRC_COLOR,R$u.ONE),colorWrite:c$10}):W$h({blending:l$P(R$u.SRC_ALPHA,R$u.ZERO,R$u.ONE_MINUS_SRC_ALPHA,R$u.ONE),colorWrite:c$10})}}h$K.shader=new t$W(u$M,(()=>import('./Fog.glsl-06560929.js')));class u$L extends t$X{constructor(){super(...arguments),this.haze=!1;}}e$Y([e$12()],u$L.prototype,"haze",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let v$D=class extends y$F{constructor(e){super(e),this._fogColor=n$1c(),this._fogColorAtNight=n$1c(),this._cameraDirection=n$1c(),this._foggyFadeStart=.95,this._foggyFadeEnd=1,this._hazeFadeStart=.7,this._hazeFadeEnd=1,this._strength=4e-6;const t=e.context.renderContext.rctx;this._vao=u$V(t,A$B);const o=p$T(e.view.spatialReference);this._planetRadius=o.radius,this._atmosphereRadius=o.radius+f$M;}destroy(){this._hazeFogTechnique=p$X(this._hazeFogTechnique),this._thickFogTechnique=p$X(this._thickFogTechnique),this._vao=s$1a(this._vao);}get _shaderTechniqueRepository(){return this.context.shaderTechniqueRepository}set strength(e){this._strength=e;}get strength(){return this._strength}get thickFogTechnique(){if(t$V(this._thickFogTechnique)){const e=new u$L;e.haze=!1,this._thickFogTechnique=this._shaderTechniqueRepository.acquire(h$K,e);}return this._thickFogTechnique}get hazeFogTechnique(){if(t$V(this._hazeFogTechnique)){const e=new u$L;e.haze=!0,this._hazeFogTechnique=this._shaderTechniqueRepository.acquire(h$K,e);}return this._hazeFogTechnique}when(){return Promise.resolve()}render(e,t,o){if(0===this.view.basemapTerrain.baseOpacity&&!t)return;if(this._update(e,t,o),this._fogAmount<=0)return;const r=t?this.thickFogTechnique:this.hazeFogTechnique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper,i=e.rctx.bindTechnique(r,x$z,e.bindParameters);s.renderDepthDetached((()=>{i.bindTexture("depthTex",s.depthTexture),this._renderFog(r.program,e);}));}_renderFog(e,t){if(t$V(this._vao))return !1;const o=t.rctx,r=t.bindParameters.camera;return e.setUniform3fv("cameraPosition",r.eye),e.setUniform1f("atmosphereC",this._atmosphereC),e.setUniform1f("fogStrength",this._strength),e.setUniform1f("fogAmount",this._fogAmount),e.setUniform3fv("fogColor",this._fogColor),o.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),o.drawArrays(E$F.TRIANGLE_STRIP,0,4),!0}_update(e,t,r){const s=e.bindParameters.camera,i=t?.1:0;r?o$W(this._fogColor,.5,.5,.5):t?o$W(this._fogColor,1.5,1.5,1.5):o$W(this._fogColor,.24,.44,.8),q$p(this._fogColorAtNight,this._fogColor,i),z$s(this._cameraDirection,s.eye);const h=Math.max(0,P$u(this._cameraDirection,e.bindParameters.lighting.lightingMainDirection));A$C(this._fogColor,this._fogColorAtNight,this._fogColor,h);const a=s$1b(s.eye),_=a*a;this._atmosphereC=_-this._atmosphereRadius*this._atmosphereRadius,this._fogAmount=t?1-I$z(this._foggyFadeStart*a$11,this._foggyFadeEnd*a$11,Math.abs(a-this._planetRadius)):1-I$z(this._hazeFadeStart*a$11,this._hazeFadeEnd*a$11,Math.abs(a-this._planetRadius));}static isSupported(e){return e.capabilities.depthTexture}};e$Y([d$R({constructOnly:!0})],v$D.prototype,"context",void 0),e$Y([d$R({constructOnly:!0})],v$D.prototype,"view",void 0),v$D=e$Y([n$18("esri.views.3d.environment.Fog")],v$D);const x$z=new t$Y;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var n$_;!function(e){e[e.Cone=0]="Cone",e[e.Cylinder=1]="Cylinder",e[e.Underground=2]="Underground",e[e.COUNT=3]="COUNT";}(n$_||(n$_={}));class t$M extends t$X{constructor(){super(...arguments),this.geometry=n$_.Cone;}}e$Y([e$12({count:n$_.COUNT})],t$M.prototype,"geometry",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class f$K extends t$Y{}function p$L(s){const f=new i$_,{vertex:p,fragment:v}=f;if(s.geometry===n$_.Underground)f.attributes.add(O$J.POSITION,"vec2"),f.varyings.add("color","vec4"),p.uniforms.add([new e$_("lightingMainDirection",((e,o)=>o.lighting.lightingMainDirection)),new o$Q("cameraPosition"),new r$R("undergroundFadeAlpha")]),p.code.add(n$19`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),v.code.add(n$19`void main() {
gl_FragColor = color;
}`);else {f.include(r$10),f.attributes.add(O$J.POSITION,"vec3"),f.varyings.add("vtc","vec2"),f.varyings.add("falloff","float");const c=s.geometry===n$_.Cylinder;p.uniforms.add([new e$Z("proj",((e,o)=>o.camera.projectionMatrix)),new o$12("view"),new e$_("lightingMainDirection",((e,o)=>o.lighting.lightingMainDirection))]),c||(f.varyings.add("innerFactor","float"),p.uniforms.add(new o$Q("silCircleCenter")),p.uniforms.add(new o$Q("silCircleV1")),p.uniforms.add(new o$Q("silCircleV2")),p.uniforms.add(new o$R("texV")),p.uniforms.add(new r$R("innerScale")));const u=6.2831853,w=1/128;p.code.add(n$19`
		void main(void) {
      ${c?n$19`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:n$19`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${n$19.float(u*w)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${n$19.float(w)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),v.uniforms.add(new c$11("tex",(e=>e.texture))),c||v.uniforms.add(new r$R("altitudeFade")),v.code.add(n$19`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${c?n$19`gl_FragColor = atmosphereColor;`:n$19`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`);}return f}const v$C=Object.freeze(Object.defineProperty({__proto__:null,SimpleAtmospherePassParameters:f$K,build:p$L},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class c$Q extends e$11{initializeProgram(e){const r=c$Q.shader.get().build(this.configuration);return new o$Z(e.rctx,r,E$E)}initializePipeline(){return this.configuration.geometry===n$_.Cylinder?W$h({blending:l$P(R$u.SRC_ALPHA,R$u.ONE,R$u.ONE_MINUS_SRC_ALPHA,R$u.ONE_MINUS_SRC_ALPHA),culling:r$11,depthTest:{func:I$y.LEQUAL},colorWrite:c$10}):W$h({blending:l$P(R$u.SRC_ALPHA,R$u.ONE,R$u.ONE_MINUS_SRC_ALPHA,R$u.ONE_MINUS_SRC_ALPHA),depthTest:{func:I$y.LEQUAL},colorWrite:c$10})}}c$Q.shader=new t$W(v$C,(()=>import('./SimpleAtmosphere.glsl-9df48f3c.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const A$x="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII=";

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var n$Z;!function(n){function t(n,t){const c=n[t],o=n[t+1],r=n[t+2];return Math.sqrt(c*c+o*o+r*r)}function c(n,t){const c=n[t],o=n[t+1],r=n[t+2],u=1/Math.sqrt(c*c+o*o+r*r);n[t]*=u,n[t+1]*=u,n[t+2]*=u;}function o(n,t,c){n[t]*=c,n[t+1]*=c,n[t+2]*=c;}function r(n,t,c,o,r,u=t){(r=r||n)[u]=n[t]+c[o],r[u+1]=n[t+1]+c[o+1],r[u+2]=n[t+2]+c[o+2];}function u(n,t,c,o,r,u=t){(r=r||n)[u]=n[t]-c[o],r[u+1]=n[t+1]-c[o+1],r[u+2]=n[t+2]-c[o+2];}n.length=t,n.normalize=c,n.scale=o,n.add=r,n.subtract=u;}(n$Z||(n$Z={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const P$r=n$Z;var U$q,S$B,p$K,x$y;!function(t){const e=.5,n=[[-e,-e,e],[e,-e,e],[e,e,e],[-e,e,e],[-e,-e,-e],[e,-e,-e],[e,e,-e],[-e,e,-e]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],a=[0,0,1,0,1,1,0,1],o=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),s=new Uint16Array(36);for(let c=0;c<6;c++)for(let t=0;t<6;t++)s[6*c+t]=c;const l=new Uint16Array(36);for(let c=0;c<6;c++)l[6*c+0]=0,l[6*c+1]=1,l[6*c+2]=2,l[6*c+3]=2,l[6*c+4]=3,l[6*c+5]=0;function i(t){Array.isArray(t)||(t=[t,t,t]);const e=new Array(24);for(let r=0;r<8;r++)e[3*r]=n[r][0]*t[0],e[3*r+1]=n[r][1]*t[1],e[3*r+2]=n[r][2]*t[2];return new g$S([[O$J.POSITION,{size:3,data:e,exclusive:!0}],[O$J.NORMAL,{size:3,data:r}],[O$J.UV0,{size:2,data:a}]],[[O$J.POSITION,o],[O$J.NORMAL,s],[O$J.UV0,l]])}t.createGeometry=i;}(U$q||(U$q={})),function(t){const e=.5,n=[[-e,0,-e],[e,0,-e],[e,0,e],[-e,0,e],[0,-e,0],[0,e,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],a=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),o=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);function s(t){Array.isArray(t)||(t=[t,t,t]);const e=new Array(18);for(let r=0;r<6;r++)e[3*r]=n[r][0]*t[0],e[3*r+1]=n[r][1]*t[1],e[3*r+2]=n[r][2]*t[2];return new g$S([[O$J.POSITION,{size:3,data:e,exclusive:!0}],[O$J.NORMAL,{size:3,data:r}]],[[O$J.POSITION,a],[O$J.NORMAL,o]])}t.createGeometry=s;}(S$B||(S$B={})),function(r){const a=.5,o=0,s=r$$(-a,o,-a),l=r$$(a,o,-a),i=r$$(0,o,a),h=r$$(0,o+a,0),f=n$1c(),O=n$1c(),A=n$1c(),y=n$1c(),I=n$1c();e$15(f,s,h),e$15(O,s,l),_$v(A,f,O),z$s(A,A),e$15(f,l,h),e$15(O,l,i),_$v(y,f,O),z$s(y,y),e$15(f,i,h),e$15(O,i,s),_$v(I,f,O),z$s(I,I);const g=[s,l,i,h],M=[0,-1,0,A[0],A[1],A[2],y[0],y[1],y[2],I[0],I[1],I[2]],d=[0,1,2,3,1,0,3,2,1,3,0,2],w=[0,0,0,1,1,1,2,2,2,3,3,3];function P(t){Array.isArray(t)||(t=[t,t,t]);const e=new Array(12);for(let n=0;n<4;n++)e[3*n]=g[n][0]*t[0],e[3*n+1]=g[n][1]*t[1],e[3*n+2]=g[n][2]*t[2];return new g$S([[O$J.POSITION,{size:3,data:e,exclusive:!0}],[O$J.NORMAL,{size:3,data:M}]],[[O$J.POSITION,new Uint16Array(d)],[O$J.NORMAL,new Uint16Array(w)]])}r.createGeometry=P;}(p$K||(p$K={})),function(M){function x(t,e,n,r={uv:!0}){const a=-Math.PI,o=2*Math.PI,s=-Math.PI/2,l=Math.PI,i=Math.max(3,Math.floor(e)),c=Math.max(2,Math.floor(n)),u=(i+1)*(c+1),h=new Float32Array(3*u),f=new Float32Array(3*u),O=new Float32Array(2*u),A=[];let y=0;for(let m=0;m<=c;m++){const e=[],n=m/c,r=s+n*l,u=Math.cos(r);for(let s=0;s<=i;s++){const l=s/i,c=a+l*o,A=Math.cos(c)*u,I=Math.sin(r),g=-Math.sin(c)*u;h[3*y]=A*t,h[3*y+1]=I*t,h[3*y+2]=g*t,f[3*y]=A,f[3*y+1]=I,f[3*y+2]=g,O[2*y]=l,O[2*y+1]=n,e.push(y),++y;}A.push(e);}const I=new Uint32Array(2*i*(c-1)*3);y=0;for(let m=0;m<c;m++)for(let t=0;t<i;t++){const e=A[m][t],n=A[m][t+1],r=A[m+1][t+1],a=A[m+1][t];0===m?(I[y++]=e,I[y++]=r,I[y++]=a):m===c-1?(I[y++]=e,I[y++]=n,I[y++]=r):(I[y++]=e,I[y++]=n,I[y++]=r,I[y++]=r,I[y++]=a,I[y++]=e);}const g=[[O$J.POSITION,I],[O$J.NORMAL,I]],M=[[O$J.POSITION,{size:3,data:h,exclusive:!0}],[O$J.NORMAL,{size:3,data:f,exclusive:!0}]];return r.uv&&(M.push([O$J.UV0,{size:2,data:O,exclusive:!0}]),g.push([O$J.UV0,I])),r.offset&&(g[0][0]=O$J.OFFSET,M[0][0]=O$J.OFFSET,g.push([O$J.POSITION,new Uint32Array(I.length)]),M.push([O$J.POSITION,{size:3,data:Float64Array.from(r.offset),exclusive:!0}])),new g$S(M,g)}function T(t,e,n){const r=t;let a,o;if(n)a=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],o=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else {const t=r*(1+Math.sqrt(5))/2;a=[-r,t,0,r,t,0,-r,-t,0,r,-t,0,0,-r,t,0,r,t,0,-r,-t,0,r,-t,t,0,-r,t,0,r,-t,0,-r,-t,0,r],o=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);}for(let h=0;h<a.length;h+=3)P$r.scale(a,h,t/P$r.length(a,h));let s={};function l(e,n){e>n&&([e,n]=[n,e]);const r=e.toString()+"."+n.toString();if(s[r])return s[r];let o=a.length;return a.length+=3,P$r.add(a,3*e,a,3*n,a,o),P$r.scale(a,o,t/P$r.length(a,o)),o/=3,s[r]=o,o}for(let h=0;h<e;h++){const t=o.length,e=new Uint32Array(4*t);for(let n=0;n<t;n+=3){const t=o[n],r=o[n+1],a=o[n+2],s=l(t,r),i=l(r,a),c=l(a,t),u=4*n;e[u]=t,e[u+1]=s,e[u+2]=c,e[u+3]=r,e[u+4]=i,e[u+5]=s,e[u+6]=a,e[u+7]=c,e[u+8]=i,e[u+9]=s,e[u+10]=i,e[u+11]=c;}o=e,s={};}const i=new Float32Array(a);for(let h=0;h<i.length;h+=3)P$r.normalize(i,h);const c=[[O$J.POSITION,o],[O$J.NORMAL,o]],u=[[O$J.POSITION,{size:3,data:new Float32Array(a),exclusive:!0}],[O$J.NORMAL,{size:3,data:i,exclusive:!0}]];return new g$S(u,c)}function L(t,e,n,r,a,o,s){const l=e?[e[0],e[1],e[2]]:[0,0,0],i=t?[t[0],t[1],t[2]]:[0,0,1];o=o||[0,0];const c=n?[255*n[0],255*n[1],255*n[2],n.length>3?255*n[3]:255]:[255,255,255,255],u=null!=r&&2===r.length?r:[1,1],h=[[O$J.POSITION,{size:3,data:l,exclusive:!0}],[O$J.NORMAL,{size:3,data:i,exclusive:!0}],[O$J.UV0,{size:o.length,data:o}],[O$J.COLOR,{size:4,data:c,exclusive:!0}],[O$J.SIZE,{size:2,data:u}]];if(null!=a){const t=new Float32Array([a[0],a[1],a[2],a[3]]);h.push([O$J.AUXPOS1,{size:4,data:t}]);}if(null!=s){const t=new Float32Array([s[0],s[1],s[2],s[3]]);h.push([O$J.AUXPOS2,{size:4,data:t}]);}return new g$S(h,null,c$12.Point)}function R(t,e,n,r,a,o,s,l){if(null!=t){const{data:e}=l.getMutableAttribute(O$J.NORMAL);e[0]=t[0],e[1]=t[1],e[2]=t[2];}if(null!=e){const{data:t}=l.getMutableAttribute(O$J.POSITION);t[0]=e[0],t[1]=e[1],t[2]=e[2];}if(null!=n){const{data:t}=l.getMutableAttribute(O$J.COLOR);t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3];}if(null!=r){const{data:t}=l.getMutableAttribute(O$J.SIZE);t[0]=r[0],t[1]=r[1];}if(null!=a){const{data:t}=l.getMutableAttribute(O$J.AUXPOS1);t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3];}if(null!=o){const{data:t}=l.getMutableAttribute(O$J.UV0);t[0]=o[0],t[1]=o[1];}if(null!=s){const{data:t}=l.getMutableAttribute(O$J.AUXPOS2);t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3];}}function b(t,e){const n=new Float32Array(3*t.length),r=new Float32Array(e?3*t.length:3),a=new Uint32Array(t.length),o=new Uint32Array(t.length);for(let c=0;c<t.length;c++)n[3*c]=t[c][0],n[3*c+1]=t[c][1],n[3*c+2]=t[c][2],e&&(r[3*c]=e[c][0],r[3*c+1]=e[c][1],r[3*c+2]=e[c][2]),a[c]=c,o[c]=0;e||(r[0]=0,r[1]=1,r[2]=0);const s=[0,0],l=[[O$J.POSITION,a],[O$J.NORMAL,e?a:o],[O$J.UV0,o]],i=[[O$J.POSITION,{size:3,data:n,exclusive:!0}],[O$J.NORMAL,{size:3,data:r,exclusive:!0}],[O$J.UV0,{size:2,data:s,exclusive:!0}]];return new g$S(i,l,c$12.Point)}function G(){const t=[0,0,0,0,0,100,100,0,0],e=new Uint16Array([0,1,2]),n=[0,1,0],r=new Uint16Array([0,0,0]),a=[0,0],o=new Uint16Array([0,0,0]),s=[[O$J.POSITION,e],[O$J.NORMAL,r],[O$J.UV0,o]],l=[[O$J.POSITION,{size:3,data:t,exclusive:!0}],[O$J.NORMAL,{size:3,data:n,exclusive:!0}],[O$J.UV0,{size:2,data:a,exclusive:!0}]];return new g$S(l,s)}M.createBoxGeometry=U$q.createGeometry,M.createDiamondGeometry=S$B.createGeometry,M.createTetrahedronGeometry=p$K.createGeometry,M.createSphereGeometry=x,M.createPolySphereGeometry=T,M.createPointGeometry=L,M.updatePointGeometry=R,M.createPointArrayGeometry=b,M.createTriangleGeometry=G;const F=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function V(t=F){const e=new Array(12);for(let c=0;c<4;c++)for(let n=0;n<3;n++)e[3*c+n]=t[c][n];const n=new Uint32Array([0,1,2,2,3,0]),r=[0,0,1],a=new Uint32Array([0,0,0,0,0,0]),o=[0,0,1,0,1,1,0,1],s=[255,255,255,255],l=[[O$J.POSITION,n],[O$J.NORMAL,a],[O$J.UV0,n],[O$J.COLOR,a]],i=[[O$J.POSITION,{size:3,data:e,exclusive:!0}],[O$J.NORMAL,{size:3,data:r,exclusive:!0}],[O$J.UV0,{size:2,data:o,exclusive:!0}],[O$J.COLOR,{size:4,data:s,exclusive:!0}]];return new g$S(i,l)}function j(t,e,n,r,a=!0,o=!0){let s=0;const l=e,i=t;let u=r$$(0,s,0),h=r$$(0,s+i,0),f=r$$(0,-1,0),O=r$$(0,1,0);r&&(s=i,h=r$$(0,0,0),u=r$$(0,s,0),f=r$$(0,1,0),O=r$$(0,-1,0));const A=[h,u],y=[f,O],I=n+2,g=Math.sqrt(i*i+l*l);if(r)for(let m=n-1;m>=0;m--){const t=m*(2*Math.PI/n),e=r$$(Math.cos(t)*l,s,Math.sin(t)*l);A.push(e);const r=r$$(i*Math.cos(t)/g,-l/g,i*Math.sin(t)/g);y.push(r);}else for(let m=0;m<n;m++){const t=m*(2*Math.PI/n),e=r$$(Math.cos(t)*l,s,Math.sin(t)*l);A.push(e);const r=r$$(i*Math.cos(t)/g,l/g,i*Math.sin(t)/g);y.push(r);}const M=new Uint32Array(2*(n+2)*3),d=new Uint32Array(2*(n+2)*3);let w=0,P=0;if(a){for(let t=3;t<A.length;t++)M[w++]=1,M[w++]=t-1,M[w++]=t,d[P++]=0,d[P++]=0,d[P++]=0;M[w++]=A.length-1,M[w++]=2,M[w++]=1,d[P++]=0,d[P++]=0,d[P++]=0;}if(o){for(let t=3;t<A.length;t++)M[w++]=t,M[w++]=t-1,M[w++]=0,d[P++]=t,d[P++]=t-1,d[P++]=1;M[w++]=0,M[w++]=2,M[w++]=A.length-1,d[P++]=1,d[P++]=2,d[P++]=y.length-1;}const U=new Float32Array(3*I);for(let c=0;c<I;c++)U[3*c]=A[c][0],U[3*c+1]=A[c][1],U[3*c+2]=A[c][2];const S=new Float32Array(3*I);for(let c=0;c<I;c++)S[3*c]=y[c][0],S[3*c+1]=y[c][1],S[3*c+2]=y[c][2];const p=[[O$J.POSITION,M],[O$J.NORMAL,d]],x=[[O$J.POSITION,{size:3,data:U,exclusive:!0}],[O$J.NORMAL,{size:3,data:S,exclusive:!0}]];return new g$S(x,p)}function C(t,l,i,f,O,A){const y=f?t$$(f):r$$(1,0,0),I=O?t$$(O):r$$(0,0,0);A=null==A||A;const g=n$1c();z$s(g,y);const M=n$1c();q$p(M,g,Math.abs(t));const d=n$1c();q$p(d,M,-.5),u$W(d,d,I);const w=r$$(0,1,0);Math.abs(1-P$u(g,w))<.2&&o$W(w,0,0,1);const P=n$1c();_$v(P,g,w),z$s(P,P),_$v(w,P,g);const U=2*i+(A?2:0),S=i+(A?2:0),p=new Float32Array(3*U),x=new Float32Array(3*S),z=new Float32Array(2*U),v=new Uint32Array(3*i*(A?4:2)),T=new Uint32Array(3*i*(A?4:2));A&&(p[3*(U-2)+0]=d[0],p[3*(U-2)+1]=d[1],p[3*(U-2)+2]=d[2],z[2*(U-2)]=0,z[2*(U-2)+1]=0,p[3*(U-1)+0]=p[3*(U-2)+0]+M[0],p[3*(U-1)+1]=p[3*(U-2)+1]+M[1],p[3*(U-1)+2]=p[3*(U-2)+2]+M[2],z[2*(U-1)]=1,z[2*(U-1)+1]=1,x[3*(S-2)+0]=-g[0],x[3*(S-2)+1]=-g[1],x[3*(S-2)+2]=-g[2],x[3*(S-1)+0]=g[0],x[3*(S-1)+1]=g[1],x[3*(S-1)+2]=g[2]);const L=(t,e,n)=>{v[t]=e,T[t]=n;};let R=0;const b=n$1c(),G=n$1c();for(let e=0;e<i;e++){const t=e*(2*Math.PI/i);q$p(b,w,Math.sin(t)),q$p(G,P,Math.cos(t)),u$W(b,b,G),x[3*e+0]=b[0],x[3*e+1]=b[1],x[3*e+2]=b[2],q$p(b,b,l),u$W(b,b,d),p[3*e+0]=b[0],p[3*e+1]=b[1],p[3*e+2]=b[2],z[2*e+0]=e/i,z[2*e+1]=0,p[3*(e+i)+0]=p[3*e+0]+M[0],p[3*(e+i)+1]=p[3*e+1]+M[1],p[3*(e+i)+2]=p[3*e+2]+M[2],z[2*(e+i)+0]=e/i,z[2*e+1]=1;const n=(e+1)%i;L(R++,e,e),L(R++,e+i,e),L(R++,n,n),L(R++,n,n),L(R++,e+i,e),L(R++,n+i,n);}if(A){for(let t=0;t<i;t++){const e=(t+1)%i;L(R++,U-2,S-2),L(R++,t,S-2),L(R++,e,S-2);}for(let t=0;t<i;t++){const e=(t+1)%i;L(R++,t+i,S-1),L(R++,U-1,S-1),L(R++,e+i,S-1);}}const F=[[O$J.POSITION,v],[O$J.NORMAL,T],[O$J.UV0,v]],V=[[O$J.POSITION,{size:3,data:p,exclusive:!0}],[O$J.NORMAL,{size:3,data:x,exclusive:!0}],[O$J.UV0,{size:2,data:z,exclusive:!0}]];return new g$S(V,F)}function E(t,e,n,r,a){n=n||10,r=null==r||r,e$18(t.length>1);const o=[[0,0,0]],s=[],l=[];for(let i=0;i<n;i++){s.push([0,-i-1,-(i+1)%n-1]);const t=i/n*2*Math.PI;l.push([Math.cos(t)*e,Math.sin(t)*e]);}return M.createPathExtrusionGeometry(l,t,o,s,r,a)}function k(o,i,h,g,M,d=r$$(0,0,0)){const w=o.length,P=new Float32Array(i.length*w*3+(6*h.length||0)),U=new Float32Array(i.length*w*3+(h?6:0)),S=(i.length-1)*w*6+3*g.length*2,p=new Uint32Array(S),x=new Uint32Array(S);let v=0,T=0,L=0,R=0;const b=n$1c(),G=n$1c(),F=n$1c(),V=n$1c(),j=n$1c(),C=n$1c(),E=n$1c(),k=n$16(),B=n$1c(),D=n$1c(),X=n$1c(),q=n$1c(),Z=n$1c(),J=p$Y();o$W(B,0,1,0),e$15(G,i[1],i[0]),z$s(G,G),M?(u$W(k,i[0],d),z$s(F,k)):o$W(F,0,0,1),H(G,F,B,B,j,F,z$q),r$V(V,F),r$V(q,j);for(let t=0;t<h.length;t++)q$p(C,j,h[t][0]),q$p(k,F,h[t][2]),u$W(C,C,k),u$W(C,C,i[0]),P[v++]=C[0],P[v++]=C[1],P[v++]=C[2];U[T++]=-G[0],U[T++]=-G[1],U[T++]=-G[2];for(let t=0;t<g.length;t++)p[L++]=g[t][0]>0?g[t][0]:-g[t][0]-1+h.length,p[L++]=g[t][1]>0?g[t][1]:-g[t][1]-1+h.length,p[L++]=g[t][2]>0?g[t][2]:-g[t][2]-1+h.length,x[R++]=0,x[R++]=0,x[R++]=0;let K=h.length;const Q=h.length-1;for(let s=0;s<i.length;s++){let c=!1;if(s>0){r$V(b,G),s<i.length-1?(e$15(G,i[s+1],i[s]),z$s(G,G)):c=!0,u$W(D,b,G),z$s(D,D),u$W(X,i[s-1],V),_$w(i[s],D,J);q$q(J,j$G(X,b),k)?(e$15(k,k,i[s]),z$s(F,k),_$v(j,D,F),z$s(j,j)):H(D,V,q,B,j,F,z$q),r$V(V,F),r$V(q,j);}M&&(u$W(k,i[s],d),z$s(Z,k));for(let t=0;t<w;t++)if(q$p(C,j,o[t][0]),q$p(k,F,o[t][1]),u$W(C,C,k),z$s(E,C),U[T++]=E[0],U[T++]=E[1],U[T++]=E[2],u$W(C,C,i[s]),P[v++]=C[0],P[v++]=C[1],P[v++]=C[2],!c){const e=(t+1)%w;p[L++]=K+t,p[L++]=K+w+t,p[L++]=K+e,p[L++]=K+e,p[L++]=K+w+t,p[L++]=K+w+e;for(let t=0;t<6;t++)x[R++]=p[L-6+t]-Q;}K+=w;}const W=i[i.length-1];for(let t=0;t<h.length;t++)q$p(C,j,h[t][0]),q$p(k,F,h[t][1]),u$W(C,C,k),u$W(C,C,W),P[v++]=C[0],P[v++]=C[1],P[v++]=C[2];const Y=T/3;U[T++]=G[0],U[T++]=G[1],U[T++]=G[2];const $=K-w;for(let t=0;t<g.length;t++)p[L++]=g[t][0]>=0?K+g[t][0]:-g[t][0]-1+$,p[L++]=g[t][2]>=0?K+g[t][2]:-g[t][2]-1+$,p[L++]=g[t][1]>=0?K+g[t][1]:-g[t][1]-1+$,x[R++]=Y,x[R++]=Y,x[R++]=Y;const _=[[O$J.POSITION,p],[O$J.NORMAL,x]],tt=[[O$J.POSITION,{size:3,data:P,exclusive:!0}],[O$J.NORMAL,{size:3,data:U,exclusive:!0}]];return new g$S(tt,_)}function B(t,e,n){e$18(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),e$18(3===t[0].length,"createPolylineGeometry(): malformed vertex"),e$18(null==e||e.length===t.length,"createPolylineGeometry: need same number of points and normals"),e$18(null==e||3===e[0].length,"createPolylineGeometry(): malformed normal");const r=new Float64Array(3*t.length),a=new Uint32Array(2*(t.length-1));let o=0,s=0;for(let c=0;c<t.length;c++){for(let e=0;e<3;e++)r[o++]=t[c][e];c>0&&(a[s++]=c-1,a[s++]=c);}const l=[],i=[];if(l.push([O$J.POSITION,a]),i.push([O$J.POSITION,{size:3,data:r,exclusive:!0}]),e){const n=new Float32Array(3*e.length);let r=0;for(let a=0;a<t.length;a++)for(let t=0;t<3;t++)n[r++]=e[a][t];l.push([O$J.NORMAL,a]),i.push([O$J.NORMAL,{size:3,data:n,exclusive:!0}]);}return n&&(i.push([O$J.COLOR,{size:4,data:n}]),l.push([O$J.COLOR,l$R(n.length/4)])),new g$S(i,l,c$12.Line)}function D(t,e,n,r,a=0){const o=new Array(18),s=[[-e,a,r/2],[n,a,r/2],[0,t+a,r/2],[-e,a,-r/2],[n,a,-r/2],[0,t+a,-r/2]],l=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let i=0;i<6;i++)o[3*i]=s[i][0],o[3*i+1]=s[i][1],o[3*i+2]=s[i][2];return new g$S([[O$J.POSITION,{size:3,data:o,exclusive:!0}]],[[O$J.POSITION,l]])}function X(t,e){const n=t.getMutableAttribute(O$J.POSITION).data;for(let r=0;r<n.length;r+=3){const t=n[r],a=n[r+1],o=n[r+2];o$W(v$B,t,a,o),L$E(v$B,v$B,e),n[r]=v$B[0],n[r+1]=v$B[1],n[r+2]=v$B[2];}}function q(t,e=t){const n=t.vertexAttributes,r=n.get(O$J.POSITION).data,a=n.get(O$J.NORMAL).data;if(a){const t=e.getMutableAttribute(O$J.NORMAL).data;for(let e=0;e<a.length;e+=3){const n=a[e+1];t[e+1]=-a[e+2],t[e+2]=n;}}if(r){const t=e.getMutableAttribute(O$J.POSITION).data;for(let e=0;e<r.length;e+=3){const n=r[e+1];t[e+1]=-r[e+2],t[e+2]=n;}}return e}function Z(t,r,a,s,l){return !(Math.abs(P$u(r,t))>l)&&(_$v(a,t,r),z$s(a,a),_$v(s,a,t),z$s(s,s),!0)}function H(t,e,n,r,a,o,s){return Z(t,e,a,o,s)||Z(t,n,a,o,s)||Z(t,r,a,o,s)}M.createSquareGeometry=V,M.createConeGeometry=j,M.createCylinderGeometry=C,M.createTubeGeometry=E,M.createPathExtrusionGeometry=k,M.createPolylineGeometry=B,M.createExtrudedTriangle=D,M.transformInPlace=X,M.cgToGIS=q,M.makeOrthoBasisDirUp=Z,M.makeOrthoBasisDirUpFallback=H;}(x$y||(x$y={}));const z$q=.99619469809,v$B=n$1c(),T$z=x$y;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const q$l=s$17.getLogger("esri.views.3d.environment.PanoramicAtmosphere");class R$r{constructor(){this.type="panoramic",this._techniqueConfig=new t$M,this._passParameters=new f$K,this._readyResolver=D$o(),this._readyController=new AbortController;}destroy(){this._readyResolver.reject(),this._passParameters.texture=s$1a(this._passParameters.texture),this._vao=s$1a(this._vao),this._readyController=h$T(this._readyController);}when(){return this._readyResolver.promise}initializeRenderContext(e){this._techniqueConfig.geometry=n$_.Cylinder,this._technique=e.shaderTechniqueRepository.acquire(c$Q,this._techniqueConfig);const r=e.renderContext.rctx;this._vao=this._createVertexArrayObject(r),this._vaoCount=n$1d(this._vao,"geometry"),t$10(A$x,{signal:this._readyController.signal}).then((t=>{this._passParameters.texture=new u$X(r,{pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,wrapMode:D$q.CLAMP_TO_EDGE,samplingMode:L$C.LINEAR,flipped:!0},t),e.requestRender(),this._readyController=null,this._readyResolver.resolve();})).catch((e=>{g$T(e)||q$l.error("Unable to initialize atmosphere: image request failed",e),this._readyResolver.reject();}));}get canRender(){return null!=this._passParameters.texture}render(e){const r=e.rctx,t=r.bindTechnique(this._technique,this._passParameters,e.bindParameters);I$u(O$F,e.bindParameters.camera.viewMatrix),t.setUniformMatrix4fv("view",O$F),r.bindVAO(this._vao),t.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(E$F.TRIANGLES,0,this._vaoCount);}renderHaze(){return !1}_createVertexArrayObject(e){const r=T$z.createPolySphereGeometry(1,2,!1),t=r.indices.get(O$J.POSITION);for(let a=0;a<t.length;a+=3){const e=t[a];t[a]=t[a+2],t[a+2]=e;}const o=r.vertexAttributes.get(O$J.POSITION).data,s=S$A.createBuffer(t.length),i=s.position;for(let a=0;a<t.length;++a){const e=3*t[a];i.set(a,0,o[e]),i.set(a,1,o[e+1]),i.set(a,2,o[e+2]);}return new f$U(e,E$E,{geometry:o$13(S$A)},{geometry:c$13.createVertex(e,F$r.STATIC_DRAW,s.buffer)})}}function I$u(e,r){n$15(e,r),e[12]=0,e[13]=0,e[14]=0,e[15]=1;}const O$F=e$10(),S$A=T$C().vec3f(O$J.POSITION);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var t$L;!function(e){e[e.Rain=0]="Rain",e[e.Snow=1]="Snow",e[e.COUNT=2]="COUNT";}(t$L||(t$L={}));class i$S extends t$X{constructor(){super(...arguments),this.type=t$L.Rain;}}e$Y([e$12({count:t$L.COUNT})],i$S.prototype,"type",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function d$L(d){const c=new i$_;return c.attributes.add(O$J.POSITION,"vec3"),c.attributes.add(O$J.INSTANCEFEATUREATTRIBUTE,"float"),c.vertex.uniforms.add(new o$Q("cameraPosition")),c.vertex.uniforms.add(new o$Q("offset")),c.vertex.uniforms.add(new r$R("width")),c.vertex.uniforms.add(new e$Z("proj",((e,t)=>t.camera.projectionMatrix))),c.vertex.uniforms.add(new o$12("view")),c.vertex.uniforms.add(new r$R("time")),c.varyings.add("vUv","vec2"),c.vertex.code.add(n$19`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${d.type===t$L.Rain?n$19`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:n$19`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),c.fragment.uniforms.add(new r$R("opacity")),c.fragment.uniforms.add(new o$Q("particleColor")),c.fragment.code.add(n$19`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${d.type===t$L.Rain?n$19`d = 0.35 * smoothstep(0.5, 0.0, d);`:n$19`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),c}const c$P=Object.freeze(Object.defineProperty({__proto__:null,build:d$L},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class g$K extends t$Y{constructor(){super(...arguments),this.time=0,this.radius=1;}}class u$K extends e$11{initializeProgram(e){const r=u$K.shader.get().build(this.configuration);return new o$Z(e.rctx,r,u$K.attributeLocation)}initializePipeline(){return W$h({blending:l$P(R$u.ONE,R$u.ONE,R$u.ONE_MINUS_SRC_ALPHA,R$u.ONE_MINUS_SRC_ALPHA),depthTest:{func:I$y.LEQUAL},colorWrite:c$10})}}u$K.shader=new t$W(c$P,(()=>import('./Precipitation.glsl-e3263e90.js'))),u$K.attributeLocation=new Map([[O$J.POSITION,0],[O$J.INSTANCEFEATUREATTRIBUTE,1]]);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class i$R{constructor(){this.enabled=!0,this._time=0;}get time(){return n$1e(this._time)}advance(t){return r$W(t.forcedTime)?this._time!==t.forcedTime&&(this._time=t.forcedTime,!0):!(!this.enabled||0===t.dt)&&(this._time+=t.dt,!0)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let O$E=class extends y$F{constructor(t){super(t),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._opacity=1,this._width=500,this._offset=n$16(),this._tile=n$16(),this._particleColor=n$1c(),this._particleColorAtNight=n$1c(),this._nightMultiplier=.7,this._cameraDirection=n$1c(),this._renderParameters=new g$K,this._animation=new i$R,this._updatingTracking=new c$14,this._renderParameters.time=0,this._renderParameters.radius=p$T(t.view.spatialReference).radius,this._shaderTechniqueRepository=t.context.shaderTechniqueRepository;}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechnique=p$X(this._snowTechnique),this._rainTechnique=p$X(this._rainTechnique),this._vao=s$1a(this._vao),this._instanceIdBuffer=s$1a(this._instanceIdBuffer);}get updating(){return this._updatingTracking.updating}get rainTechnique(){if(t$V(this._rainTechnique)){const t=new i$S;t.type=t$L.Rain,this._rainTechnique=this._shaderTechniqueRepository.acquire(u$K,t);}return this._rainTechnique}get snowTechnique(){if(t$V(this._snowTechnique)){const t=new i$S;t.type=t$L.Snow,this._snowTechnique=this._shaderTechniqueRepository.acquire(u$K,t);}return this._snowTechnique}update(t){return this._animation.advance(t)}render(t,e,r){const s="rainy"===r,h=s?this.rainTechnique:this.snowTechnique;if(!h.compiled)return void this.context.requestRender();const c=t.rctx;if(this._ensureResources(c),t$V(h)||t$V(this._vao)||t$V(this._instanceIdBuffer))return;if(r$W(t.bindParameters.clouds.data)&&(this._opacity=1-t.bindParameters.clouds.fadeInOutHeight.factor),this._opacity<=0)return;const _=.35;e=e<.5?s$1c(0,_,2*e):s$1c(_,1,2*(e-.5));const m=c.bindTechnique(h);this._renderParameters.camera=t.bindParameters.camera,this._renderParameters.time=(s?this._rainSpeed:this._snowSpeed)*u$Y(this._animation.time),this._renderParameters.time=this._renderParameters.time%1e5,this._update(m,r,t),c.bindVAO(this._vao);const p=u$K.attributeLocation;m.assertCompatibleVertexAttributeLocations(this._vao),R$v(c,p,this._instanceIdBuffer,B$p,0),c.capabilities.instancing.drawArraysInstanced(E$F.TRIANGLES,0,3,this._numParticles*e),E$H(c,p,this._instanceIdBuffer,B$p);}_update(t,e,i){const r=i.bindParameters.camera,s=r.eye;this._tile[0]=Math.floor((s[0]+.5*this._width)/this._width),this._tile[1]=Math.floor((s[1]+.5*this._width)/this._width),this._tile[2]=Math.floor((s[2]+.5*this._width)/this._width),this._offset[0]=s[0]-this._tile[0]*this._width,this._offset[1]=s[1]-this._tile[1]*this._width,this._offset[2]=s[2]-this._tile[2]*this._width,t.setUniform1f("width",this._width),t.setUniform3fv("offset",this._offset),t.setUniformMatrix4fv("view",r.viewMatrix),t.setUniform3fv("cameraPosition",s),t.bindPass(null,i.bindParameters),t.setUniform1f("time",this._renderParameters.time),"rainy"===e?o$W(this._particleColor,.85,.85,.85):o$W(this._particleColor,1,1,1),q$p(this._particleColorAtNight,this._particleColor,this._nightMultiplier),z$s(this._cameraDirection,s);const o=Math.max(0,P$u(this._cameraDirection,i.bindParameters.lighting.lightingMainDirection));A$C(this._particleColor,this._particleColorAtNight,this._particleColor,o),t.setUniform3fv("particleColor",this._particleColor),t.setUniform1f("opacity",this._opacity);}_ensureResources(t){t$V(this._vao)&&(this._vao=this._createVertexArrayObject(t)),t$V(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(t));}_createInstanceIndices(t){const e=[];for(let i=0;i<this._numParticles;i++)e.push(i);return c$13.createVertex(t,F$r.STATIC_DRAW,new Float32Array(e))}_createVertexArrayObject(t){const e=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new f$U(t,u$K.attributeLocation,{geometry:o$13(k$v)},{geometry:c$13.createVertex(t,F$r.STATIC_DRAW,e)})}};e$Y([d$R({constructOnly:!0})],O$E.prototype,"context",void 0),e$Y([d$R({constructOnly:!0})],O$E.prototype,"view",void 0),e$Y([d$R({readOnly:!0})],O$E.prototype,"updating",null),e$Y([d$R()],O$E.prototype,"_updatingTracking",void 0),O$E=e$Y([n$18("esri.views.3d.environment.Precipitation")],O$E);const k$v=T$C().vec3f(O$J.POSITION),B$p=o$13(T$C().f32(O$J.INSTANCEFEATUREATTRIBUTE),1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const A$w="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg==";

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const X$a=s$17.getLogger("esri.views.3d.environment.SimpleAtmosphere"),Z$e=128,$$i=-n$11,ee$7=0,te$7=50,re$6=()=>1-511/512,ie$8=U$t([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class se$8{constructor(e){this.view=e,this.type="simple",this._renderData={texV:n$1b(),silCircleCenter:n$16(),silCircleV1:n$16(),silCircleV2:n$16(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0},this._passParameters=new f$K,this._fadeVaoCount=0,this._readyResolver=D$o(),this._readyController=new AbortController,this.texV1=1,this.canRender=!0,this.isOnMars=P$v(e.spatialReference);const t=p$T(e.spatialReference);this.planetRadius=t.radius,this.outerRimWidth=t.outerAtmosphereRimWidth,this.innerRimFactor=(this.planetRadius+$$i)/this.planetRadius,this.middleRimFactor=(this.planetRadius+ee$7)/this.planetRadius,this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius,this.texV0=ee$7/this.outerRimWidth,this.texVScale=this.texV1-this.texV0;}destroy(){this._readyResolver.reject(),this._cameraChangeHandle=a$W(this._cameraChangeHandle),this._passParameters.texture=s$1a(this._passParameters.texture),this._fadeVao=s$1a(this._fadeVao),this._vao=s$1a(this._vao),this._readyController=h$T(this._readyController);}when(){return this._readyResolver.promise}async initializeRenderContext(e){this._shaderTechniqueRepository=e.shaderTechniqueRepository;const t=e.renderContext.rctx;this._cameraChangeHandle=l$M((()=>this.view.state?.camera),(()=>e.requestRender()),w$x),this._vao=this._createRibbon(t),this._vaoCount=n$1d(this._vao,"geometry"),this._fadeVao=u$V(t),this._fadeVaoCount=n$1d(this._fadeVao,"geometry");const r=this.isOnMars?A$w:A$x,i=this._readyController.signal;try{const s=await t$10(r,{signal:i});f$V(i),this._passParameters.texture=new u$X(t,{pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,wrapMode:D$q.CLAMP_TO_EDGE,samplingMode:L$C.LINEAR,flipped:!0},s),e.requestRender(),this._readyController=null,this._readyResolver.resolve();}catch(s){g$T(s)||X$a.error("Unable to initialize simple atmosphere: image request failed",s),this._readyResolver.reject(s);}}get coneTechnique(){if(t$V(this._coneTechnique)){const e=new t$M;e.geometry=n$_.Cone,this._coneTechnique=this._shaderTechniqueRepository.acquire(c$Q,e);}return this._coneTechnique}get undergroundTechnique(){if(t$V(this._undergroundTechnique)){const e=new t$M;e.geometry=n$_.Underground,this._undergroundTechnique=this._shaderTechniqueRepository.acquire(c$Q,e);}return this._undergroundTechnique}render(e){const t=e.bindParameters.camera;this._update(t);const r=e.rctx;if(this._renderData.undergroundFadeAlpha<1){const i=r.bindTechnique(this.coneTechnique,this._passParameters,e.bindParameters);i.setUniformMatrix4fv("proj",t.projectionMatrix),i.setUniformMatrix4fv("view",t.viewMatrix),i.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),i.setUniform3fv("silCircleV1",this._renderData.silCircleV1),i.setUniform3fv("silCircleV2",this._renderData.silCircleV2),i.setUniform2fv("texV",this._renderData.texV),i.setUniform1f("altitudeFade",this._renderData.altitudeFade),i.setUniform1f("innerScale",this._renderData.innerScale),r.bindVAO(this._vao),r.drawArrays(E$F.TRIANGLES,0,this._vaoCount);}if(this._renderData.undergroundFadeAlpha>0){const i=r.bindTechnique(this.undergroundTechnique,this._passParameters,e.bindParameters);i.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),i.setUniform3fv("cameraPosition",t.eye),r.bindVAO(this._fadeVao),r.drawArrays(E$F.TRIANGLE_STRIP,0,this._fadeVaoCount);}}renderHaze(){return !1}_update(e){const i=n$16(),s=this.planetRadius,a=s$1b(e.eye),o=a-s;if(o<0){const e=Math.min(-o/5e3,1);this._renderData.undergroundFadeAlpha=e;}else this._renderData.undergroundFadeAlpha=0;const n=Math.max(te$7,o),h=s+$$i;this._renderData.innerScale=me$d(s+n,s,h)-1,this._renderData.altitudeFade=t$R(o),q$p(i,e.eye,(s+te$7)/a),ae$b(i,e.center,e.up,s,this._renderData);const m=this._computeScreenRimWidth(e,i,e.up,this._renderData),c=re$6(),l=ie$8(o);let d=this.texV0+c*this.texVScale,u=this.texV0+m*l*this.texVScale;if(o>te$7){ae$b(e.eye,e.center,e.up,s,this._renderData);const i=this._computeScreenRimWidth(e,e.eye,e.up,this._renderData),a=o$X((i-1.5)/(m-1.5),0,1);d=this.texV0+a*c*this.texVScale,u=this.texV0+s$1c(this.texV1,m*l,a)*this.texVScale;}r$Y(this._renderData.texV,d,u);}_createRibbon(e){const t=new Float32Array(3+3*Z$e*3),r=new Uint32Array(3*Z$e*5);t[0]=0,t[1]=0,t[2]=-1;for(let a=0;a<Z$e;a++){const e=9*a+3;t[e+0]=a,t[e+1]=this.innerRimFactor,t[e+2]=-1,t[e+3]=a,t[e+4]=this.middleRimFactor,t[e+5]=0,t[e+6]=a,t[e+7]=this.outerRimFactor,t[e+8]=1;const i=3*a+1,s=a===Z$e-1?1:i+3,o=15*a;r[o+0]=i,r[o+1]=i+1,r[o+2]=s+1,r[o+3]=s+1,r[o+4]=s,r[o+5]=i,r[o+6]=i+1,r[o+7]=i+2,r[o+8]=s+2,r[o+9]=s+2,r[o+10]=s+1,r[o+11]=i+1,r[o+12]=i,r[o+13]=s,r[o+14]=0;}const i=ce$e.createBuffer(r.length),s=i.position;for(let a=0;a<r.length;++a){const e=3*r[a];s.set(a,0,t[e]),s.set(a,1,t[e+1]),s.set(a,2,t[e+2]);}return new f$U(e,E$E,{geometry:o$13(ce$e)},{geometry:c$13.createVertex(e,F$r.STATIC_DRAW,i.buffer)})}_computeScreenRimWidth(e,t,r,i){return u$W(ne$a,i.silCircleCenter,i.silCircleV2),q$p(he$c,ne$a,this.outerRimFactor),F$s(oe$d,t,ne$a,r),i$$(ne$a,oe$d,e.projectionMatrix,e.viewport),i$$(he$c,oe$d,e.projectionMatrix,e.viewport),x$H(ne$a,he$c)/e.height}}function ae$b(e,t,r,i,s){const a=s$1b(e),o=i*Math.sqrt(a*a-i*i)/a,n=Math.sqrt(i*i-o*o),h=s.silCircleV1,m=s.silCircleV2;return q$p(s.silCircleCenter,e,n/a),_$v(h,e,t),v$P(h)<1&&_$v(h,e,r),q$p(h,h,o/s$1b(h)),_$v(m,h,e),q$p(m,m,o/s$1b(m)),o}const oe$d=e$10(),ne$a=n$16(),he$c=n$16();function me$d(e,t,r){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-r*r)+t*r)}const ce$e=T$C().vec3f(O$J.POSITION);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function c$O(c){const i=n$19`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,o=n$19`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;c.vertex.code.add(i),c.vertex.code.add(o),c.fragment.code.add(i),c.fragment.code.add(o);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function c$N(){const e=new i$_;return e.attributes.add(O$J.POSITION,"vec3"),e.attributes.add(O$J.COLOR,"vec4"),e.attributes.add(O$J.SIZE,"float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add([new e$Z("transform",((e,o)=>m$I(e,o))),new e$19("viewport",((e,o)=>o.camera.fullViewport)),new o$_("pixelRatio",((e,o)=>o.camera.pixelRatio))]),e.include(c$O),e.vertex.code.add(n$19`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(n$19`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),e}function m$I(r,i){const a=24e-8;return n$15(p$J,i.camera.projectionMatrix),p$J[10]=a-1,p$J[11]=-1,p$J[14]=(a-2)*i.camera.near,u$Z(p$J,p$J,i.camera.viewMatrix),u$Z(p$J,p$J,r.modelMatrix)}const p$J=e$10(),v$A=Object.freeze(Object.defineProperty({__proto__:null,build:c$N},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class d$K extends t$Y{constructor(){super(...arguments),this.modelMatrix=e$10();}}class g$J extends e$11{constructor(e){super(e,null,(()=>this.destroy()));}initializeProgram(e){const r=g$J.shader.get().build();return new o$Z(e.rctx,r,E$E)}initializePipeline(){return W$h({blending:l$P(R$u.SRC_ALPHA,R$u.ONE,R$u.ONE_MINUS_SRC_ALPHA,R$u.ONE_MINUS_SRC_ALPHA),depthTest:{func:I$y.LEQUAL},colorWrite:c$10})}}g$J.shader=new t$W(v$A,(()=>import('./Stars.glsl-7de9dd5d.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const O$D=s$17.getLogger("esri.views.3d.environment.Stars");let S$z=class extends y$F{constructor(t){super(t),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new d$K,this._updatingTracking=new c$14;}get updating(){return this._updatingTracking.updating||this.loading}get loading(){return r$W(this._loadDataTask)&&!this._loadDataTask.finished}initialize(){this._loadDataTask=this._createLoadDataTask();}destroy(){this._loadDataTask=h$T(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=p$X(this._technique),this._vao=s$1a(this._vao);}render(t){const{rctx:e}=t;if(this._ensureResources(e),t$V(this._technique)||t$V(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const r=e.bindTechnique(this._technique,this._renderParameter,t.bindParameters);e.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.drawArrays(E$F.POINTS,0,this._numPoints);}_ensureResources(t){if(r$W(this._technique)||t$V(V$m))return;this._technique=new g$J({rctx:t,viewingMode:this.view.state.viewingMode}),this._numPoints=V$m.byteLength/R$q;const e=new Float32Array(V$m,0,2*this._numPoints),r=new Uint8Array(V$m,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(t,e,r,this._numPoints),this._updatingTracking.add((()=>"sun"===this.view.environment.lighting.type?this.view.environment.lighting.date:null),(t=>this._update(t)),h$V);}_computeDayDuration(t){const e=t,r=new Date(t.getFullYear(),0,1,11,58,56);return (+e-+r)/(+new Date(t.getFullYear()+1,0,1,11,58,55)-+r)}_update(t){if(!t)return;const e=(t.getHours()/12+t.getMinutes()/60*(2/24)+t.getSeconds()/60*(2/1440)-.9972222)%2,r=2*this._computeDayDuration(t),s=n$15(this._renderParameter.modelMatrix,L$y);m$P(s,s,-r*Math.PI),u$Z(s,M$r,s),m$P(s,s,-e*Math.PI),this.requestRender();}_hexToRGB(t){return [parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)]}_unpackUint8Attributes(t){return t>=192?[2.9,t-192]:t>=160?[2.5,t-160]:t>=128?[2,t-128]:t>=96?[1.5,t-96]:t>=64?[1,t-64]:t>=32?[.7,t-32]:[.4,t]}_createVertexArrayObject(t,e,r,s){const i=U$p.createBuffer(s),a=i.position,o=i.color,n=i.size;for(let c=0;c<s;c++){const t=e[2*c+0],s=e[2*c+1];a.set(c,0,-Math.cos(t)*Math.sin(s)),a.set(c,1,-Math.sin(t)*Math.sin(s)),a.set(c,2,-Math.cos(s));const i=this._unpackUint8Attributes(r[c]),f=this._hexToRGB(I$t[i[1]]);o.set(c,0,255*f[0]),o.set(c,1,255*f[1]),o.set(c,2,255*f[2]),o.set(c,3,255),n.set(c,i[0]);}return new f$U(t,E$E,{geometry:o$13(U$p)},{geometry:c$13.createVertex(t,F$r.STATIC_DRAW,i.buffer)})}_createLoadDataTask(){if(r$W(V$m))return null;const t=O$I((async t=>{const{data:r}=await n$1f("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});this._verifyStarData(r),V$m=r;}));return t.promise.catch((t=>{g$T(t)||O$D.error(t);})).then((()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"));})),t}_verifyStarData(t){if(!t)throw new s$16("stars:no-data-received","Failed to create stars because star catalogue is missing");const e=t.byteLength/R$q;if(e%1!=0||e>5e4||e<5e3)throw new s$16("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};e$Y([d$R({constructOnly:!0})],S$z.prototype,"view",void 0),e$Y([d$R({constructOnly:!0})],S$z.prototype,"requestRender",void 0),e$Y([d$R({readOnly:!0})],S$z.prototype,"updating",null),e$Y([d$R()],S$z.prototype,"_loadDataTask",void 0),e$Y([d$R()],S$z.prototype,"_updatingTracking",void 0),S$z=e$Y([n$18("esri.views.3d.environment.Stars")],S$z);const I$t=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],M$r=t$11(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),L$y=t$11(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),R$q=9,U$p=T$C().vec3f(O$J.POSITION).vec4u8(O$J.COLOR).f32(O$J.SIZE);let V$m=null;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var P$q;const O$C=[E$G.POSTPROCESSING_ENVIRONMENT_OPAQUE,E$G.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let S$y,M$q=P$q=class extends y$F{constructor(e){super(e),this._handles=new u$U,this._context=null,this._pendingAtmosphere=null,this._atmosphere=null;}initialize(){this.view._stage.addRenderPlugin(O$C,this);}destroy(){this._pendingAtmosphere=l$N(this._pendingAtmosphere),null!=this.view?._stage&&this.view._stage.removeRenderPlugin(this),this._handles=l$N(this._handles),this._set("view",null);}get atmosphereType(){return r$W(this._pendingAtmosphere)?this._pendingAtmosphere.type:r$W(this._atmosphere)?this._atmosphere.type:"none"}get canRender(){return !!this.view.basemapTerrain?.renderer.canRender||"global"!==this.view.viewingMode}get needsLinearDepth(){return "realistic"===this._selectAtmosphereType()}updateAnimation(e){return !!r$W(this._precipitation)&&this._precipitation.update(e)}get updating(){return r$W(this._pendingAtmosphere)||r$W(this._stars)&&this._stars.updating||r$W(this._clouds)&&this._clouds.running}get weatherVisible(){return s$1b(this.view.state.camera.eye)-p$T(this.view.spatialReference).radius<=a$11}get _stars(){const e=this.view,t=e.environment?.starsEnabled??!1,s=this._get("_stars");return !t||t$V(this._context)?(l$N(s),null):r$W(s)?s:new S$z({view:e,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||t$V(this._context))return l$N(e),null;const t=this.view,s=this._context;return r$W(e)&&e.context===s?e:(l$N(e),new O$E({context:s,view:t}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||t$V(this._context))return l$N(e),null;if(r$W(e))return e;const t=this.view,s=this._context;return l$N(e),new I$v({context:s,view:t,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||t$V(this._context))return l$N(e),null;const t=this.view.state.viewingMode,s=this._context.renderContext.rctx,i=p$T(this.view.spatialReference).radius;return r$W(e)&&e.viewingMode===t&&e.planetRadius===i?e:(l$N(e),new j$B({rctx:s,viewingMode:t,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||t$V(this._context))return l$N(e),null;if(r$W(e))return e;const t=this.view,s=this._context;return l$N(e),new v$D({context:s,view:t})}get weatherEnabled(){return !!this.view?.environmentManager?.weatherEnabled}get _precipitationEnabled(){return this.weatherEnabled&&("rainy"===this.view.environment.weather.type||"snowy"===this.view.environment.weather.type)}initializeRenderContext(e=null){this._context=e,this._handles.add([f$R((()=>this.view?.basemapTerrain),(()=>this._updateBasemapTerrain()),w$x),l$M((()=>({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality})),(()=>this._updateAtmosphere()),w$x),l$M((()=>this._stars),(()=>this._setNeedsRender())),l$M((()=>this._clouds),(()=>this._updateWeather(this._weatherUpdateParameters)),h$V),l$M((()=>this._precipitation),(()=>this._setNeedsRender())),l$M((()=>this._fog),(()=>this._updateFog(this._weatherUpdateParameters)),h$V),l$M((()=>this._weatherUpdateParameters),(e=>{this._updateWeather(e),this._updateFog(e);}),w$x)]);}uninitializeRenderContext(){this._context=null,this._atmosphere=l$N(this._atmosphere),this._set("_stars",l$N(this._stars)),this._set("_precipitation",l$N(this._precipitation)),this._set("_clouds",l$N(this._clouds)),this._set("_cloudsComposition",l$N(this._cloudsComposition)),this._set("_fog",l$N(this._fog));}prepareRender(e){e.bindParameters.clouds.data=n$10(this._clouds)?this._clouds:null;}render(e){if(e.pass===A$D.MATERIAL)switch(e.bindParameters.slot){case E$G.POSTPROCESSING_ENVIRONMENT_OPAQUE:r$W(this._stars)&&this._stars.render(e),r$W(this._atmosphere)&&this._atmosphere.canRender&&(this._atmosphere.render(e),r$W(this._cloudsComposition)&&r$W(e.bindParameters.clouds.data)&&(this.weatherVisible&&r$W(this._clouds)&&this._clouds.ensureWeatherTile(),this._cloudsComposition.render(e,r$W(this.view.animation))));break;case E$G.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(r$W(this._atmosphere)&&this._atmosphere.canRender){const t=this.weatherEnabled?this.view.environment.weather.type:"disabled";if(this._atmosphere.renderHaze(e,"rainy"===t),r$W(this._fog)){const s="foggy"===t||"rainy"===t||"snowy"===t;(s||"realistic"!==this._selectAtmosphereType())&&this._fog.render(e,s,"rainy"===t);}if(r$W(this._precipitation)){const t=this.view.environment.weather;"rainy"!==t.type&&"snowy"!==t.type||this._precipitation.render(e,t.precipitation,t.type);}}}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return t$V(e)?null:"rainy"===e.type||"snowy"===e.type?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:"foggy"===e.type?e.fogStrength:e.cloudCover}}_updateWeather(e){t$V(e)||t$V(this._clouds)||(this._clouds.applyPreset(t$O[e.type],e.weatherAdjustment),this._setNeedsRender());}_setNeedsRender(){r$W(this._context)&&this._context.requestRender();}_updateFog(e){if(!t$V(this._fog)&&!t$V(e))switch(e.type){case"foggy":this._fog.strength=s$1c(3e-5,.005,e.weatherAdjustment**3),this._setNeedsRender();break;case"rainy":case"snowy":this._fog.strength=s$1c(4e-6,2e-4,e.effect**3),this._setNeedsRender();break;default:this._fog.strength=4e-6,this._setNeedsRender();}}_updateAtmosphere(){const e=this._selectAtmosphereType();if(this.atmosphereType===e)return;r$W(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);const t=this._getAtmosphereClass();if(!t)return r$W(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();const s=new t(this.view);r$W(this._context)&&s.initializeRenderContext(this._context),t$V(this._atmosphere)&&(this._atmosphere=s,this._setNeedsRender()),this._pendingAtmosphere=s,s.when().then((()=>{r$W(this._atmosphere)&&this._pendingAtmosphere&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere),this._pendingAtmosphere=null,this._setNeedsRender(),this._updateBasemapTerrain();})).catch((()=>{this._pendingAtmosphere===s&&(this._pendingAtmosphere=null);}));}_getAtmosphereClass(){switch(this._selectAtmosphereType()){case"none":return null;case"realistic":return C$w;case"panoramic":return R$r;case"simple":return se$8;default:return}}_selectAtmosphereType(){const e=this.view.get("environment.atmosphereEnabled"),t=this.view.get("environment.atmosphere.quality"),s=this.view.viewingMode;return !e||null==t||s$15(this.view.spatialReference)?"none":"local"===s?"panoramic":"high"===t&&r$W(this._context)&&C$w.isSupported(this._context)&&A$E(this.view.spatialReference)?"realistic":"simple"}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=r$W(this._atmosphere)&&"simple"===this.atmosphereType);}get test(){return {atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:e=>{S$y=P$q.prototype._getAtmosphereClass,P$q.prototype._getAtmosphereClass=e;},restoreGetAtmosphereClass:()=>{P$q.prototype._getAtmosphereClass=S$y;}}}};e$Y([d$R({constructOnly:!0})],M$q.prototype,"view",void 0),e$Y([d$R({type:Boolean,readOnly:!0})],M$q.prototype,"updating",null),e$Y([d$R({readOnly:!0})],M$q.prototype,"weatherVisible",null),e$Y([d$R()],M$q.prototype,"_context",void 0),e$Y([d$R()],M$q.prototype,"_pendingAtmosphere",void 0),e$Y([d$R({readOnly:!0})],M$q.prototype,"_stars",null),e$Y([d$R({readOnly:!0})],M$q.prototype,"_precipitation",null),e$Y([d$R({readOnly:!0})],M$q.prototype,"_clouds",null),e$Y([d$R({readOnly:!0})],M$q.prototype,"_cloudsComposition",null),e$Y([d$R({readOnly:!0})],M$q.prototype,"_fog",null),e$Y([d$R({readOnly:!0})],M$q.prototype,"weatherEnabled",null),e$Y([d$R({readOnly:!0})],M$q.prototype,"_precipitationEnabled",null),e$Y([d$R({readOnly:!0})],M$q.prototype,"_weatherUpdateParameters",null),M$q=P$q=e$Y([n$18("esri.views.3d.environment.EnvironmentRenderer")],M$q);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var n$Y,t$K,r$N,e$S={exports:{}};n$Y=e$S,t$K=function(){var n=Math.PI,t=Math.sin,r=Math.cos,e=Math.tan,o=Math.asin,u=Math.atan2,a=Math.acos,i=n/180,c=864e5,f=2440588,d=2451545,s={dec:0,ra:0};function v(n){return n.valueOf()/c-.5+f}function M(n){return new Date((n+.5-f)*c)}function p(n){return v(n)-d}var h=23.4397*i;function l(n,o){return u(t(n)*r(h)-e(o)*t(h),r(n))}function x(n,e){return o(t(e)*r(h)+r(e)*t(h)*t(n))}function N(n,o,a){return u(t(n),r(n)*t(o)-e(a)*r(o))}function P(n,e,u){return o(t(e)*t(u)+r(e)*r(u)*r(n))}function E(n,t){return i*(280.16+360.9856235*n)-t}function I(n){return i*(357.5291+.98560028*n)}function O(n){return i*(1.9148*t(n)+.02*t(2*n)+3e-4*t(3*n))}function T(t,r){return t+r+102.9372*i+n}function g(n,t){var r=I(n),e=T(r,O(r));return t||(t={dec:0,ra:0}),t.dec=x(e,0),t.ra=l(e,0),t}var m={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(n,t,r,e){var o=i*-r,u=i*t,a=p(n),c=g(a,s),f=E(a,o)-c.ra;return e||(e={azimuth:0,altitude:0}),e.azimuth=N(f,u,c.dec),e.altitude=P(f,u,c.dec),e}},A=[[-.83,"sunrise","sunset"]];m.addTime=function(n,t,r){A.push([n,t,r]);};var L=9e-4;function R(t,r){return Math.round(t-L-r/(2*n))}function G(t,r,e){return L+(t+r)/(2*n)+e}function H(n,r,e){return d+n+.0053*t(r)-.0069*t(2*e)}function _(n,e,o){return a((t(n)-t(e)*t(o))/(r(e)*r(o)))}function z(n){var e=i*(134.963+13.064993*n),o=i*(93.272+13.22935*n),u=i*(218.316+13.176396*n)+6.289*i*t(e),a=5.128*i*t(o),c=385001-20905*r(e);return {ra:l(u,a),dec:x(u,a),dist:c}}return m.getTimes=function(n,e,o){var u=i*-o,a=i*e,c=R(p(n),u),f=G(0,u,c),d=I(f),s=O(d),v=T(d,s),h=x(v,0),l=H(f,d,v);function N(n){return H(G(_(n,a,h),u,c),d,v)}function P(n){var e=(t(n)-t(a)*t(h))/(r(a)*r(h));return e<-1?m.PolarException.MIDNIGHT_SUN:e>1?m.PolarException.POLAR_NIGHT:m.PolarException.NORMAL}var E,g,L,z,D,S={solarNoon:M(l),nadir:M(l-.5),polarException:m.PolarException.NORMAL};for(E=0,g=A.length;E<g;E+=1)D=l-((z=N((L=A[E])[0]*i))-l),S[L[1]]=M(D),S[L[2]]=M(z);return S.polarException=P(A[0][0]*i),S},m.getMoonPosition=function(n,t,r){var o=i*-r,u=i*t,a=p(n),c=z(a),f=E(a,o)-c.ra,d=P(f,u,c.dec);return d+=.017*i/e(d+10.26*i/(d+5.1*i)),{azimuth:N(f,u,c.dec),altitude:d,distance:c.dist}},m.getMoonFraction=function(n){var e=p(n),o=g(e),i=z(e),c=149598e3,f=a(t(o.dec)*t(i.dec)+r(o.dec)*r(i.dec)*r(o.ra-i.ra)),d=u(c*t(f),i.dist-c*r(f));return (1+r(d))/2},m},void 0!==(r$N=t$K())&&(n$Y.exports=r$N);const o$L=e$S.exports;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const w$t={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function N$n(i,n,o,a,r,l,u){o$W(u.ambient.color,1,1,1),u.ambient.intensity=w$t.global.ambient,o$W(u.direct.color,1,1,1),u.direct.intensity=w$t.global.direct;const m=n[2],d=o$X((Math.abs(m)-w$t.local.altitude)/(w$t.global.altitude-w$t.local.altitude),0,1);let g;if(u.globalFactor=d,"sun"===l&&(g=o$L.getTimes(i,n[1],n[0])),d<1){let e;if("sun"===l)e=I$s(i,g,a);else {const t=D$k(a);e={direct:{intensity:w$t.local.directAtNoon*t.direct,color:r$X(1,1,1)},ambient:{intensity:w$t.local.ambientAtNoon*t.ambient,color:r$X(1,1,1)},timeOfDay:"early afternoon"};}A$C(u.ambient.color,e.ambient.color,u.ambient.color,d),u.ambient.intensity=s$1c(e.ambient.intensity,u.ambient.intensity,d),A$C(u.direct.color,e.direct.color,u.direct.color,d),u.direct.intensity=s$1c(e.direct.intensity,u.direct.intensity,d),u.specularStrength="rainy"===a||"snowy"===a||"foggy"===a?0:1,u.environmentStrength="rainy"===a?.7:"snowy"===a||"foggy"===a?.75:1;}u.noonFactor="sun"===l?j$A(i,g):1,"sun"===l?M$p(i,n,o,u.direct.directionToLightSource):T$y(r,o,u.direct.directionToLightSource);}function T$y(t,e,n){e===l$O.Global?z$s(F$p,t.eye):o$W(F$p,0,0,1),q$p(L$x,t.viewForward,-1);const o=x$I(L$x,F$p),a=Math.max(o-2*U$o,0),r=.85*a/(a+1),l=Math.max(U$o,o-U$o-r);p$Z(k$u,-l,t.viewRight),L$E(n,L$x,k$u),u$W(n,n,q$p(R$p,t.viewRight,_$u)),z$s(n,n);}function M$p(t,i,l,s){const u=z$p,m=r$12(P$p);if(l===l$O.Global)o$L.getPosition(t,0,0,u),o$W(s,0,0,-1),b$C(m,m,-u.azimuth),l$S(m,m,-u.altitude),L$E(s,s,m);else {const n=w$t.planarDirection,a=n.globalAngles,l=i[2];let g=(Math.abs(l)-n.localAltitude)/(n.globalAltitude-n.localAltitude);g=o$X(g,0,1),g<1?(o$L.getPosition(t,i[1],i[0],u),u.azimuth=(1-g)*u.azimuth+g*a.azimuth,u.altitude=(1-g)*u.altitude+g*a.altitude):(u.azimuth=a.azimuth,u.altitude=a.altitude),o$W(s,0,-1,0),m$P(m,m,-u.azimuth),b$C(m,m,-u.altitude),L$E(s,s,m);}}function v$z(t,e){if(e===l$O.Global)return !0;const i=w$t.planarDirection;return Math.abs(t)<i.localAltitude}function x$x(t,e,i,n,o){const a=t.getTime(),r=e.getTime()-a,l=Math.floor(r/i)+1,c=new Array(l);for(let s=0;s<l;++s)H$k.setTime(a+i*s),c[s]=n$16(),M$p(H$k,n,o,c[s]);return c}const S$x=r$X(.5773502691896258,-.5773502691896258,.5773502691896258);class O$B{constructor(){this.ambient={color:r$X(1,1,1),intensity:.55},this.direct={color:r$X(1,1,1),intensity:.55,directionToLightSource:t$12(S$x)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1;}}const P$p=e$10(),z$p={azimuth:0,altitude:0};function j$A(t,i){const n=t.valueOf();let o,a;i.polarException===o$L.PolarException.MIDNIGHT_SUN?(o=n-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):i.polarException===o$L.PolarException.POLAR_NIGHT?(o=n-2,a=n-1):(o=i.sunrise.valueOf(),a=i.sunset.valueOf());const r=o+(a-o)/2;return 1-o$X(Math.abs(n-r)/432e5,0,1)}function D$k(t){switch(t){case"disabled":case"sunny":case"cloudy":return {direct:1,ambient:1};case"rainy":return {direct:.4,ambient:1.2};case"snowy":return {direct:.5,ambient:1.3};case"foggy":return {direct:.2,ambient:1.6}}}function E$B(t,e){const i=(t[0]+t[1]+t[2])/3;for(let n=0;n<3;n++)t[n]=t[n]+(i-t[n])*e;return t}function I$s(t,e,i){const n=t.valueOf();let o,a;e.polarException===o$L.PolarException.MIDNIGHT_SUN?(o=n-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):e.polarException===o$L.PolarException.POLAR_NIGHT?(o=n-2,a=n-1):(o=e.sunrise.valueOf(),a=e.sunset.valueOf());const r=a-o,l=o+r/2,c=r/4,s=l-c,u=l+c,m=.06*r,d=o-m/2,g=o+m/2,b=a-m/2,f=a+m/2,y=w$t.local,A=[.01,y.ambientAtNight],N=[.8,.8,1],T=[.01,.01,.01],M=[y.directAtTwilight,y.ambientAtTwilight],v=[1,.6,.5],x=[.8,.8,1],S=[.9*y.directAtNoon,y.ambientAtNoon],O=[1,.98,.98],P=[.98,.98,1],z=[y.directAtNoon,y.ambientAtNoon],j=[1,1,1],I=[1,1,1],H=S,k=O,F=P,L=M,R=v,U=x;let _,C,V=[0,0],q=[0,0,0],B=[0,0,0];n<d||n>f?(V=A,q=T,B=N,C="night"):n<g?(_=g-d,V=G$h(n-d,_,A,M),q=G$h(n-d,_,T,v),B=G$h(n-d,_,N,x),C="sun rising"):n<s?(_=s-g,V=G$h(n-g,_,M,S),q=G$h(n-g,_,v,O),B=G$h(n-g,_,x,P),C="early morning"):n<l?(_=l-s,V=G$h(n-s,_,S,z),q=G$h(n-s,_,O,j),B=G$h(n-s,_,P,I),C="late morning"):n<u?(_=u-l,V=G$h(n-l,_,z,H),q=G$h(n-l,_,j,k),B=G$h(n-l,_,I,F),C="early afternoon"):n<b?(_=b-u,V=G$h(n-u,_,H,L),q=G$h(n-u,_,k,R),B=G$h(n-u,_,F,U),C="late afternoon"):n<f&&(_=f-b,V=G$h(n-b,_,L,A),q=G$h(n-b,_,R,T),B=G$h(n-b,_,U,N),C="sun setting");let J=0;switch(i){case"rainy":case"foggy":J=.9;case"snowy":J=.5;}J>0&&(q=E$B(q,J),B=E$B(B,J));const K=r$X(q[0],q[1],q[2]),Q=r$X(B[0],B[1],B[2]),W=D$k(i);return {direct:{intensity:V[0]*W.direct,color:K},ambient:{intensity:V[1]*W.ambient,color:Q},timeOfDay:C}}function G$h(t,e,i,n){const o=[];for(let a=0;a<i.length;a++)o[a]=(n[a]-i[a])*t/e+i[a];return o}const H$k=new Date(0),k$u=e$10(),F$p=n$16(),L$x=n$16(),R$p=n$16(),U$o=.25,_$u=.2;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let L$w=class extends n$17.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new u$U,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new n$1g,this._ambientLight=new i$10,this._moonLight=new c$15,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition();}destroy(){this.disconnectView(),this._viewHandles.destroy();}get _view(){return this._renderer?.view}get updating(){return !((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===l$O.Global&&A$E(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new M$q({view:e});const t=()=>this._updateRenderParameters(),r=()=>this._cameraHandler(),i=()=>this._updateLighting();this._viewHandles.add([l$M((()=>e.environment.lighting),(e=>this._updateLightingHandler(e)),U$s),l$M((()=>"sun"===e.environment.lighting.type?e.environment.lighting.date:null),(e=>this._lightingDateHandler(e)),U$s),l$M((()=>e.stationary),(()=>this._interactingStationaryHandler())),l$M((()=>e.environment.lighting.directShadowsEnabled),t,U$s),l$M((()=>e.environment.lighting.ambientOcclusionEnabled),t,U$s),l$M((()=>e.environment.lighting.waterReflectionEnabled),t,U$s),l$M((()=>e.environment.background?.color),t,U$s),l$M((()=>e.spatialReference),(()=>this._resetReferencePosition(!0)),U$s),l$M((()=>e.environment.weather.type),i,U$s),l$M((()=>this.weatherEnabled),i,U$s),l$M((()=>e.viewingMode),(()=>this._resetReferencePosition(!0)),w$x),l$M((()=>"sun"===e.environment.lighting.type&&e.environment.lighting.cameraTrackingEnabled),(e=>this._updateCameraTracking(e)),w$x),l$M((()=>e.state.camera),r,w$x),l$M((()=>this.disableQueries),r)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating");}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=l$N(this._renderer);}_updateLightingHandler(e){this._updateCameraTracking("sun"===e.type&&e.cameraTrackingEnabled),this._lightingDateHandler("sun"===e.type?e.date:null),this._updateRenderParameters();}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else {const e=this._view.environment.lighting;"sun"===e?.type&&(e.positionTimezoneInfo.autoUpdated=!1);}}_lightingDateHandler(e){const t=this._view.environment.lighting;if("virtual"!==t?.type){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!Ce$1(r)){const e=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(e))return void this._requestReferencePositionUpdate(e)}if(this._preupdateTracking(e),r$W(this._referencePosWGS84Comparable)){const e=m$Q(this._referencePosWGS84Comparable,A$v);r$W(e)&&(t.autoUpdate(null,e),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0));}}this._updateLighting(e);}}else this._updateLighting();}_preupdateTracking(e){!this._trackingEnabled&&"sun"===this._view.environment.lighting.type&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e);}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const r=t.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r));}_cameraHandlerClientSide(e,t){const r=A$E(this._view.spatialReference);if(r&&!Ce$1(this._view.spatialReference))return !1;const i=e.position;return t$V(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=n$16()),r?jn(i,this._referencePosWGS84Comparable):o$W(this._referencePosWGS84Comparable,i.longitude,i.latitude,i.z),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=t.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged());}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate();}_updateLighting(e){const t=this._view,r=e||("sun"===t.environment.lighting.type?t.environment.lighting.date:null),i=this._referencePosWGS84Comparable,s=r$W(i)?Q$i:D$j;if(r$W(i)){const e=this.weatherVisible?t.environment.weather.type:"disabled";N$n(r,i,t.state.viewingMode,e,t.state.camera,t.environment.lighting.type,s);}const o=this._mainLight,a=s.direct;q$p(o.intensity,a.color,a.intensity*Math.PI),r$V(o.direction,a.directionToLightSource),o.specularStrength=s.specularStrength,o.environmentStrength=s.environmentStrength;const h=this._ambientLight;q$p(h.intensity,s.ambient.color,s.ambient.intensity);const c=this._moonLight;A$C(c.intensity,V$l,I$r,s.globalFactor);const d=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));q$p(c.intensity,c.intensity,d),r$V(c.direction,a.directionToLightSource),t._stage.renderView.updateLightSources([o,h,c],1-s.noonFactor,s.globalFactor),this._updateRenderParameters();}_autoUpdateTimezone(e,t=null){if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||t$V(e))return !1;const r=q$k;r.setTime((t||this._view.environment.lighting.date).getTime());const i=m$Q(e,A$v);if(t$V(i))return !1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===i.hours&&s.minutes===i.minutes&&s.seconds===i.seconds)return !1}else s=i;const n=r.getUTCHours()-(i.hours-s.hours),a=r.getUTCMinutes()-(i.minutes-s.minutes),h=r.getUTCSeconds()-(i.seconds-s.seconds);return r.setUTCHours(n),r.setUTCMinutes(a),r.setUTCSeconds(h),!t&&this._view.environment.lighting.autoUpdate(r,i)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const r=E$I(this._referencePosWGS84Comparable,!0,(e=>v$z(e[2],this._view.state.viewingMode))),i=this._view.environment.background,s=i instanceof n$1h?{type:"color",color:e$1a(l$T.toUnitRGBA(i.color))}:{type:"color",color:r$Z(0,0,0,1)};e.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&r,background:s,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible});}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler();}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const e=this._referencePosUpdateQuery=L$F(this._referencePointUpdateDelay).then((()=>{if(this._referencePosUpdateQuery===e){const t=()=>this._referencePosUpdateQuery!==e;return this._doReferencePositionUpdateQuery(t)}})).catch((e=>{"mapcoordshelper:missing-geometry-service"===e.name&&(this.disableQueries=!0);})).then((()=>{this._referencePosUpdateQuery===e&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"));})),t=this._referencePosUpdateTimer=L$F(this._referencePointUpdateInterval).then((()=>{this._referencePosUpdateTimer===t&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate());}));this.notifyChange("updating");}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const e=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=e):this._referencePosWGS84Comparable=[t[0],t[1],e],this._referencePosChanged();}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime);}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable");}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return !0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return {get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t;},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t;},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t;},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t;},set disableWeather(t){e._disableWeather=t;}}}};e$Y([d$R({type:Boolean,readOnly:!0})],L$w.prototype,"updating",null),e$Y([d$R()],L$w.prototype,"disableQueries",void 0),e$Y([d$R()],L$w.prototype,"_disableWeather",void 0),e$Y([d$R()],L$w.prototype,"weatherEnabled",null),e$Y([d$R()],L$w.prototype,"weatherVisible",null),e$Y([d$R()],L$w.prototype,"referencePositionWGS84Comparable",null),e$Y([d$R()],L$w.prototype,"_renderer",void 0),e$Y([d$R()],L$w.prototype,"_referencePosWGS84Comparable",void 0),L$w=e$Y([n$18("esri.views.3d.environment.SceneViewEnvironmentManager")],L$w);const Q$i=new O$B,D$j=new O$B,q$k=new Date,A$v={hours:0,minutes:0,seconds:0},V$l=r$X(.22,.22,.33),I$r=r$X(.22,.22,.22);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function O$A(n,t){return 0!=(n&t)}function L$v(n,t,a,O,L,i){0!==n&&(a?(i.min=Math.min(i.min,t),i.max=Math.max(i.max,t)):null!=O?(i.min-=Math.max(0,(t-i.min)*(1-O)),i.max+=Math.max(0,(t-i.max)*(1-O))):L&&(i.min-=Math.max(0,t-i.min-L),i.max+=Math.max(0,t-i.max-L)));}var i$Q,N$m,m$H;!function(n){n[n.NONE=0]="NONE",n[n.ZOOM=1]="ZOOM",n[n.TUMBLE=2]="TUMBLE",n[n.LOOK_AROUND=3]="LOOK_AROUND",n[n.PAN=4]="PAN",n[n.ASCEND=5]="ASCEND";}(i$Q||(i$Q={})),function(n){n[n.NONE=0]="NONE",n[n.TILT=1]="TILT",n[n.ALTITUDE=2]="ALTITUDE",n[n.DISTANCE=4]="DISTANCE",n[n.COLLISION=8]="COLLISION",n[n.ALL=15]="ALL",n[n.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION";}(N$m||(N$m={})),function(n){n[n.TUMBLE=0]="TUMBLE",n[n.LOOK_AROUND=1]="LOOK_AROUND";}(m$H||(m$H={}));const E$A={selection:N$m.NONE,interactionType:i$Q.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:m$H.TUMBLE};function o$K(O,L,i,N){return L=L||O.viewForward,r$V(N,L),q$p(N,N,Math.sign(P$u(L,i))),N}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function p$I(r,n,t){return r[0]*n[0]+r[1]*n[1]+r[2]*n[2]+r[3]<t}function a$P(r,n,t){const i=n[0],e=n[1],c=n[2];return !(r[0][0]*i+r[0][1]*e+r[0][2]*c+r[0][3]>t)&&(!(r[1][0]*i+r[1][1]*e+r[1][2]*c+r[1][3]>t)&&(!(r[2][0]*i+r[2][1]*e+r[2][2]*c+r[2][3]>t)&&(!(r[3][0]*i+r[3][1]*e+r[3][2]*c+r[3][3]>t)&&(!(r[4][0]*i+r[4][1]*e+r[4][2]*c+r[4][3]>t)&&!(r[5][0]*i+r[5][1]*e+r[5][2]*c+r[5][3]>t)))))}function m$G(r,n,t,i){return b$y(r,n,null,k$t(i,n,t,!1))}function d$J(r,n){for(let t=0;t<6;t++){if(W$i(r[t],n)>0)return !1}return !0}function h$J(r,n,t,i){return b$y(r,n,t,k$t(i,n,t,!0))}function j$z(r,c,u,o){const s=P$u(u,e$15(r,o,c));return u$W(r,c,q$p(r,u,s))}const g$I={dir:n$16(),len:0,clip:n$1b()};function k$t(r,n,i,s){const f=g$I;return r?(i&&s&&(f.len=x$H(n,i)),r$V(f.dir,r)):s?(f.len=x$H(n,i),e$15(f.dir,i,n),q$p(f.dir,f.dir,1/f.len)):(e$15(f.dir,i,n),z$s(f.dir,f.dir)),f}function v$y(r,t,i){const e=P$u(Z$g(r),i.dir),c=-W$i(r,t);if(c<0&&e>=0)return !1;if(e>-1e-6&&e<1e-6)return c>0;if((c<0||e<0)&&!(c<0&&e<0))return !0;const u=c/e;return e>0?u<i.clip[1]&&(i.clip[1]=u):u>i.clip[0]&&(i.clip[0]=u),i.clip[0]<=i.clip[1]}function b$y(r,n,t,i){i.clip[0]=0,i.clip[1]=t?i.len:Number.MAX_VALUE;for(let e=0;e<r.length;e++)if(!v$y(r[e],n,i))return !1;return !0}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function d$I(t,n,o=E$A){const a=l$I(t,n,o);if(0===a)return !1;const m=t.renderCoordsHelper,u=m.getAltitude(n.eye)+a,f=o$K(n,o.interactionDirection,x$w(t,n,Math.sign(a),h$I),T$x),d=r$V(A$u,n.viewForward),y=m.intersectInfiniteManifold(j$G(n.eye,f),u,C$v);return n.eye=r$W(y)?y:m.setAltitude(C$v,u,n.eye),n.center=j$z(C$v,n.eye,d,n.center),!0}function l$I(e,r,n=E$A){if(!y$z(e,n))return 0;const o=g$H(e.state.constraints.altitude,M$o);j$y(e,n,o);const i=e.renderCoordsHelper.getAltitude(r.eye),s=o$X(i,o.min,o.max)-i;return Math.abs(s)<=1e-6?0:s}function y$z(t,e){const r=t.state.constraints.altitude;return !(!t.state.isGlobal||!r)&&(e.interactionType!==i$Q.TUMBLE||!O$A(e.selection,N$m.TILT))}function j$y(t,e,r){const n=e.interactionType;if(n===i$Q.NONE)return;const{min:o,max:i}=r,{interactionStartCamera:s,interactionFactor:c}=e,m=n===i$Q.TUMBLE||n===i$Q.ZOOM,u=l$I(t,s),p=0===u?0:t.renderCoordsHelper.getAltitude(s.eye);r.min=o,r.max=i;L$v(u,p,m,c,.05*p,r);}function x$w(t,e,r,o){return t.renderCoordsHelper.worldUpAtPosition(e.eye,o),q$p(o,o,r),o}function g$H(t,e){return e.min=t.min,e.max=t.max,e}const M$o={min:0,max:0},T$x=n$16(),h$I=n$16(),A$u=n$16(),C$v=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function y$y(e,n,r=E$A){if(!e.state.isLocal)return 0;const t=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||t===1/0)return 0;x$v.min=0,x$v.max=t,g$G(e,r,x$v);const o=j$x(e,n),i=x$v.max-o;return i>=-1e-6?0:i}function O$z(n,t,s=E$A){const p=y$y(n,t,s);if(0===p)return !1;const d=n.pointsOfInterest.surfaceOrigin,O=j$x(n,t)+p,g=r$V(h$H,t.eye),x=o$K(t,s.interactionDirection,l$H(n,t,k$s),L$u);if(!U$u(w$y(d.renderLocation,O),j$G(t.eye,x),C$u))return !1;t.eye=C$u;const N=e$15(I$q,t.eye,g);t.center=u$W(C$u,t.center,N);const b=n.renderCoordsHelper.getAltitude(t.center),v=n.renderCoordsHelper.intersectInfiniteManifold(t.ray,b,C$u);return r$W(v)&&(t.center=v),!0}function g$G(e,n,r){const t=n.interactionType;if(t===i$Q.NONE)return;const{min:o,max:i}=r,{interactionStartCamera:s,interactionFactor:c}=n,a=t===i$Q.ZOOM||t===i$Q.PAN,f=y$y(e,s),m=0===f?0:j$x(e,s);r.min=o,r.max=i;L$v(f,m,a,c,.05*m,r);}function j$x(e,r){const t=e.pointsOfInterest.surfaceOrigin;return x$H(r.eye,t.renderLocation)}function l$H(e,n,r){const o=e.pointsOfInterest.surfaceOrigin;return H$n(r,n.eye,o.renderLocation)}const x$v={min:0,max:0},h$H=n$16(),I$q=n$16(),L$u=n$16(),k$s=n$16(),C$u=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function o$J(r,o,l=i$P.EYE){const a=r.state.constraints;if(!a.collision.enabled)return !1;const N=m$R(r,o.eye),A=r.renderCoordsHelper.getAltitude(o.eye),C=N+a.collision.elevationMargin;if(A>=C)return !1;const f=s$1b(o.eye);if(e$15(c$M,o.center,o.eye),o.eye=r.renderCoordsHelper.setAltitude(_$t,C,o.eye),l===i$P.EYE_AND_CENTER)o.center=u$W(c$M,o.eye,c$M);else if(l===i$P.EYE_AND_CENTER_SCALE){const e=(f-A+C)/f;o.center=q$p(c$M,o.center,e);}return !0}var i$P;!function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE";}(i$P||(i$P={}));const c$M=n$16(),_$t=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function n$X(c,n,e){c.worldUpAtPosition(n,i$O),e$15(m$F,e,n);const a=s$1b(m$F);return 0===a?0:l$U(P$u(m$F,i$O)/a)}const i$O=n$16(),m$F=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function P$o(t,r,n=E$A,i=!0){W$f.eyeCenterDistance=0,W$f.requiresTwoSteps=!1;const s=U$n(t,r,n,void 0,W$f);if(0===s)return !1;switch(p$Z(z$o,-s,r.viewRight),n.tiltMode){case m$H.LOOK_AROUND:L$E(_$s,r.viewForward,z$o),q$p(_$s,_$s,W$f.eyeCenterDistance),r.center=u$W(G$g,r.eye,_$s);break;case m$H.TUMBLE:e$15(_$s,r.center,r.eye),L$E(_$s,_$s,z$o),r.eye=e$15(G$g,r.center,_$s);break;default:n$1i(n.tiltMode);}return r.up=L$E(G$g,r.up,z$o),!W$f.requiresTwoSteps||!i||P$o(t,r,n,!1)}function U$n(e,t,r=E$A,n=E$A,i){if(!e.state.constraints.tilt)return 0;const s=t.distance,a=e.state.constraints.tilt(s,Q$h);return B$o(e,r,a),n.interactionType===i$Q.TUMBLE&&O$A(n.selection,N$m.ALTITUDE)&&K$i(e,n.interactionStartCamera,a),r.tiltMode===m$H.LOOK_AROUND||n.tiltMode===m$H.LOOK_AROUND?L$t(e,t,a,i):v$x(e,t,a)}function v$x(e,r,n){const i=n$X(e.renderCoordsHelper,r.center,r.eye),s=i-o$X(i,n.min,n.max);return g$F(s)?s:0}function L$t(t,r,n,i){switch(i&&(i.requiresTwoSteps=!1),t.viewingMode){case"global":return q$j(t,r,n,i);case"local":return k$r(t,r,n,i);default:return void n$1i(t.viewingMode)}}function k$r(e,r,n,i){const s=n$X(e.renderCoordsHelper,r.center,r.eye),a=o$X(s,n.min,n.max),c=s-a;if(!g$F(c))return 0;if(i){const t=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=e.renderCoordsHelper.getAltitude(r.eye)-t,s=Math.cos(a);Math.abs(s)>1e-4?i.eyeCenterDistance=n/s:i.eyeCenterDistance=r.distance;}return c}function q$j(e,r,n,i){const s=b$x(e,r,V$k),a=o$X(s.tiltAtCenter,n.min,n.max);if(!g$F(s.tiltAtCenter-a))return 0;let c,o;return s.centerIsOnSurface?(c=E$z(s),o=F$o(s,c)):(c=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),i&&c<Math.PI/2&&(i.requiresTwoSteps=!0,c=Math.PI/2-1e-5),o=N$l(s,c)),i&&(i.eyeCenterDistance=H$j(s,c)),o}function b$x(e,t,n){const i=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,a=i+p$T(e.spatialReference).radius,c=e.renderCoordsHelper.intersectManifold(t.ray,i,G$g);return n.eyeCenterDistance=t.distance,n.centerIsOnSurface=!1,r$W(c)?(n.eyeCenterDistance=x$H(t.eye,c),n.tiltAtCenter=n$X(e.renderCoordsHelper,c,t.eye),n.centerIsOnSurface=!0):e.state.isLocal?n.tiltAtCenter=n$X(e.renderCoordsHelper,t.center,t.eye):(B$r(T$D($$j,a),t.ray,G$g),n.eyeCenterDistance=x$H(t.eye,G$g),n.tiltAtCenter=l$U(-P$u(t.viewForward,z$s(G$g,G$g)))),n.radius=a,n.eyeRadius=s$1b(t.eye),n.constraints=e.state.constraints,n}function g$F(e){return Math.abs(e)>1e-9}function E$z(e){const{constraints:t,eyeCenterDistance:r,tiltAtCenter:n}=e;let i=n,s=t.clampTilt(r,n);const a=H$j(e,s);if(t.clampTilt(a,n)===s)return s;let c=0;for(;c<10&&g$F(s-i);){const r=(i+s)/2,n=H$j(e,r);g$F(t.clampTilt(n,r)-r)?i=r:s=r,c++;}return s}function H$j(e,r){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const i=Math.PI-o$X(r,0,Math.PI),s=b$D(e.radius/e.eyeRadius*Math.sin(i)),a=Math.PI-i-s,c=Math.sin(a)/Math.sin(i);if(e.eyeRadius<e.radius&&c>1){const t=Math.PI-s,r=Math.PI-i-t;return Math.sin(r)/Math.sin(i)*e.eyeRadius}return c*e.eyeRadius}function F$o(e,t){const r=b$D(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),i=b$D(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?r-i:i-r}function N$l(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}function B$o(e,t,r){if(t.interactionType===i$Q.NONE)return;const{interactionStartCamera:n,interactionFactor:i}=t,{min:s,max:a}=r,c=U$n(e,n,E$A,t),o=0===c?0:n$X(e.renderCoordsHelper,n.center,n.eye);r.min=s,r.max=a,t.interactionType===i$Q.TUMBLE?(O$A(t.selection,N$m.ALTITUDE)&&K$i(e,n,r),L$v(c,o,!0,i,J$f,r)):L$v(c,o,!1,i,J$f,r);}function K$i(e,t,n){if(e.state.isLocal)return;const i=e.state.constraints;if(!i.altitude)return;const s=v$P(t.center),a=Math.sqrt(s),c=t.distance,o=p$T(e.spatialReference).radius,u=i.altitude.min+o,l=i.altitude.max+o,m=(u*u-c*c-s)/(-2*a*c),d=(l*l-c*c-s)/(-2*a*c);n.min=Math.max(n.min,Math.min(Math.PI-l$U(d),n.max)),n.max=Math.min(n.max,Math.PI-l$U(m));}const _$s=n$16(),z$o=e$10(),G$g=n$16(),J$f=M$t(5),Q$h={min:0,max:0},V$k={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},W$f={eyeCenterDistance:0,requiresTwoSteps:!1};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function t$J(t){return t}const u$J=t=>t*t,o$I=t=>1-u$J(1-t),i$N=t=>t<.5?u$J(2*t)/2:(o$I(2*(t-.5))+1)/2,n$W=t=>t*t*t,c$L=t=>1-n$W(1-t),a$O=t=>t<.5?n$W(2*t)/2:(c$L(2*(t-.5))+1)/2,s$U=t=>t*t*t*t,q$i=t=>1-s$U(1-t),r$M=t=>t<.5?s$U(2*t)/2:(q$i(2*(t-.5))+1)/2,e$R=t=>t*t*t*t*t,b$w=t=>1-e$R(1-t),d$H=t=>t<.5?e$R(2*t)/2:(b$w(2*(t-.5))+1)/2,h$G=t=>1-Math.cos(t*Math.PI/2),p$H=t=>1-h$G(1-t),x$u=t=>t<.5?h$G(2*t)/2:(p$H(2*(t-.5))+1)/2,M$n=t=>2**(10*(t-1)),f$J=t=>1-M$n(1-t),l$G=t=>t<.5?M$n(2*t)/2:(f$J(2*(t-.5))+1)/2,I$p=t=>-(Math.sqrt(1-t*t)-1),P$n=t=>1-I$p(1-t),g$E=t=>t<.5?I$p(2*t)/2:(P$n(2*(t-.5))+1)/2;function j$w(t){const u=2*(t-Math.sqrt((t-1)*t)),o=u/2/t;return i=>i<o?t*i*i:u*i-u+1}function k$q(t,u){return (o,i)=>o<u?u*t(o/u,i):1-t((1-o)/(1-u),i)*(1-u)}const m$E=k$q(j$w(1),1),v$w=k$q(j$w(1),0),w$s=k$q(j$w(1),.5),y$x=k$q(j$w(2),1),z$n=k$q(j$w(2),0),A$t=k$q(j$w(2),.5),B$n=k$q(j$w(3),1),C$t=k$q(j$w(3),0),D$i=k$q(j$w(3),.5),E$y=k$q(j$w(4),1),F$n=k$q(j$w(4),0),G$f=k$q(j$w(4),.5),H$i={linear:t$J,"in-quad":u$J,"out-quad":o$I,"in-out-quad":i$N,"in-coast-quad":m$E,"out-coast-quad":v$w,"in-out-coast-quad":w$s,"in-cubic":n$W,"out-cubic":c$L,"in-out-cubic":a$O,"in-coast-cubic":y$x,"out-coast-cubic":z$n,"in-out-coast-cubic":A$t,"in-quart":s$U,"out-quart":q$i,"in-out-quart":r$M,"in-coast-quart":B$n,"out-coast-quart":C$t,"in-out-coast-quart":D$i,"in-quint":e$R,"out-quint":b$w,"in-out-quint":d$H,"in-coast-quint":E$y,"out-coast-quint":F$n,"in-out-coast-quint":G$f,"in-sine":h$G,"out-sine":p$H,"in-out-sine":x$u,"in-expo":M$n,"out-expo":f$J,"in-out-expo":l$G,"in-circ":I$p,"out-circ":P$n,"in-out-circ":g$E};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function E$x(t,o,r=d$G,i=o){let e=!1;i!==o&&i.copyFrom(o),i.computeUp(t.state.viewingMode);for(let n=0;n<j$v;n++){let o=0;for(const n of U$m)if(O$A(r.selection,n.type)){const s=Math.abs(n.error(t,i,r));n.apply(t,i,r)&&(e=!0,o+=s);}if(0===o)break}const a=O$A(r.selection,N$m.COLLISION),l=C$s(r.interactionType,t);return a&&o$J(t,i,l)&&(e=!0),e&&i.computeUp(t.state.viewingMode),e}function C$s(t,o){switch(t){case i$Q.PAN:return i$P.EYE_AND_CENTER;case i$Q.ASCEND:return o.state.isGlobal?i$P.EYE_AND_CENTER_SCALE:i$P.EYE_AND_CENTER;default:return i$P.EYE}}function y$w(o,r){const n="number"==typeof o?o:m$S(o,r),i=Math.min(1,n/150);return a$O(i)}function T$w(t,o,r){return U$n(t,o,r)*o.distance}const U$m=[{type:N$m.TILT,error:T$w,apply:P$o},{type:N$m.ALTITUDE,error:l$I,apply:d$I},{type:N$m.DISTANCE,error:y$y,apply:O$z}],d$G={selection:N$m.ALL,interactionType:i$Q.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:m$H.TUMBLE},j$v=5;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const P$m=n$16(),g$D=n$16(),_$r=n$16(),k$p=n$16(),v$v=n$16(),x$t=n$16(),z$m={upward:r$X(0,0,1),forward:r$X(0,1,0),sideway:r$X(1,0,0)},b$v=e$16();class T$v{constructor(t=l$O.Global){this.viewingMode=t,this.center=n$16(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=t$12(z$m.forward);}pixelsPerPanAtZoom(t){return this.size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this.size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t}compareTo(t,e){if(e||(e={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===l$O.Global){const i=(s$1b(this.center)+s$1b(t.center))/2;e.pan=x$I(this.center,t.center)*i;}else e.pan=x$H(this.center,t.center);let i=Math.abs(t.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const o=Math.abs(t.pitch-this.pitch);return e.rotate=Math.max(i,o),e.sourceZoom=this.distance,e.targetZoom=t.distance,e}interpolate(e,i,s){this.viewingMode===l$O.Global?k$A(e.center,i.center,s.pan,this.center):A$C(this.center,e.center,i.center,s.pan),this.distance=s$1c(e.distance,i.distance,s.zoom),this.pitch=s$1c(e.pitch,i.pitch,s.rotate);let a=e.yaw;const h=i.yaw;Math.abs(h-a)>=Math.PI&&(a+=2*(a<h?1:-1)*Math.PI),this.yaw=s$1c(a,h,s.rotate);}copyFrom(t){r$V(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,r$V(this.lookAtDirection,t.lookAtDirection),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode;}copyFromRenderCamera(t){const e=this._lookAtOrientation(t.center,b$v);r$V(this.center,t.center),e$15(k$p,t.center,t.eye),O$K(k$p,k$p,e),O$K(v$v,t.up,e),this.distance=s$1b(k$p),k$p[0]/=this.distance,k$p[1]/=this.distance,k$p[2]/=this.distance,this.pitch=this._eyeUpToPitch(k$p),this.yaw=this._eyeUpToYaw(k$p,v$v),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t);}copyFromCommon(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov);}copyToRenderCamera(t){const i=this._lookAtOrientation(this.center,b$v);o$14(i,i),this._axisAngleVec3(z$m.sideway,this.pitch-Math.PI/2,z$m.forward,k$p),this._axisAngleVec3(z$m.upward,this.yaw,k$p),this._axisAngleVec3(z$m.sideway,this.pitch-Math.PI/2,z$m.upward,v$v),this._axisAngleVec3(z$m.upward,this.yaw,v$v),q$p(k$p,k$p,this.distance),O$K(k$p,k$p,i),O$K(v$v,v$v,i),t.center=this.center,t.eye=e$15(k$p,this.center,k$p),t.up=v$v;}_axisAngleVec3(t,e,i,s=i){const a=Math.cos(e),o=Math.sin(e);return q$p(P$m,i,a),_$v(g$D,t,i),q$p(g$D,g$D,o),q$p(_$r,t,(1-a)*P$u(t,i)),u$W(s,u$W(s,P$m,g$D),_$r)}_lookAtOrientation(t,e=e$16()){return this._upAtLookAt(t,_$r),_$v(P$m,this.lookAtDirection,_$r),z$s(P$m,P$m),0===P$m[0]&&0===P$m[1]&&0===P$m[2]&&r$V(P$m,z$m.sideway),_$v(g$D,_$r,P$m),z$s(g$D,g$D),e[0]=P$m[0],e[1]=g$D[0],e[2]=_$r[0],e[3]=P$m[1],e[4]=g$D[1],e[5]=_$r[1],e[6]=P$m[2],e[7]=g$D[2],e[8]=_$r[2],e}_upAtLookAt(t,e){return this.viewingMode===l$O.Local?r$V(e,z$m.upward):z$s(e,t)}_eyeUpToPitch(t){return Math.PI-x$I(z$m.upward,t)}_eyeUpToYaw(t,e){const i=x$t;return Math.abs(e[2])<.5?(r$V(i,e),t[2]>0&&q$p(i,i,-1)):r$V(i,t),_$v(g$D,i,z$m.upward),z$s(g$D,g$D),x$I(z$m.sideway,g$D,z$m.upward)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const J$e=s$17.getLogger("esri.views.3d.webgl-engine.lib.Camera");class K$h{constructor(t=null,i=null,r=null){this._viewUp=n$16(),this._viewForward=n$16(),this._viewRight=n$16(),this._ray=d$U(),this._viewport=r$Z(0,0,1,1),this._padding=r$Z(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=r$13(1,1e3),this._viewDirty=!0,this._viewMatrix=e$10(),this._projectionDirty=!0,this._projectionMatrix=e$10(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=e$10(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=e$10(),this._inverseProjectionDirty=!0,this._inverseProjectionMatrix=null,this._frustumDirty=!0,this._frustum=H$o(),this._fullViewport=n$1a(),this._pixelRatio=1,this.relativeElevation=0,r$W(t)&&r$V(this._ray.origin,t),this._center=r$W(i)?t$12(i):n$16(),this._up=r$W(r)?t$12(r):r$X(0,0,1);}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1;}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin);}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center);}get ray(){return e$15(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up);}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){n$15(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0;}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0);}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0);}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3];}get x(){return this._viewport[0]}set x(t){t+=this._padding[et$6.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0);}get y(){return this._viewport[1]}set y(t){t+=this._padding[et$6.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0);}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0);}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0);}get fullWidth(){return this._viewport[2]+this._padding[et$6.RIGHT]+this._padding[et$6.LEFT]}set fullWidth(t){this.width=t-(this._padding[et$6.RIGHT]+this._padding[et$6.LEFT]);}get fullHeight(){return this._viewport[3]+this._padding[et$6.TOP]+this._padding[et$6.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[et$6.TOP]+this._padding[et$6.BOTTOM]);}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[et$6.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[et$6.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){this._padding[et$6.TOP]===t[et$6.TOP]&&this._padding[et$6.RIGHT]===t[et$6.RIGHT]&&this._padding[et$6.BOTTOM]===t[et$6.BOTTOM]&&this._padding[et$6.LEFT]===t[et$6.LEFT]||(this._viewport[0]+=t[et$6.LEFT]-this._padding[et$6.LEFT],this._viewport[1]+=t[et$6.BOTTOM]-this._padding[et$6.BOTTOM],this._viewport[2]-=t[et$6.RIGHT]+t[et$6.LEFT]-(this._padding[et$6.RIGHT]+this._padding[et$6.LEFT]),this._viewport[3]-=t[et$6.TOP]+t[et$6.BOTTOM]-(this._padding[et$6.TOP]+this._padding[et$6.BOTTOM]),a$15(this._padding,t),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0);}get viewProjectionMatrix(){return this._viewProjectionDirty&&(u$Z(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const t=this.width,i=this.height,e=this.near*Math.tan(this.fovY/2),r=e*this.aspect;A$F(this._projectionMatrix,-r*(1+2*this._padding[et$6.LEFT]/t),r*(1+2*this._padding[et$6.RIGHT]/t),-e*(1+2*this._padding[et$6.BOTTOM]/i),e*(1+2*this._padding[et$6.TOP]/i),this.near,this.far),this._projectionDirty=!1;}return this._projectionMatrix}get inverseProjectionMatrix(){return t$V(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=e$10()),this._inverseProjectionDirty&&h$U(this._inverseProjectionMatrix,this.projectionMatrix),this._inverseProjectionMatrix}set projectionMatrix(t){n$15(this._projectionMatrix,t),this._projectionDirty=!1,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0;}get fov(){return this._fov}set fov(t){this._fov=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0;}get fovX(){return g$U(this._fov,this.width,this.height)}set fovX(t){this._fov=l$V(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0;}get fovY(){return k$B(this._fov,this.width,this.height)}set fovY(t){this._fov=m$T(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0;}get distance(){return x$H(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return (this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(h$U(this._viewInverseTransposeMatrix,this.viewMatrix),o$15(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const i=2*t-1;return 2*this.near*this.far/(this.far+this.near-i*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this._pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(t){r$V(this._ray.origin,t.eye),r$V(this._center,t.center),r$V(this._up,t.up),a$15(this._viewport,t.viewport),a$15(this._padding,t.padding),a$16(this._nearFar,t.nearFar),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const i=t;return this._viewDirty=i._viewDirty,this._viewDirty||(n$15(this._viewMatrix,t.viewMatrix),r$V(this._viewRight,t.viewRight),r$V(this._viewUp,t.viewUp),r$V(this._viewForward,t.viewForward)),i._projectionDirty?this._projectionDirty=!0:(n$15(this._projectionMatrix,t.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._inverseProjectionDirty=!0,this._frustumDirty=i._frustumDirty,this._frustumDirty||(i$11(this._frustum,t.frustum),this._frustumDirty=!1),i._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(n$15(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),a$15(this._fullViewport,t.fullViewport),this._pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up;}clone(){return (new K$h).copyFrom(this)}equals(t){return F$t(this.eye,t.eye)&&F$t(this._center,t.center)&&F$t(this._up,t.up)&&D$r(this._viewport,t.viewport)&&D$r(this._padding,t.padding)&&S$F(this._nearFar,t.nearFar)&&this._fov===t.fov&&this._pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(this._pixelRatio!==t.pixelRatio||Math.abs(t.fov-this._fov)>=.001)return !1;const i=5e-4,e=1-1e-10;J$g($$h,t.eye,t.center),J$g(tt$7,this.eye,this._center);const r=P$u($$h,tt$7),s=Z$h($$h),h=Z$h(tt$7);return r*r>=e*s*h&&X$b(t.eye,this.eye)<Math.max(s,h)*i*i&&b$E(t.padding,this._padding)<.5&&b$E(t.viewport,this._viewport)<.5}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(f$W(this.viewForward,e$15($$h,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,i){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(i||1)))}getScreenCenter(t=i$12()){return t[0]=(this.padding[et$6.LEFT]+this.width/2)/this._pixelRatio,t[1]=(this.padding[et$6.TOP]+this.height/2)/this._pixelRatio,t}getRenderCenter(t,i=.5,e=.5){return t[0]=this.padding[et$6.LEFT]+this.width*i,t[1]=this.padding[et$6.BOTTOM]+this.height*e,t[2]=.5,t}setGLViewport(t){const i=this.viewport,e=this.padding;t.setViewport(i[0]-e[3],i[1]-e[2],i[2]+e[1]+e[3],i[3]+e[0]+e[2]);}applyProjection(t,e){t!==Q$g&&r$V(Q$g,t),Q$g[3]=1,w$z(Q$g,Q$g,this.projectionMatrix);const r=Math.abs(Q$g[3]);q$p(Q$g,Q$g,1/r);const s=this.fullViewport;e[0]=s$1c(0,s[0]+s[2],.5+.5*Q$g[0]),e[1]=s$1c(0,s[1]+s[3],.5+.5*Q$g[1]),e[2]=.5*(Q$g[2]+1),e[3]=r;}unapplyProjection(t,i){const e=this.fullViewport;Q$g[0]=(t[0]/(e[0]+e[2])*2-1)*t[3],Q$g[1]=(t[1]/(e[1]+e[3])*2-1)*t[3],Q$g[2]=(2*t[2]-1)*t[3],Q$g[3]=t[3],w$z(Q$g,Q$g,this.inverseProjectionMatrix),i[0]=Q$g[0],i[1]=Q$g[1],i[2]=Q$g[2];}projectToScreen(t,i){this.projectToRenderScreen(t,it$7),this.renderToScreen(it$7,i);}projectToRenderScreen(t,e){if(Q$g[0]=t[0],Q$g[1]=t[1],Q$g[2]=t[2],Q$g[3]=1,w$z(Q$g,Q$g,this.viewProjectionMatrix),0===Q$g[3])return null;q$p(Q$g,Q$g,1/Math.abs(Q$g[3]));const r=this.fullViewport;return "x"in e?(e.x=s$1c(0,r[0]+r[2],.5+.5*Q$g[0]),e.y=s$1c(0,r[1]+r[3],.5+.5*Q$g[1])):(e[0]=s$1c(0,r[0]+r[2],.5+.5*Q$g[0]),e[1]=s$1c(0,r[1]+r[3],.5+.5*Q$g[1]),e.length>2&&(e[2]=.5*(Q$g[2]+1))),e}unprojectFromScreen(t,i){return this.unprojectFromRenderScreen(this.screenToRender(t,it$7),i)}unprojectFromRenderScreen(t,i){if(u$Z(Z$d,this.projectionMatrix,this.viewMatrix),!h$U(Z$d,Z$d))return null;const e=this.fullViewport;return Q$g[0]=2*(t[0]-e[0])/e[2]-1,Q$g[1]=2*(t[1]-e[1])/e[3]-1,Q$g[2]=2*t[2]-1,Q$g[3]=1,w$z(Q$g,Q$g,Z$d),0===Q$g[3]?null:(i[0]=Q$g[0]/Q$g[3],i[1]=Q$g[1]/Q$g[3],i[2]=Q$g[2]/Q$g[3],i)}constrainWindowSize(t,i,e,r=e){const s=t*this._pixelRatio,h=i*this._pixelRatio,o=Math.max(s-e/2,0),n=Math.max(this.fullHeight-h-r/2,0),a=-Math.min(s-e/2,0),_=-Math.min(this.fullHeight-h-r/2,0);return [o,n,e-a- -Math.min(this.fullWidth-s-e/2,0),r-_- -Math.min(h-r/2,0)]}computeUp(t){t===l$O.Global?this._computeUpGlobal():this._computeUpLocal();}screenToRender(t,i){const e=t[0]*this._pixelRatio,r=this.fullHeight-t[1]*this._pixelRatio;return i[0]=e,i[1]=r,i}renderToScreen(t,i){const e=t[0]/this._pixelRatio,r=(this.fullHeight-t[1])/this._pixelRatio;i[0]=e,i[1]=r;}_computeUpGlobal(){e$15($$h,this.center,this.eye);const t=s$1b(this.center);t<1?(o$W(this._up,0,0,1),this._markViewDirty()):Math.abs(P$u($$h,this.center))>.9999*s$1b($$h)*t||(_$v(this._up,$$h,this.center),_$v(this._up,this._up,$$h),z$s(this._up,this._up),this._markViewDirty());}_computeUpLocal(){H$n($$h,this.eye,this.center),Math.abs($$h[2])<=.9999&&(q$p($$h,$$h,$$h[2]),o$W(this._up,-$$h[0],-$$h[1],1-$$h[2]),z$s(this._up,this._up),this._markViewDirty());}_compareAndSetView(t,i){"number"==typeof t[0]&&isFinite(t[0])&&"number"==typeof t[1]&&isFinite(t[1])&&"number"==typeof t[2]&&isFinite(t[2])?F$t(t,i)||(r$V(i,t),this._markViewDirty()):J$e.warn("Camera vector contains invalid number, ignoring value");}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0;}_recomputeFrustum(){this._frustumDirty&&(s$1f(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1);}_ensureViewClean(){this._viewDirty&&(F$s(this._viewMatrix,this.eye,this._center,this._up),o$W(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),o$W(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),o$W(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0);}}const Q$g=n$1a(),Z$d=e$10(),$$h=n$16(),tt$7=n$16(),it$7=x$J();var et$6;!function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT";}(et$6||(et$6={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const o$H={desiredScreenFlow:2,minDuration:n$1e(500),maxDuration:n$1e(8e3)};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class t$I{constructor(t){this.createCamera=t,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:o$H.desiredScreenFlow},this.source=t(),this.target=t();}clone(){const e=new t$I(this.createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings);}update(t,r,s){this.source!==t&&this.source.copyFrom(t),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=null!=s.desiredScreenFlow?s.desiredScreenFlow:o$H.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2;}halfWindowPanAtZoom(e){const t=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/t}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class e$Q{constructor(){this.segments=[];}get time(){return this.segments.reduce(((e,o)=>t$13(e+o.time)),t$13(0))}interpolateComponentsAt(t,e){t=Math.min(Math.max(t,0),1),t*=this.time;let o=0,n=0;const s=this.definition;for(let m=0;m<this.segments.length;m++){const r=this.segments[m],a=r.definition;if(t<=r.time||m===this.segments.length-1){e=this.segmentInterpolateComponentsAt(r,t/r.time,e),s.hasPan?e.pan=(o+a.compared.pan*e.pan)/s.compared.pan:e.pan=1,s.hasRotate?e.rotate=(n+a.compared.rotate*e.rotate)/s.compared.rotate:e.rotate=1;const m=e.zoom*(a.compared.targetZoom-a.compared.sourceZoom)+a.compared.sourceZoom,i=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;return s.hasZoom?e.zoom=(m-i)/(p-i):e.zoom=1,e}t-=r.time,o+=a.compared.pan,n+=a.compared.rotate;}}segmentInterpolateComponentsAt(t,e,o){return t.interpolateComponentsAt(e,o)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class i$M{constructor(t){t&&this.update(t);}get time(){return this._time}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow();}_updatePrecomputedVariables(){const t=this.definition,i=t.compared,o=i.sourceZoom,e=i.targetZoom;this._zoomSign=o>e?1:-1,this._panPixelsAtSource=i.pan*t.source.pixelsPerPanAtZoom(o);const n=(t.source.pixelsPerRotateAtZoom(o)+t.target.pixelsPerRotateAtZoom(e))/2;this._rotatePixels=i.rotate*n;}_updatePixelFlow(){const i=this.definition.compared.sourceZoom,o=this.definition.compared.targetZoom,{hasZoom:e,hasPan:n,hasRotate:s}=this.definition;let a=0,h=0;e&&(n&&(a=(o/i-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(h=this._zoomSign*(Math.log(i/o)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(e&&n&&s){const t=a+h+a*h;this._zoomPixelFlow=a*h/t*l,this._panPixelFlow=h/t*l,this._rotatePixelFlow=a/t*l;}else if(e&&n){const t=1+a;this._zoomPixelFlow=a/t*l,this._panPixelFlow=1/t*l;}else if(e&&s){const t=1+h;this._zoomPixelFlow=h/t*l,this._rotatePixelFlow=1/t*l;}else if(n&&s){const t=this._panPixelsAtSource/this._rotatePixels,i=1+t;this._panPixelFlow=t/i*l,this._rotatePixelFlow=1/i*l;}else n?this._panPixelFlow=l:e?this._zoomPixelFlow=l:s&&(this._rotatePixelFlow=l);this._time=s?this.rotateTime:e?this.zoomTime:n?this.panTime:t$13(0);}get rotateTime(){return this.definition.hasRotate?t$13(this._rotatePixels/this._rotatePixelFlow):t$13(0)}get zoomTime(){return this.definition.hasZoom?t$13(this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow):t$13(0)}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,o=i*this._panPixelsAtSource;return t$13(Math.log(o*(this._zoomPixelFlow/this._panPixelFlow)+1)/(i*this._zoomPixelFlow))}return t$13(this._panPixelsAtSource/this._panPixelFlow)}return t$13(0)}_interpolateComponentsZoom(t){if(0===t||1===t)return t;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,o=this.definition.compared.targetZoom;return (i*(i/o)**-t-i)/(o-i)}return t}_interpolateComponentsPan(t){if(0===t||1===t)return t;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*t*this._time)-1))/(i*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1);const o=this._interpolateComponentsZoom(t),e=this._interpolateComponentsPan(t),n=this._interpolateComponentsRotate(t);return i?(i.zoom=o,i.pan=e,i.rotate=n):i={zoom:o,pan:e,rotate:n},i}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function o$G(o,a,e){const n=a-o.compared.sourceZoom,t=o.halfWindowPanAtZoom(n);return -o.halfWindowSize*(e.ascensionFactor*Math.LN2*o.compared.pan+t)*Math.log(o.compared.sourceZoom/a)/(o.desiredPixelFlow*Math.LN2*t)}function a$N(o,a,e){const n=1/a,t=Math.log(o.compared.sourceZoom*n),i=1/o.desiredPixelFlow,r=1/Math.LN2,d=a-o.compared.sourceZoom,c=1/d,l=(e.ascensionFactor*Math.LN2*o.compared.pan+o.halfWindowPanAtZoom(d))/o.halfWindowPanAtZoom(1);return o.halfWindowSize*n*i*r*c*l-o.halfWindowSize*t*i*r*c+o.halfWindowSize*t*i*r*l/(d*d)}function e$P(o,a,e){const n=a-o.compared.sourceZoom,t=1/n,i=1/a,r=Math.log(o.compared.sourceZoom*i),d=(e.ascensionFactor*Math.LN2*o.compared.pan+o.halfWindowPanAtZoom(n))/o.halfWindowPanAtZoom(1);return o.halfWindowSize*t*(-2*t*i*d+2*t*r+2*i-2*r*d/(n*n)-d/(a*a))/(o.desiredPixelFlow*Math.LN2)}function n$V(o,a){return -o.halfWindowSize*Math.log(o.compared.sourceZoom/a)/(o.desiredPixelFlow*Math.LN2)}function t$H(o,a){return o.halfWindowSize/(a*o.desiredPixelFlow*Math.LN2)}function i$L(o,a){return -o.halfWindowSize/(a*a*o.desiredPixelFlow*Math.LN2)}function r$L(o,a,e){return -o.compared.pan*o.halfWindowSize*(e.ascensionFactor+e.descensionFactor-1)/(o.desiredPixelFlow*o.halfWindowPanAtZoom(a))}function d$F(o,a,e){return o.compared.pan*o.halfWindowSize*(e.ascensionFactor+e.descensionFactor-1)/(o.desiredPixelFlow*o.halfWindowPanAtZoom(a*a))}function c$K(o,a,e){return -2*o.compared.pan*o.halfWindowSize*(e.ascensionFactor+e.descensionFactor-1)/(o.desiredPixelFlow*o.halfWindowPanAtZoom(a*a*a))}function l$F(o,a,e){return o.halfWindowSize*(-o.halfWindowPanAtZoom(a)-e.descensionFactor*Math.LN2*o.compared.pan+o.halfWindowPanAtZoom(o.compared.targetZoom))*Math.log(a/o.compared.targetZoom)/(o.desiredPixelFlow*Math.LN2*o.halfWindowPanAtZoom(-a+o.compared.targetZoom))}function m$D(o,a,e){const n=Math.log(a/o.compared.targetZoom),t=1/o.desiredPixelFlow,i=1/Math.LN2,r=-a+o.compared.targetZoom,d=1/r,c=(-o.halfWindowPanAtZoom(a)-e.descensionFactor*Math.LN2*o.compared.pan+o.halfWindowPanAtZoom(o.compared.targetZoom))/o.halfWindowPanAtZoom(1);return -o.halfWindowSize*n*t*i*d+o.halfWindowSize*n*t*i*c/(r*r)+o.halfWindowSize*t*i*d*c/a}function h$F(o,a,e){const n=a-o.compared.targetZoom,t=1/n,i=1/a,r=Math.log(a/o.compared.targetZoom),d=(o.halfWindowPanAtZoom(a)+e.descensionFactor*Math.LN2*o.compared.pan-o.halfWindowPanAtZoom(o.compared.targetZoom))/o.halfWindowPanAtZoom(1);return o.halfWindowSize*t*(-2*t*i*d-2*t*r+2*i+2*r*d/(n*n)-d/(a*a))/(o.desiredPixelFlow*Math.LN2)}function s$T(o,a){return o.halfWindowSize*Math.log(a/o.compared.targetZoom)/(o.desiredPixelFlow*Math.LN2)}function f$I(o,a){return o.halfWindowSize/(a*o.desiredPixelFlow*Math.LN2)}function w$r(o,a){return -o.halfWindowSize/(a*a*o.desiredPixelFlow*Math.LN2)}function p$G(o){const a=Math.LN2*o.compared.pan,e=o.compared.sourceZoom-o.compared.targetZoom,n=o.halfWindowPanAtZoom(e),t=o.halfWindowSize*Math.log(o.compared.sourceZoom/o.compared.targetZoom)/(o.desiredPixelFlow*Math.LN2*n);return o.compared.sourceZoom<=o.compared.targetZoom?t*(a-n):t*(a+n)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function f$H(f,Z){let P=D$h(f,Z);const b={ascensionFactor:null!=Z.ascensionFactor?Z.ascensionFactor:.5,descensionFactor:null!=Z.descensionFactor?Z.descensionFactor:.5},g=0===b.ascensionFactor,h=0===b.descensionFactor,M=g?n$V:o$G,k=g?t$H:a$N,N=g?i$L:e$P,j=h?s$T:l$F,w=h?f$I:m$D,z=h?w$r:h$F,A=e=>M(f,e,b)+r$L(f,e,b)+j(f,e,b),I=o=>k(f,o,b)+d$F(f,o,b)+w(f,o,b),q=o=>N(f,o,b)+c$K(f,o,b)+z(f,o,b);let v=A(P);const y=p$G(f);let B;const C=Z.maximumIterations||20,E=null!=Z.maximumDistance?Z.maximumDistance:1/0;for(B=0;B<C;B++){const o=1e-6,e=(I(P)+o)/q(P);if(isNaN(e)||P>=E&&e<0){if(!isFinite(E))return null;P=E,v=A(P);break}if(P-=e,P<f.compared.sourceZoom||P<f.compared.targetZoom)return null;const n=A(P);if(Math.abs(n-v)/v<=.005)break;v=n;}return v>y*(1-.3)||P<f.compared.sourceZoom||P<f.compared.targetZoom?null:P}function D$h(o,e){const n=Math.max(o.compared.sourceZoom,o.compared.targetZoom),a=o.source.zoomAtPixelsPerPan(o.desiredPixelFlow/o.compared.pan)/2;return a<n?null!=e.maximumDistance?n+(e.maximumDistance-n)/2:1.5*n:e.maximumDistance?Math.min(e.maximumDistance,a):a}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$S extends e$Q{constructor(i,e){super(),this._preallocSegments=[new i$M,new i$M,new i$M],this.update(i,e);}update(i,e){if(!i)return;this.definition?this.definition.copyFrom(i):this.definition=i.clone();let t=null;e&&e.apex&&(t=f$H(i,e.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,null==t?this._updateWithoutApex():this._updateWithApex(t,e.apex);}segmentInterpolateComponentsAt(t,n,o){return o=t.interpolateComponentsAt(n,o),t===this._ascensionSegment?o.zoom=o$I(o.zoom):t===this._descensionSegment&&(o.zoom=u$J(o.zoom)),o}_updateWithApex(i,e){const[t,n,o]=this._preallocSegments,s=null!=e.ascensionFactor?e.ascensionFactor:.5,d=Math.min(1-s,null!=e.ascensionFactor?e.descensionFactor:.5),a=1-s-d;t.definition?t.definition.copyFrom(this.definition):t.definition=this.definition.clone(),t.definition.compared.targetZoom=i,t.definition.compared.pan=this.definition.compared.pan*s,t.definition.compared.rotate=this.definition.compared.rotate*s,t.update(),this._ascensionSegment=t,this.segments.push(t),a>0&&(n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.copyFrom(this.definition),n.definition.compared.sourceZoom=i,n.definition.compared.targetZoom=i,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this.segments.push(n)),o.definition?o.definition.copyFrom(this.definition):o.definition=this.definition.clone(),o.definition.compared.sourceZoom=i,o.definition.compared.pan=this.definition.compared.pan*d,o.definition.compared.rotate=this.definition.compared.rotate*d,o.update(),this._descensionSegment=o,this.segments.push(o);}_updateWithoutApex(){const[i]=this._preallocSegments;i.update(this.definition),this.segments.push(i);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const r$K={zoom:0,pan:0,rotate:0};class m$C{constructor(i){this.createCamera=i,this._time=n$1e(0),this.definition=new t$I(i),this.path=new s$S;}get time(){return this._time}update(t,a,s){this.definition.update(t,a,s),this.path.update(this.definition,s),this._time=this._applyTimeSettings(r$14(this.path.time),s),this._easing=s.easing?s.easing:this._time>=1e3?w$s:f$J;}cameraAt(t,i){i=i||this.createCamera(),t=Math.min(Math.max(0,t),1),t=this._normalizedEasing(t);const e=this.path.interpolateComponentsAt(t,r$K);return i.interpolate(this.definition.source,this.definition.target,e),i}_normalizedEasing(t){const i=this._easing(0,this._time),e=this._easing(1,this._time);return (this._easing(t,this._time)-i)/(e-i)}_applyTimeSettings(i,e){const n=null!=e.speedFactor?e.speedFactor:1;null!=e.duration?i=e.duration:null!=e.speedFactor&&(i=n$1e(i/n));const a=null!=e.minDuration?e.minDuration:o$H.minDuration/n,o=null!=e.maxDuration?e.maxDuration:o$H.maxDuration/n;return n$1e(Math.min(Math.max(a,i),o))}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const c$J=n$16();class h$E{constructor(i){this.currentTime=n$1e(0),this._animation=new m$C((()=>new T$v(i))),this._current=new T$v(i);}get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}update(i,m,s){const a=this._animation.definition.source,o=this._animation.definition.target,h=e$15(c$J,m.center,i.center),u=s$1b(h);u>=1e-5?(h[0]/=u,h[1]/=u,h[2]/=u):(h[0]=0,h[1]=1,h[0]=0),r$V(a.lookAtDirection,h),r$V(o.lookAtDirection,h),a.copyFromRenderCamera(i),o.copyFromRenderCamera(m),this._current.copyFrom(a),this._animation.update(a,o,s),this.currentTime=n$1e(0),i.almostEquals(m)&&(this.currentTime=this._animation.time);}cameraAt(t,i){return this._animation.cameraAt(t,this._current),i=i||new K$h,this._current.copyToRenderCamera(i),i}step(e,r){return this.finished||(this.currentTime=n$1e(this.currentTime+r$14(e)),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var o$F;!function(e){e.Ready="ready",e.Rejected="rejected",e.Running="running",e.Stopped="stopped",e.Finished="finished";}(o$F||(o$F={}));let i$K=class extends y$F{constructor(){super(...arguments),this.state=o$F.Ready;}get active(){return this.state===o$F.Running}get isInteractive(){return !1}get canStop(){return !1}stopController(){return !!this.canStop&&(this.state=o$F.Stopped,!0)}finishController(){this.state=o$F.Finished;}get steppingFinished(){return !1}};e$Y([d$R({readOnly:!0})],i$K.prototype,"active",null),e$Y([d$R()],i$K.prototype,"state",void 0),i$K=e$Y([n$18("esri.views.3d.state.controllers.CameraController")],i$K);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let a$M=class extends i$K{get canStop(){return !0}set asyncResult(t){this._asyncResult&&(this._asyncResult.reject(m$L()),this._asyncResult=null),this.state===o$F.Finished||this.state===o$F.Stopped?this.state===o$F.Finished?t.resolve():t.reject(m$L()):this._asyncResult=t;}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=o$F.Running,r$W(this.viewAnimation)&&this.viewAnimation.when((()=>this.updateStateFromViewAnimation()),(()=>this.updateStateFromViewAnimation()));}updateStateFromViewAnimation(){!r$W(this.viewAnimation)||this.state!==o$F.Ready&&this.state!==o$F.Running||(this.viewAnimation.state===n$1j.State.FINISHED?this.finish():this.viewAnimation.state===n$1j.State.STOPPED&&(this.state=o$F.Stopped));}onControllerEnd(){r$W(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===o$F.Finished?this.viewAnimation.finish():this.state===o$F.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===o$F.Finished?this._asyncResult.resolve():this._asyncResult.reject(m$L()));}finish(){this.finishController();}};a$M=e$Y([n$18("esri.views.3d.state.controllers.AnimationController")],a$M);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let h$D=class extends a$M{constructor(i){super(i),this.view=null,this.mode="interaction",this.hasTarget=!1;}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.animation=new h$E(this.view.state.viewingMode),this.viewAnimation="interaction"===this.mode?null:new n$1j;}get isInteractive(){return "interaction"===this.mode}begin(i,t){this.hasTarget=!0;const e=this.animationSettings(t);p$F.copyFrom(this.view.state.camera);const n=x$K(this.view.state.viewingMode);this.intersectionHelper.intersectRay(p$F.ray,n,l$E)&&(p$F.center=l$E),this.animation.update(p$F,i,e),this.animation.finished&&this.finish();}finish(){this.animation.currentTime=this.animation.time,super.finish();}get steppingFinished(){return this.hasTarget&&this.animation.finished}stepController(i,t){this.hasTarget&&this.animation.step(i,t);}onControllerEnd(i){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,i),this.animation.currentTime=this.animation.time),super.onControllerEnd(i);}animationSettings(i={}){return {apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...i,easing:"string"==typeof i.easing?H$i[i.easing]:i.easing}}};e$Y([d$R({constructOnly:!0})],h$D.prototype,"view",void 0),e$Y([d$R({constructOnly:!0})],h$D.prototype,"mode",void 0),h$D=e$Y([n$18("esri.views.3d.state.controllers.PointToPointAnimationController")],h$D);const p$F=new K$h,l$E=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function s$R(e,n,o){return u$I(e,e.screenToRender(n,p$_(c$16.get())),o)}function u$I(t,c,s){const u=p$_(a$16(c$16.get(),c));if(u[2]=0,!t.unprojectFromRenderScreen(u,s.origin))return null;const m=p$_(a$16(c$16.get(),c));m[2]=1;const g=t.unprojectFromRenderScreen(m,c$16.get());return t$V(g)?null:(e$15(s.direction,g,s.origin),s)}function m$B(e,n,o){return g$C(e,e.screenToRender(n,p$_(c$16.get())),o)}function g$C(r,n,s){r$V(s.origin,r.eye);const u=o$W(c$16.get(),n[0],n[1],1),m=r.unprojectFromRenderScreen(u,c$16.get());return t$V(m)?null:(e$15(s.direction,m,s.origin),s)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function s$Q(r,s,p,e){const n=m$B(s,p,m$A);return U$u(r,n,e)}const m$A=d$U();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var K$g;!function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette";}(K$g||(K$g={}));const L$s=30,N$k=[1,3e8],O$y=70;function Q$f(t,e,n){return n[0]=e[0]/(t.fullWidth/t.pixelRatio),n[1]=e[1]/(t.fullHeight/t.pixelRatio),n}function X$9(t,e,n){const o=c$16.get(),r=c$16.get(),a=c$16.get();r$V(r,t),r$V(a,e);const i=P$u(r,n),s=P$u(a,n);q$p(o,n,i),e$15(r,r,o),z$s(r,r),q$p(o,n,s),e$15(a,a,o),z$s(a,a);const c=P$u(r,a);_$v(o,n,r);const m=P$u(a,o);return Math.atan2(m,c)}function Y$c(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function Z$c(t,e,n){const o=p$Z(f$X.get(),n[3],v$I(n));t$V(o)||(e$15(Ot,t.eye,e),L$E(Ot,Ot,o),t.eye=u$W(Ot,Ot,e),e$15(Ot,t.center,e),L$E(Ot,Ot,o),t.center=u$W(Ot,Ot,e),t.up=L$E(Ot,t.up,o));}function $$g(t,e,n,o){return q$q(t,s$R(e,n,$t),o)}function _$q(t,e,n,o){return q$q(t,m$B(e,n,$t),o)}function tt$6(t,e,n,o){const r=c$16.get();let a=1-n;e$15(r,e,t.eye);const i=s$1b(r);let s=i*(1-a);a>=0&&s<o&&(s=o,a=-(s-i)/i),Math.abs(i-s)<1e-6||(q$p(r,r,a),t.eye=u$W(Ot,t.eye,r),t.center=A$C(Ot,t.center,e,a));}function et$5(t,e,n){e.getScreenCenter(nt$4),s$Q(t,e,nt$4,Ot)&&(e.center=Ot);const o=e.distance,r=o*n;if(Math.abs(o-r)<1e-6)return;const a=q$p(c$16.get(),e.viewForward,r);e.eye=e$15(Ot,e.center,a);}const nt$4=i$12();function ot$5(t,e,n){rt$5(e,n),z$s(n,n),q$p(n,n,t);}function rt$5(t,e){o$W(e,0,0,0);for(const n of t)u$W(e,e,n);q$p(e,e,1/t.length);}function at$5(t,e,n,o){return Math.sin(t/s$1b(e))*(n+o.radius)}function it$6(t,e,n,o){return at$5(Math.PI/2,e,n,o)+(t-Math.PI/2)}var st$5;!function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal";}(st$5||(st$5={}));const ct$4={Elevation:3e4,Angle:M$t(6)},mt$3={Pole:.95,Angle:M$t(18),Tilt:45},ut$4=M$t(80);function lt$4(t,e,n,o,r,a){const i=n$16(),s=_$x();let c=!0,m=!0;return t.intersectScreen(n,i,a)?s[3]=s$1b(i):(m=!1,e.aboveGround&&r!==K$g.Ellipsoid?s[3]=Math.max(s$1b(e.center),.9*o.radius):s[3]=s$1b(e.eye)-e.relativeElevation,r===K$g.Silhouette?Mt$1(s,e,n,i):c=s$Q(s,e,n,i)),{sphere:s,scenePickPoint:c?i:null,hasGeometryIntersection:m}}function pt$4(t,e,n,o){if(s$1b(t.eye)-o.radius>ct$4.Elevation)return st$5.Horizontal;if(!n)return st$5.Vertical;m$B(t,e,_t$1);return -Math.sign(t.relativeElevation)*(.5*Math.PI+a$_(t.eye,_t$1.direction))<ct$4.Angle?st$5.Vertical:st$5.Horizontal}function ft$4(t,e,n){e$15(ht$4,n,e),t.eye=e$15(Ot,t.eye,ht$4),t.center=e$15(Ot,t.center,ht$4);}const ht$4=n$16();function Mt$1(t,e,n,o){const a=m$B(e,n,$t);return !t$V(a)&&(B$r(t,a,yt$1),U$u(t,a,o)?!(p$$(yt$1,a.origin)<p$$(o,a.origin))||(r$V(o,yt$1),!1):(e$15(gt$3,e.eye,e.center),z$s(gt$3,gt$3),T$E(gt$3,-P$u(z$s(gt$3,gt$3),yt$1),dt$3),q$q(dt$3,a,o),!1))}const yt$1=n$16(),gt$3=n$16(),dt$3=p$Y();function bt$2(r,a,i,s,c,m){let u;if(_$v(Yt,r,a),e$15(Qt,r,a),s$1b(r)<=c||!s.aboveGround){_$v(i,Qt,s.eye);const l=P$u(r,a)/(s$1b(r)*s$1b(a)),p=Math.cos(o$X(r$15.normalize(M$t(m)),0,ut$4));u=-l$U(l)-Math.max(0,s$1b(a)-c)/(p*c);}else e$15(jt$1,s.eye,s.center),_$v(i,Qt,jt$1),u=-s$1b(Qt)/c;return z$s(i,i),q$p(i,i,s$1b(Yt)),u}const jt$1=n$16();function vt$1(r,a,i,s){let c,m;const u=Math.cos(o$X(r$15.normalize(M$t(s)),0,ut$4));return c=a>i?-(a-i)/(u*i):a<-i?Math.PI-(a+i)/(u*i):l$U(a/i),m=r>i?-(r-i)/(u*i):r<-i?Math.PI-(r+i)/(u*i):l$U(r/i),(m-c)*i}function zt$1(t,e,n,o,r,a,i,s,c,m){const l=vt$1(t[2],e[2],i[3],c),p=m?vt$1(t[0],e[0],i[3],180):e[0]-t[0],h=Math.sin(s)*p-Math.cos(s)*l,M=Math.cos(s)*p+Math.sin(s)*l;z$s(Ot,r);const g=m?h/Math.sqrt(Math.abs(i[3]**2-P$u(n,Ot)**2)):h/i[3],d=M/Math.sqrt(Math.abs(i[3]**2-P$u(n,o)**2));r$Y(a,g,d);}function xt$1(t,e,n,o,r,a,i,s,c,m){_$v(Yt,t,e),F$q(a.up,a.eye,Ct$1,Ft,Rt$1),F$q([0,0,1],a.eye,Ut$1,Vt,qt),r$V(n,Vt),r$V(o,Ut$1),z$s(n,n),q$p(n,n,s$1b(Yt)),D$m(t,z$s(Ft,Ft),z$s(Rt$1,Rt$1),z$s(Ct$1,Ct$1),Tt$1),D$m(e,Ft,Rt$1,Ct$1,Wt),zt$1(Tt$1,Wt,t,Ut$1,Vt,r,i,s,c,m);}function Pt(t,e,n,o,r,a,c){p$Z(Jt,r,o),p$Z(Kt,c,a),u$Z(Lt,Jt,Kt),e$15(e,t,n),L$E(e,e,Lt),u$W(e,e,n);}function kt(t,e,n,o,r,a){p$Z(Jt,o,n),p$Z(Kt,a,r),u$Z(Lt,Jt,Kt),e$15(Ot,t.eye,e),L$E(Ot,Ot,Lt),t.eye=u$W(Ot,Ot,e),e$15(Ot,t.center,e),L$E(Ot,Ot,Lt),t.center=u$W(Ot,Ot,e),e$15(Ot,t.up,e),L$E(Ot,Ot,Lt),t.up=u$W(Ot,Ot,e);}function It(t,e,n,o,r,a,i=mt$3.Pole,s=mt$3.Angle){const c=Math.abs(o)>Math.PI-s||Math.abs(o)<s,m=Math.abs(t[2])<n*i||Math.abs(e)>n;return !!(c&&m&&a.aboveGround&&r<mt$3.Tilt)}function wt$1(t,e,n,o,r,a){if(a)k$x(n,o,Dt$1),Z$c(e,t,Dt$1);else {const a=bt$2(n,o,Zt,e,t[3],r);Z$c(e,t,m$J(Zt,a));}}function Et$1(t,e,n,o,r,a,i){const s=i?20:1,c=1e-12;let m,u;r$V(Nt,o),Xt.copyFrom(e);for(let l=0;l<s&&p$$(n,Nt)>c&&(m=p$$(n,Nt),xt$1(n,Nt,Vt,Ut$1,Bt,Xt,t,r,a,i),kt(Xt,t,Ut$1,Bt[1],Vt,Bt[0]),Pt(Nt,Nt,t,Ut$1,Bt[1],Vt,Bt[0]),u=p$$(n,Nt),u<m||0===l);l++)e.copyFrom(Xt);}function St$2(n,o,r,a,i,s,c){It(r,P$u(o.up,r),n[3],-r$15.normalize(M$t(i)),s,o,mt$3.Pole,mt$3.Angle)?Et$1(n,o,r,a,-r$15.normalize(M$t(i)),s,c):wt$1(n,o,r,a,s,c);}function At(t,e,n,o,r,a){const{eye:i}=t;F$q([0,0,1],i,Ut$1,Vt,qt);const s=e.translation[0]*n.pan,m="zoom"===r.mode?0:e.translation[1]*n.pan,u=Math.max(Math.sqrt(Math.abs(1-P$u(t.center,Ut$1)**2/s$1b(t.center)**2)),.5),l=(Math.sin(a)*m+Math.cos(a)*s)/u,p=-Math.cos(a)*m+Math.sin(a)*s;switch(f$T(o.pan.matrix,o.pan.matrix,l,Ut$1),o.pan.enabled=!0,r.mode){case"pan":f$T(o.pan.matrix,o.pan.matrix,p,Vt),o.pan.enabled=!0;break;case"zoom":o.zoom=-e.translation[1]*n.zoom;}}function Ht(t,e,n,o,r){const{eye:a,viewRight:i}=t,s=_$v(c$16.get(),i,a),m=e.translation[0]*n.pan;switch(0!==m&&(f$T(o.pan.matrix,o.pan.matrix,-m,s),o.pan.enabled=!0),r.mode){case"pan":{const t=e.translation[1]*n.pan;0!==t&&(f$T(o.pan.matrix,o.pan.matrix,t,i),o.pan.enabled=!0);break}case"zoom":o.zoom=-e.translation[1]*n.zoom;}}function Gt(n,o,r,a,i,s,c,m,u){It(n.center,P$u(n.up,n.center),s$1b(n.center),-r$15.normalize(M$t(s)),c,o)?At(o,r,a,m,u,-r$15.normalize(M$t(i))):Ht(o,r,a,m,u);}const Ut$1=n$16(),Vt=n$16(),qt=n$16(),Ct$1=n$16(),Ft=n$16(),Rt$1=n$16(),Tt$1=n$16(),Wt=n$16(),Bt=n$1b(),Dt$1=i$U(),Jt=e$10(),Kt=e$10(),Lt=e$10(),Nt=n$16(),Ot=n$16(),Qt=n$16(),Xt=new K$h,Yt=n$16(),Zt=n$16(),$t={origin:n$16(),direction:n$16()},_t$1={origin:n$16(),direction:n$16()};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const z$l=.6,U$l=4,V$j=12,x$s=60,_$p=200;let F$m=class extends h$D{constructor(){super(...arguments),this.zoomLocation=n$16(),this.tmpCamera=new K$h,this.tmpViewDir=n$16(),this.tmpRayDir={origin:n$16(),direction:n$16()},this.targetOnSphere=n$16(),this.tmpCenter=n$16(),this.constraintOptions={selection:N$m.ALL_EXCEPT_COLLISION,interactionType:i$Q.ZOOM,interactionFactor:null,interactionStartCamera:new K$h,interactionDirection:null,tiltMode:m$H.TUMBLE},this.sphere=_$x();}initialize(){this.intersector=x$K(this.view.state.viewingMode);}zoomStep(t,i){if(!this.active)return;const e=this.view.state,{interactionStartCamera:s}=this.constraintOptions;this.animation.finished?s.copyFrom(e.camera):this.animation.cameraAt(1,s);let o=!1,a=!1;this.intersectionHelper.intersectScreen(i,this.zoomLocation,0===this.view.map.ground.opacity?A$s:{})&&(o=t>0,a=!0),this.tmpCamera.copyFrom(e.camera),o?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:r$V(this.zoomLocation,this.tmpCamera.center),this._updateCamera(this.tmpCamera,t,this.zoomLocation,i,a),this.begin(this.tmpCamera);}animationSettings(){return {apex:null,duration:n$1e(600),easing:f$J}}_updateCamera(t,i,e,r,p){const y=p$T(this.view.spatialReference),w=pt$4(t,r,p,y);let g;this.view.camera.position.hasZ&&(g=Math.abs(this.view.camera.position.z)),z$s(k$o,t.eye),q$p(k$o,k$o,-1),m$B(t,r,this.tmpRayDir),z$s(this.tmpRayDir.direction,this.tmpRayDir.direction);const u=Math.max(Math.min(V$j,1/Math.abs(P$u(k$o,this.tmpRayDir.direction)))*g,_$p);if(w===st$5.Horizontal){let s=z$l**i;this.sphere[3]=s$1b(e),e$15(this.tmpViewDir,t.center,t.eye);const a=Math.min(s$1b(this.tmpViewDir),u);let p=a*s;if(s<=1&&p<U$l&&(p=U$l,s=p/a),Math.abs(a-p)<1e-6)return;const l=s$1b(t.center);if(this.sphere[3]!==l){const i=this.sphere[3]+s*(l-this.sphere[3]);t.center=q$p(T$u,t.center,i/l);}q$p(this.tmpViewDir,this.tmpViewDir,-s),t.eye=u$W(T$u,t.center,this.tmpViewDir),E$x(this.view,t,this.constraintOptions),p$$(e,t.center)>1e-12&&s$Q(this.sphere,t,r,this.targetOnSphere)&&St$2(this.sphere,t,e,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0);}else {let s=z$l**Math.abs(i);const a=i>0?1:-1;e$15(this.tmpViewDir,e,t.eye);const h=s$1b(this.tmpViewDir),l=this.view._stage.renderView.getMinimalDepthForArea(null,r[0],r[1],this.view.state.camera,x$s);let y=l?Math.min(u,l):u;y=p?Math.min(y,h):y,q$p(this.tmpRayDir.direction,this.tmpRayDir.direction,y),u$W(e,this.tmpRayDir.origin,this.tmpRayDir.direction);let f=y*s;const w=Math.max(U$l,1.01*t.nearFar[0]);if(i>0&&f<w&&(f=w,s=f/y),Math.abs(y-f)<1e-6)return;q$p(this.tmpRayDir.direction,this.tmpRayDir.direction,a*(1-s)),t.eye=u$W(T$u,t.eye,this.tmpRayDir.direction),t.center=u$W(T$u,t.center,this.tmpRayDir.direction);}o$J(this.view,t);}};F$m=e$Y([n$18("esri.views.3d.state.controllers.global.ZoomStepController")],F$m);const T$u=n$16(),k$o=n$16(),A$s={exclude:new Set([j$H])};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const L$r=.6,d$E=4,z$k=60,M$m=14,S$w=200;let F$l=class extends h$D{constructor(){super(...arguments),this.zoomLocation=n$16(),this.tmpCamera=new K$h,this.tmpRayDir=n$16(),this.tmpCenter=n$16(),this.constraintOptions={selection:N$m.ALL,interactionType:i$Q.ZOOM,interactionFactor:null,interactionStartCamera:new K$h,interactionDirection:null,tiltMode:m$H.TUMBLE};}zoomStep(t,e){if(!this.active)return;const i=this.view.state,{interactionStartCamera:p}=this.constraintOptions;this.animation.finished?p.copyFrom(i.camera):this.animation.cameraAt(1,p),this.tmpCamera.copyFrom(i.camera);const l=x$K(this.view.state.viewingMode);t>0?(0===this.view.map.ground.opacity?this.intersectionHelper.intersectScreenFreePointFallback(e,this.zoomLocation,O$x):this.intersectionHelper.intersectScreenFreePointFallback(e,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,l,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,l,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:r$V(this.zoomLocation,this.tmpCamera.center);const C=L$r**t;let y=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,z$k);e$15(x$r,this.tmpCamera.eye,this.zoomLocation),z$s(x$r,x$r);const u=Math.max(Math.min(M$m,1/Math.abs(P$u(R$o,x$r)))*Math.abs(this.view.camera.position.z),S$w);if(y=y?Math.min(y,u):u,y){const t=n$16();e$15(t,this.zoomLocation,this.tmpCamera.eye),y<s$1b(t)&&(z$s(t,t),u$W(this.zoomLocation,this.tmpCamera.eye,q$p(t,t,y)));}this._updateCamera(this.tmpCamera,C,this.zoomLocation),this.begin(this.tmpCamera);}animationSettings(){return {apex:null,duration:n$1e(600),easing:f$J}}_updateCamera(t,e,i){e$15(this.tmpRayDir,i,t.eye);const o=s$1b(this.tmpRayDir);let a=o*e;const r=e<=1,m=Math.max(d$E,1.01*t.nearFar[0]);r&&a<m&&(a=m,e=a/o),Math.abs(o-a)<1e-6||(q$p(this.tmpRayDir,this.tmpRayDir,e),t.eye=e$15(D$g,i,this.tmpRayDir),t.center=A$C(D$g,t.center,i,1-e),E$x(this.view,t,this.constraintOptions));}};F$l=e$Y([n$18("esri.views.3d.state.controllers.local.ZoomStepController")],F$l);const D$g=n$16(),R$o=r$X(0,0,1),x$r=n$16(),O$x={exclude:new Set([j$H])};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$P extends i$13{constructor(o,t){super(!0),this.view=o,this.registerIncoming("double-click",t,(o=>this._handleDoubleClick(o)));}_handleDoubleClick(r){const s=r.data;if(t$14(s,"primary")){const i=this.view.state.isGlobal?new F$m({view:this.view,mode:"animation"}):new F$l({view:this.view,mode:"animation"});this.view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),i$12(s.x,s.y)),r.stopPropagation();}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let a$L=class extends i$K{constructor(){super(...arguments),this.startCamera=new K$h,this.currentCamera=new K$h;}get isInteractive(){return !0}stepController(r,e){e.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(e);}onControllerStart(r){this.state=o$F.Running,this.startCamera.copyFrom(r),this.currentCamera.copyFrom(r);}onControllerEnd(r){r.copyViewFrom(this.currentCamera);}};a$L=e$Y([n$18("esri.views.3d.state.controllers.InteractiveController")],a$L);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var g$B;!function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE";}(g$B||(g$B={}));const k$n=7,A$r=90;let L$q=class extends a$L{constructor(t){super(t),this.view=null,this.pivot=g$B.CENTER,this.lastPoint=n$1b(),this.tmpWorldUp=n$16(),this.tmpViewDir=n$16(),this.tmpRotCurPoint=n$1b(),this.tmpTransf=e$10(),this.tmpAxis=n$16(),this.tmpPivotPoint=n$16(),this.pivotPos=n$16(),this.constraintOptions={selection:N$m.ALL,interactionType:i$Q.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:m$H.TUMBLE};}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.rotScale=this.pivot===g$B.CENTER?3:1.5;}begin(t){if(this.active){switch(this.pivot){case g$B.EYE:r$V(this.pivotPos,this.startCamera.eye),this.constraintOptions.interactionType=i$Q.LOOK_AROUND,this.constraintOptions.tiltMode=m$H.LOOK_AROUND,this.constraintOptions.selection=N$m.NONE;break;case g$B.CENTER:{const i=this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos);i||r$V(this.pivotPos,this.startCamera.center),this._constrainPivotPoint(t,i),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=i$Q.TUMBLE,this.constraintOptions.tiltMode=m$H.TUMBLE,this.constraintOptions.selection=N$m.ALL&~N$m.DISTANCE;break}}this.constraintOptions.interactionStartCamera=this.startCamera,Q$f(this.startCamera,t,this.lastPoint);}}_constrainPivotPoint(t,i){const s=this.startCamera,r=n$16();e$15(r,this.pivotPos,s.eye);const e=s$1b(r);let a=Math.min(e,k$n*Math.abs(this.view.camera.position.z));const n=p$T(this.view.spatialReference),h=i$12(s.width/s.pixelRatio*.5,s.height/s.pixelRatio*.5),p=pt$4(this.startCamera,h,!0,n);let c=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,s.fullWidth/s.pixelRatio*.5,s.fullHeight/s.pixelRatio*.5,s,2.5*A$r,A$r),P=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,t[0],t[1],s,A$r);void 0===c&&void 0===P||(c=void 0===c?P:c,P=void 0===P||p===st$5.Horizontal?c:P,a=c>P?P:c,a=i?Math.min(a,e):a),z$s(r,r),r$V(this.pivotPos,u$W(this.tmpPivotPoint,s.eye,q$p(this.tmpPivotPoint,r,a)));}update(t){if(this.active){switch(this.pivot){case g$B.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,t,this.currentCamera.center,this.pivotPos);break;case g$B.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,t,this.currentCamera.eye,this.pivotPos);}E$x(this.view,this.currentCamera,this.constraintOptions);}}end(){this.active&&this.finishController();}_applyRotation(t,o,r,e){this.view.renderCoordsHelper.worldUpAtPosition(e,this.tmpWorldUp),Q$f(t,o,this.tmpRotCurPoint);let h=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale,c=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;e$15(this.tmpViewDir,r,e);const m=s$1b(this.tmpViewDir),u=l$U(P$u(this.tmpViewDir,this.tmpWorldUp)/m);if(this.pivot===g$B.EYE){h*=-.5;const t=.5*Math.PI-u,i=.5*Math.PI*.99;h=t-Math.max(-i,Math.min(i,t+h));}return h=o$X(h+u,h$P.min,h$P.max)-u,_$v(this.tmpAxis,t.up,this.tmpViewDir),this.pivot===g$B.CENTER&&(c=-c),p$Z(this.tmpTransf,c,this.tmpWorldUp),f$T(this.tmpTransf,this.tmpTransf,h,this.tmpAxis),L$E(this.tmpViewDir,this.tmpViewDir,this.tmpTransf),t.up=L$E(V$i,t.up,this.tmpTransf),u$W(V$i,e,this.tmpViewDir),a$16(this.lastPoint,this.tmpRotCurPoint),V$i}};e$Y([d$R({constructOnly:!0})],L$q.prototype,"view",void 0),e$Y([d$R()],L$q.prototype,"pivot",void 0),L$q=e$Y([n$18("esri.views.3d.state.controllers.RotateController")],L$q);const V$i=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class a$K extends i$13{constructor(t,r,e,o){super(!0),this.view=t,this.pointerAction=r,this.pivot=e,this.registerIncoming("drag",o,(t=>this._handleDrag(t)));}_handleDrag(e){const a=e.data;if(a.pointers.size>1)return;if(!r$16(e.data,this.pointerAction))return;const i=i$12(a.center.x,a.center.y);switch(a.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.cameraController=new L$q({view:this.view,pivot:this.pivot}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(i);break;case"update":this.cameraController&&this.cameraController.update(i);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null);}e.stopPropagation();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let H$h=class extends a$L{constructor(t){super(t),this.view=null,this.pickPoint=n$16(),this.tmpP0=n$1b(),this.panAxisAngle=i$U(),this.tmpRayDir=n$16(),this.tmpRayDirPick=n$16(),this.targetOnSphere=n$16(),this.tmpRay={origin:n$16(),direction:n$16()},this.dragBeginPoint=i$12(),this.normalizedAnchorPoint=n$1b(),this.constraintOptions={selection:N$m.ALL_EXCEPT_COLLISION,interactionType:i$Q.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:m$H.TUMBLE},this.sphere=_$x(),this.hasPickPoint=!1;}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(t){if(!this.active)return;a$16(this.dragBeginPoint,t),Q$f(this.startCamera,t,this.normalizedAnchorPoint);const e=p$T(this.view.spatialReference),r=lt$4(this.intersectionHelper,this.startCamera,t,e,K$g.Ellipsoid,0===this.view.map.ground.opacity?L$p:{});if(this.navMode=pt$4(this.startCamera,t,r.hasGeometryIntersection,e),this.navMode===st$5.Horizontal)this.hasPickPoint=!!r.scenePickPoint,this.pickPoint=r.scenePickPoint,this.sphere=r.sphere;else {let e,s;m$B(this.startCamera,t,this.tmpRay),z$s(this.tmpRay.direction,this.tmpRay.direction),r.scenePickPoint&&(e$15(this.tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),s=s$1b(this.tmpRayDirPick)),this.view.camera.position.hasZ&&(e=Math.abs(this.view.camera.position.z));let a=o$X(L$s*e,N$k[0],N$k[1]);const n=this.view._stage.renderView.getMinimalDepthForArea(null,t[0],t[1],this.view.state.camera,O$y);a=n?Math.min(a,n):a,a=r.scenePickPoint?Math.min(a,s):a,this.hasPickPoint=!0,q$p(this.tmpRay.direction,this.tmpRay.direction,a),u$W(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction);}this.constraintOptions.interactionStartCamera=this.startCamera;}update(t){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this.navMode===st$5.Horizontal){e$15(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=s$1b(this.tmpRayDir);Q$f(this.currentCamera,t,this.tmpP0);const e=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=i*2**e;const s=this.view.state.constraints.minimumPoiDistance;if(e<0&&r<s&&(r=s),Math.abs(i-r)<1e-6)return;if(this.hasPickPoint&&r<i){const t=1-(1-r/i)*(1-this.sphere[3]/s$1b(this.currentCamera.center));this.currentCamera.center=q$p(I$o,this.currentCamera.center,t);}q$p(this.tmpRayDir,this.tmpRayDir,-r/i),this.currentCamera.eye=u$W(I$o,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=y$w(this.dragBeginPoint,t),E$x(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(Mt$1(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),k$x(this.pickPoint,this.targetOnSphere,this.panAxisAngle),Z$c(this.currentCamera,this.sphere,this.panAxisAngle));}else {const i=s$1b(this.tmpRay.direction);Q$f(this.currentCamera,t,this.tmpP0);const e=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=i*2**e;const s=this.view.state.constraints.minimumPoiDistance;if(e<0&&r<s&&(r=s),Math.abs(i-r)<1e-6)return;q$p(this.tmpRayDir,this.tmpRay.direction,1-r/i),this.currentCamera.eye=u$W(I$o,this.currentCamera.eye,this.tmpRayDir),this.currentCamera.center=u$W(I$o,this.currentCamera.center,this.tmpRayDir);}o$J(this.view,this.currentCamera);}}end(){this.active&&this.finishController();}};e$Y([d$R({constructOnly:!0})],H$h.prototype,"view",void 0),H$h=e$Y([n$18("esri.views.3d.state.controllers.global.ZoomController")],H$h);const I$o=n$16(),L$p={exclude:new Set([j$H])};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let S$v=class extends a$L{constructor(t){super(t),this.view=null,this.tmpP=n$16(),this.tmpDir=n$16(),this.tmpN=n$16(),this.tmpP0=n$1b(),this.tmpPoi=n$16(),this.tmpRayDir=n$16(),this.dragBeginPoint=i$12(),this.normalizedAnchorPoint=n$1b(),this.constraintOptions={selection:N$m.ALL,interactionType:i$Q.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:n$16(),tiltMode:m$H.TUMBLE},this.plane=p$Y();}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(t){if(!this.active)return;a$16(this.dragBeginPoint,t),Q$f(this.startCamera,t,this.normalizedAnchorPoint);const s=this.intersectionHelper.intersectScreenFreePointFallback(t,this.tmpP,0===this.view.map.ground.opacity?A$q:{});e$15(this.tmpDir,this.tmpP,this.startCamera.eye);const r=s$1b(this.tmpDir);let e;z$s(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(e=Math.abs(this.view.camera.position.z));let o=o$X(L$s*e,N$k[0],N$k[1]);const u=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,t[0],t[1],this.view.state.camera,O$y);o=u?Math.min(o,u):o,o=s?Math.min(o,r):o,q$p(this.tmpDir,this.tmpDir,o),u$W(this.tmpP,this.startCamera.eye,this.tmpDir),e$15(this.tmpN,this.startCamera.eye,this.startCamera.center),z$s(this.tmpN,this.tmpN),this.tmpN[1]<0&&j$I(this.tmpN,this.tmpN),_$w(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.startCamera;}update(t){if(!this.active)return;$$g(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||r$V(this.tmpPoi,this.currentCamera.center),Q$f(this.currentCamera,t,this.tmpP0);let i=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);a$16(this.normalizedAnchorPoint,this.tmpP0),e$15(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const s=s$1b(this.tmpRayDir);let r=s*(1-i);r$V(this.constraintOptions.interactionDirection,this.tmpRayDir),q$p(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(i)/s);const e=this.view.state.constraints.minimumPoiDistance;i>=0&&r<e&&(r=e,i=-(r-s)/s),Math.abs(s-r)<1e-6||(q$p(this.tmpRayDir,this.tmpRayDir,i),this.currentCamera.eye=u$W(k$m,this.currentCamera.eye,this.tmpRayDir),A$C(k$m,this.currentCamera.center,this.tmpPoi,i),this.tmpPoi[2]>this.startCamera.center[2]?k$m[2]=Math.max(this.startCamera.center[2],k$m[2]):k$m[2]=Math.min(this.startCamera.center[2],k$m[2]),this.currentCamera.center=k$m,this.constraintOptions.interactionFactor=y$w(this.dragBeginPoint,t),E$x(this.view,this.currentCamera,this.constraintOptions));}end(){this.active&&this.finishController();}};e$Y([d$R({constructOnly:!0})],S$v.prototype,"view",void 0),S$v=e$Y([n$18("esri.views.3d.state.controllers.local.ZoomController")],S$v);const k$m=n$16(),A$q={exclude:new Set([j$H])};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$O extends i$13{constructor(r,t,e){super(!0),this.view=r,this.pointerAction=t,this.registerIncoming("drag",e,(r=>this._handleDrag(r)));}_handleDrag(o){const s=o.data;if(s.pointers.size>1)return;if(!r$16(o.data,this.pointerAction))return;const i=i$12(s.center.x,s.center.y);switch(s.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.view.state.isGlobal?this.cameraController=new H$h({view:this.view}):this.cameraController=new S$v({view:this.view}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(i);break;case"update":this.cameraController&&this.cameraController.update(i);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null);}o.stopPropagation();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let q$h=class extends a$L{constructor(t){super(t),this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this.tmpCamera=new K$h,this.constraintOptions={selection:N$m.ALL,interactionType:i$Q.NONE,interactionStartCamera:new K$h,interactionFactor:0,interactionDirection:null,tiltMode:m$H.LOOK_AROUND};}handleEventGamepad(t){const e=i$14(t,this.view.navigation.gamepad,this.transformation);("end"===t.action||s$1g(e))&&this.finishController();}activateDirection(t){this.keysButtonState[t]=1,o$16(this.keysButtonState,this.transformation);}deactivateDirection(t){this.keysButtonState[t]=0;const e=o$16(this.keysButtonState,this.transformation);s$1g(e)&&this.finishController();}onControllerStart(t){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this.headingStart=this.view.camera.heading,super.onControllerStart(t);}_updateFilteredSurfaceElevation(t){const e=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this.filteredSurfaceElevation+=i*(e-this.filteredSurfaceElevation)*t;}stepController(t,e){this._updateStartHeading(),this._updateFilteredSurfaceElevation(t),this.currentCamera.copyViewFrom(e),this._updateCameraCenter(),this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this._calculateControlTransformation(t,this.currentCamera,it$5),this._applyDisabledMovementTypes(it$5),this._applyPan(it$5.pan),this._applyRotate(it$5.rotate),this._applyZoom(it$5.zoom),this._applyAscend(it$5.ascend),this.constraintOptions.interactionType=i$Q.NONE,this.constraintOptions.selection=N$m.COLLISION,E$x(this.view,this.currentCamera,this.constraintOptions),super.stepController(t,e);}_updateStartHeading(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading);}_applyRotate(t){if(!t.enabled)return;const e=this.currentCamera;e$15(at$4,e.center,e.eye),L$E(at$4,at$4,t.matrix),e.center=u$W(at$4,at$4,e.eye),e.up=L$E(at$4,e.up,t.matrix),this.constraintOptions.interactionType=i$Q.LOOK_AROUND,this.constraintOptions.selection=N$m.ALL_EXCEPT_COLLISION,E$x(this.view,e,this.constraintOptions);}_applyPan(t,e=this.currentCamera){if(!t.enabled)return;e.eye=L$E(at$4,e.eye,t.matrix),e.center=L$E(at$4,e.center,t.matrix);this.view.state.isGlobal&&(e.up=L$E(at$4,e.up,t.matrix)),this.constraintOptions.interactionType=i$Q.PAN,this.constraintOptions.selection=N$m.ALL,E$x(this.view,e,this.constraintOptions);}_applyZoom(t){if(!t)return;const e=this.currentCamera.viewForward;this.currentCamera.eye=u$W(at$4,this.currentCamera.eye,q$p(c$16.get(),e,t)),r$V(rt$4,e),j$I(rt$4,rt$4),this.constraintOptions.interactionDirection=rt$4,this.constraintOptions.interactionType=i$Q.ZOOM,this.constraintOptions.selection=N$m.ALL_EXCEPT_COLLISION,E$x(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null;}_applyAscend(t){if(!t)return;const e=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,c$16.get());this.constraintOptions.interactionDirection=r$V(rt$4,e);if(this.view.state.isGlobal){const e=s$1b(this.currentCamera.eye),i=(e+t)/e;this.currentCamera.eye=q$p(at$4,this.currentCamera.eye,i),this.currentCamera.center=q$p(at$4,this.currentCamera.center,i);}else {const i=q$p(c$16.get(),e,t);this.currentCamera.eye=u$W(at$4,this.currentCamera.eye,i),this.currentCamera.center=u$W(at$4,this.currentCamera.center,i);}this._updateCameraCenter(),this.constraintOptions.interactionType=i$Q.ASCEND,this.constraintOptions.selection=N$m.COLLISION,E$x(this.view,this.currentCamera,this.constraintOptions)&&this._updateCameraCenter(),this.constraintOptions.selection=N$m.ALL_EXCEPT_COLLISION,E$x(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null;}_calculateControlTransformation(t,e,i){st$4(i);const a=this._computeVelocities(t);this.view.state.isLocal?this._calculateControlTransformationLocal(a,e,i):this._calculateControlTransformationGlobal(a,e,i);}_updateCameraCenter(){const t=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,e=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=e.intersectManifoldClosestSilhouette(i,t,at$4);}_calculateControlTransformationLocal(t,a,r){const{viewRight:o,viewForward:s}=a,n=this.transformation,l=this.view.navigation.gamepad,p=o$W(c$16.get(),s[0],s[1],0);z$s(p,p);const h=n.translation[0]*t.pan;if(0!==h){const t=q$p(c$16.get(),o,h);c$17(r.pan.matrix,r.pan.matrix,t),r.pan.enabled=!0;}switch(l.mode){case"pan":{const e=-n.translation[1]*t.pan;if(0!==e){const t=q$p(c$16.get(),p,e);c$17(r.pan.matrix,r.pan.matrix,t),r.pan.enabled=!0;}r.zoom=n.zoom*t.zoom;break}case"zoom":r.zoom=(-n.translation[1]+n.zoom)*t.zoom;break;default:n$1i(l.mode);}const d=n.translation[2]*t.ascend;r.ascend=d;const u=-n.heading*t.rotate;0!==u&&(f$T(r.rotate.matrix,r.rotate.matrix,u,this.view.renderCoordsHelper.worldUpAtPosition(a.eye,c$16.get())),r.rotate.enabled=!0);const v=n.tilt*t.rotate,C=n$X(this.view.renderCoordsHelper,a.center,a.eye),g=o$X(C+v,h$P.min,h$P.max)-C;g&&(f$T(r.rotate.matrix,r.rotate.matrix,g,o),r.rotate.enabled=!0);}_calculateControlTransformationGlobal(t,e,i){const{eye:a,viewRight:r}=e,o=this.transformation,s=this.view.navigation.gamepad,n=_$v(c$16.get(),r,a);z$s(n,n),j$I(n,n),Gt(this.startCamera,e,o,t,this.view.camera.heading,this.headingStart,this.view.camera.tilt,i,s),this.tmpCamera.copyFrom(this.currentCamera),this._applyPan(it$5.pan,this.tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=o.translation[2]*t.ascend;i.ascend=l;const p=-o.heading*t.rotate;0!==p&&(f$T(i.rotate.matrix,i.rotate.matrix,p,this.tmpCamera.eye),i.rotate.enabled=!0);const h=o.tilt*t.rotate,d=this._clampTiltDeltaGlobalToValidRange(h,e.ray,c);0!==d&&(f$T(i.rotate.matrix,i.rotate.matrix,d,this.tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=o.zoom*t.zoom;}_clampTiltDeltaGlobalToValidRange(t,e,r){const o=p$T(this.view.spatialReference),s=at$5(h$P.min,e.origin,r,o);let n=0,c=0;const m=c$16.get();if(this.view.renderCoordsHelper.intersectManifold(e,r,m)){const t=n$X(this.view.renderCoordsHelper,m,e.origin);n=at$5(t,e.origin,r,o),c=at$5(h$P.max,e.origin,r,o);}else {B$r(T$D($$j,r+o.radius),e,m);const t=l$U(-P$u(e.direction,z$s(m,m)));n=it$6(t,e.origin,r,o),c=it$6(h$P.max,e.origin,r,o);}return o$X(n+t,s,c)-n}_getPointAbsoluteSurfaceElevation(t,e,i){const{renderCoordsHelper:a}=this.view,r=a.getAltitude(t),o=e+Math.abs(r-e);return a.setAltitude(i,o,t),o}_clampedDistanceToSurface(t,e){const{renderCoordsHelper:i}=this.view,{camera:a}=this.view.state,{direction:r}=Z$i(this.view,e,0,Q$e,ot$4),o=i.intersectManifoldClosestSilhouette(j$G(e,r),t,c$16.get()),s=x$H(e,o),n=i.intersectManifoldClosestSilhouette(j$G(e,H$n(c$16.get(),e,a.center)),t,c$16.get()),c=x$H(e,n);return Math.min(s,c)}_computeHeadingRotateRadius(t){const{renderCoordsHelper:e,state:i}=this.view,{camera:r,isGlobal:o}=i,s=e.intersectManifoldClosestSilhouette(r.ray,this.filteredSurfaceElevation,c$16.get());if(o){const e=e$15(c$16.get(),t,s),i=s$1b(e);q$p(e,e,1/i);const r=z$s(c$16.get(),t),o=l$U(P$u(r,e));return i*Math.sin(Math.min(W$e,o))}{const i=r$V(c$16.get(),t);return e.setAltitude(i,this.filteredSurfaceElevation),x$H(s,i)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:$$f}_computeVelocities(t){const e=this.filteredSurfaceElevation,a=e+p$T(this.view.spatialReference).radius,{camera:r,isGlobal:o}=this.view.state,s=c$16.get(),n=this._getPointAbsoluteSurfaceElevation(r.eye,e,s),c=this._clampedDistanceToSurface(e,s),m=r.width/2,l=Y$b*r.width,p=Y$b*r.width,h=c*Math.tan(.5*r.fovX)/m,d=h/a,u=h/this._computeHeadingRotateRadius(s),f=n-e;return {pan:(o?d:h)*l*t,ascend:Math.max(this._minimumAscendVelocity()*t,2**(l*t/m)*f-f),zoom:2**(l*t/m)*c-c,rotate:o$X(u*p,tt$5,et$4)*t}}_applyDisabledMovementTypes(t){!r$W(this.disableMovements)||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(t.zoom=this.disableMovements.zoom?0:t.zoom,t.ascend=this.disableMovements.ascend?0:t.ascend,t.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&r$12(t.pan.matrix),t.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&r$12(t.rotate.matrix));}static activatesFor(t,e){const i=i$14(e,t.navigation.gamepad,J$d);return !("end"===e.action||s$1g(i))}};e$Y([d$R({constructOnly:!0})],q$h.prototype,"view",void 0),e$Y([d$R({constructOnly:!0})],q$h.prototype,"gamepadDevice",void 0),e$Y([d$R({constructOnly:!0})],q$h.prototype,"disableMovements",void 0),q$h=e$Y([n$18("esri.views.3d.state.controllers.GamepadKeyboardController")],q$h);const J$d={translation:[0,0,0],heading:0,tilt:0,zoom:0},Q$e=80,W$e=M$t(Q$e),Y$b=.75,$$f=5,tt$5=M$t(30),et$4=M$t(80),it$5={zoom:0,ascend:0,pan:{enabled:!1,matrix:e$10()},rotate:{enabled:!1,matrix:e$10()}},at$4=n$16(),rt$4=n$16(),ot$4=h$W();function st$4(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,r$12(t.pan.matrix),t.rotate.enabled=!1,r$12(t.rotate.matrix);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class l$D extends i$13{constructor(e){super(!0),this.view=e,this.watchHandles=new u$U,this.handle=this.registerIncoming("gamepad",(a=>this._handleEventGamepad(a))),this.handle.pause();}onInstall(a){super.onInstall(a),this.watchHandles.add([l$M((()=>this.view.navigation.gamepad.enabled),(a=>{a?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null));}),h$V),l$M((()=>this.view.navigation.gamepad.device),(a=>{this.cameraControllerGamepad&&a&&this.cameraControllerGamepad.gamepadDevice!==a&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null);}))]);}onUninstall(){this.watchHandles.removeAll(),super.onUninstall();}_handleEventGamepad(a){const e=this.view.navigation.gamepad.device;if(e&&a.data.device!==e)return;const t=this.cameraControllerGamepad&&this.cameraControllerGamepad.active;if(t||q$h.activatesFor(this.view,a.data)){if(!t){const e=new q$h({view:this.view,gamepadDevice:a.data.device});this.view.state.switchCameraController(e)&&(this.cameraControllerGamepad=e);}this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===a.data.device&&this.cameraControllerGamepad.handleEventGamepad(a.data);}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var a$J;!function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT";}(a$J||(a$J={}));class o$E extends i$13{constructor(t,r){super(!0),this.view=t,this.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:l$O.Local},this.keyToNumber={[r.left]:a$J.LEFT,[r.right]:a$J.RIGHT,[r.forward]:a$J.FORWARD,[r.backward]:a$J.BACKWARD,[r.up]:a$J.UP,[r.down]:a$J.DOWN,[r.headingLeft]:a$J.HEADINGLEFT,[r.headingRight]:a$J.HEADINGRIGHT,[r.tiltUp]:a$J.TILTUP,[r.tiltDown]:a$J.TILTDOWN,[r.zoomIn]:a$J.ZOOMIN,[r.zoomOut]:a$J.ZOOMOUT},this.registerIncoming("key-down",null,(e=>this._handleKeyDown(e))),this.registerIncoming("key-up",null,(e=>this._handleKeyUp(e))),this.registerIncoming("blur",null,(()=>this._handleBlur()));}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this.keyToNumber[e.data.key];null!=r&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new q$h({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(r),e.stopPropagation()));}_handleBlur(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null);}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const t=this.keyToNumber[e.data.key];null!=t&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(t),e.stopPropagation());}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class i$J extends i$13{constructor(e,t){super(!0),this.view=e,this.registerIncoming("mouse-wheel",t,(e=>this._handleMouseWheel(e)));}_handleMouseWheel(r){if(!this.view.navigation.mouseWheelZoomEnabled)return;const i=r.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new F$m({view:this.view,mode:"interaction"}):new F$l({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController)),this.cameraController.zoomStep(-1/60*i.deltaY,i$12(i.x,i.y)),r.preventDefault(),r.stopPropagation();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class t$G{constructor(t){this._gain=t;}reset(t){this._value=t;}set gain(t){this._gain=t;}get value(){return void 0===this._value?0:this._value}update(t){void 0===this._value?this._value=t:this._value=this._gain*t+(1-this._gain)*this._value;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let p$E=class extends a$M{constructor(t){super(t),this.view=null,this.beginCamera=new K$h,this.elapsedTimeSec=0,this.constraintOptions={selection:N$m.ALL,interactionType:i$Q.PAN,interactionFactor:0,interactionStartCamera:new K$h,interactionDirection:null,tiltMode:m$H.TUMBLE};}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new n$1j;}get steppingFinished(){return this.momentum.isFinished(this.elapsedTimeSec)}onControllerStart(t){this.beginCamera.copyFrom(t),this.constraintOptions.interactionStartCamera=this.beginCamera,super.onControllerStart(t);}stepController(t,e){e.copyViewFrom(this.beginCamera),this.elapsedTimeSec+=t,this.momentumStep(this.elapsedTimeSec,e),E$x(this.view,e,this.constraintOptions);}};e$Y([d$R({constructOnly:!0})],p$E.prototype,"view",void 0),p$E=e$Y([n$18("esri.views.3d.state.controllers.momentum.MomentumController")],p$E);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let i$I=class extends p$E{constructor(t){super(t),this.interactionType=i$Q.PAN,this.tmpPan=n$16();}momentumStep(t,o){const r=this.momentum.value(t);q$p(this.tmpPan,this.momentum.direction,r),o.eye=e$15(p$D,o.eye,this.tmpPan),o.center=e$15(p$D,o.center,this.tmpPan),this.constraintOptions.interactionDirection=this.tmpPan;}};e$Y([d$R({constructOnly:!0})],i$I.prototype,"momentum",void 0),i$I=e$Y([n$18("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],i$I);const p$D=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const p$C=n$16(),u$H=n$16();let l$C=class extends p$E{constructor(o){super(o),this.interactionType=i$Q.PAN;}momentumStep(o,s){const t=this.momentum.value1(o),i=this.momentum.value2(o);r$V(u$H,s.eye),z$s(u$H,u$H),_$v(this.momentum.axis2,u$H,this.momentum.axis1),kt(s,p$C,this.momentum.axis1,t,this.momentum.axis2,i);}};e$Y([d$R({constructOnly:!0})],l$C.prototype,"momentum",void 0),l$C=e$Y([n$18("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],l$C);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let n$U=class extends p$E{constructor(t){super(t),this.interactionType=i$Q.TUMBLE;}set center(t){this._set("center",t$12(t));}set axis(t){this._set("axis",t$12(t));}momentumStep(t,o){const r=this.momentum.value(t);Z$c(o,this.center,m$J(this.axis,r));}};e$Y([d$R({constructOnly:!0})],n$U.prototype,"momentum",void 0),e$Y([d$R({constructOnly:!0})],n$U.prototype,"center",null),e$Y([d$R({constructOnly:!0})],n$U.prototype,"axis",null),n$U=e$Y([n$18("esri.views.3d.state.controllers.momentum.MomentumController")],n$U);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let p$B=class extends p$E{constructor(t){super(t),this.interactionType=i$Q.ZOOM,this.constraintOptions.interactionDirection=n$16();}set zoomCenter(t){this._set("zoomCenter",t$12(t));}momentumStep(t,o){r$V(this.constraintOptions.interactionDirection,o.eye);const r=this.momentum.valueDelta(0,t);tt$6(o,this.zoomCenter,r,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionDirection=H$n(this.constraintOptions.interactionDirection,o.eye,this.constraintOptions.interactionDirection);}};e$Y([d$R({constructOnly:!0})],p$B.prototype,"momentum",void 0),e$Y([d$R({constructOnly:!0})],p$B.prototype,"zoomCenter",null),p$B=e$Y([n$18("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],p$B);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let j$u=class extends p$E{constructor(t){super(t),this.interactionType=i$Q.ZOOM,this.radius=0,this.tmpSceneCenter=n$16(),this.tmpZoomAxisAngle=i$U(),this.sphere=_$x();}set screenCenter(t){this._set("screenCenter",i$12(t[0],t[1]));}set sceneCenter(t){this._set("sceneCenter",t$12(t));}initialize(){this.sphere[3]=this.radius;}momentumStep(t,e){const s=this.momentum.valueDelta(0,t);et$5(this.sphere,e,s),this.constraintOptions.interactionType=i$Q.ZOOM,E$x(this.view,e,this.constraintOptions),Mt$1(this.sphere,e,this.screenCenter,this.tmpSceneCenter),k$x(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle),Z$c(e,this.sphere,this.tmpZoomAxisAngle),this.constraintOptions.interactionType=i$Q.PAN;}};e$Y([d$R({constructOnly:!0})],j$u.prototype,"momentum",void 0),e$Y([d$R({constructOnly:!0})],j$u.prototype,"screenCenter",null),e$Y([d$R({constructOnly:!0})],j$u.prototype,"sceneCenter",null),e$Y([d$R({constructOnly:!0})],j$u.prototype,"radius",void 0),j$u=e$Y([n$18("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],j$u);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class e$O{constructor(e){this.gain=e;}update(e){this.hasFilteredValue?this.filteredValue=(1-this.gain)*this.filteredValue+this.gain*e:this.filteredValue=e;}reset(){this.filteredValue=void 0;}get hasFilteredValue(){return void 0!==this.filteredValue}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const u$G=1e-5;class c$I extends t$15{constructor(t,e,i,s,a,h=0,n){super(t,e,i),this.angularVelocity1=s,this.axis1=a,this.angularVelocity2=h,this.axis2=n;}value1(t){return super.valueFromInitialVelocity(this.angularVelocity1,t)}value2(t){return super.valueFromInitialVelocity(this.angularVelocity2,t)}}class o$D{constructor(e=300,i=12,s=.84){this.minimumInitialVelocity=e,this.stopVelocity=i,this.friction=s,this.enabled=!0,this.tmpAxis1=n$16(),this.tmpAxis2=n$16(),this.tmpAngles=n$1b(),this.time=new t$16(.3),this.screen=[new t$16(.4),new t$16(.4)],this.angle1=new e$O(.6),this.angle2=new e$O(.6),this.axis1=n$16(),this.axis2=n$16(),this.lastScene=n$16();}addMomentumDirectRotation(t,a,n,l,r,m){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(n)<.01)return;let t=bt$2(this.lastScene,a,this.tmpAxis2,l,r,m);this.angle2.update(0),v$P(this.tmpAxis2)<u$G?t=0:z$s(this.axis1,this.tmpAxis2),this.angle1.update(t),r$V(this.lastScene,a);}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(n);}}addMomentumPreserveHeading(t,a,h,l,r,m,c){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(h)<.01)return;xt$1(this.lastScene,a,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,l,r,m,c,!1),v$P(this.tmpAxis2)<u$G?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),z$s(this.axis1,this.tmpAxis1),z$s(this.axis2,this.tmpAxis2)),r$V(this.lastScene,a);}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(h);}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.angle1.reset(),this.angle2.reset(),this.time.reset();}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,e=this.screen[1].filteredDelta,i=Math.sqrt(t*t+e*e)/this.time.filteredDelta;return Math.abs(i)<this.minimumInitialVelocity?null:this.createMomentum(i,this.stopVelocity,this.friction)}createMomentum(t,e,i){const s=this.angle1.filteredValue/this.time.filteredDelta,a=this.angle2.filteredValue/this.time.filteredDelta;return new c$I(t,e,i,s,this.axis1,a,this.axis2)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let it$4=class extends a$L{constructor(t){super(t),this.view=null,this.smoothRotation=new t$G(.05),this.rotationAxis=n$16(),this.panningPlane=p$Y(),this.smoothScaling=new t$G(.05),this.zoomCenterScreen=i$12(),this.zoomMomentumEstimator=new s$1h,this.rotationMomentumEstimator=new a$17,this.panSphericalMomentumEstimator=new o$D,this.panPlanarMomentumEstimator=new h$X,this.adjustedSphere=_$x(),this.tmp3d=n$16(),this.tmpScreenPointArray=i$12(),this.beginScreenPoint=i$12(),this.beginScenePoint=n$16(),this.screenPickPoint=i$12(),this.navMode=st$5.Horizontal,this.tmpInteractionDirection=n$16(),this.constraintOptions={selection:N$m.ALL,interactionType:i$Q.NONE,interactionFactor:0,interactionStartCamera:new K$h,interactionDirection:null,tiltMode:m$H.TUMBLE};}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(t){if(!this.active)return;const n=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=n,this.rotationMomentumEstimator.enabled=n,this.panPlanarMomentumEstimator.enabled=n,this.panSphericalMomentumEstimator.enabled=n,this.beginHeading=-r$15.normalize(M$t(this.view.camera.heading)),this.beginRadius=t.radius,this.pointerCount=t.pointers.size,this.beginAngle=t.angle,this.smoothRotation.reset(),d$V(t.center,this.screenPickPoint),a$16(this.beginScreenPoint,this.screenPickPoint);const o=p$T(this.view.spatialReference),r=lt$4(this.intersectionHelper,this.startCamera,this.screenPickPoint,o,K$g.Silhouette);this.scenePickPoint=r.scenePickPoint,this.sphere=r.sphere,r$V(this.beginScenePoint,this.scenePickPoint),this.navMode=pt$4(this.startCamera,this.screenPickPoint,r.hasGeometryIntersection,o),this.navMode===st$5.Vertical&&this._preparePlanarPanMode(t),this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera);}_preparePlanarPanMode(t){const i=j$I(this.tmp3d,this.startCamera.viewForward);_$w(this.scenePickPoint,i,this.panningPlane);const e=i$12(this.screenPickPoint[0],0),r=n$16(),a=s$1b(this.startCamera.eye);this.adjustedSphere[3]=a<this.sphere[3]?a-100:this.sphere[3],Mt$1(this.adjustedSphere,this.startCamera,e,r);const m=x$J();this.startCamera.projectToRenderScreen(r,m);const M=.9*m[1];this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],M);const C=this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint);C&&_$w(this.scenePickPoint,Z$g(this.panningPlane),this.panningPlane);const S=n$16(),f=n$16(),j=n$16(),E=80,y=5,O=50;e$15(S,this.scenePickPoint,this.currentCamera.eye);const k=s$1b(S);z$s(S,S);const A=y*Math.max(Math.abs(this.view.camera.position.z),O),z=this.view._stage.renderView.getMinimalDepthForArea(null,this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,E);let R=z?Math.min(z,A):A;R=C?Math.min(R,k):R,r$V(j,u$W(f,this.currentCamera.eye,q$p(f,S,R))),this.panningPlane[3]=-P$u(this.panningPlane,j),this.startCamera.center=u$W(f,this.startCamera.eye,q$p(f,this.startCamera.viewForward,R));const x=d$V(t.center,this.tmpScreenPointArray);_$q(this.panningPlane,this.startCamera,x,this.beginScenePoint);}update(t){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=t.pointers.size>1;this.navMode===st$5.Horizontal?(i&&this._zoomSpherical(t),this._panningSpherical(t),i&&this._rotateSpherical(t)):(i&&this._zoomPlanar(t),this._panningPlanar(t),i&&this._rotatePlanar(t));}end(t){t.pointers.size===this.pointerCount&&this.update(t),this.finishController();const i=this.zoomMomentumEstimator.evaluateMomentum();if(i)return this.navMode===st$5.Horizontal?new j$u({view:this.view,momentum:i,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new p$B({view:this.view,momentum:i,zoomCenter:this.beginScenePoint});const e=this.rotationMomentumEstimator.evaluateMomentum();if(e)return new n$U({view:this.view,momentum:e,center:this.sphere,axis:this.rotationAxis});if(this.navMode===st$5.Horizontal){const t=this.panSphericalMomentumEstimator.evaluateMomentum();if(t)return new l$C({view:this.view,momentum:t})}else {const t=this.panPlanarMomentumEstimator.evaluateMomentum();if(t)return new i$I({view:this.view,momentum:t})}return null}_zoomSpherical(t){const i=this.beginRadius/t.radius,e=.001875*Math.min(Math.max(t.radius,40),120);this.smoothScaling.gain=e,this.smoothScaling.update(i),et$5(this.sphere,this.currentCamera,this.smoothScaling.value),d$V(t.center,this.zoomCenterScreen),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*t.timestamp),this.constraintOptions.interactionType=i$Q.ZOOM,this.constraintOptions.interactionFactor=y$w(t.radius-this.beginRadius),E$x(this.view,this.currentCamera,this.constraintOptions);}_panningSpherical(t){const i=d$V(t.center,this.tmpScreenPointArray);Mt$1(this.sphere,this.currentCamera,i,this.tmp3d),It(this.beginScenePoint,P$u(this.currentCamera.up,this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(Et$1(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this.tmp3d,.001*t.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(wt$1(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(i,this.tmp3d,.001*t.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt)),this.constraintOptions.interactionType=i$Q.PAN,this.constraintOptions.interactionFactor=y$w(this.screenPickPoint,i),E$x(this.view,this.currentCamera,this.constraintOptions);}_rotateSpherical(t){z$s(this.rotationAxis,this.scenePickPoint),this.currentCamera.aboveGround||j$I(this.rotationAxis,this.rotationAxis);const i=this.smoothRotation.value,e=i+Y$c(t.angle-i),n=.00125*Math.min(Math.max(t.radius,40),120);this.smoothRotation.gain=n,this.smoothRotation.update(e);const s=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(s,.001*t.timestamp),Z$c(this.currentCamera,this.sphere,m$J(this.rotationAxis,s)),this.constraintOptions.interactionType=i$Q.TUMBLE,this.constraintOptions.interactionFactor=y$w(t.radius*e),E$x(this.view,this.currentCamera,this.constraintOptions);}_panningPlanar(t){const i=d$V(t.center,this.tmpScreenPointArray);_$q(this.panningPlane,this.currentCamera,i,this.tmp3d)&&(ft$4(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(i,this.tmp3d,.001*t.timestamp),this.constraintOptions.interactionType=i$Q.PAN,this.constraintOptions.interactionFactor=y$w(this.beginScreenPoint,i),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),E$x(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null);}_zoomPlanar(t){const i=this.beginRadius/t.radius,e=.001875*Math.min(Math.max(t.radius,40),120);this.smoothScaling.gain=e,this.smoothScaling.update(i),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*t.timestamp),tt$6(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionType=i$Q.ZOOM,this.constraintOptions.interactionFactor=y$w(t.radius-this.beginRadius),E$x(this.view,this.currentCamera,this.constraintOptions);}_rotatePlanar(t){r$V(this.rotationAxis,this.beginScenePoint),this.currentCamera.aboveGround||j$I(this.rotationAxis,this.rotationAxis);const i=this.smoothRotation.value;let e=t.angle-i;e=Y$c(e);const n=i+e,s=.00125*Math.min(Math.max(t.radius,40),120);this.smoothRotation.gain=s,this.smoothRotation.update(n);const o=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(o,.001*t.timestamp),Z$c(this.currentCamera,this.sphere,m$J(this.rotationAxis,o)),this.constraintOptions.interactionType=i$Q.TUMBLE,this.constraintOptions.interactionFactor=y$w(t.radius*o),E$x(this.view,this.currentCamera,this.constraintOptions);}};e$Y([d$R({constructOnly:!0})],it$4.prototype,"view",void 0),it$4=e$Y([n$18("esri.views.3d.state.controllers.global.PinchAndPanController")],it$4);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const G$e=r$X(0,0,1),Z$b={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI},B$m=80;let W$d=class extends a$L{constructor(t){super(t),this.view=null,this.rotationValueSmooth=new t$G(.05),this.scalingValueSmooth=new t$G(.05),this.planeHorizontal=p$Y(),this.planeVertical=p$Y(),this.rotationMomentumEstimator=new a$17,this.panMomentumEstimator=new h$X(300,12,.9),this.zoomMomentumEstimator=new s$1h,this.beginCenter=n$16(),this.tmpPoints=[],this.beginCenterScreen=i$12(),this.tmpCentroid3d=n$16(),this.tmpCentroid2d=i$12(),this.tmp2d=i$12(),this.constraintOptions={selection:N$m.ALL,interactionType:i$Q.NONE,interactionFactor:0,interactionStartCamera:new K$h,interactionDirection:null,tiltMode:m$H.TUMBLE};}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(t){if(!this.active)return;const e=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=e,this.rotationMomentumEstimator.enabled=e,this.panMomentumEstimator.enabled=e,this.beginRadius=t.radius,this.pointerCount=t.pointers.size,this.beginAngle=t.angle,this.rotationValueSmooth.reset(),this.scalingValueSmooth.reset(),d$V(t.center,this.beginCenterScreen),T$E(G$e,0,this.planeHorizontal);const o=n$16(),s=this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,o),C=n$16();j$I(C,this.startCamera.viewForward);const g=n$16();r$V(g,G$e);const v=P$u(C,g),w=b$D(v<0?-v:v);if(this.panMode=w>=Z$b.ANGLE_THRESHOLD?st$5.Horizontal:st$5.Vertical,L$G(this.planeHorizontal,this.planeHorizontal,o),this.startCamera.aboveGround||P$x(this.planeHorizontal,this.planeHorizontal),this.panMode===st$5.Vertical){q$p(g,g,v),e$15(this.planeVertical,C,g),z$s(this.planeVertical,this.planeVertical),L$G(this.planeVertical,this.planeVertical,o);const i=n$16(),e=n$16(),n=n$16();e$15(i,o,this.currentCamera.eye);const r=s$1b(i);z$s(i,i);const M=5*Math.max(Math.abs(this.view.camera.position.z),50),f=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,B$m);let w=f?Math.min(f,M):M;w=s?Math.min(w,r):w,r$V(n,u$W(e,this.currentCamera.eye,q$p(e,i,w))),this.planeVertical[3]=-P$u(this.planeVertical,n),this.computePlanePoints(t.pointers,this.planeVertical,this.startCamera,this.tmpPoints),rt$5(this.tmpPoints,this.beginCenter);}else this.computePlanePoints(t.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints),rt$5(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera);}update(t){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=t.pointers.size>1,e=this.panMode===st$5.Horizontal?this.planeHorizontal:this.planeVertical,o=this.beginCenter;if(i){const i=this.beginRadius/t.radius,e=.001875*Math.min(Math.max(t.radius,40),120);this.scalingValueSmooth.gain=e,this.scalingValueSmooth.update(i),tt$6(this.currentCamera,o,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*t.timestamp),this.constraintOptions.interactionType=i$Q.ZOOM,this.constraintOptions.interactionFactor=y$w(Math.abs(t.radius-this.beginRadius)),E$x(this.view,this.currentCamera,this.constraintOptions);}if(this.computePlanePoints(t.pointers,e,this.currentCamera,this.tmpPoints),rt$5(this.tmpPoints,this.tmpCentroid3d),d$V(t.center,this.tmpCentroid2d),ft$4(this.currentCamera,o,this.tmpCentroid3d),this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*t.timestamp),this.constraintOptions.interactionType=i$Q.PAN,this.constraintOptions.interactionFactor=y$w(this.beginCenterScreen,this.tmpCentroid2d),E$x(this.view,this.currentCamera,this.constraintOptions),i){const i=this.planeHorizontal,e=o,n=this.rotationValueSmooth.value,s=n+Y$c(t.angle-n),r=.00125*Math.min(Math.max(t.radius,40),120);this.rotationValueSmooth.gain=r,this.rotationValueSmooth.update(s);const a=this.rotationValueSmooth.value-this.beginAngle;this.rotationMomentumEstimator.add(a,.001*t.timestamp),Z$c(this.currentCamera,e,m$J(i,a)),this.constraintOptions.interactionType=i$Q.TUMBLE,this.constraintOptions.interactionFactor=y$w(Math.abs(t.radius*a)),E$x(this.view,this.currentCamera,this.constraintOptions);}}end(t){t.pointers.size===this.pointerCount&&this.update(t),this.finishController();const i=this.zoomMomentumEstimator.evaluateMomentum();if(i)return new p$B({view:this.view,momentum:i,zoomCenter:this.beginCenter});const e=this.rotationMomentumEstimator.evaluateMomentum();if(e)return new n$U({view:this.view,momentum:e,center:this.beginCenter,axis:Z$g(this.planeHorizontal)});const n=this.panMomentumEstimator.evaluateMomentum();return n?new i$I({view:this.view,momentum:n}):null}computePlanePoints(t,i,e,n){n.length=t.size;const o=this.tmp2d;let s=0;return t.forEach((t=>{o[0]=t.x,o[1]=t.y,void 0===n[s]&&(n[s]=n$16()),_$q(i,e,o,n[s]),s+=1;})),n}};e$Y([d$R({constructOnly:!0})],W$d.prototype,"view",void 0),W$d=e$Y([n$18("esri.views.3d.state.controllers.local.PinchAndPanController")],W$d);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class i$H extends i$13{constructor(t,e,s){super(!0),this.view=t,this.pointerAction=e,this.lastEndTimestamp=0,this.lastTimestamp=0,this.registerIncoming("drag",s,(t=>this._handleDrag(t)));}_handleDrag(t){if("mouse"===t.data.pointerType&&!r$16(t.data,this.pointerAction))return;const e=t.timestamp-this.lastEndTimestamp,s=40,i=this.momentum&&this.momentum.active&&e<s;switch(t.data.action){case"start":case"update":if(i)break;this.controller&&this.controller.active?t.data.timestamp-this.lastTimestamp>2&&(this.controller.update(t.data),this.lastTimestamp=t.timestamp):this._startController(t);break;case"end":case"removed":this._endController(t,!0);break;case"added":this._endController(t,!1),this._startController(t);}t.stopPropagation();}_endController(t,e){if(this.controller&&this.controller.active){this.lastEndTimestamp=t.timestamp;const s=this.controller.end(t.data);e&&s&&(this.momentum=s,this.view.state.switchCameraController(this.momentum));}this.controller=null;}_startController(t){this.controller=this._createController(),this.view.state.switchCameraController(this.controller),this.controller.begin(t.data),this.lastTimestamp=t.timestamp;}_createController(){return this.view.state.isGlobal?new it$4({view:this.view}):new W$d({view:this.view})}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class e$N extends i$13{constructor(t,e){super(!0),this.view=t,this.registerIncoming("pointer-down",e,(()=>this.view.state.stopActiveCameraController()));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class e$M extends i$13{constructor(t,e){super(!0),this.key=t,this.registerIncoming("key-down",e,(t=>this._handleKeyDown(t)));}_handleKeyDown(t){t.data.key===this.key&&(this.activate(),t.stopPropagation());}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class t$F extends e$M{constructor(e,t,i){super(t,i),this.view=e;}activate(){this.view.goTo({heading:0}).catch((()=>{}));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class e$L extends e$M{constructor(t,e,i){super(e,i),this.view=t;}activate(){this.view.goTo({tilt:0}).catch((()=>{}));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class o$C extends i$13{constructor(e,t=!1){super(!0),this.view=e,this.invert=t,this.registerIncoming("vertical-two-finger-drag",(e=>this._handleTwoFinger(e)));}_handleTwoFinger(a){const o=this.invert?-1:1,i=i$12(0,a.data.delta*o);switch(a.data.action){case"begin":this.cameraController?.end(),this.cameraController=new L$q({view:this.view,pivot:g$B.CENTER}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(i);break;case"update":this.cameraController?.update(i);break;case"end":this.cameraController?.end(),this.cameraController=null;}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class a$I extends i$13{constructor(e=20,a=40){super(!1),this._threshold=e,this._maxDelta=a,this.state="ready",this.emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this.dragEventSeparator=new t$17({start:(t,e)=>this._observeStart(t,e),update:(t,e,a)=>this._observeUpdate(t,e,a),end:(t,e)=>this._observeEnd(e)}),this.registerIncoming("drag",(t=>this.dragEventSeparator.handle(t)));}get failed(){return "failed"===this.state}_observeStart(t,e){1===t&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:e.data.button,buttons:e.data.buttons,pointerType:e.data.pointerType,timestamp:e.data.timestamp,pointers:e.data.pointers,pointer:e.data.pointer,angle:e.data.angle,radius:e.data.radius,center:e.data.center}),e.stopPropagation()),this.state=2===t?"ready":"failed";}_observeUpdate(t,e,a){if("failed"!==this.state&&2===t)return "active"===this.state?(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void e.stopPropagation()):void(this._checkMovementWithinLimits(e.data,a.data)?this._checkVerticalThresholdReached(e.data,a.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=e.data.center,this._artificalDrag.emit({action:"end",button:e.data.button,buttons:e.data.buttons,pointerType:e.data.pointerType,timestamp:e.data.timestamp,pointers:e.data.pointers,pointer:e.data.pointer,angle:e.data.angle,radius:e.data.radius,center:e.data.center}),this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),e.stopPropagation()):this.state="failed")}_observeEnd(t){"active"===this.state&&(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",t.stopPropagation());}_checkMovementWithinLimits(t,e){let a=-1/0,i=1/0,r=-1/0,s=1/0;e.pointers.forEach((t=>{a=Math.max(a,t.x),i=Math.min(i,t.x),r=Math.max(r,t.y),s=Math.min(s,t.y);}));let n=-1/0,h=1/0,d=-1/0,o=1/0;t.pointers.forEach((t=>{n=Math.max(n,t.x),h=Math.min(h,t.x),d=Math.max(d,t.y),o=Math.min(o,t.y);}));const c=a-i,l=r-s,p=n-h,m=d-o;return Math.abs(t.center.x-e.center.x)<this._threshold&&Math.abs(p-c)<=this._maxDelta&&Math.abs(m-l)<=this._maxDelta}_checkVerticalThresholdReached(t,e){let a=Math.abs(t.center.y-e.center.y);return t.pointers.forEach(((t,i)=>{const r=e.pointers.get(i);a=Math.min(a,Math.abs(t.y-r.y));})),a>=this._threshold}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let z$j=class extends y$F{constructor(){super(...arguments),this._handles=new u$U;}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this.disconnect();}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){"pan"!==e&&"rotate"!==e||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode());}get mode(){return this._get("mode")}set mode(e){"default"!==e&&"pro"!==e||e===this._get("mode")||(this._set("mode",e),this._updateMode());}get hasPendingInputs(){return this._inputManager?.hasPendingInputs}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}disconnect(){this.view.viewEvents.disconnect(),this._inputManager&&(this._inputManager.destroy(),this._inputManager=null),this._source&&(this._source.destroy(),this._source=null);}connect(){const e=this.view;this._source=new u$_(this.view.surface,e.input);const t=[new n$1k,new o$17,new a$18,new s$1i(this.view.navigation),new a$I],r=new c$18({eventSource:this._source,recognizers:t});this._inputManager=r,r.installHandlers("prevent-context-menu",[new e$1b],g$V.INTERNAL),this._modeDragPan=new i$H(e,"primary"),this._modeDragRotate=new a$K(e,"secondary",g$B.CENTER),this._modeDragZoom=new s$O(e,"tertiary");const i={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new e$N(e),new s$P(e),new l$D(e),new o$E(e,i.pan),new i$J(e),new e$L(e,i.resetTilt),new t$F(e,i.resetHeading),new a$K(e,"primary",g$B.EYE,[i.lookAround]),new a$K(e,"secondary",g$B.CENTER,[i.lookAround]),new i$H(e,"tertiary",[i.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new o$C(e)],g$V.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this._handles.add(l$M((()=>this.view.navigation?.browserTouchPanEnabled),(e=>{this._source.browserTouchPanningEnabled=!e;}),h$V));}_updateMode(){const e=this.mode,t=this.primaryDragAction,r=E$w.get(e).get(t);this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom);}get test(){return {inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};e$Y([d$R()],z$j.prototype,"view",void 0),e$Y([d$R({value:"pan"})],z$j.prototype,"primaryDragAction",null),e$Y([d$R({value:"default"})],z$j.prototype,"mode",null),e$Y([d$R({readOnly:!0})],z$j.prototype,"hasPendingInputs",null),e$Y([d$R()],z$j.prototype,"latestPointerType",null),e$Y([d$R()],z$j.prototype,"latestPointerLocation",null),e$Y([d$R()],z$j.prototype,"_inputManager",void 0),z$j=e$Y([n$18("esri.views.3d.input.SceneInputManager")],z$j);const E$w=new Map,b$u=new Map,k$l=new Map;b$u.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),b$u.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),k$l.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),k$l.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),E$w.set("default",b$u),E$w.set("pro",k$l);const C$r=z$j;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let T$t=class extends y$F{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1;}};e$Y([d$R()],T$t.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),e$Y([d$R()],T$t.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),e$Y([d$R()],T$t.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),e$Y([d$R()],T$t.prototype,"DECONFLICTOR_SHOW_GRID",void 0),e$Y([d$R()],T$t.prototype,"LABELS_SHOW_BORDER",void 0),e$Y([d$R()],T$t.prototype,"TEXT_SHOW_BASELINE",void 0),e$Y([d$R()],T$t.prototype,"TEXT_SHOW_BORDER",void 0),e$Y([d$R()],T$t.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),e$Y([d$R()],T$t.prototype,"OVERLAY_SHOW_CENTER",void 0),e$Y([d$R()],T$t.prototype,"SHOW_POI",void 0),e$Y([d$R()],T$t.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),e$Y([d$R()],T$t.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),e$Y([d$R()],T$t.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),e$Y([d$R()],T$t.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),e$Y([d$R()],T$t.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),e$Y([d$R()],T$t.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),e$Y([d$R()],T$t.prototype,"I3S_TREE_SHOW_TILES",void 0),e$Y([d$R()],T$t.prototype,"I3S_SHOW_MODIFICATIONS",void 0),e$Y([d$R()],T$t.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),e$Y([d$R()],T$t.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),e$Y([d$R()],T$t.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),e$Y([d$R()],T$t.prototype,"LINE_WIREFRAMES",void 0),T$t=e$Y([n$18("esri.views.3d.support.DebugFlags")],T$t);const t$E=new T$t;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let e$K,n$T,i$G=!1,l$B=!1,o$B=!1,s$N=!1,a$H=null;function c$H(t,e){if(!l$B||!n$T)return;u$F();const i=n$T;let o=0;for(let n=0;n<t.accBinsNumX;n++)for(let e=0;e<t.accBinsNumY;e++){const l=t.accBins[n][t.accBinsNumY-1-e];o+=l.length;const s=n*t.accBinsSizeX,a=(n+1)*t.accBinsSizeX,c=e*t.accBinsSizeY,r=(e+1)*t.accBinsSizeY;i.fillText(l.length.toFixed(),s+5,c+15),h$C(s,a,c,r,"blue");}i.fillText("total totalShownLabels: "+o,70,40),i.fillText("total visible labels: "+e.size,70,50),i.fillText("total numTests: "+t.accNumTests,70,30);}function r$J(n){o$B=t$E.DECONFLICTOR_SHOW_VISIBLE,s$N=t$E.DECONFLICTOR_SHOW_INVISIBLE,i$G=o$B||s$N,l$B=t$E.DECONFLICTOR_SHOW_GRID,a$H=null,i$G||l$B?a$H=()=>p$A(n):e$K&&(e$K.parentElement.removeChild(e$K),e$K=null);}function u$F(){a$H&&(a$H(),a$H=null);}function p$A(t){null==e$K&&(e$K=document.createElement("canvas"),e$K.setAttribute("id","canvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(e$K));const{state:i}=t,{camera:l,pixelRatio:o}=i,{width:s,height:a}=l,c=s*o,r=a*o;e$K.setAttribute("width",`${c}px`),e$K.setAttribute("height",`${r}px`),e$K.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${a}px`),n$T=e$K.getContext("2d"),n$T.clearRect(0,0,s,a),n$T.font="12px Arial";}function h$C(t,i,l,o,s){u$F();const a=e$K.height,c=n$T;c.beginPath(),c.lineWidth=1,c.strokeStyle=s,c.moveTo(t,a-l),c.lineTo(i,a-l),c.stroke(),c.lineTo(i,a-o),c.stroke(),c.lineTo(i,a-l),c.stroke(),c.lineTo(t,a-l),c.stroke(),c.lineTo(t,a-l),c.stroke(),c.closePath();}function f$G(t,e){i$G&&(e&&o$B||!e&&s$N)&&h$C(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red");}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var E$v,C$q;!function(E){E[E.GRAPHIC=0]="GRAPHIC",E[E.LABEL=1]="LABEL",E[E._COUNT=2]="_COUNT";}(E$v||(E$v={})),function(E){E[E.USER_SETTING=0]="USER_SETTING",E[E.SCALE_RANGE=1]="SCALE_RANGE",E[E.FILTER=2]="FILTER",E[E.DECONFLICTION=3]="DECONFLICTION",E[E._COUNT=4]="_COUNT";}(C$q||(C$q={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function n$S(n){return n instanceof Float32Array&&n.length>=16}function r$I(n){return Array.isArray(n)&&n.length>=16}function t$D(t){return n$S(t)||r$I(t)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var c$G;!function(c){c[c.Occluded=0]="Occluded",c[c.NotOccluded=1]="NotOccluded",c[c.Both=2]="Both",c[c.COUNT=3]="COUNT";}(c$G||(c$G={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var p$z;function u$E(u,v){u.include(c$19),u.attributes.add(O$J.POSITION,"vec3"),u.attributes.add(O$J.NORMAL,"vec3"),u.attributes.add(O$J.AUXPOS1,"vec4");const m=u.vertex;d$W(u,v),c$1a(m,v),m.uniforms.add([new e$19("viewport",((e,t)=>t.camera.fullViewport)),new o$_("polygonOffset",(e=>e.shaderPolygonOffset)),new o$_("cameraGroundRelative",((e,t)=>t.camera.aboveGround?1:-1)),new o$_("renderTransparentlyOccludedHUD",((e,o)=>o.renderTransparentlyOccludedHUD===c$G.Occluded?1:o.renderTransparentlyOccludedHUD===c$G.NotOccluded?0:.75)),new c$11("hudVisibilityTexture",((e,t)=>t.hudVisibilityTexture))]),v.hasVerticalOffset&&f$Y(m),m.constants.add("smallOffsetAngle","float",.984807753012208),m.code.add(n$19`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),m.code.add(n$19`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),v.isDraped&&!v.hasVerticalOffset||m.uniforms.add(new e$Z("viewNormal",((e,t)=>t.camera.viewInverseTransposeMatrix))),v.isDraped||(m.uniforms.add(new o$_("perDistancePixelRatio",((e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)))),m.code.add(n$19`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),v.screenCenterOffsetUnitsEnabled===p$z.Screen&&m.uniforms.add(new o$_("pixelRatio",((e,t)=>t.camera.pixelRatio))),v.hasScreenSizePerspective&&i$15(m),m.code.add(n$19`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${v.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${v.hasScreenSizePerspective&&(v.hasVerticalOffset||v.screenCenterOffsetUnitsEnabled===p$z.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${v.hasVerticalOffset?v.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${v.hasVerticalOffset?n$19`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${v.screenCenterOffsetUnitsEnabled!==p$z.Screen?n$19`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${v.screenCenterOffsetUnitsEnabled===p$z.Screen?v.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${v.screenCenterOffsetUnitsEnabled===p$z.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),m.code.add(n$19`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`);}!function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT";}(p$z||(p$z={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const e$J=128,a$G=.5;function o$A(t,o=e$J,c=o*a$G,s=0){const i=u$D(t,o,c,s);return new L$H(i,{mipmap:!1,wrap:{s:D$q.CLAMP_TO_EDGE,t:D$q.CLAMP_TO_EDGE},width:o,height:o,components:4,noUnpackFlip:!0})}function u$D(t,n=e$J,r=n*a$G,o=0){switch(t){case"circle":default:return c$F(n,r);case"square":return s$M(n,r);case"cross":return h$B(n,r,o);case"x":return f$F(n,r,o);case"kite":return i$F(n,r);case"triangle":return M$l(n,r);case"arrow":return m$z(n,r)}}function c$F(t,n){const r=t/2-.5;return w$q(t,T$s(r,r,n/2))}function s$M(t,n){return l$A(t,n,!1)}function i$F(t,n){return l$A(t,n,!0)}function h$B(t,n,r=0){return p$y(t,n,!1,r)}function f$F(t,n,r=0){return p$y(t,n,!0,r)}function M$l(t,n){return w$q(t,b$t(t/2,n,n/2))}function m$z(t,n){const r=n,e=n/2,a=t/2,o=.8*r,u=T$s(a,(t-n)/2-o,Math.sqrt(o*o+e*e)),c=b$t(a,r,e);return w$q(t,((t,n)=>Math.max(c(t,n),-u(t,n))))}function l$A(t,n,r){return r&&(n/=Math.SQRT2),w$q(t,((e,a)=>{let o=e-.5*t+.25,u=.5*t-a-.75;if(r){const t=(o+u)/Math.SQRT2;u=(u-o)/Math.SQRT2,o=t;}return Math.max(Math.abs(o),Math.abs(u))-.5*n}))}function p$y(t,n,r,e=0){n-=e,r&&(n*=Math.SQRT2);const a=.5*n;return w$q(t,((n,o)=>{let u,c=n-.5*t,s=.5*t-o-1;if(r){const t=(c+s)/Math.SQRT2;s=(s-c)/Math.SQRT2,c=t;}return c=Math.abs(c),s=Math.abs(s),u=c>s?c>a?Math.sqrt((c-a)*(c-a)+s*s):s:s>a?Math.sqrt(c*c+(s-a)*(s-a)):c,u-=e/2,u}))}function T$s(t,n,r){return (e,a)=>{const o=e-t,u=a-n;return Math.sqrt(o*o+u*u)-r}}function b$t(t,n,r){const e=Math.sqrt(n*n+r*r);return (a,o)=>{const u=Math.abs(a-t)-r,c=o-t+n/2+.75,s=(n*u+r*c)/e,i=-c;return Math.max(s,i)}}function w$q(n,r){const e=new Uint8Array(4*n*n);for(let a=0;a<n;a++)for(let o=0;o<n;o++){const u=o+n*a;let c=r(o,a);c=c/n+.5,o$18(c,e,4*u);}return e}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function s$L(s,n){const{vertex:p,fragment:l}=s;n.hasMultipassGeometry&&p.include(a$Q),n.hasMultipassTerrain&&s.varyings.add("depth","float"),p.code.add(n$19`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${n.hasMultipassGeometry?n$19`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${n.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),n.hasMultipassTerrain&&l.include(a$Y),n.hasMultipassTerrain&&l.uniforms.add([new c$11("terrainDepthTexture",((e,r)=>r.multipassTerrain.linearDepthTexture)),new e$$("nearFar",((e,r)=>r.camera.nearFar)),new e$$("inverseViewport",((e,r)=>r.inverseViewport))]),l.include(a$10),l.code.add(n$19`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${n.hasMultipassTerrain?n$19`
          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function B$l(i){const l=new i$_,B=i.signedDistanceFieldEnabled;if(l.include(c$O),l.include(u$E,i),l.include(u$$,i),i.output===o$19.Occlusion)return l.include(s$L,i),l;const{vertex:H,fragment:V}=l;l.include(c$19),V.include(a$10),V.include(e$14),l.include(s$1j,i),l.varyings.add("vcolor","vec4"),l.varyings.add("vtc","vec2"),l.varyings.add("vsize","vec2"),i.binaryHighlightOcclusionEnabled&&l.varyings.add("voccluded","float"),H.uniforms.add([new e$19("viewport",((e,o)=>o.camera.fullViewport)),new e$$("screenOffset",((e,i)=>r$Y(U$k,2*e.screenOffset[0]*i.camera.pixelRatio,2*e.screenOffset[1]*i.camera.pixelRatio))),new e$$("anchorPosition",(e=>L$o(e))),new e$19("materialColor",(e=>e.color)),new o$_("pixelRatio",((e,o)=>o.camera.pixelRatio))]),B&&(H.uniforms.add(new e$19("outlineColor",(e=>e.outlineColor))),V.uniforms.add([new e$19("outlineColor",(e=>_$o(e)?e.outlineColor:l$W)),new o$_("outlineSize",(e=>_$o(e)?e.outlineSize:0))])),i.hasScreenSizePerspective&&(t$18(H),i$15(H)),(i.debugDrawLabelBorder||i.binaryHighlightOcclusionEnabled)&&l.varyings.add("debugBorderCoords","vec4"),l.attributes.add(O$J.UV0,"vec2"),l.attributes.add(O$J.COLOR,"vec4"),l.attributes.add(O$J.SIZE,"vec2"),l.attributes.add(O$J.AUXPOS2,"vec4"),H.code.add(n$19`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${i.hasScreenSizePerspective?n$19`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:n$19`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${i.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${i.occlusionTestEnabled||i.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${i.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const E=n$19`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,T=i.pixelSnappingEnabled?B?n$19`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:n$19`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:n$19`posProj += quadOffset;`;i.vvColor&&H.uniforms.add([new e$1c("vvColorColors",(e=>e.vvColorColors),o$1a),new o$1b("vvColorValues",(e=>e.vvColorValues),o$1a)]),H.uniforms.add(new e$$("textureCoordinateScaleFactor",(o=>r$W(o.texture)&&r$W(o.texture.descriptor.textureCoordinateScaleFactor)?o.texture.descriptor.textureCoordinateScaleFactor:i$16))),H.code.add(n$19`
    ${i.occlusionTestEnabled?"if (visible) {":""}
    ${E}
    ${i.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${n$19.float(t$19)};
    ${B?`alphaDiscard = alphaDiscard && outlineColor.a < ${n$19.float(t$19)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${T}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${i.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${i.occlusionTestEnabled?n$19`} else { vtc = vec2(0.0);
      ${i.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),V.uniforms.add(new c$11("tex",(e=>e.texture)));const M=i.debugDrawLabelBorder?n$19`(isBorder > 0.0 ? 0.0 : ${n$19.float(o$1c)})`:n$19.float(o$1c),R=n$19`
    ${i.debugDrawLabelBorder?n$19`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${B?n$19`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${n$19.float(e$J)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${M} ||
          fillPixelColor.a + outlinePixelColor.a < ${n$19.float(t$19)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${M}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:n$19`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${M}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${i.debugDrawLabelBorder?n$19`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return i.output===o$19.Alpha&&V.code.add(n$19`
      void main() {
        ${R}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),i.output===o$19.Color&&V.code.add(n$19`
    void main() {
      ${R}
      ${i.transparencyPassType===O$L.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),i.output===o$19.Highlight&&(l.include(a$19),V.code.add(n$19`
    void main() {
      ${R}
      ${i.binaryHighlightOcclusionEnabled?n$19`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),l}function _$o(e){return e.outlineColor[3]>0&&e.outlineSize>0}function L$o(e,o=U$k){return e.textureIsSignedDistanceField?H$g(e.anchorPosition,e.distanceFieldBoundingBox,o):a$16(o,e.anchorPosition),o}function H$g(i,r,l){r$W(r)?r$Y(l,i[0]*(r[2]-r[0])+r[0],i[1]*(r[3]-r[1])+r[1]):r$Y(l,0,0);}const U$k=n$1b(),V$h=Object.freeze(Object.defineProperty({__proto__:null,build:B$l,calculateAnchorPosForRendering:L$o},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class g$A extends e$11{initializeConfiguration(e,i){i.spherical=e.viewingMode===l$O.Global;}initializeProgram(t){const e=g$A.shader.get().build(this.configuration);return new o$Z(t.rctx,e,E$E)}_setPipelineState(t){const i=this.configuration,r=t===O$L.NONE,n=t===O$L.FrontFace,a=this.configuration.hasPolygonOffset&&b$s,l=(r||n)&&i.output!==o$19.Highlight?(i.depthEnabled||i.output===o$19.Occlusion)&&a$1a:null;return W$h({blending:i.output===o$19.Color||i.output===o$19.Alpha||i.output===o$19.Highlight?r?j$t:E$J(t):null,depthTest:{func:I$y.LEQUAL},depthWrite:l,colorWrite:c$10,polygonOffset:a})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.output===o$19.Occlusion?E$F.POINTS:E$F.TRIANGLES}}g$A.shader=new t$W(V$h,(()=>import('./HUDMaterial.glsl-c05bc999.js')));const b$s={factor:0,units:-4},j$t=s$1e(R$u.ONE,R$u.ONE_MINUS_SRC_ALPHA);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class p$x extends i$17{constructor(){super(...arguments),this.output=o$19.Color,this.screenCenterOffsetUnitsEnabled=p$z.World,this.transparencyPassType=O$L.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1;}}e$Y([e$12({count:o$19.COUNT})],p$x.prototype,"output",void 0),e$Y([e$12({count:p$z.COUNT})],p$x.prototype,"screenCenterOffsetUnitsEnabled",void 0),e$Y([e$12({count:O$L.COUNT})],p$x.prototype,"transparencyPassType",void 0),e$Y([e$12()],p$x.prototype,"spherical",void 0),e$Y([e$12()],p$x.prototype,"occlusionTestEnabled",void 0),e$Y([e$12()],p$x.prototype,"signedDistanceFieldEnabled",void 0),e$Y([e$12()],p$x.prototype,"vvSize",void 0),e$Y([e$12()],p$x.prototype,"vvColor",void 0),e$Y([e$12()],p$x.prototype,"hasVerticalOffset",void 0),e$Y([e$12()],p$x.prototype,"hasScreenSizePerspective",void 0),e$Y([e$12()],p$x.prototype,"debugDrawLabelBorder",void 0),e$Y([e$12()],p$x.prototype,"binaryHighlightOcclusionEnabled",void 0),e$Y([e$12()],p$x.prototype,"hasSlicePlane",void 0),e$Y([e$12()],p$x.prototype,"hasPolygonOffset",void 0),e$Y([e$12()],p$x.prototype,"depthEnabled",void 0),e$Y([e$12()],p$x.prototype,"pixelSnappingEnabled",void 0),e$Y([e$12()],p$x.prototype,"isDraped",void 0),e$Y([e$12()],p$x.prototype,"hasMultipassGeometry",void 0),e$Y([e$12()],p$x.prototype,"hasMultipassTerrain",void 0),e$Y([e$12()],p$x.prototype,"cullAboveGround",void 0),e$Y([e$12({constValue:!0})],p$x.prototype,"hasSliceInVertexProgram",void 0),e$Y([e$12({constValue:!1})],p$x.prototype,"hasVvInstancing",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class J$c extends d$X{constructor(e){super(e,new Se$2),this.techniqueConfig=new p$x;}getConfiguration(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasVerticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?p$z.Screen:p$z.World,this.techniqueConfig.hasPolygonOffset=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,e===o$19.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),e===o$19.Highlight&&(this.techniqueConfig.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.hasMultipassGeometry=t.multipassGeometry.enabled,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(e,s,i,r,n,a,o,c,l){r$W(l)?this._intersectDrapedHudGeometry(e,a,o,c,l):this._intersectHudGeometry(e,s,i,r,o,c);}_intersectDrapedHudGeometry(e,s,i,r,n){const a=e.vertexAttributes.get(O$J.POSITION),o=e.vertexAttributes.get(O$J.SIZE),c=this.parameters,l=L$o(c);let f=1,h=1;if(r$W(r)){const e=r(pe$c);f=e[0],h=e[5];}f*=e.screenToWorldRatio,h*=e.screenToWorldRatio;const u=de$a*e.screenToWorldRatio;for(let t=0;t<a.data.length/a.size;t++){const r=t*a.size,p=a.data[r],m=a.data[r+1],d=t*o.size;let g;ge$8[0]=o.data[d]*f,ge$8[1]=o.data[d+1]*h,c.textureIsSignedDistanceField&&(g=c.outlineSize*e.screenToWorldRatio/2),ee$6(s,p,m,ge$8,u,g,c,l)&&i(n.dist,n.normal,-1,!1);}}_intersectHudGeometry(e,s,r,a,o,c){if(!a.options.selectionMode||!a.options.hud||u$10(s))return;const l=this.parameters;let S=1,v=1;if(a$13(ce$d,r),r$W(c)){const e=c(pe$c);S=e[0],v=e[5],$$e(ce$d);}const A=e.vertexAttributes.get(O$J.POSITION),b=e.vertexAttributes.get(O$J.SIZE),x=e.vertexAttributes.get(O$J.NORMAL),C=e.vertexAttributes.get(O$J.AUXPOS1);e$18(A.size>=3);const y=a.point,I=a.camera,z=L$o(l);S*=I.pixelRatio,v*=I.pixelRatio;const T="screen"===this.parameters.centerOffsetUnits;for(let t=0;t<A.data.length/A.size;t++){const e=t*A.size;o$W(ie$7,A.data[e],A.data[e+1],A.data[e+2]),L$E(ie$7,ie$7,r);const s=t*b.size;ge$8[0]=b.data[s]*S,ge$8[1]=b.data[s+1]*v,L$E(ie$7,ie$7,I.viewMatrix);const i=t*C.size;if(o$W(he$b,C.data[i+0],C.data[i+1],C.data[i+2]),!T&&(ie$7[0]+=he$b[0],ie$7[1]+=he$b[1],0!==he$b[2])){const e=he$b[2];z$s(he$b,ie$7),e$15(ie$7,ie$7,q$p(he$b,he$b,e));}const c=t*x.size;if(o$W(re$5,x.data[c],x.data[c+1],x.data[c+2]),this._normalAndViewAngle(re$5,ce$d,I,ue$e),this._applyVerticalOffsetTransformationView(ie$7,ue$e,I,te$6),I.applyProjection(ie$7,ne$9),ne$9[0]>-1){ne$9[0]=Math.floor(ne$9[0]),ne$9[1]=Math.floor(ne$9[1]),T&&(he$b[0]||he$b[1])&&(ne$9[0]+=he$b[0],0!==he$b[1]&&(ne$9[1]+=o$1d(he$b[1],te$6.factorAlignment)),I.unapplyProjection(ne$9,ie$7)),ne$9[0]+=this.parameters.screenOffset[0],ne$9[1]+=this.parameters.screenOffset[1],f$Z(ge$8,te$6.factor,ge$8);const e=me$c*I.pixelRatio;let t;if(l.textureIsSignedDistanceField&&(t=l.outlineSize*I.pixelRatio/2),ee$6(y,ne$9[0],ne$9[1],ge$8,e,t,l,z)){const e=a.ray;if(L$E(oe$c,ie$7,h$U(fe$b,I.viewMatrix)),ne$9[0]=y[0],ne$9[1]=y[1],I.unprojectFromRenderScreen(ne$9,ie$7)){const t=n$16();r$V(t,e.direction);const s=1/s$1b(t);q$p(t,t,s);o(x$H(e.origin,ie$7)*s,t,-1,!0,1,oe$c);}}}}}computeAttachmentOrigin(e,t){const s=e.vertexAttributes;if(!s)return !1;const i=s.get(O$J.POSITION),r=e.indices.get(O$J.POSITION);return g$W(i,r,t)}createBufferWriter(){return new Ae$2(this)}_normalAndViewAngle(e,t,s,r){return t$D(t)&&(t=a$13(le$c,t)),O$K(r.normal,e,t),L$E(r.normal,r.normal,s.viewInverseTransposeMatrix),r.cosAngle=P$u(ae$a,Oe$2),r}_updateScaleInfo(e,s,i){const r=this.parameters;r$W(r.screenSizePerspective)?d$Y(i,s,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),r$W(r.screenSizePerspectiveAlignment)?d$Y(i,s,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels);}applyShaderOffsetsView(e,t,s,i,r,n,a){const o=this._normalAndViewAngle(t,s,r,ue$e);return this._applyVerticalGroundOffsetView(e,o,r,a),this._applyVerticalOffsetTransformationView(a,o,r,n),this._applyPolygonOffsetView(a,o,i[3],r,a),this._applyCenterOffsetView(a,i,a),a}applyShaderOffsetsNDC(e,s,i,r,n){return this._applyCenterOffsetNDC(e,s,i,r),r$W(n)&&r$V(n,r),this._applyPolygonOffsetNDC(r,s,i,r),r}_applyPolygonOffsetView(t,s,i,r,n){const a=r.aboveGround?1:-1;let o=Math.sign(i);0===o&&(o=a);const c=a*o;if(this.parameters.shaderPolygonOffset<=0)return r$V(n,t);const l=o$X(Math.abs(s.cosAngle),.01,1),f=1-Math.sqrt(1-l*l)/l/r.viewport[2];return q$p(n,t,c>0?f:1/f),n}_applyVerticalGroundOffsetView(e,t,s,i){const r=s$1b(e),n=s.aboveGround?1:-1,a=.5*s.computeRenderPixelSizeAtDist(r),o=q$p(ie$7,t.normal,n*a);return u$W(i,e,o),i}_applyVerticalOffsetTransformationView(e,t,i,r){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const s=s$1b(e);this._updateScaleInfo(r,s,t.cosAngle);}else r.factor.scale=1,r.factorAlignment.scale=1;return e}const a=s$1b(e),o=c$$(n.screenSizePerspectiveAlignment,n.screenSizePerspective),c=L$I(i,a,n.verticalOffset,t.cosAngle,o);return this._updateScaleInfo(r,a,t.cosAngle),q$p(t.normal,t.normal,c),u$W(e,e,t.normal)}_applyCenterOffsetView(e,t,s){const i="screen"!==this.parameters.centerOffsetUnits;return s!==e&&r$V(s,e),i&&(s[0]+=t[0],s[1]+=t[1],t[2]&&(z$s(re$5,s),u$W(s,s,q$p(re$5,re$5,t[2])))),s}_applyCenterOffsetNDC(e,t,s,i){const r="screen"!==this.parameters.centerOffsetUnits;return i!==e&&r$V(i,e),r||(i[0]+=t[0]/s.fullWidth*2,i[1]+=t[1]/s.fullHeight*2),i}_applyPolygonOffsetNDC(e,t,s,i){const r=this.parameters.shaderPolygonOffset;if(e!==i&&r$V(i,e),r){const e=s.aboveGround?1:-1,n=e*Math.sign(t[3]);i[2]-=(n||e)*r;}return i}requiresSlot(e){if(e===E$G.DRAPED_MATERIAL)return !0;const{drawInSecondSlot:t,occlusionTest:s}=this.parameters;return e===(t?E$G.LABEL_MATERIAL:E$G.HUD_MATERIAL)||s&&e===E$G.OCCLUSION_PIXELS}createGLMaterial(e){return e.output===o$19.Color||e.output===o$19.Alpha?new Q$d(e):e.output===o$19.Highlight?new K$f(e):null}calculateRelativeScreenBounds(e,t,s=u$T()){return Y$a(this.parameters,e,t,s),s[2]=s[0]+e[0],s[3]=s[1]+e[1],s}}class K$f extends h$Y{constructor(e){super({...e,...e.material.parameters});}selectProgram(e){return this.ensureTechnique(g$A,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}}class Q$d extends K$f{_isOcclusionSlot(e){return e.slot===E$G.OCCLUSION_PIXELS&&this._material.parameters.occlusionTest&&(this._output===o$19.Color||this._output===o$19.Alpha)}selectProgram(e){return this.ensureTechnique(g$A,e,this._isOcclusionSlot(e)?o$19.Occlusion:this._output)}}function Y$a(e,t,s,i=se$7){return a$16(i,e.anchorPosition),i[0]*=-t[0],i[1]*=-t[1],i[0]+=e.screenOffset[0]*s,i[1]+=e.screenOffset[1]*s,i}function $$e(e){const t=e[0],s=e[1],i=e[2],r=e[3],n=e[4],a=e[5],o=e[6],c=e[7],l=e[8],f=1/Math.sqrt(t*t+s*s+i*i),h=1/Math.sqrt(r*r+n*n+a*a),u=1/Math.sqrt(o*o+c*c+l*l);return e[0]=t*f,e[1]=s*f,e[2]=i*f,e[3]=r*h,e[4]=n*h,e[5]=a*h,e[6]=o*u,e[7]=c*u,e[8]=l*u,e}function ee$6(e,s,i,r,n,a,o,c){let l=s-n-(c[0]>0?r[0]*c[0]:0),f=l+r[0]+2*n,h=i-n-(c[1]>0?r[1]*c[1]:0),u=h+r[1]+2*n;const p=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&r$W(p)&&(l+=r[0]*p[0],h+=r[1]*p[1],f-=r[0]*(1-p[2]),u-=r[1]*(1-p[3]),l-=a,f+=a,h-=a,u+=a),e[0]>l&&e[0]<f&&e[1]>h&&e[1]<u}const te$6={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},se$7=n$1b(),ie$7=n$16(),re$5=n$16(),ne$9=n$1a(),ae$a=n$16(),oe$c=n$16(),ce$d=e$16(),le$c=e$16(),fe$b=e$10(),he$b=n$16(),ue$e={normal:ae$a,cosAngle:0},pe$c=e$10(),me$c=1,de$a=2,ge$8=[0,0],Oe$2=r$X(0,0,1);class Se$2 extends o$1e{constructor(){super(...arguments),this.renderOccluded=h$Z.Occlude,this.color=[1,1,1,1],this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=r$13(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=[1,1,1,1],this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.debugDrawLabelBorder=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1;}}const ve$3=T$C().vec3f(O$J.POSITION).vec3f(O$J.NORMAL).vec2f(O$J.UV0).vec4u8(O$J.COLOR).vec2f(O$J.SIZE).vec4f(O$J.AUXPOS1).vec4f(O$J.AUXPOS2);class Ae$2{constructor(e){this.material=e,this.vertexBufferLayout=ve$3;}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(O$J.POSITION).length}write(e,t,s,i){p$10(t.indices.get(O$J.POSITION),t.vertexAttributes.get(O$J.POSITION).data,e.transformation,s.position,i,6),B$s(t.indices.get(O$J.NORMAL),t.vertexAttributes.get(O$J.NORMAL).data,e.invTranspTransformation,s.normal,i,6);{const e=t.vertexAttributes.get(O$J.UV0).data;let r,n,a,o;if(null==e||e.length<4){const e=this.material.parameters;r=0,n=0,a=e.texCoordScale[0],o=e.texCoordScale[1];}else r=e[0],n=e[1],a=e[2],o=e[3];a=Math.min(1.99999,a+1),o=Math.min(1.99999,o+1);const c=t.indices.get(O$J.POSITION).length,l=s.uv0;let f=i;for(let t=0;t<c;++t)l.set(f,0,r),l.set(f,1,n),f+=1,l.set(f,0,a),l.set(f,1,n),f+=1,l.set(f,0,a),l.set(f,1,o),f+=1,l.set(f,0,a),l.set(f,1,o),f+=1,l.set(f,0,r),l.set(f,1,o),f+=1,l.set(f,0,r),l.set(f,1,n),f+=1;}g$X(t.indices.get(O$J.COLOR),t.vertexAttributes.get(O$J.COLOR).data,4,s.color,i,6);{const e=t.indices.get(O$J.SIZE),r=t.vertexAttributes.get(O$J.SIZE).data,n=e.length,a=s.size;let o=i;for(let t=0;t<n;++t){const s=r[2*e[t]],i=r[2*e[t]+1];for(let e=0;e<6;++e)a.set(o,0,s),a.set(o,1,i),o+=1;}}t.indices.get(O$J.AUXPOS1)&&t.vertexAttributes.get(O$J.AUXPOS1)&&d$Z(t.indices.get(O$J.AUXPOS1),t.vertexAttributes.get(O$J.AUXPOS1).data,s.auxpos1,i,6),t.indices.get(O$J.AUXPOS2)&&t.vertexAttributes.get(O$J.AUXPOS2)&&d$Z(t.indices.get(O$J.AUXPOS2),t.vertexAttributes.get(O$J.AUXPOS2).data,s.auxpos2,i,6);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const H$f=n$16(),Z$a=n$1a(),q$g=n$1a(),J$b=n$16(),K$e=e$10(),Q$c=_$x(),$$d=d$U(),ii=n$16(),ti=u$T();class si{constructor(){this.aabr=u$T(),this.distance=0,this.culled=!1,this.visible=!1;}}class ei{constructor(i,t,s={}){this.graphics3DGraphic=i,this.slicePlaneEnabled=t,this.info=s;}}class ri{constructor(){this.active=new Map,this.visible=new Map;}clear(){this.active.clear(),this.visible.clear();}}class ai{}class oi{constructor(){this.sortArray=new n$1l({allocator:i=>i||new ai});}}var ci;!function(i){i[i.Idle=0]="Idle",i[i.Process=1]="Process",i[i.Sort=2]="Sort",i[i.Deconflict=3]="Deconflict",i[i.NumStates=4]="NumStates";}(ci||(ci={}));class ni{constructor(){this.camera=new K$h,this.slicePlane=G$n(),this.slicePlaneEnabled=!1;}copyFrom(i){this.camera.copyFrom(i.camera),X$c(i.slicePlane,this.slicePlane),this.slicePlaneEnabled=i.slicePlaneEnabled;}}let hi=class extends y$F{constructor(){super(...arguments),this._dirty=!1,this._runningViewState=new ni,this._state=ci.Idle,this.graphics=new ri,this.iterators=new oi,this.accBinsNumX=15,this.accBinsNumY=20,this.accBinsSizeX=0,this.accBinsSizeY=0,this.accBins=null,this.accNumTests=0;}get dirty(){return this._dirty}get state(){return this._state}destroy(){this.graphics.clear(),this.iterators=null;}setDirty(){!this._dirty&&this.graphics.active.size>0&&(this._dirty=!0,this.notifyChange("updating"));}get updating(){return this._state!==ci.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const i=this._state/ci.NumStates;return this._dirty?.5*i:i}get running(){return this.view.ready&&null!=this.view.state&&this.updating}runTask(i){switch(this._state){case ci.Idle:this._startUpdate(),i.madeProgress();case ci.Process:if(this._state=ci.Process,!this._processActiveGraphics(i))return;case ci.Sort:if(this._state=ci.Sort,!this._sortVisibleGraphics(i))return;case ci.Deconflict:if(this._state=ci.Deconflict,!this._deconflictVisibleGraphics(i))return;default:c$H(this,this.graphics.visible),this._state=ci.Idle,this.notifyChange("updating");}}modifyGraphics(i,t){t?i.forEach((i=>this.addToActiveGraphics(i))):i.forEach((i=>this.removeFromActiveGraphics(i))),this.setDirty();}layerSupportsDeconfliction(i){if(t$V(i)||"object3d"!==i.type)return !1;const t=i.stageObject;if(1!==(t?t.geometryRecords.length:0))return !1;return t.geometryRecords[0].material instanceof J$c}_startUpdate(){r$J(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:i,fullHeight:t}=this._runningViewState.camera;this._initBins(i,t),this._resetIterators();}addToActiveGraphics(i){i.info[this.visibilityGroup]=new si,this.graphics.active.set(i.graphics3DGraphic.graphic.uid,i),this.setDirty();}removeFromActiveGraphics(i){this._removeFromVisibleGraphics(i),li(i,this.visibilityGroup),delete i.info[this.visibilityGroup],this.graphics.active.delete(i.graphics3DGraphic.graphic.uid),this.setDirty();}_addToVisibleGraphics(i){this.graphics.visible.set(i.graphics3DGraphic.graphic.uid,i);}_removeFromVisibleGraphics(i){this.graphics.visible.delete(i.graphics3DGraphic.graphic.uid);}_processActiveGraphics(i){const t=this._ensureActiveGraphicsIterator(),s=h$U(K$e,this._runningViewState.camera.projectionMatrix),e="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&this._runningViewState.camera.relativeElevation>0?Q$c:null;let a=0;for(r$W(e)&&(L$E(e,f$_,this._runningViewState.camera.viewMatrix),e[3]=p$T(this.view.spatialReference).radius,a=G$o(e,f$_));!i.done;){i.madeProgress();const r=t.next();if(!0===r.done)return this._resetActiveGraphicsIterator(),!0;const o=r.value,c=o&&o.info[this.visibilityGroup];c&&(this._collectGraphics3DGraphics(o,s,e,a),c.culled?this._removeFromVisibleGraphics(o):this._addToVisibleGraphics(o));}return !1}_sortVisibleGraphics(i){const t=this._ensureSortGraphicsIterator();for(;!i.done;){const s=t.next();if(i.madeProgress(),!0===s.done)return this._resetSortGraphicsIterator(),!0}return !1}_deconflictVisibleGraphics(i){const t=this._ensureVisibleGraphicsIterator(),s=this.visibilityGroup===E$v.LABEL;for(;!i.done;){i.madeProgress();const e=t.next();if(!0===e.done)return this._resetVisibleGraphicsIterator(),!0;const r=e.value,a=r.info[this.visibilityGroup];if(!a||a.culled)continue;const o=r.graphics3DGraphic,c=(!s||o.isVisible())&&!this._isConflicted(r);c&&this._addToBins(r),a.visible=c,this._setGraphicVisibility(r,c),f$G(a,c);}return !1}_resetIterators(){this.iterators.active=null,this.iterators.visible=null,this.iterators.sort=null;}_ensureActiveGraphicsIterator(){return this.iterators.active||(this.iterators.active=pi(this.graphics.active)),this.iterators.active}_resetActiveGraphicsIterator(){this.iterators.active=null;}_ensureVisibleGraphicsIterator(){return this.iterators.visible||(this.iterators.visible=pi(this.graphics.visible)),this.iterators.visible}_resetVisibleGraphicsIterator(){this.iterators.visible=null;}_ensureSortGraphicsIterator(){return this.iterators.sort||(this.iterators.sort=ui(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup)),this.iterators.sort}_resetSortGraphicsIterator(){this.iterators.sort=null;}_collectGraphics3DGraphics(i,t,s,a){const o=i.graphics3DGraphic;if(o.destroyed)return;const c=i.info[this.visibilityGroup];if(!o.isVisible(E$v.GRAPHIC,C$q.DECONFLICTION))return void(c.culled=!0);const n=this.getGraphicsLayers(o);D$s(c.aabr);let h=null;for(const l of n){if(!this.layerSupportsDeconfliction(l))continue;const o=l.stageObject.geometryRecords[0].material;if(t$V(h)){if(h=this._getProjectionInfo(l,t,mi),h.isOutsideScreen||this._isCulledBySlice(i,H$f)||r$W(s)&&this._isCulledByHorizon(h,s,a))return void(c.culled=!0);!t$E.TESTS_DISABLE_OPTIMIZATIONS&&c.visible&&(h.distance*=.7);}this._expandBoundingRect(c,l,o,h);}t$V(h)?c.culled=!0:(c.distance=h.distance,c.culled=!1);}_getProjectionInfo(i,t,s){const e=this._runningViewState.camera,r=i.stageObject,a=r.geometryRecords[0],o=a.material,c=E$K(r.boundingVolumeWorldSpace.bounds);L$E(H$f,c,e.viewMatrix);const n=a.geometry.vertexAttributes,h=n.get(O$J.NORMAL).data,l=n.get(O$J.AUXPOS1).data;return o.applyShaderOffsetsView(H$f,h,r.transformation,l,e,s.scaleInfo,H$f),r$17(Z$a,H$f[0],H$f[1],H$f[2],1),w$z(q$g,Z$a,e.projectionMatrix),q$p(s.positionNDC,q$g,1/q$g[3]),o.applyShaderOffsetsNDC(s.positionNDC,l,e,s.positionNDC,J$b),s.distanceWithoutPolygonOffset=e.depthNDCToWorld(J$b[2]),s.distance=J$b[2]===s.positionNDC[2]?s.distanceWithoutPolygonOffset:e.depthNDCToWorld(s.positionNDC[2]),r$17(q$g,s.positionNDC[0],s.positionNDC[1],s.positionNDC[2],1),w$z(Z$a,q$g,t),l$X(Z$a,Z$a,1/Z$a[3]),o$W(s.positionView,H$f[0],H$f[1],H$f[2]),s}_isCulledByHorizon(i,t,s){return r$V($$d.direction,i.positionView),o$W($$d.origin,0,0,0),!!U$u(t,$$d,ii)&&i.distanceWithoutPolygonOffset>s}_isCulledBySlice(i,t){return i.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&cs(this._runningViewState.slicePlane,t)}_expandBoundingRect(i,t,e,{positionNDC:r,scaleInfo:a}){const o=this._runningViewState.camera,c=t.getScreenSize(di);f$Z(c,a.factor,c),c[0]*=o.pixelRatio,c[1]*=o.pixelRatio;const n=z$u(e.calculateRelativeScreenBounds(c,a.factorAlignment.scale,ti),s$1c(0,o.fullWidth,.5+.5*r[0]),s$1c(0,o.fullHeight,.5+.5*r[1])),h=this.iconMarginFactor;if(0!==h){const i=h*Math.min(s$1k(n),l$Y(n));n[0]-=i,n[1]-=i,n[2]+=i,n[3]+=i;}h$_(i.aabr,n,i.aabr);}_isConflicted(i){const t=i.graphics3DGraphic.graphic.uid,s=i.info[this.visibilityGroup];for(let e=Math.floor(s.aabr[0]/this.accBinsSizeX);e<=Math.floor(s.aabr[2]/this.accBinsSizeX);e++)if(!(e<0||e>=this.accBinsNumX))for(let i=Math.floor(s.aabr[1]/this.accBinsSizeY);i<=Math.floor(s.aabr[3]/this.accBinsSizeY);i++){if(i<0||i>=this.accBinsNumY)continue;const r=this.accBins[e][i];for(let i=0;i<r.length;i++){const e=r.data[i],a=e.info[this.visibilityGroup];if(a&&a.visible&&(e.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,E$L(a.aabr,s.aabr))))return !0}}return !1}_initBins(i,t){if(null==this.accBins){this.accBins=[];for(let i=0;i<this.accBinsNumX;i++){this.accBins.push([]);const i=this.accBins[this.accBins.length-1];for(let t=0;t<this.accBinsNumY;t++)i.push(new n$1l);}}else for(let s=0;s<this.accBinsNumX;s++)for(let i=0;i<this.accBinsNumY;i++)this.accBins[s][i].clear();this.accBinsSizeX=i/this.accBinsNumX,this.accBinsSizeY=t/this.accBinsNumY,this.accNumTests=0;}_addToBins(i){const t=i.info[this.visibilityGroup],s=Math.floor(t.aabr[0]/this.accBinsSizeX),e=Math.floor(t.aabr[2]/this.accBinsSizeX),r=Math.floor(t.aabr[1]/this.accBinsSizeY),a=Math.floor(t.aabr[3]/this.accBinsSizeY);for(let o=s;o<=e;o++)if(!(o<0||o>=this.accBinsNumX))for(let t=r;t<=a;t++)t<0||t>=this.accBinsNumY||this.accBins[o][t].push(i);}_setGraphicVisibility(i,t){const s=i.graphics3DGraphic;s.destroyed||(s.setVisibilityFlag(C$q.DECONFLICTION,t,this.visibilityGroup),this.visibilityGroup===E$v.LABEL&&this.view.labeler.setLabelGraphicVisibility(s,t));}};function li(i,t){const s=i.graphics3DGraphic;s.destroyed||s.clearVisibilityFlag(C$q.DECONFLICTION,t);}function*pi(i){if(Map.prototype.entries){const t=i.entries();for(let i=t.next();!i.done;i=t.next())yield i.value[1];}else yield*i.values();}function*ui(i,t,s){t.clear(),i.forEach(((i,e)=>{const r=t.pushNew();r.id=e,r.prio=i.info?-i.info[s].distance:Number.MAX_VALUE;})),yield;const e=t.iterableSort(((i,t)=>t.prio-i.prio));for(let r=e.next();!r.done;r=e.next())yield;t.forAll((t=>{const s=i.get(t.id);s&&(i.delete(t.id),i.set(t.id,s));})),t.clear();}e$Y([d$R({constructOnly:!0})],hi.prototype,"view",void 0),e$Y([d$R({type:Boolean,readOnly:!0})],hi.prototype,"updating",null),hi=e$Y([n$18("esri.views.3d.layers.graphics.Deconflictor")],hi);const di=n$1b();class fi{constructor(){this.positionView=n$16(),this.positionNDC=n$16(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}};}get isOutsideScreen(){const i=this.positionNDC;return i[0]<-1||i[1]<-1||i[2]<-1||i[0]>=1||i[1]>=1}}const mi=new fi;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const c$E=2e3;let n$R=class extends hi{constructor(){super(...arguments),this.visibilityGroup=E$v.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0;}get viewState(){return this.parent.viewState}runTask(r){if(this.parent.running)return;const t=performance.now();(r.state===N$q.IDLE||t-this._lastDeconfliction>c$E)&&(super.runTask(r),this.state===ci.Idle&&(this._lastDeconfliction=t));}enabledChanged(r,t){this.modifyGraphics(t,r.labelsEnabled);}getGraphicsLayers(r){return r.labelGraphics}};e$Y([d$R({constructOnly:!0})],n$R.prototype,"parent",void 0),n$R=e$Y([n$18("esri.views.3d.layers.graphics.LabelDeconflictor")],n$R);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let _$n=class extends hi{constructor(){super(...arguments),this._handles=new u$U,this._contexts=new Map,this._viewState=new ni,this.visibilityGroup=E$v.GRAPHIC,this._iconMarginFactor=-.1;}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([l$M((()=>this.view?.state?.camera),(()=>{this._updateViewState(),this.setDirty();})),l$M((()=>this.view?.map?.ground?.opacity),((e,t)=>{1!==e&&1!==t||this.setDirty();})),l$M((()=>this.view?.slicePlane),(()=>{this._updateSlicePlane(),this._slicePlaneChanged();}),h$V)]),this._frameTask=this.view.resourceController.scheduler.registerTask(L$D.GRAPHICS_DECONFLICTOR,this),this._labels=new n$R({view:this.view,parent:this});}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null);}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty();}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty());}runTask(e){super.runTask(e),this.running||this._labels.setDirty();}setInitialIconVisibilityFlag(e,t){const i=!(this._graphicSupportsDeconfliction(t)&&g$z(e));t.setVisibilityFlag(C$q.DECONFLICTION,i,E$v.GRAPHIC);}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane());}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;r$W(e)&&ls(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=r$W(e);}_slicePlaneChanged(){n$1m(this._contexts,((e,t)=>t.symbolCreationContext.slicePlaneEnabled))&&this.setDirty();}addGraphicsOwner(e){let t=this._contexts.get(e);return null==t&&(t=new Map,this._contexts.set(e,t),this.setDirty()),{addGraphic:i=>this._addGraphic(e,t,i),removeGraphic:e=>this._removeGraphic(t,e),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach((e=>this._removeGraphic(t,e.graphics3DGraphic)))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach((e=>this._removeGraphic(t,e.graphics3DGraphic))),this._contexts.delete(e),this.setDirty());}_addGraphic(e,t,i){const s=i.graphic.uid,r=new ei(i,e.symbolCreationContext.slicePlaneEnabled);t.set(s,r),g$z(e)&&this.addToActiveGraphics(r),e.labelsEnabled&&this._labels.addToActiveGraphics(r);}_removeGraphic(e,t){const i=t.graphic.uid,s=e.get(i);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(i),this.setDirty());}enabledChanged(e,t){const i=g$z(e);i||f$E(e),this.modifyGraphics(t,i);}_slicePlaneEnabledChanged(e,t){const i=e.symbolCreationContext.slicePlaneEnabled;t.forEach((e=>e.slicePlaneEnabled=i)),this.setDirty();}getGraphicsLayers(e){return e.graphics}_graphicSupportsDeconfliction(e){if(e.isDraped)return !1;const t=e.graphics;if(!t||!t.length)return !1;for(const i of t)if(this.layerSupportsDeconfliction(i))return !0;return !1}};function g$z(e){const t=e.layer;return !(!t||!t.featureReduction||"selection"!==t.featureReduction.type)}function f$E(e){const t=e.graphics3DGraphics;t&&t.forEach((e=>e.clearVisibilityFlag(C$q.DECONFLICTION)));}_$n=e$Y([n$18("esri.views.3d.layers.graphics.GraphicsDeconflictor")],_$n);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function m$y(e){return "declaredClass"in e}function u$C(e){return "declaredClass"in e}function l$z(e){return "declaredClass"in e}function c$D(r,t){if(!r)return null;if(l$z(r))return r;const s=new g$Y({layer:t,sourceLayer:t});return s.visible=r.visible,s.symbol=m$N(r.symbol),s.attributes=m$N(r.attributes),s.geometry=f$D(r.geometry),s}function f$D(e){return t$V(e)?null:m$y(e)?e:d$_(h$A(e))}function h$A(e){const n=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:r,y:t,z:s,m:a}=e;return {x:r,y:t,z:s,m:a,spatialReference:n}}case"polygon":{const{rings:r,hasZ:t,hasM:s}=e;return {rings:p$w(r),hasZ:t,hasM:s,spatialReference:n}}case"polyline":{const{paths:r,hasZ:t,hasM:s}=e;return {paths:p$w(r),hasZ:t,hasM:s,spatialReference:n}}case"extent":{const{xmin:r,xmax:t,ymin:s,ymax:a,zmin:i,zmax:o,mmin:m,mmax:u,hasZ:l,hasM:c}=e;return {xmin:r,xmax:t,ymin:s,ymax:a,zmin:i,zmax:o,mmin:m,mmax:u,hasZ:l,hasM:c,spatialReference:n}}case"multipoint":{const{points:r,hasZ:t,hasM:s}=e;return {points:M$k(r)?y$v(r):r,hasZ:t,hasM:s,spatialReference:n}}default:return}}function p$w(e){return x$q(e)?e.map((e=>y$v(e))):e}function y$v(e){return e.map((e=>l$Z(e)))}function x$q(e){for(const n of e)if(0!==n.length)return M$k(n);return !1}function M$k(e){return e.length&&(y$I(e[0])||A$G(e[0]))}function Z$9(e,n){if(!e)return null;let r;if(u$C(e)){if(null==n)return e.clone();if(u$C(n))return n.copy(e)}return null!=n?(r=n,r.x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=null,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=null,r.hasM=!1)):(r=v$Q(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function w$p(t,e){if("point"===t.type)return P$l(t,e,!1);if(m$y(t))switch(t.type){case"extent":return P$l(t.center,e,!1);case"polygon":return P$l(t.centroid,e,!1);case"polyline":return P$l(R$n(t),e,!0);case"mesh":return P$l(t.origin,e,!1)}else switch(t.type){case"extent":return P$l(A$p(t),e,!0);case"polygon":return P$l(M$j(t),e,!0);case"polyline":return P$l(R$n(t),e,!0)}}function R$n(t){const e=t.paths[0];if(!e||0===e.length)return null;const r=l$_(e,s$1l(e)/2);return v$Q(r[0],r[1],r[2],t.spatialReference)}function A$p(t){const e=isFinite(t.zmin);return v$Q(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),e?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function M$j(t){const e=t.rings[0];if(!e||0===e.length)return null;const r=o$1f(t.rings,t.hasZ);return v$Q(r[0],r[1],r[2],t.spatialReference)}function P$l(t,e,r){const n=r?t:Z$9(t);return e&&t?Pn(t,n,e)?n:null:n}function k$k(t,e,r,n=0){if(t){e||(e=u$T());const o=t;let i=.5*o.width*(r-1),s=.5*o.height*(r-1);return o.width<1e-7*o.height?i+=s/20:o.height<1e-7*o.width&&(s+=i/20),r$17(e,o.xmin-i-n,o.ymin-s-n,o.xmax+i+n,o.ymax+s+n),e}return null}function F$k(t,e){for(let r=0;r<t.geometries.length;++r){const n=t.geometries[r].getMutableAttribute(O$J.AUXPOS1);n&&n.data[3]!==e&&(n.data[3]=e,t.geometryVertexAttrsUpdated(t.geometryRecords[r]));}}function z$i(e,r){const n=t$1a(_$y);return r$W(e)&&(n[0]=e[0],n[1]=e[1],n[2]=e[2]),r$W(r)?n[3]=r:r$W(e)&&e.length>3&&(n[3]=e[3]),n}function B$k(e,r,n,o,i,s=[0,0,0,0]){for(let u=0;u<3;++u)r$W(e)&&null!=e[u]?s[u]=e[u]:r$W(n)&&null!=n[u]?s[u]=n[u]:s[u]=i[u];return r$W(r)?s[3]=r:r$W(o)?s[3]=o:s[3]=i[3],s}function D$f(t=l$$,r,n,o=1){const i=new Array(3);if(t$V(r)||t$V(n))i[0]=1,i[1]=1,i[2]=1;else {let e,o=0;for(let s=2;s>=0;s--){const u=t[s];let a;const l=null!=u,m=0===s&&!e&&!l,c=n[s];"symbol-value"===u||m?a=0!==c?r[s]/c:1:l&&"proportional"!==u&&isFinite(u)&&(a=0!==c?u/c:1),null!=a&&(i[s]=a,e=a,o=Math.max(o,Math.abs(a)));}for(let t=2;t>=0;t--)null==i[t]?i[t]=e:0===i[t]&&(i[t]=.001*o);}for(let e=2;e>=0;e--)i[e]/=o;return e$1d(i)}function I$n(t){return null!=t.isPrimitive}function O$w(t){return I$n(t)&&(t=[t.width,t.depth,t.height]),U$j(t)?null:"Symbol sizes may not be negative values"}function U$j(t){if(Array.isArray(t)){for(const e of t)if(!U$j(e))return !1;return !0}return null==t||t>=0}function S$u(t,e,s,u=e$10()){const a=t||0,l=e||0,m=s||0;return 0!==a&&m$P(u,u,-a/180*Math.PI),0!==l&&b$C(u,u,l/180*Math.PI),0!==m&&l$S(u,u,m/180*Math.PI),u}function V$g(t,e){return null!=e.minDemResolution?e.minDemResolution:S$G(t)?e.minDemResolutionForPoints:.01*z$v(t)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function f$C(e,t,n,o,r,s,a,l,c,u,f){const d=O$v[f.mode];let m,p,g=0;if(Un(e,t,n,o,c.spatialReference,r,l))return d.requiresAlignment(f)?(g=d.applyElevationAlignmentBuffer(o,r,s,a,l,c,u,f),m=s,p=a):(m=o,p=r),Un(m,c.spatialReference,p,s,u.spatialReference,a,l)?g:void 0}function d$D(n,o,r,i,s){const l=(t$1b(n)?n.z:a$1b(n)?n.array[n.offset+2]:n[2])||0;switch(r.mode){case"on-the-ground":{const e=c$$(i$18(o,n,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=e,void(s.z=e)}case"relative-to-ground":{const e=c$$(i$18(o,n,"ground"),0),a=r.geometryZWithOffset(l,i);return s.verticalDistanceToGround=a,s.sampledElevation=e,void(s.z=a+e)}case"relative-to-scene":{const e=c$$(i$18(o,n,"scene"),0),a=r.geometryZWithOffset(l,i);return s.verticalDistanceToGround=a,s.sampledElevation=e,void(s.z=a+e)}case"absolute-height":{const e=r.geometryZWithOffset(l,i),a=c$$(i$18(o,n,"ground"),0);return s.verticalDistanceToGround=e-a,s.sampledElevation=a,void(s.z=e)}default:return n$1i(r.mode),void(s.z=0)}}function m$x(e,t,n,o){return d$D(e,t,n,o,z$h),z$h.z}function p$v(e,t,n){return null==t||null==n?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===n?e.staysOnTheGround:t===n||"on-the-ground"!==t&&"on-the-ground"!==n?x$p.UPDATE:e.onTheGroundChanged}function g$y(e){return "relative-to-ground"===e||"relative-to-scene"===e}function v$u(e){return "absolute-height"!==e}function h$z(e,t,o,r,i){d$D(t,o,i,r,z$h),F$k(e,z$h.verticalDistanceToGround);const a=z$h.sampledElevation,c=n$15(U$i,e.transformation);C$p[0]=t.x,C$p[1]=t.y,C$p[2]=z$h.z;return qn(t.spatialReference,C$p,c,r.spatialReference)?e.transformation=c:console.warn("Could not locate symbol object properly, it might be misplaced"),a}function E$u(e,n,o,r,i,s){let a=0;const l=s.spatialReference;n*=3,r*=3;for(let c=0;c<i;++c){const i=e[n+0],c=e[n+1],u=e[n+2],f=c$$(s.getElevation(i,c,u,l,"ground"),0);a+=f,o[r+0]=i,o[r+1]=c,o[r+2]=f,n+=3,r+=3;}return a/i}function y$u(e,n,o,r,i,s,a,l){let c=0;const u=l.calculateOffsetRenderUnits(a),f=l.featureExpressionInfoContext,d=s.spatialReference;n*=3,r*=3;for(let m=0;m<i;++m){const i=e[n+0],a=e[n+1],l=e[n+2],m=c$$(s.getElevation(i,a,l,d,"ground"),0);c+=m,o[r+0]=i,o[r+1]=a,o[r+2]=null==f?l+m+u:m+u,n+=3,r+=3;}return c/i}function A$o(e,n,o,r,i,s,a,l){let c=0;const u=l.calculateOffsetRenderUnits(a),f=l.featureExpressionInfoContext,d=s.spatialReference;n*=3,r*=3;for(let m=0;m<i;++m){const i=e[n+0],a=e[n+1],l=e[n+2],m=c$$(s.getElevation(i,a,l,d,"scene"),0);c+=m,o[r+0]=i,o[r+1]=a,o[r+2]=null==f?l+m+u:m+u,n+=3,r+=3;}return c/i}function R$m(e){const t=e.meterUnitOffset,n=e.featureExpressionInfoContext;return 0!==t||null!=n}function T$r(e,t,n,o,r,i,s,a){const l=a.calculateOffsetRenderUnits(s),c=a.featureExpressionInfoContext;t*=3,o*=3;for(let u=0;u<r;++u){const r=e[t+0],i=e[t+1],s=e[t+2];n[o+0]=r,n[o+1]=i,n[o+2]=null==c?s+l:l,t+=3,o+=3;}return 0}class j$s{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0;}}var x$p;!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE";}(x$p||(x$p={}));const O$v={"absolute-height":{applyElevationAlignmentBuffer:T$r,requiresAlignment:R$m},"on-the-ground":{applyElevationAlignmentBuffer:E$u,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:y$u,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:A$o,requiresAlignment:()=>!0}},U$i=e$10(),z$h=new j$s,C$p=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function p$u(t,e,o,a){const r=t.stageObject,n=r.geometryRecords;let s=0;for(const i of n){const{update:t,averageGeometrySampledElevation:n}=O$u(i,e,o,a);s+=n,t&&r.geometryVertexAttrsUpdated(i);}return s/n.length}function d$C(t,o,r,s){const l=t.stageObject,f=o.centerPointInElevationSR;let u=0;if(l.metadata.usesVerticalDistanceToGround)d$D(f,r,o,s,M$i),F$k(l,M$i.verticalDistanceToGround),u=M$i.sampledElevation;else {d$D(f,r,o,s,M$i);"absolute-height"!==o.mode&&(u=M$i.sampledElevation);}const p=n$15(g$x,l.transformation),d=o$W(E$t,p[12],p[13],p[14]);t$E.TESTS_DISABLE_OPTIMIZATIONS?(T$q[0]=f.x,T$q[1]=f.y,T$q[2]=M$i.z,qn(f.spatialReference,T$q,p,s.spatialReference)&&(l.transformation=p)):s.setAltitudeOfTransformation(M$i.z,p);const I=S$t/s.unitInMeters;return (Math.abs(p[12]-d[0])>=I||Math.abs(p[13]-d[1])>=I||Math.abs(p[14]-d[2])>=I)&&(l.transformation=p),u}const g$x=e$10();function I$m(e,o,r,s){const l=e.graphics3DSymbolLayer.lodRenderer;if(t$V(l))return 0;const c=o.centerPointInElevationSR;d$D(c,r,o,s,M$i);const f="absolute-height"!==o.mode?M$i.sampledElevation:0,u=l.instanceData,p=e.instanceIndex,d=A$n;u.getGlobalTransform(p,d);const g=o$W(E$t,d[12],d[13],d[14]);t$E.TESTS_DISABLE_OPTIMIZATIONS?(T$q[0]=c.x,T$q[1]=c.y,T$q[2]=M$i.z,qn(c.spatialReference,T$q,d,s.spatialReference)&&u.setGlobalTransform(p,d)):s.setAltitudeOfTransformation(M$i.z,d);const I=S$t/s.unitInMeters;return (t$E.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(d[12]-g[0])>=I||Math.abs(d[13]-g[1])>=I||Math.abs(d[14]-g[2])>=I)&&u.setGlobalTransform(p,d),f}function b$r(t,e,o,a){const r=t.stageObject,n=r.geometryRecords;if(0===n.length)return 0;let s=0,i=null,l=0,c=!1;for(const m of n){const t=m.geometry.vertexAttributes.get(O$J.POSITION);if(t!==i){const{update:r,averageGeometrySampledElevation:n}=O$u(m,e,o,a);l=n,i=t,c=r;}c&&r.geometryVertexAttrsUpdated(m),s+=l;}return s/n.length}const S$t=.01,T$q=n$16(),h$y=n$16(),v$t=n$16(),A$n=e$10(),E$t=n$16(),M$i=new j$s;function O$u(t,e,o,a){let r=!1;const n=o.spatialReference,l=t.geometry,c=t.getShaderTransformation(),p=e.requiresSampledElevationInfo;h$y[0]=c[12],h$y[1]=c[13],h$y[2]=c[14],l.invalidateBoundingInfo();const d=l.getMutableAttribute(O$J.POSITION),g=d.data,I=l.vertexAttributes.get(O$J.MAPPOS).data,b=d.size,A=g.length/b,E=new t$1c(I,n);let O=0,y=0;for(let f=0;f<A;f++){if(v$t[0]=g[O],v$t[1]=g[O+1],v$t[2]=g[O+2],d$D(E,o,e,a,M$i),p&&(y+=M$i.sampledElevation),t$E.TESTS_DISABLE_OPTIMIZATIONS)g[O]=E.array[E.offset],g[O+1]=E.array[E.offset+1],g[O+2]=M$i.z,Un(g,n,O,g,a.spatialReference,O,1),g[O]-=h$y[0],g[O+1]-=h$y[1],g[O+2]-=h$y[2],r=!0;else {T$q[0]=g[O]+h$y[0],T$q[1]=g[O+1]+h$y[1],T$q[2]=g[O+2]+h$y[2],a.setAltitude(T$q,M$i.z),g[O]=T$q[0]-h$y[0],g[O+1]=T$q[1]-h$y[1],g[O+2]=T$q[2]-h$y[2];const t=S$t/a.unitInMeters;(Math.abs(v$t[0]-g[O])>=t||Math.abs(v$t[1]-g[O+1])>=t||Math.abs(v$t[2]-g[O+2])>=t)&&(r=!0);}O+=b,E.offset+=3;}return y/=A,{update:r,averageGeometrySampledElevation:y}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const n$Q=s$17.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function c$C(e){return {cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function o$z(e){const t=e&&e.expression;if("string"==typeof t){const e=p$t(t);if(null!=e)return {cachedResult:e}}return null}async function a$F(e,t,n){const c=e&&e.expression;if("string"!=typeof c)return null;const o=p$t(c);if(null!=o)return {cachedResult:o};const a=await a$1c(),u=a.arcadeUtils,s=u.createSyntaxTree(c);return u.dependsOnView(s)?(null!=n&&n.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:u.createFunction(s),context:u.createExecContext(null,{sr:t}),modules:a}}}function u$B(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function s$K(e,r){if(null!=e&&!f$B(e)){if(!r||!e.arcade)return void n$Q.errorOncePerTick("Arcade support required but not provided");const c=r;c._geometry&&(c._geometry=f$D(c._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,r);}}function l$y(e){if(null!=e){if(f$B(e))return e.cachedResult;const t=e.arcade;let r=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return "number"!=typeof r&&(e.cachedResult=0,r=0),r}return 0}function i$E(e,t=!1){let r=e&&e.featureExpressionInfo;const n=r&&r.expression;return t||"0"===n||(r=null),r}const d$B={cachedResult:0};function f$B(e){return null!=e.cachedResult}function p$t(e){return "0"===e?0:null}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class h$x{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null;}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(t){this._unit=t,this._metersPerElevationInfoUnit=r$18(t);}get requiresSampledElevationInfo(){return "absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters";}set offsetMeters(t){this._meterUnitOffset=t,this._renderUnitOffset=0;}set offsetElevationInfoUnits(t){this._meterUnitOffset=t*this._metersPerElevationInfoUnit,this._renderUnitOffset=0;}addOffsetRenderUnits(t){this._renderUnitOffset+=t;}geometryZWithOffset(t,e){const n=this.calculateOffsetRenderUnits(e);return null!=this.featureExpressionInfoContext?n:t+n}calculateOffsetRenderUnits(t){let e=this._meterUnitOffset;const n=this.featureExpressionInfoContext;return null!=n&&(e+=l$y(n)*this._metersPerElevationInfoUnit),e/t.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=n$1n(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=c$$(e.offset,0);}updateFeatureExpressionInfoContext(t,s,i){if(t$V(t))return void(this._featureExpressionInfoContext=null);const r=t&&t.arcade;r&&r$W(s)&&r$W(i)?(this._featureExpressionInfoContext=c$C(t),s$K(this._featureExpressionInfoContext,u$B(r.modules,s,i))):this._featureExpressionInfoContext=t;}static fromElevationInfo(t){const e=new h$x;return r$W(t)&&e.setFromElevationInfo(t),e}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var A$m;!function(A){A[A.INVISIBLE=0]="INVISIBLE",A[A.TRANSPARENT=1]="TRANSPARENT",A[A.OPAQUE=2]="OPAQUE";}(A$m||(A$m={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class p$s{constructor(e,t,s,i,a,r,n,o=null){this.graphics3DSymbolLayer=e,this.stageObject=t,this._uniqueGeometries=s,this._uniqueMaterials=i,this._sharedResource=a,this.elevationAligner=r,this.elevationContext=n,this._edgeState=o,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=e,this.stageObject=t;}get isElevationSource(){return !(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(e,t){this._stageLayer=t,this._stage=e,e.addMany(this._uniqueMaterials),e.addMany(this._uniqueGeometries),e.add(this.stageObject);}destroy(){const t=this._stage;this._stageLayer&&(t.removeMany(this._uniqueMaterials),t.removeMany(this._uniqueGeometries)),t.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const s=this._stage.renderView.ensureEdgeView();s.hasObject(this.stageObject)&&s.removeObject(this.stageObject),this.stageObject.dispose(),r$W(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null;}layerOpacityChanged(e,s){if(t$V(this._edgeState))return;const i=v$s(this._edgeState.baseMaterial);let a=!1;for(const t of this._edgeState.edgeMaterials)t.objectTransparency!==i&&(t.objectTransparency=i,a=!0);a&&this._resetEdgeObject(s);this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e]);}slicePlaneEnabledChanged(e,s){if(t$V(this._edgeState))return;this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!s),this._edgeState.properties.hasSlicePlane=e;}setVisibility(t){if(null!=this._stage&&this._visible!==t&&(this._visible=t,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),r$W(this._edgeState))){const e=this._stage.renderView.ensureEdgeView();e.hasObject(this.stageObject)?e.updateObjectVisibility(this.stageObject,t):t&&this._addOrUpdateEdgeObject(e,!1);}}get visible(){return this._visible}alignWithElevation(t,s,i,a){null!=this.elevationAligner&&(r$W(i)&&s$K(this.elevationContext.featureExpressionInfoContext,i),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,t,s),this._resetEdgeObject(a));}getCenterObjectSpace(e=n$16()){return r$V(e,E$K(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(e=a$1d()){const t=this.stageObject.boundingVolumeObjectSpace;return q$r(e,t.min),w$A(e,t.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const t=this.stageObject.transformation;e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++;}else for(const t of this.stageObject.geometryRecords)t.computeAttachmentOrigin(y$t)&&(L$E(y$t,y$t,this.stageObject.transformation),u$W(e.render.origin,e.render.origin,y$t),e.render.num++);}async getProjectedBoundingBox(e,t,i,r,n){const o=this.getBoundingBoxObjectSpace(n),c=E$s,h=S$G(o)?1:c.length;for(let s=0;s<h;s++){const e=c[s];S$s[0]=o[e[0]],S$s[1]=o[e[1]],S$s[2]=o[e[2]],L$E(S$s,S$s,this.stageObject.transformation),f$A[3*s+0]=S$s[0],f$A[3*s+1]=S$s[1],f$A[3*s+2]=S$s[2];}if(!e(f$A,0,h))return null;B$t(o);let u=null;this.calculateRelativeScreenBounds&&(u=this.calculateRelativeScreenBounds());for(let s=0;s<3*h;s+=3){for(let e=0;e<3;e++)o[e]=Math.min(o[e],f$A[s+e]),o[e+3]=Math.max(o[e+3],f$A[s+e]);u&&i.push({location:f$A.slice(s,s+3),screenSpaceBoundingRect:u});}if(t&&t.service&&"absolute-height"!==this.elevationContext.mode){p$11(o,y$t);const e="relative-to-scene"===this.elevationContext.mode?"scene":"ground";let i=0;if(t.useViewElevation)i=c$$(t.service.getElevation(y$t[0],y$t[1],e),0);else try{const a=V$g(o,t);i=c$$(await t.service.queryElevation(y$t[0],y$t[1],r,a,e),0);}catch(O){}V$p(o,0,0,-this.alignedSampledElevation+i);}return o}addObjectState(e,t){e===u$11.Highlight&&t.addObject(this.stageObject,this.stageObject.highlight()),e===u$11.MaskOccludee&&t.addObject(this.stageObject,this.stageObject.maskOccludee());}removeObjectState(e){e.removeObject(this.stageObject);}_resetEdgeObject(e){if(t$V(this._edgeState))return;const s=this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(s,e):s.removeObject(this.stageObject);}_addOrUpdateEdgeObject(e,s){const i=this._edgeState;if(t$V(i))return;const a=v$s(i.baseMaterial);for(const t of i.edgeMaterials)t.objectTransparency=a;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!s).then((()=>this._stageLayer?.sync()));}}function v$s(e){return e.isVisible?e.parameters.transparent?A$m.TRANSPARENT:A$m.OPAQUE:A$m.INVISIBLE}const f$A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S$s=n$16(),y$t=n$16(),E$s=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var e$I;!function(e){e[e.Recreate_Symbol=0]="Recreate_Symbol",e[e.Recreate_Graphics=1]="Recreate_Graphics",e[e.Fast_Update=2]="Fast_Update";}(e$I||(e$I={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class a$E{constructor(t){this.schedule=t,this._loadStatus=e$H.LOADING,this.logger=null;}destroy(){this.abortLoad();}get loadStatus(){return this._loadStatus}load(r,s){return this._loadStatus===e$H.LOADED?(r&&r(),e$X(this._loader)):this._loadStatus===e$H.FAILED?(s&&s(this._loadError),e$X(this._loader)):(t$V(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then((()=>{this._abortController=null,this._loadStatus=e$H.LOADED;}),(t=>{throw this._loadError=t,this._abortController=null,this._loadStatus=e$H.FAILED,!g$T(t)&&this.logger&&t.message&&this.logger.warn(t.message),t}))),this._loader.then(r,s).catch((()=>{})),this._loader)}abortLoad(){r$W(this._abortController)?this._abortController=h$T(this._abortController):this._loadStatus===e$H.LOADING&&(this._loadStatus=e$H.FAILED),this._loader=null;}}var e$H;!function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED";}(e$H||(e$H={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function n$P(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return !0}return !1}function t$C(n,t){const r=(n,a,r=!1)=>({levels:n.map((n=>{const c=a(n.tesselation);return r&&T$z.cgToGIS(c),{components:[{geometry:c,material:t}],faceCount:c.indexCount/3,minScreenSpaceRadius:n.minScreenSpaceRadius}}))});switch(n){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],(n=>T$z.createPolySphereGeometry(.5,n,!0)));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],(()=>T$z.createBoxGeometry(1)));case"cone":return r(a$D,(n=>T$z.createConeGeometry(1,.5,n,!1)),!0);case"inverted-cone":return r(a$D,(n=>T$z.createConeGeometry(1,.5,n,!0)),!0);case"cylinder":return r(a$D,(n=>T$z.createCylinderGeometry(1,.5,n,[0,0,1],[0,0,.5])));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],(()=>T$z.createTetrahedronGeometry(1)),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],(()=>T$z.createDiamondGeometry(1)),!0);default:return}}const a$D=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function t$B(t){return "fill"===t.type}function e$G(t){return "extrude"===t.type}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function a$C(e){return e&&e.enabled&&(e$G(e)||t$B(e))&&r$W(e.edges)}function u$A(e){return e&&e.enabled&&e.edges||null}function f$z(e,n){return p$r(u$A(e),n)}function p$r(i,c){if(t$V(i))return null;const l=r$W(i.color)?e$1a(l$T.toUnitRGBA(i.color)):r$Z(0,0,0,0),a=u$12(i.size),u=u$12(i.extensionLength);switch(i.type){case"solid":return m$w({color:l,size:a,extensionLength:u,...c});case"sketch":return h$w({color:l,size:a,extensionLength:u,...c});default:return}}function m$w(e){return {...g$w,...e,type:"solid"}}function h$w(e){return {...d$A,...e,type:"sketch"}}const g$w={color:r$Z(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:A$m.OPAQUE,hasSlicePlane:!1},d$A={color:r$Z(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:A$m.OPAQUE,hasSlicePlane:!1};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function r$H(r){const e=[];return r.levels.forEach((o=>{o.components.forEach((o=>{e.push(o.material);}));})),u$13(e)}function e$F(r){const e=new Array;return r.levels.forEach((o=>{o.components.forEach((o=>{o.textures&&e.push(...o.textures);}));})),u$13(e)}function n$O(r){const e=[];return r.components.forEach((o=>{e.push(o.geometry);})),u$13(e)}function t$A(r){const e=[];return r.levels.forEach((o=>{o.components.forEach((o=>{e.push(o.geometry);}));})),u$13(e)}function c$B(o){return n$O(o).reduce(((o,r)=>o+r.indexCount/3),0)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const b$q={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function P$k(e){if("web-style"===e.type)return b$q;return d$z(e.symbolLayers.toArray().map((r=>m$v(e,r))))}function d$z(e){let t=0,a=0,s=0,i=!1,o=0;const u={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const b of e)t$V(b)||(t+=b.primitivesPerFeature,a+=b.primitivesPerCoordinate,s+=b.drawCallsPerFeature,u.bytesPerFeature+=b.memory.bytesPerFeature,u.bytesPerFeatureLabel+=b.memory.bytesPerFeatureLabel,u.bytesPerCoordinate+=b.memory.bytesPerCoordinate,u.draped.bytesPerFeature+=b.memory.bytesPerFeature,u.draped.bytesPerFeatureLabel+=b.memory.bytesPerFeatureLabel,u.draped.bytesPerCoordinate+=b.memory.bytesPerCoordinate,i=i||b.estimated,++o);return {primitivesPerFeature:t,primitivesPerCoordinate:a,drawCallsPerFeature:s,estimated:i,memory:u,numComplexities:o}}function y$s(e){const r=d$z(e);return r.numComplexities>0&&(r.primitivesPerFeature/=r.numComplexities,r.primitivesPerCoordinate/=r.numComplexities,r.drawCallsPerFeature/=r.numComplexities,r.memory.bytesPerFeature/=r.numComplexities,r.memory.bytesPerFeatureLabel/=r.numComplexities,r.memory.bytesPerCoordinate/=r.numComplexities,r.memory.draped.bytesPerFeature/=r.numComplexities,r.memory.draped.bytesPerFeatureLabel/=r.numComplexities,r.memory.draped.bytesPerCoordinate/=r.numComplexities),r}const n$N={};function m$v(r,s){const o=l$x(r,s),u=a$C(s)?2:0;switch(s.type){case"extrude":return {primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:u,estimated:!1,memory:o};case"fill":return "mesh-3d"===r.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:u,estimated:!1,memory:o}:r$W(s.outline)&&s.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:o}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:o};case"water":return {primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:o};case"line":return {primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:o};case"object":if(s.resource&&s.resource.href)return {primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:o};return {...F$j(s.resource&&s.resource.primitive||d$$),memory:o};case"path":{const r=3,t=3,a=10;let i=0,u=0;switch(s.profile){case"circle":i=a;break;case"quad":i=4;break;default:return void n$1i(s.profile)}switch(s.join){case"round":u=r;break;case"miter":case"bevel":u=1;break;default:return void n$1i(s.join)}const b=2*i,P=i*u*2;let d=-2*P-b;switch(s.cap){case"none":break;case"butt":case"square":d+=2*(i-1);break;case"round":d+=2*(i*(t-1)*2+i);break;default:return}return {primitivesPerFeature:d,primitivesPerCoordinate:P+b,drawCallsPerFeature:0,estimated:!1,memory:o}}case"text":case"icon":return {primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:o};default:return}}function l$x(r,a){const s="point-3d"===r.type;switch(a.type){case"extrude":return a.edges&&a.edges.size>0?C$o.EXTRUDE_EDGES:C$o.EXTRUDE;case"fill":return r$W(a.outline)&&a.outline.size>0?C$o.FILL_OUTLINE:C$o.FILL;case"water":return C$o.FILL;case"line":return "round"===a.join?C$o.LINE_ROUND:C$o.LINE_MITER;case"path":switch(a.join){case"round":switch(a.profile){case"circle":return C$o.PATH_ROUND_CIRCLE;case"quad":return C$o.PATH_ROUND_QUAD;default:return void n$1i(a.profile)}case"miter":case"bevel":switch(a.profile){case"circle":return C$o.PATH_MITER_CIRCLE;case"quad":return C$o.PATH_MITER_QUAD;default:return void n$1i(a.profile)}default:return void n$1i(a.join)}case"object":return s?C$o.OBJECT_POINT:C$o.OBJECT_POLYGON;case"icon":case"text":return s?C$o.ICON_POINT:C$o.ICON_POLYGON;default:return}}function F$j(e){let r=n$N[e];if(r)return r;const t=t$C(e,null);return r={primitivesPerFeature:n$O(t.levels[0]).reduce(((e,r)=>e+r.indices.get(O$J.POSITION).length/3),0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},n$N[e]=r,r}const C$o={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const f$y=s$17.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class y$r extends a$E{constructor(e,t,i,o){super(i.schedule),this._context=i,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=f$y,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=e,this.symbolLayer=t,this._renderPriority=o.renderPriority,this._renderPriorityStep=o.renderPriorityStep,this._elevationContext=new h$x,this.complexity=this.computeComplexity(),this._ignoreDrivers=o.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=g$v(this._context.renderer)),this._updateElevationContext();}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this._ignoreDrivers)return !1;const t=this._drivenProperties,i=g$v(e);return i.color!==t.color||i.opacity!==t.opacity||i.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||i.size!==t.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,t,i,o){const r=e.projectionSuccess,n="polygons"in e?e.polygons:null,s=`${o} geometry failed to be created`;let a=null;r?!t.length||1===t.length&&!t[0].length?a=`${s} (no ${i} were defined)`:Array.isArray(t)&&Array.isArray(t[0])?n&&0===n.length&&"rings"===i&&t.length>0&&t[0].length>2&&(a=`${s} (filled rings should use clockwise winding - try reversing the order of vertices)`):a=`${s} (${i} should be defined as a 2D array)`:a=`${s} (failed to project geometry to view spatial reference)`,a&&f$y.warnOncePerTick(a);}_validateGeometry(e,t=null,o=null){if(r$W(t)&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+o+` symbol: ${e.type}`),!1;if("point"===e.type){const t=e;if(!isFinite(t.x)||!isFinite(t.y))return f$y.warn("point coordinate is not a valid number, graphic skipped"),!1}return !0}_defaultElevationInfoNoZ(){return m$u}_defaultElevationInfoZ(){return _$m}_updateElevationContext(){r$W(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset();}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,t=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext();}setGraphicElevationContext(e,t){const i=e$X(e.geometry),n=this.getDefaultElevationInfo(i);t.unit=null!=this._elevationContext.unit?this._elevationContext.unit:n.unit,t.mode=this.getGeometryElevationMode(i,n),t.offsetMeters=c$$(this._elevationContext.meterUnitOffset,c$$(n.offset,0));const s=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===t.mode;s&&(t.mode="relative-to-ground",t.offsetMeters=0);const a=s?d$B:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(a,e,this._context.layer),t}prepareSymbolLayerPatch(e){}updateGeometry(e,t){return !1}onRemoveGraphic(e){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const e=this._context.layer.opacity;return null==e?1:e}_getCombinedOpacity(e,t=x$o){let o=1;return this.draped||(o*=this._getLayerOpacity()),this._drivenProperties.opacity||(r$W(e)?o*=e.a:t.hasIntrinsicColor||(o=0)),o}_getCombinedOpacityAndColor(t,o=x$o){const r=this._getCombinedOpacity(t,o);if(this._drivenProperties.color)return z$i(null,r);const s=r$W(t)?l$T.toUnitRGB(t):l$$;return z$i(s,r)}_getVertexOpacityAndColor(e,t=null){const o=this._drivenProperties.color?e.color:null,r=this._drivenProperties.opacity?e.opacity:null,n=z$i(o,r);return r$W(t)&&(n[0]*=t,n[1]*=t,n[2]*=t,n[3]*=t),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return m$v(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,i){switch(e){case"opacity":return this.layerOpacityChanged(t,i);case"elevationInfo":{const e=this._elevationContext.mode;this._updateElevationContext();return this.layerElevationInfoChanged(t,i,e)!==x$p.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return !1}}updateGraphics3DGraphicElevationInfo(e,t,o){let r=x$p.UPDATE;return e.forEach((e=>{const n=t(e);if(r$W(n)){const t=e.graphic;this.setGraphicElevationContext(t,n.elevationContext),n.needsElevationUpdates=o(n.elevationContext.mode);}else r=x$p.RECREATE;})),r}applyRendererDiff(e,t){return e$I.Recreate_Symbol}getFastUpdateAttrValues(e){if(!this._fastUpdates.enabled)return null;const t=this._fastUpdates.visualVariables,i=t.size?v$r(t.size.field,e):0,o=t.color?v$r(t.color.field,e):0,r=t.opacity?v$r(t.opacity.field,e):0;return r$Z(i,o,r,0)}get draped(){return this._draped}ensureDrapedStatus(e){return null==this._draped?(this._draped=e,!0):(e!==this.draped&&f$y.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>({size:this._fastUpdates?.visualVariables?.size?.field??null,color:this._fastUpdates?.visualVariables?.color?.field??null,opacity:this._fastUpdates?.visualVariables?.opacity?.field??null,rotation:this._fastUpdates?.visualVariables?.rotation?.field??null});return {drivenProperties:this._drivenProperties,getVisVarFields:e}}}function v$r(e,t){const i=null!=e?t.attributes[e]:0;return null!=i&&isFinite(i)?i:0}function g$v(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach((e=>{switch(e.type){case"color":if(t.color=!0,e.stops)for(let i=0;i<e.stops.length;i++){const o=e.stops[i].color;o&&(t.opacity=!0,o.a<1&&(t.opacityAlwaysOpaque=!1));}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0;}})),t}const m$u={mode:"on-the-ground",offset:0,unit:"meters"},_$m={mode:"absolute-height",offset:0,unit:"meters"},x$o={hasIntrinsicColor:!1};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class o$y{constructor(){this._disposed=!1;}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(t,r,i,o,e,a){this.id=e$1e(),this.geometry=t,this.material=r,this.transformation=i,this.instanceParameters=o,this.origin=e,this._shaderTransformation=a,this._disposed=!1;}release(){this._disposed=!1;}dispose(){this._disposed=!0;}getStaticTransformation(){return this.transformation}getShaderTransformation(){return r$W(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(t){return !!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,t):this.geometry.computeAttachmentOrigin(t))&&(L$E(t,t,this.getStaticTransformation()),!0)}}o$y.pool=new e$1f(o$y);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class r$G{constructor(r){this.channel=r,this.id=e$1e();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class O$t extends r$19{constructor(t={}){super(),this.type=e$1g.Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=e$10(),this._bvObjectSpace=new R$l,this._bvWorldSpace=new R$l,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=null==t.castShadow||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new L$n),this.transformation=e$10();const{geometries:e,materials:s,transformations:i,origins:r}=t;if(Array.isArray(e)){e$18(s.length===e.length,"Object3D: materials don't match geometries"),e$18(i.length===e.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=e.length,this._geometries.length=e.length;for(let t=0;t<e.length;t++)this._geometries[t]=e[t],this._geometryRecords[t]=o$y.pool.acquire(e[t],s[t],r$1a(i[t]),{highlights:null,occludees:null,visible:this._visible},r&&r[t]);}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(t){n$15(this._objectTransformation,t),this._invalidateBoundingVolume(),this._emit("objectTransformation",this);}dispose(){this._geometryRecords.length=0,this._geometries.length=0;}get parentLayer(){return this._parentLayer}set parentLayer(t){e$18(null==this._parentLayer||null==t,"Object3D can only be added to a single Layer"),this._parentLayer=t;}addGeometry(e,s,i,r,o){i=i||o$1g,this._geometries.push(e);const a=o$y.pool.acquire(e,s,i,{highlights:null,occludees:null,visible:this._visible},r,o);return this._geometryRecords.push(a),this._hasVolatileTransformation=this._hasVolatileTransformation||r$W(a.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:a}),this._invalidateBoundingVolume(),a}removeGeometry(e){const s=this._geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=r$W(s.shaderTransformation)?this._geometryRecords.some((e=>r$W(e.shaderTransformation))):this._hasVolatileTransformation,s.dispose(),this._geometries.splice(e,1),this._emit("objectGeometryRemoved",{object:this,record:s}),this._invalidateBoundingVolume(),s}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0);}geometryVertexAttrsUpdated(t){this._emit("vertexAttrsUpdated",{object:this,record:t}),this._invalidateBoundingVolume();}get isVisible(){return this._visible}setVisible(t){if(this._visible!==t){this._visible=t;for(const t of this._geometryRecords)t.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this);}}maskOccludee(){const t=new r$G(u$11.MaskOccludee);for(const e of this._geometryRecords)e.instanceParameters.occludees=c$1b(e.instanceParameters.occludees,t);return this._emit("occlusionChanged",this),t}removeOcclude(t){for(const e of this._geometryRecords)e.instanceParameters.occludees=f$$(e.instanceParameters.occludees,t);this._emit("occlusionChanged",this);}highlight(){const t=new r$G(u$11.Highlight);for(const e of this._geometryRecords)e.instanceParameters.highlights=c$1b(e.instanceParameters.highlights,t);return this._emit("highlightChanged",this),t}removeHighlight(t){for(const e of this._geometryRecords)e.instanceParameters.highlights=f$$(e.instanceParameters.highlights,t);this._emit("highlightChanged",this);}getCombinedStaticTransformation(t,s){return u$Z(c$$(s,e$10()),this.transformation,t.getStaticTransformation())}_getCombinedShaderTransformation(t,e){return e=e||e$10(),u$Z(e,this.transformation,t.getShaderTransformation()),e}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let s=0;s<this._geometryRecords.length;++s){const e=this._geometries[s],i=this._geometryRecords[s],r=e.boundingInfo;r$W(r)&&(this._calculateTransformedBoundingVolume(r,this._bvObjectSpace,i.getShaderTransformation()),this._calculateTransformedBoundingVolume(r,this._bvWorldSpace,this._getCombinedShaderTransformation(i)));}A$C(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),A$C(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=n$16(),i=n$16(),r=l$10(this.transformation);for(let t=0;t<this._geometryRecords.length;++t){const o=this._geometries[t].boundingInfo;if(t$V(o))continue;const a=this._geometryRecords[t].getShaderTransformation(),n=l$10(a);L$E(e,o.getCenter(),a);const h=x$H(e,this._bvObjectSpace.bounds),l=o.getBSRadius()*n;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],h+l),L$E(i,e,this.transformation);const d=x$H(i,this._bvWorldSpace.bounds),g=l*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],d+g);}this._bvDirty=!1;}_calculateTransformedBoundingVolume(t,e,s){const i=t.getBBMin(),r=t.getBBMax(),o=t$12(i),a=t$12(r);L$E(o,o,s),L$E(a,a,s);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],o[n],a[n]),e.max[n]=Math.max(e.max[n],o[n],a[n]);for(let n=0;n<3;++n){r$V(o,i),r$V(a,r),o[n]=r[n],a[n]=i[n],L$E(o,o,s),L$E(a,a,s);for(let t=0;t<3;++t)e.min[t]=Math.min(e.min[t],o[t],a[t]),e.max[t]=Math.max(e.max[t],o[t],a[t]);}}_invalidateBoundingVolume(){this._bvDirty=!0,r$W(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds);}_emit(e,s){r$W(this._parentLayer)&&this._parentLayer.events.emit(e,s);}get test(){const t=this;return {hasGeometry:e=>t._geometries.includes(e),getGeometryIndex:e=>t._geometries.indexOf(e)}}}class L$n{constructor(){this.min=r$X(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=r$X(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class R$l extends L$n{constructor(){super(...arguments),this.bounds=_$x();}init(){o$W(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o$W(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),O$M(this.bounds);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const u$z=n$16();function f$x(r,i,s,a,c,p,f,g){const d=s?s.length:0,h=r.clippingExtent;if(Hn(i,u$z,r.elevationProvider.spatialReference),r$W(h)&&!E$M(h,u$z))return null;Hn(i,u$z,r.renderCoordsHelper.spatialReference);const j=r.localOriginFactory.getOrigin(u$z),y=new O$t({castShadow:!1,metadata:{layerUid:p,graphicUid:f,usesVerticalDistanceToGround:!0}});for(let e=0;e<d;e++){const r=o$1g;y.addGeometry(s[e],a[e],r,j,g);}return {object:y,sampledElevation:h$z(y,i,r.elevationProvider,r.renderCoordsHelper,c)}}function g$u(e,t,r){const n=e.elevationContext,i=r.spatialReference;Hn(t,u$z,i),n.centerPointInElevationSR=v$Q(u$z[0],u$z[1],t.hasZ?u$z[2]:0,i);}function d$y(e){switch(e.type){case"point":return e;case"polygon":case"extent":return w$p(e);case"polyline":{const t=e.paths[0];if(!t||0===t.length)return null;const r=l$_(t,s$1l(t)/2);return v$Q(r[0],r[1],r[2],e.spatialReference)}case"mesh":return e.origin}return null}function h$v(e,t,r,o,n){const i=new Float64Array(3*e.length),s=new Float64Array(i.length);e.forEach(((e,t)=>{i[3*t+0]=e[0],i[3*t+1]=e[1],i[3*t+2]=e.length>2?e[2]:0;}));const a=f$C(i,t,0,s,0,i,0,i.length/3,r,o,n),l=null!=a;return {numVertices:e.length,position:i,mapPosition:s,projectionSuccess:l,sampledElevation:a}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function S$r(o){const r=new i$_;r.include(c$O),r.include(u$E,o),r.include(u$$,o),r.attributes.add(O$J.UV0,"vec2");const{vertex:S,fragment:u}=r;return S.uniforms.add([new e$19("viewport",((e,i)=>i.camera.fullViewport)),new o$_("lineSize",((e,i)=>Math.ceil(e.size)*i.camera.pixelRatio)),new e$$("pixelToNDC",((e,o)=>r$Y(m$t,2/o.camera.fullViewport[2],2/o.camera.fullViewport[3]))),new o$_("borderSize",((i,o)=>r$W(i.borderColor)?o.camera.pixelRatio:0)),new e$$("screenOffset",((e,o)=>r$Y(m$t,e.screenOffset[0]*o.camera.pixelRatio,e.screenOffset[1]*o.camera.pixelRatio)))]),r.varyings.add("coverageSampling","vec4"),r.varyings.add("lineSizes","vec2"),o.hasMultipassGeometry&&r.varyings.add("depth","float"),o.hasScreenSizePerspective&&i$15(S),S.code.add(n$19`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${o.occlusionTestEnabled?n$19`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${o.hasScreenSizePerspective?n$19`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:n$19`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${o.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${o.depthHudEnabled?o.depthHudAlignStartEnabled?n$19`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:n$19`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${o.hasScreenSizePerspective?n$19`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:n$19`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),u.uniforms.add([new e$19("uColor",(e=>v$q(e.color))),new e$19("borderColor",(e=>v$q(e.borderColor)))]),o.hasMultipassGeometry&&(u.include(a$Q,o),u.uniforms.add(new e$$("inverseViewport",((e,i)=>i.inverseViewport)))),u.code.add(n$19`
    void main() {
      ${o.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${o.depthHudEnabled?n$19`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:n$19`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),r}function v$q(i){return r$W(i)?i:l$W}const m$t=n$1b(),u$y=Object.freeze(Object.defineProperty({__proto__:null,build:S$r},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class h$u extends e$11{initializeConfiguration(i,t){t.spherical=i.viewingMode===l$O.Global;}initializeProgram(e){const i=h$u.shader.get().build(this.configuration);return new o$Z(e.rctx,i,E$E)}setPipelineState(e){const i=e?I$y.ALWAYS:I$y.LESS;return this.configuration.depthHudEnabled?W$h({depthTest:{func:i},depthWrite:a$1a}):W$h({blending:l$P(R$u.ONE,R$u.SRC_ALPHA,R$u.ONE_MINUS_SRC_ALPHA,R$u.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:c$10})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}h$u.shader=new t$W(u$y,(()=>import('./LineCallout.glsl-d04e2faf.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class i$D extends i$17{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=p$z.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1;}}e$Y([e$12({count:p$z.COUNT})],i$D.prototype,"screenCenterOffsetUnitsEnabled",void 0),e$Y([e$12()],i$D.prototype,"spherical",void 0),e$Y([e$12()],i$D.prototype,"occlusionTestEnabled",void 0),e$Y([e$12()],i$D.prototype,"hasVerticalOffset",void 0),e$Y([e$12()],i$D.prototype,"hasScreenSizePerspective",void 0),e$Y([e$12()],i$D.prototype,"depthHudEnabled",void 0),e$Y([e$12()],i$D.prototype,"depthHudAlignStartEnabled",void 0),e$Y([e$12()],i$D.prototype,"hasSlicePlane",void 0),e$Y([e$12()],i$D.prototype,"hasMultipassGeometry",void 0),e$Y([e$12({constValue:!0})],i$D.prototype,"hasSliceInVertexProgram",void 0),e$Y([e$12({constValue:!1})],i$D.prototype,"isDraped",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class g$t extends d$X{constructor(e){super(e,new S$q),this.techniqueConfig=new i$D,this._uniqueMaterialIdentifier=g$t.uniqueMaterialIdentifier(this.parameters);}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}getPassParameters(){return this.parameters}getConfiguration(t,r){const i=r?.slot!==E$G.LINE_CALLOUTS;return this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.hasVerticalOffset=r$W(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=r$W(this.parameters.screenSizePerspective),this.techniqueConfig.depthHudEnabled=i,this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?p$z.Screen:p$z.World,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasMultipassGeometry=!!r&&r.multipassGeometry.enabled,this.techniqueConfig}intersect(){}requiresSlot(e){switch(e){case E$G.LINE_CALLOUTS:case E$G.LINE_CALLOUTS_HUD_DEPTH:return !0}return !1}createGLMaterial(e){return e.output===o$19.Color?new O$s(e):null}createBufferWriter(){return new C$n}validateParameters(e){const t=g$t.uniqueMaterialIdentifier(e);t!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=t);}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}}class O$s extends t$1d{beginSlot(e){return this.ensureTechnique(h$u,e)}}class S$q extends o$1h{constructor(){super(...arguments),this.screenOffset=f$S,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1;}}const q$f=T$C().vec3f(O$J.POSITION).vec3f(O$J.NORMAL).vec2f(O$J.UV0).vec4f(O$J.AUXPOS1),L$m=[t$_(0,0),t$_(1,0),t$_(0,1),t$_(1,0),t$_(1,1),t$_(0,1)];class C$n{constructor(){this.vertexBufferLayout=q$f;}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(O$J.POSITION).length}write(e,t,r,i){p$10(t.indices.get(O$J.POSITION),t.vertexAttributes.get(O$J.POSITION).data,e.transformation,r.position,i,6),B$s(t.indices.get(O$J.NORMAL),t.vertexAttributes.get(O$J.NORMAL).data,e.invTranspTransformation,r.normal,i,6),d$Z(t.indices.get(O$J.AUXPOS1),t.vertexAttributes.get(O$J.AUXPOS1).data,r.auxpos1,i,6);for(let s=0;s<L$m.length;++s)r.uv0.setVec(i+s,L$m[s]);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class b$p extends y$r{constructor(e,t){super(e,null,t,U$h),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1);}async doLoad(){this._material=new g$t(this.materialParameters),this._context.stage.add(this._material);}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null;}_perInstanceMaterialParameters(e){const t=this.materialParameters;return t.screenOffset=e.screenOffset||f$S,t.centerOffsetUnits=e.centerOffsetUnits||"world",t}get materialParameters(){const r=this.symbol,a=r.callout,n=r$W(a.color)?l$T.toUnitRGBA(a.color):[0,0,0,0];n[3]*=this._getLayerOpacity();const s=u$12(a.size||0);let o=null;if(r.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:a}=r.verticalOffset;o={screenLength:u$12(e),minWorldLength:t||0,maxWorldLength:null!=a?a:1/0};}const l=r$W(a.border)&&r$W(a.border.color)?l$T.toUnitRGBA(a.border.color):null,c="object"===r.symbolLayers.getItemAt(0).type,m=!c,d=c?0:void 0,h="label-3d"===r.type;return {color:n,size:s,verticalOffset:o,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:l,occlusionTest:m,shaderPolygonOffset:d,depthHUDAlignStart:h,hasSlicePlane:this._context.slicePlaneEnabled,renderOccluded:h$Z.Occlude,__tagStrict:"NoParameters"}}_defaultElevationInfoNoZ(){return E$r}createGraphics3DGraphic(e){const t=e.renderingInfo,i=e.graphic,a=this.setGraphicElevationContext(i,new h$x,t.elevationOffset||0),s=t.symbol,o="on-the-ground"===this._elevationContext.mode&&("cim"===s.type||!s.symbolLayers.some((e=>"object"===e.type||"text"===e.type)));if("label-3d"!==s.type&&o)return null;if("point-3d"===s.type&&s.symbolLayers.every((e=>"text"===e.type&&!i$19(e))))return null;const l=w$p(i.geometry);return t$V(l)?null:this._createAs3DShape(l,a,t,i.uid)}layerOpacityChanged(){return t$V(this._material)||this._material.setParameters(this.materialParameters),!0}layerElevationInfoChanged(e,r,i){const a=this._elevationContext.mode,n=p$v(b$p.elevationModeChangeTypes,i,a);return n!==x$p.UPDATE||e.forEach((e=>{const i=r(e);r$W(i)&&this.updateGraphicElevationContext(e.graphic,i);})),n}slicePlaneEnabledChanged(){return t$V(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return !0}pixelRatioChanged(){return !0}setGraphicElevationContext(e,t,r=0){const i=super.setGraphicElevationContext(e,t);return i.addOffsetRenderUnits(r),i}updateGraphicElevationContext(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata.elevationOffset),t.needsElevationUpdates=g$y(t.elevationContext.mode);}computeComplexity(){return {primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:b$q.memory}}_createVertexData(e){const{translation:t,centerOffset:r}=e,i=t?{size:3,data:[t[0],t[1],t[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0},a=r?{size:4,data:[r[0],r[1],r[2],r[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0};return [[O$J.POSITION,i],[O$J.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[O$J.AUXPOS1,a]]}_getOrCreateMaterial(e){const i=this._perInstanceMaterialParameters(e),a=g$t.uniqueMaterialIdentifier(i);if(r$W(this._material)&&a===this._material.uniqueMaterialIdentifier)return {material:this._material,isUnique:!1};if(e.materialCollection){let t=e.materialCollection.get(a);return t$V(t)&&(t=new g$t(i),e.materialCollection.add(a,t)),{material:t,isUnique:!1}}return {material:new g$t(i),isUnique:!0}}_createAs3DShape(e,t,r,i){const a=[new g$S(this._createVertexData(r),P$j,c$12.Point)],n=this._getOrCreateMaterial(r),o=f$x(this._context,e,a,[n.material],t,this._context.layer.uid,i);if(null===o)return null;const l=new p$s(this,o.object,a,n.isUnique?[n.material]:null,null,d$C,t);return l.metadata={elevationOffset:r.elevationOffset||0},l.alignedSampledElevation=o.sampledElevation,l.needsElevationUpdates=g$y(t.mode),g$u(l,e,this._context.elevationProvider),l}}b$p.elevationModeChangeTypes={definedChanged:x$p.UPDATE,staysOnTheGround:x$p.UPDATE,onTheGroundChanged:x$p.RECREATE};const C$m=new Uint16Array([0]),P$j=[[O$J.POSITION,C$m],[O$J.NORMAL,C$m],[O$J.AUXPOS1,C$m]],E$r={mode:"relative-to-ground",offset:0},U$h={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const t$z=s$17.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function e$E(o,l){if(!o$1i(o))return t$z.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${o.type}' does not support callouts`),null;if(!o.callout)return null;const e=a$B[o.callout.type];return e?new e(o,l):(t$z.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${o.callout.type}`),null)}const a$B={line:b$p};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class r$F{constructor(r,s,t){this.graphic=r,this.renderingInfo=s,this.layer=t;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const v$p=new e$1f(Array,(i=>A$H(i,H$p)),null,10,5),S$p=u$T();class B$j{constructor(i,e,r,s,a){this.graphic=i,this.graphics3DSymbol=e,this.graphics=r,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=V$f(E$v._COUNT,C$q._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++e.referenced,this._featureExpressionFeature=a?u$B(a,i,s):null;for(const o of r)r$W(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource);}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(i,e){this._layer=e,this._stage=i,this._forEachSymbolLayerGraphic((t=>{t.initialize(i,e),t.setVisibility(this.isVisible());}));}destroy(){this._forEachSymbolLayerGraphic((i=>i.destroy())),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null;}get destroyed(){return null==this.graphics}clearLabelGraphics(){this._forEachLabelGraphic((i=>i.destroy())),this._labelGraphics.length=0;}addLabelGraphic(i,e,t){this._labelGraphics.push(i),i.initialize(e,t),i.setVisibility(this.isVisible(E$v.LABEL));}addAuxiliaryGraphic(i){this._auxiliaryGraphics.push(i),this._layer&&(i.initialize(this._stage,this._layer),i.setVisibility(this.isVisible()));}get isDraped(){let i=!1;return this._forEachSymbolLayerGraphic((e=>{"draped"===e.type&&(i=!0);})),i}isVisible(i=E$v.GRAPHIC,e){for(let t=0;t<=i;t++){const i=this._visibilityFlags[t];for(let t=0;t<i.length;++t)if(!1===i[t]&&t!==e)return !1}return !0}hasVisibilityFlag(i,e){return null!=this._visibilityFlags[e][i]}setVisibilityFlag(i,e,t){const r=this.isVisible(t);this._visibilityFlags[t][i]=e;const s=this.isVisible(t);if(r===s)return !1;if(t===E$v.LABEL)this._forEachLabelGraphic((i=>i.setVisibility(s)));else {this._forEachSymbolLayerGraphic((i=>i.setVisibility(s)));const i=this.isVisible(E$v.LABEL);this._forEachLabelGraphic((e=>e.setVisibility(i)));}return !0}clearVisibilityFlag(i,e=E$v.GRAPHIC){return this.setVisibilityFlag(i,void 0,e)}computeExtent(i){if(!this._extent){const e=this.graphic.geometry;if(t$V(e))return !1;this._extent=u$T(),J$h(e,this._extent);const t=e.spatialReference;if(!t.equals(i)&&!zn(this._extent,t,this._extent,i))return this._extent=null,!1}return !0}getAsOptimizedGeometry(i,e){return r$W(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===i&&this._optimizedGeometry.hasM===e||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,i,e),this._optimizedGeometry.hasZ=i,this._optimizedGeometry.hasM=e),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(i,e,t){let r=i.geometry;return "mesh"!==r.type&&"extent"!==r.type||(r=v$R.fromExtent("mesh"===r.type?r.extent:r)),te$8(r,e,t)}get usedMemory(){let i=r$1b(this.graphic.attributes);return this._forEachSymbolLayerGraphic((e=>{const t=e.graphics3DSymbolLayer.complexity;if(t$V(t))return;const s="draped"===e.type?t.memory.draped:t.memory;i+=s.bytesPerFeature,s.bytesPerCoordinate&&(i+=w$B(this.graphic.geometry)*s.bytesPerCoordinate);})),i}computeAttachmentOrigin(){const i={render:{origin:n$16(),num:0},draped:{origin:n$1b(),num:0}};for(const e of this.graphics)t$V(e)||e.computeAttachmentOrigin(i);return i.render.num&&q$p(i.render.origin,i.render.origin,1/i.render.num),i.draped.num&&l$11(i.draped.origin,i.draped.origin,1/i.draped.num),i}async getProjectedBoundingBox(e,t,s,a,o){return o||(o={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),o.boundingBox?B$t(o.boundingBox):o.boundingBox=B$t(),o.requiresDrapedElevation=!1,await n$1o(this.graphics,(async i=>{if(t$V(i))return;const h="draped"===i.type?t:e,n=v$p.acquire(),c=await i.getProjectedBoundingBox(h,s,o.screenSpaceObjects,a,n);isFinite(c[2])&&isFinite(c[5])||(o.requiresDrapedElevation=!0),c&&f$10(o.boundingBox,n),v$p.release(n);})),l$12(o.boundingBox)||M$w(G$p(o.boundingBox,S$p))?o:null}needsElevationUpdates(){for(const i of this.graphics)if(r$W(i)&&("object3d"===i.type||"lod-instance"===i.type)&&i.needsElevationUpdates)return !0;for(const i of this._labelGraphics)if(i&&i.needsElevationUpdates)return !0;return !1}alignWithElevation(i,e,t){this._forEachRenderedGraphic((r=>{"object3d"!==r.type&&"lod-instance"!==r.type||r.alignWithElevation(i,e,this._featureExpressionFeature,t);}));}addObjectStateSet(i,e){this._forEachSymbolLayerGraphic((t=>t.addObjectState(i,e)));}removeObjectState(i){this._forEachSymbolLayerGraphic((e=>e.removeObjectState(i)));}_forEachGraphicList(i,e){i.forEach((i=>i&&e(i)));}_forEachSymbolLayerGraphic(i){this._forEachGraphicList(this.graphics,i),this._forEachGraphicList(this._auxiliaryGraphics,i);}_forEachLabelGraphic(i){this._forEachGraphicList(this._labelGraphics,i);}_forEachRenderedGraphic(i){this._forEachSymbolLayerGraphic(i),this._forEachLabelGraphic(i);}}function V$f(i,e){const t=new Array(i);for(let r=0;r<t.length;r++)t[r]=new Array(e);return t}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function i$C(e,o){if(!e||e.symbol)return null;const r=o&&o.renderer;return e&&r$W(r)&&r.getObservationRenderer?r.getObservationRenderer(e):r}function n$M(e,o){if(r$W(e.symbol))return e.symbol;const r=i$C(e,o);return r$W(r)&&"dot-density"!==r.type?r.getSymbol(e,o):null}function a$A(e,t){const a=i$C(e,t),l=n$M(e,t);if(t$V(l))return null;const s={renderer:a,symbol:l};if(t$V(a)||!("visualVariables"in a)||!a.visualVariables)return s;const u=N$r(a,e,t),c=["proportional","proportional","proportional"];for(const{variable:o,value:r}of u)switch(o.type){case"color":s.color=r.toRgba();break;case"size":if("outline"===o.target)s.outlineSize=r;else {const e=o.axis,t=o.useSymbolValue?"symbol-value":r;switch(e){case"width":c[0]=t;break;case"depth":c[1]=t;break;case"height":c[2]=t;break;case"width-and-depth":c[0]=c[1]=t;break;default:c[0]=c[1]=c[2]=t;}}break;case"opacity":s.opacity=r;break;case"rotation":switch(o.axis){case"tilt":s.tilt=r;break;case"roll":s.roll=r;break;default:s.heading=r;}}return "proportional"===c[0]&&"proportional"===c[1]&&"proportional"===c[2]||(s.size=c),s}async function l$w(e,o){if(r$W(e.symbol))return e.symbol;const r=i$C(e,o);return r$W(r)&&r.getSymbolAsync(e,o)}async function s$J(t,o){const n=i$C(t,o),a=await l$w(t,o);if(!a)return null;const s={renderer:n,symbol:a};if(!n||!("visualVariables"in n)||!n.visualVariables)return s;const u=N$r(n,t,o),c=["proportional","proportional","proportional"];for(const{variable:r,value:i}of u)if("color"===r.type)s.color=l$T.toUnitRGBA(i);else if("size"===r.type)if("outline"===r.target)s.outlineSize=i;else {const e=r.axis,t=r.useSymbolValue?"symbol-value":i;"width"===e?c[0]=t:"depth"===e?c[1]=t:"height"===e?c[2]=t:c[0]=c[1]="width-and-depth"===e?t:c[2]=t;}else "opacity"===r.type?s.opacity=i:"rotation"===r.type&&"tilt"===r.axis?s.tilt=i:"rotation"===r.type&&"roll"===r.axis?s.roll=i:"rotation"===r.type&&(s.heading=i);return (isFinite(c[0])||isFinite(c[1])||isFinite(c[2]))&&(s.size=c),s}function u$x(e,t=0){const o=e[t];return "number"==typeof o&&isFinite(o)?o:null}function c$A(e){for(let t=0;t<3;t++){const o=e[t];if("number"==typeof o)return isFinite(o)?o:0}return 0}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var e$D,t$y;!function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features";}(e$D||(e$D={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage";}(t$y||(t$y={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var T$p,O$r,E$q,S$o,H$e,A$l;!function(T){T[T.INNER=0]="INNER",T[T.OUTER=1]="OUTER";}(T$p||(T$p={})),function(T){T[T.REGULAR=0]="REGULAR",T[T.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",T[T.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",T[T.HAS_BOTH_POLES=3]="HAS_BOTH_POLES";}(O$r||(O$r={})),function(T){T[T.NORTH=0]="NORTH",T[T.NORTH_EAST=1]="NORTH_EAST",T[T.EAST=2]="EAST",T[T.SOUTH_EAST=3]="SOUTH_EAST",T[T.SOUTH=4]="SOUTH",T[T.SOUTH_WEST=5]="SOUTH_WEST",T[T.WEST=6]="WEST",T[T.NORTH_WEST=7]="NORTH_WEST";}(E$q||(E$q={})),function(T){T[T.OFF=0]="OFF",T[T.ON=1]="ON";}(S$o||(S$o={})),function(T){T[T.Color=0]="Color",T[T.ColorNoRasterImage=1]="ColorNoRasterImage",T[T.Highlight=2]="Highlight",T[T.Water=3]="Water",T[T.Occluded=4]="Occluded";}(H$e||(H$e={})),function(T){T[T.FADING=0]="FADING",T[T.IMMEDIATE=1]="IMMEDIATE",T[T.UNFADED=2]="UNFADED";}(A$l||(A$l={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class r$E{constructor(n,t){this.vec3=n,this.id=t;}}function s$I(t,s){return new r$E(t$12(t),s)}function c$z(n,s,c,e){return new r$E(r$X(n,s,c),e)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var h$t;!function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded";}(h$t||(h$t={}));class l$v{constructor(e,r){this.index=e,this.renderTargets=r,this._extent=u$T(),this.resolution=0,this.renderLocalOrigin=c$z(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new u$w,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(r.renderTargets.length).fill(!1);}get extent(){return this._extent}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const t=e===h$t.ColorAndWater?this.renderTargets.getTarget(H$e.Color):e===h$t.Highlight?this.renderTargets.getTarget(H$e.Highlight):this.renderTargets.getTarget(H$e.Occluded);return t?t.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(H$e.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(H$e.Color):null}getNormalTexture(e){const t=e===h$t.ColorAndWater?this.renderTargets.getTarget(H$e.Water):null;return t?t.getTexture():null}draw(e,t){const r=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==H$e.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=e.drawTarget(this,s,t):this.validTargets[s.type]=!1;return r^this.computeRenderTargetValidityBitfield()?A$I.CHANGED:A$I.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return +e[H$e.Color]|+e[H$e.ColorNoRasterImage]<<1|+e[H$e.Highlight]<<2|+e[H$e.Water]<<3|+e[H$e.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];z$u(this._extent,e.range,0,t);}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];z$u(this._extent,-e.range,0,t);}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,a$1e(this.canvasGeometries.extents[0],this._extent);}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return !0}return !1}applyViewport(e){e.setViewport(this.index===T$p.INNER?0:this.resolution,0,this.resolution,this.resolution);}}function g$s(t,r,s){return Math.min(a$1f(Math.max(t,r)+256),s)}class u$w{constructor(){this.extents=[u$T(),u$T(),u$T()],this.numViews=0;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class b$o{constructor(e,b){this.size=n$1p(),this._fbo=null,this._fbo=new D$p(e,{colorTarget:Y$d.TEXTURE,depthStencilTarget:V$q.NONE},{target:M$v.TEXTURE_2D,pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,wrapMode:D$q.CLAMP_TO_EDGE,samplingMode:L$C.LINEAR_MIPMAP_LINEAR,hasMipmap:b,maxAnisotropy:8,width:0,height:0});}dispose(){this._fbo=s$1a(this._fbo);}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return null!==this._fbo}resize(e,t){this.size[0]=e,this.size[1]=t,this._fbo.resize(this.size[0],this.size[1]);}bind(e){e.bindFramebuffer(this._fbo);}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap();}disposeRenderTargetMemory(){this._fbo?.resize(0,0);}get gpuMemoryUsage(){return this._fbo?.gpuMemoryUsage??0}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class t$x{constructor(t){const o=(e,s,o=!0)=>({type:s,fbo:new b$o(t,o),renderPass:e,valid:!1,lastUsed:1/0});this.renderTargets=[o(A$D.MATERIAL,H$e.Color),o(A$D.MATERIAL,H$e.ColorNoRasterImage),o(A$D.MATERIAL_HIGHLIGHT,H$e.Highlight,!1),o(A$D.MATERIAL_NORMAL,H$e.Water),o(A$D.MATERIAL,H$e.Occluded)];}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose();}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory();}validateUsageForTarget(e,r,s){if(e)r.lastUsed=s;else if(s-r.lastUsed>o$x)r.fbo.disposeRenderTargetMemory(),r.lastUsed=1/0;else if(r.lastUsed<1/0)return !0;return !1}get gpuMemoryUsage(){return this.renderTargets.reduce(((e,r)=>e+r.fbo.gpuMemoryUsage),0)}}const o$x=1e3;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$H{constructor(e){this._context=e,this._perConstructorInstances=new t$1e,this._frameCounter=0,this._keepAliveFrameCount=o$w;}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.destroy())))),this._perConstructorInstances.clear();}acquire(t,r){const s=r.key;let o=this._perConstructorInstances.get(t,s);if(t$V(o)){const e=new t(this._context,r,(()=>this.release(e)));o=new n$L(e),this._perConstructorInstances.set(t,s,o);}return ++o.refCount,o.technique}releaseAndAcquire(e,r,s){if(r$W(s)){if(r.key===s.key)return s;this.release(s);}return this.acquire(e,r)}release(t){if(t$V(t)||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(t.constructor,t.key);t$V(r)||(--r.refCount,0===r.refCount&&(r.refZeroFrame=this._frameCounter));}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==o$w&&this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((e,r)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(t,r));}));}));}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach(((t,r)=>{const s=async(e,t)=>{const r=t.shader;r&&(await r.reload(),e.forEach((e=>{e.technique.reload(this._context);})));};e.push(s(t,r));})),await Promise.all(e);}}class n$L{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0;}}const o$w=-1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const s$G=s=>{class e extends s{constructor(){super(...arguments),this._isDisposed=!1;}dispose(){for(const s of this._managedDisposables??[]){const e=this[s];this[s]=null,e&&"function"==typeof e.dispose&&e.dispose();}this._isDisposed=!0;}get isDisposed(){return this._isDisposed}}return e};class e$C extends(s$G(class{})){}function i$B(){return (s,e)=>{s.hasOwnProperty("_managedDisposables")||(s._managedDisposables=s._managedDisposables?.slice()??[]),s._managedDisposables.unshift(e);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const a$z=s$17.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class l$u{constructor(e,t,r,i){this._textureRepository=e,this._techniqueRepository=t,this.materialChanged=r,this.requestRender=i,this._id2glMaterialRef=new t$1e;}dispose(){this._textureRepository.dispose();}acquire(e,r){this._ownMaterial(e);let i=this._id2glMaterialRef.get(r,e.id);if(t$V(i)){const t=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:r});i=new n$K(t),this._id2glMaterialRef.set(r,e.id,i);}return i.ref(),i.glMaterial}release(e,t){const s=this._id2glMaterialRef.get(t,e.id);r$W(s)&&(s.unref(),s.referenced||(s$1a(s.glMaterial),this._id2glMaterialRef.delete(t,e.id)));}_ownMaterial(e){r$W(e.repository)&&e.repository!==this&&a$z.error("Material is already owned by a different material repository"),e.repository=this;}}class n$K{constructor(e){this.glMaterial=e,this.refCnt=0;}ref(){++this.refCnt;}unref(){--this.refCnt,e$18(this.refCnt>=0);}get referenced(){return this.refCnt>0}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const e$B={orderedRepackingEnabled:!1},n$J={rootOrigin:null};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const e$A=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class l$t extends r$19{constructor(s,r=""){super(),this.apiLayerUid=r,this.type=e$1g.Layer,this.events=new n$17,this.isSliceable=!1,this._objects=new n$1l,this._stageHandles=new u$U,this.apiLayerUid=r,this.isVisible=s?.isVisible??!0,this.isPickable=s?.isPickable??!0,this.updatePolicy=s?.updatePolicy??o$1j.ASYNC;}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null;}attachStage(e){this.detachStage(),this._stage=e;for(const t of e$A)this._stageHandles.add(this.events.on(t,(s=>e.handleEvent(t,s))));}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator();}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),r$W(this._octree)&&this._octree.add([e]);}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),r$W(this._octree)&&this._octree.remove([e]));}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),r$W(this._octree)&&this._octree.add(e);}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),r$W(this._octree)&&this._octree.remove(t);}}sync(){r$W(this._stage)&&this.updatePolicy!==o$1j.SYNC&&this._stage.syncLayer(this.id);}notifyObjectBBChanged(e,t){r$W(this._octree)&&this._octree.update(e,t);}getSpatialQueryAccelerator(){return t$V(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this);}invalidateSpatialQueryAccelerator(){this._octree=l$N(this._octree);}_createOctree(){this._octree=new G$q((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length);}}function y$q(e){return r$W(e)&&e.type===e$1g.Layer}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class a$y{constructor(r,e){this._material=r,this._repository=e,this._map=new Map;}destroy(){this._map.forEach(((e,t)=>{r$W(e)&&this._repository.release(this._material,i$A(t));}));}load(e,s){this._map.has(s)||this._map.set(s,this._repository.acquire(this._material,i$A(s)));const a=this._map.get(s);if(r$W(a)){if(a.ensureResources(e)===i$1a.LOADED)return a;this._repository.requestRender();}return null}}function i$A(r){switch(r){case A$D.MATERIAL:return o$19.Color;case A$D.MATERIAL_ALPHA:return o$19.Alpha;case A$D.MATERIAL_DEPTH:return o$19.Depth;case A$D.MATERIAL_NORMAL:return o$19.Normal;case A$D.MATERIAL_DEPTH_SHADOWMAP_ALL:return o$19.Shadow;case A$D.MATERIAL_HIGHLIGHT:return o$19.Highlight;case A$D.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:case A$D.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return o$19.Shadow}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const l$s=8;function s$F(s,u){const c=s.vertex;c.uniforms.add(new o$_("intrinsicWidth",(e=>e.width))),u.vvSize?(s.attributes.add(O$J.SIZEFEATUREATTRIBUTE,"float"),c.uniforms.add(new e$_("vvSizeMinSize",(e=>e.vvSizeMinSize))),c.uniforms.add(new e$_("vvSizeMaxSize",(e=>e.vvSizeMaxSize))),c.uniforms.add(new e$_("vvSizeOffset",(e=>e.vvSizeOffset))),c.uniforms.add(new e$_("vvSizeFactor",(e=>e.vvSizeFactor))),c.code.add(n$19`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(s.attributes.add(O$J.SIZE,"float"),c.code.add(n$19`float getSize(){
return intrinsicWidth * size;
}`)),u.vvOpacity?(s.attributes.add(O$J.OPACITYFEATUREATTRIBUTE,"float"),c.constants.add("vvOpacityNumber","int",8),c.uniforms.add([new o$1b("vvOpacityValues",(e=>e.vvOpacityValues),l$s),new o$1b("vvOpacityOpacities",(e=>e.vvOpacityOpacities),l$s)]),c.code.add(n$19`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):c.code.add(n$19`vec4 applyOpacity( vec4 color ){
return color;
}`),u.vvColor?(s.attributes.add(O$J.COLORFEATUREATTRIBUTE,"float"),c.constants.add("vvColorNumber","int",o$1a),c.uniforms.add(new o$1b("vvColorValues",(e=>e.vvColorValues),o$1a)),c.uniforms.add(new e$1c("vvColorColors",(e=>e.vvColorColors),o$1a)),c.code.add(n$19`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(s.attributes.add(O$J.COLOR,"vec4"),c.code.add(n$19`vec4 getColor(){
return applyOpacity(color);
}`));}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function t$w(c){return t$V(c)?l$W:4===c.length?c:r$17(e$z,c[0],c[1],c[2],1)}const e$z=n$1a();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function p$q(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?n$I(e,t):d$x(e);}function n$I(p,n){const d=!(n.draped&&n.stipplePreferContinuous),{vertex:f,fragment:m}=p;m.include(a$10),f.uniforms.add(new r$R("stipplePatternPixelSize")),n.draped||(c$1a(f,n),f.uniforms.add(new o$_("worldToScreenPerDistanceRatio",((e,t)=>1/t.camera.perScreenPixelRatio))),f.code.add(n$19`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),p.varyings.add("vStippleDistance","float"),n.stippleRequiresClamp&&p.varyings.add("vStippleDistanceLimits","vec2"),n.stippleRequiresStretchMeasure&&p.varyings.add("vStipplePatternStretch","float"),f.code.add(n$19`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${c$y};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),f.code.add(n$19`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),f.code.add(n$19`
    if (segmentLengthPseudoScreen >= ${d?"patternLength":"1e4"}) {
  `),f.uniforms.add(new o$_("pixelRatio",((e,t)=>t.camera.pixelRatio))),f.code.add(n$19`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${n.stippleRequiresStretchMeasure?n$19`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),m.uniforms.add(new s$10("stipplePatternTexture")),m.uniforms.add(new r$R("stipplePatternSDFNormalizer")),m.uniforms.add(new r$R("stipplePatternTextureSize")),m.uniforms.add(new r$R("stipplePatternPixelSizeInv")),m.code.add(n$19`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),m.code.add(n$19`
    float getStippleSDF(out bool isClamped) {
      ${n.stippleRequiresClamp?n$19`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:n$19`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${n.stippleScaleWithLineWidth?n$19`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${n.stippleRequiresStretchMeasure?n$19`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:n$19`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${n.stippleScaleWithLineWidth?n$19`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:n$19`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),n.stippleOffColorEnabled?(m.uniforms.add(new e$19("stippleOffColor",(e=>t$w(e.stippleOffColor)))),m.code.add(n$19`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):m.code.add(n$19`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`);}function d$x(e){e.fragment.code.add(n$19`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`);}const c$y=n$19.float(.4);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var r$D;!function(o){o[o.BUTT=0]="BUTT",o[o.SQUARE=1]="SQUARE",o[o.ROUND=2]="ROUND",o[o.COUNT=3]="COUNT";}(r$D||(r$D={}));class s$E extends i$17{constructor(){super(...arguments),this.output=o$19.Color,this.capType=r$D.BUTT,this.transparencyPassType=O$L.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1;}}e$Y([e$12({count:o$19.COUNT})],s$E.prototype,"output",void 0),e$Y([e$12({count:r$D.COUNT})],s$E.prototype,"capType",void 0),e$Y([e$12({count:O$L.COUNT})],s$E.prototype,"transparencyPassType",void 0),e$Y([e$12()],s$E.prototype,"occluder",void 0),e$Y([e$12()],s$E.prototype,"hasSlicePlane",void 0),e$Y([e$12()],s$E.prototype,"hasPolygonOffset",void 0),e$Y([e$12()],s$E.prototype,"writeDepth",void 0),e$Y([e$12()],s$E.prototype,"draped",void 0),e$Y([e$12()],s$E.prototype,"stippleEnabled",void 0),e$Y([e$12()],s$E.prototype,"stippleOffColorEnabled",void 0),e$Y([e$12()],s$E.prototype,"stippleScaleWithLineWidth",void 0),e$Y([e$12()],s$E.prototype,"stipplePreferContinuous",void 0),e$Y([e$12()],s$E.prototype,"roundJoins",void 0),e$Y([e$12()],s$E.prototype,"vvSize",void 0),e$Y([e$12()],s$E.prototype,"vvColor",void 0),e$Y([e$12()],s$E.prototype,"vvOpacity",void 0),e$Y([e$12()],s$E.prototype,"falloffEnabled",void 0),e$Y([e$12()],s$E.prototype,"innerColorEnabled",void 0),e$Y([e$12()],s$E.prototype,"hasOccludees",void 0),e$Y([e$12()],s$E.prototype,"hasMultipassTerrain",void 0),e$Y([e$12()],s$E.prototype,"cullAboveGround",void 0),e$Y([e$12()],s$E.prototype,"wireframe",void 0),e$Y([e$12({constValue:!0})],s$E.prototype,"stippleRequiresClamp",void 0),e$Y([e$12({constValue:!0})],s$E.prototype,"stippleRequiresStretchMeasure",void 0),e$Y([e$12({constValue:!0})],s$E.prototype,"hasVvInstancing",void 0),e$Y([e$12({constValue:!0})],s$E.prototype,"hasSliceTranslatedView",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const x$n=1;function b$n(b){const L=new i$_,w=b.hasMultipassTerrain&&(b.output===o$19.Color||b.output===o$19.Alpha);L.include(t$Z),L.include(s$F,b),L.include(p$q,b),b.output===o$19.Depth&&L.include(e$1h,b),d$W(L,b);const{vertex:y,fragment:C}=L;y.uniforms.add([new e$Z("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new e$$("nearFar",((e,t)=>t.camera.nearFar)),new o$_("miterLimit",(e=>"miter"!==e.join?0:e.miterLimit)),new e$19("viewport",((e,t)=>t.camera.fullViewport))]),y.constants.add("LARGE_HALF_FLOAT","float",65500),L.attributes.add(O$J.POSITION,"vec3"),L.attributes.add(O$J.SUBDIVISIONFACTOR,"float"),L.attributes.add(O$J.UV0,"vec2"),L.attributes.add(O$J.AUXPOS1,"vec3"),L.attributes.add(O$J.AUXPOS2,"vec3"),L.varyings.add("vColor","vec4"),L.varyings.add("vpos","vec3"),L.varyings.add("linearDepth","float"),w&&L.varyings.add("depth","float");const j=b.capType===r$D.ROUND,R=b.stippleEnabled&&b.stippleScaleWithLineWidth||j;R&&L.varyings.add("vLineWidth","float");const A=b.stippleEnabled&&b.stippleScaleWithLineWidth;A&&L.varyings.add("vLineSizeInv","float");const F=b.innerColorEnabled||j;F&&L.varyings.add("vLineDistance","float");const P=b.stippleEnabled&&j,E=b.falloffEnabled||P;E&&L.varyings.add("vLineDistanceNorm","float"),j&&(L.varyings.add("vSegmentSDF","float"),L.varyings.add("vReverseSegmentSDF","float")),y.code.add(n$19`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),y.code.add(n$19`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),y.code.add(n$19`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${w?"depth = pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),y.uniforms.add(new o$_("pixelRatio",((e,t)=>t.camera.pixelRatio))),y.code.add(n$19`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${R?n$19`vLineWidth = lineWidth;`:""}
      ${A?n$19`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `);(b.stippleEnabled||j)&&y.code.add(n$19`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${j?n$19`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),y.code.add(n$19`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),b.roundJoins?y.code.add(n$19`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${b.stippleEnabled?n$19`min(1.0, subdivisionFactor * ${n$19.float((x$n+2)/(x$n+1))})`:n$19`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):y.code.add(n$19`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const T=b.capType!==r$D.BUTT;return y.code.add(n$19`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${T?n$19`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),y.code.add(n$19`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${E||F?n$19`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${F?n$19`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${E?n$19`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),j&&y.code.add(n$19`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),b.stippleEnabled&&(b.draped?y.uniforms.add(new o$_("worldToScreenRatio",((e,t)=>1/t.screenToPCSRatio))):y.code.add(n$19`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),y.code.add(n$19`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),b.draped?y.code.add(n$19`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):y.code.add(n$19`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),y.code.add(n$19`
      float patternLength = ${b.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),y.code.add(n$19`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${b.wireframe&&!b.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `),w&&L.include(n$1q,b),L.include(u$$,b),C.include(e$14),C.code.add(n$19`
  void main() {
    discardBySlice(vpos);
    ${w?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),b.wireframe?C.code.add(n$19`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(j&&C.code.add(n$19`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${n$19.float(t$19)}) {
        discard;
      }
    `),P?C.code.add(n$19`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${n$19.float(t$19)}, stippleCoverage);
      `):C.code.add(n$19`float stippleAlpha = getStippleAlpha();`),C.uniforms.add(new e$19("intrinsicColor",(e=>e.color))),C.code.add(n$19`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),b.innerColorEnabled&&(C.uniforms.add(new e$19("innerColor",(t=>c$$(t.innerColor,t.color)))),C.uniforms.add(new o$_("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio))),C.code.add(n$19`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),C.code.add(n$19`vec4 finalColor = blendStipple(color, stippleAlpha);`),b.falloffEnabled&&(C.uniforms.add(new o$_("falloff",(e=>e.falloff))),C.code.add(n$19`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),C.code.add(n$19`
    if (finalColor.a < ${n$19.float(t$19)}) {
      discard;
    }

    ${b.output===o$19.Alpha?n$19`gl_FragColor = vec4(finalColor.a);`:""}
    ${b.output===o$19.Color?n$19`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${b.output===o$19.Color&&b.transparencyPassType===O$L.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${b.output===o$19.Highlight?n$19`gl_FragColor = vec4(1.0);`:""}
    ${b.output===o$19.Depth?n$19`outputDepth(linearDepth);`:""}
  }
  `),L}const L$l=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:x$n,build:b$n},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const A$k=new Map([[O$J.POSITION,0],[O$J.SUBDIVISIONFACTOR,1],[O$J.UV0,2],[O$J.AUXPOS1,3],[O$J.AUXPOS2,4],[O$J.COLOR,5],[O$J.COLORFEATUREATTRIBUTE,5],[O$J.SIZE,6],[O$J.SIZEFEATUREATTRIBUTE,6],[O$J.OPACITYFEATUREATTRIBUTE,7]]);class I$l extends e$11{constructor(e,t,i){super(e,t,i),this.stippleTextureRepository=e.stippleTextureRepository;}initializeProgram(e){const t=I$l.shader.get().build(this.configuration);return new o$Z(e.rctx,t,A$k)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null;}bindPass(t,i){if(this.program.bindPass(t,i),this.stipplePattern!==t.stipplePattern){const e=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,e),this.stipplePattern=e;}if(this.configuration.stippleEnabled){const{pixelSize:t,sdfNormalizer:i,pixels:r}=r$W(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",i),this.program.setUniform1f("stipplePatternTextureSize",r),this.program.setUniform1f("stipplePatternPixelSize",t),this.program.setUniform1f("stipplePatternPixelSizeInv",1/t);}}_makePipelineState(e,i){const r=this.configuration,c=e===O$L.NONE,u=e===O$L.FrontFace;return W$h({blending:r.output===o$19.Color||r.output===o$19.Alpha?c?c$1c:E$J(e):null,depthTest:{func:l$13(e)},depthWrite:c?r.writeDepth&&a$1a:S$H(e),colorWrite:c$10,stencilWrite:r.hasOccludees?e$1i:null,stencilTest:r.hasOccludees?i?o$1k:f$11:null,polygonOffset:c||u?r.hasPolygonOffset&&U$g:f$12})}initializePipeline(){const e=this.configuration;if(e.occluder){const t=e.hasPolygonOffset&&U$g;this._occluderPipelineTransparent=W$h({blending:c$1c,polygonOffset:t,depthTest:s$1m,depthWrite:null,colorWrite:c$10,stencilWrite:null,stencilTest:m$U}),this._occluderPipelineOpaque=W$h({blending:c$1c,polygonOffset:t,depthTest:s$1m,depthWrite:null,colorWrite:c$10,stencilWrite:l$14,stencilTest:P$y}),this._occluderPipelineMaskWrite=W$h({blending:null,polygonOffset:t,depthTest:i$1b,depthWrite:null,colorWrite:null,stencilWrite:e$1i,stencilTest:o$1k});}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?E$F.LINES:E$F.TRIANGLE_STRIP}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?e===E$G.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===E$G.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,t)}}I$l.shader=new t$W(L$l,(()=>import('./RibbonLine.glsl-99897217.js')));const U$g={factor:0,units:-4};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const z$g=s$17.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var B$i;!function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END";}(B$i||(B$i={}));class H$d extends d$X{constructor(e){super(e,new V$e),this._vertexAttributeLocations=A$k,this.techniqueConfig=new s$E,this.layout=this.createLayout();}isClosed(e,t){return Y$9(this.parameters,e,t)}getConfiguration(e,t){this.techniqueConfig.output=e,this.techniqueConfig.draped=t.slot===E$G.DRAPED_MATERIAL;const i=r$W(this.parameters.stipplePattern)&&e!==o$19.Highlight;return this.techniqueConfig.stippleEnabled=i,this.techniqueConfig.stippleOffColorEnabled=i&&r$W(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.roundJoins="round"===this.parameters.join,this.techniqueConfig.capType=this.parameters.cap,this.techniqueConfig.hasPolygonOffset=this.parameters.hasPolygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&r$W(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=this.parameters.renderOccluded===h$Z.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig.wireframe=this.parameters.wireframe,this.techniqueConfig}intersect(e,t,i,s,a,n,o,h,l){r$W(l)?this._intersectDrapedLineGeometry(e,s,l,n,o):this._intersectLineGeometry(e,t,i,s,o);}_intersectDrapedLineGeometry(e,r,i,s,a){if(!r.options.selectionMode)return;const n=e.vertexAttributes.get(O$J.POSITION).data,o=e.vertexAttributes.get(O$J.SIZE);let h=this.parameters.width;if(this.parameters.vvSizeEnabled){const r=e.vertexAttributes.get(O$J.SIZEFEATUREATTRIBUTE).data[0];h*=o$X(this.parameters.vvSizeOffset[0]+r*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0]);}else o&&(h*=o.data[0]);const l=s[0],c=s[1],u=(h/2+4)*e.screenToWorldRatio;let p=Number.MAX_VALUE,m=0;for(let f=0;f<n.length-5;f+=3){const e=n[f],r=n[f+1],i=l-e,s=c-r,a=n[f+3]-e,o=n[f+4]-r,h=o$X((a*i+o*s)/(a*a+o*o),0,1),u=a*h-i,T=o*h-s,E=u*u+T*T;E<p&&(p=E,m=f/3);}p<u*u&&a(i.dist,i.normal,m,!1);}_intersectLineGeometry(e,r,i,m,f){if(!m.options.selectionMode||u$10(r))return;if(!M$x(i))return void z$g.error("intersection assumes a translation-only matrix");const T=e.vertexAttributes,d=T.get(O$J.POSITION).data;let R=this.parameters.width;if(this.parameters.vvSizeEnabled){const e=T.get(O$J.SIZEFEATUREATTRIBUTE).data[0];R*=o$X(this.parameters.vvSizeOffset[0]+e*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0]);}else T.has(O$J.SIZE)&&(R*=T.get(O$J.SIZE).data[0]);const g=m.camera,b=te$5;a$16(b,m.point);const C=R*g.pixelRatio/2+4*g.pixelRatio;o$W(ue$d[0],b[0]-C,b[1]+C,0),o$W(ue$d[1],b[0]+C,b[1]+C,0),o$W(ue$d[2],b[0]+C,b[1]-C,0),o$W(ue$d[3],b[0]-C,b[1]-C,0);for(let t=0;t<4;t++)if(!g.unprojectFromRenderScreen(ue$d[t],pe$b[t]))return;j$J(g.eye,pe$b[0],pe$b[1],me$b),j$J(g.eye,pe$b[1],pe$b[2],fe$a),j$J(g.eye,pe$b[2],pe$b[3],Te$1),j$J(g.eye,pe$b[3],pe$b[0],Ee$1);let L=Number.MAX_VALUE,N=0;const P=X$8(this.parameters,T,e.indices)?d.length-2:d.length-5;for(let t=0;t<P;t+=3){Q$b[0]=d[t]+i[12],Q$b[1]=d[t+1]+i[13],Q$b[2]=d[t+2]+i[14];const e=(t+3)%d.length;if(K$d[0]=d[e]+i[12],K$d[1]=d[e+1]+i[13],K$d[2]=d[e+2]+i[14],W$i(me$b,Q$b)<0&&W$i(me$b,K$d)<0||W$i(fe$a,Q$b)<0&&W$i(fe$a,K$d)<0||W$i(Te$1,Q$b)<0&&W$i(Te$1,K$d)<0||W$i(Ee$1,Q$b)<0&&W$i(Ee$1,K$d)<0)continue;if(g.projectToRenderScreen(Q$b,re$4),g.projectToRenderScreen(K$d,ie$6),re$4[2]<0&&ie$6[2]>0){e$15($$c,Q$b,K$d);const e=g.frustum,t=-W$i(e[k$C.NEAR],Q$b)/P$u($$c,Z$g(e[k$C.NEAR]));q$p($$c,$$c,t),u$W(Q$b,Q$b,$$c),g.projectToRenderScreen(Q$b,re$4);}else if(re$4[2]>0&&ie$6[2]<0){e$15($$c,K$d,Q$b);const e=g.frustum,t=-W$i(e[k$C.NEAR],K$d)/P$u($$c,Z$g(e[k$C.NEAR]));q$p($$c,$$c,t),u$W(K$d,K$d,$$c),g.projectToRenderScreen(K$d,ie$6);}else if(re$4[2]<0&&ie$6[2]<0)continue;re$4[2]=0,ie$6[2]=0;const r=b$F(l$15(re$4,ie$6,ne$8),b);r<L&&(L=r,r$V(se$6,Q$b),r$V(ae$9,K$d),N=t/3);}const y=m.rayBegin,D=m.rayEnd;if(L<C*C){let e=Number.MAX_VALUE;if(k$D(l$15(se$6,ae$9,ne$8),l$15(y,D,oe$b),ee$5)){e$15(ee$5,ee$5,y);const t=s$1b(ee$5);q$p(ee$5,ee$5,1/t),e=t/x$H(y,D);}f(e,ee$5,N,!1);}}computeAttachmentOrigin(e,t){const r=e.vertexAttributes;if(!r)return null;const i=e.indices,s=r.get(O$J.POSITION);return h$$(s,i?i.get(O$J.POSITION):null,i&&X$8(this.parameters,r,i),t)}createLayout(){const e=T$C().vec3f(O$J.POSITION).f32(O$J.SUBDIVISIONFACTOR).vec2f(O$J.UV0).vec3f(O$J.AUXPOS1).vec3f(O$J.AUXPOS2);return this.parameters.vvSizeEnabled?e.f32(O$J.SIZEFEATUREATTRIBUTE):e.f32(O$J.SIZE),this.parameters.vvColorEnabled?e.f32(O$J.COLORFEATUREATTRIBUTE):e.vec4f(O$J.COLOR),this.parameters.vvOpacityEnabled&&e.f32(O$J.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new Z$8(this.layout,this.parameters)}requiresSlot(e,t){if(e===E$G.DRAPED_MATERIAL)return !0;if(this.parameters.renderOccluded===h$Z.OccludeAndTransparentStencil)return e===E$G.OPAQUE_MATERIAL||e===E$G.OCCLUDER_MATERIAL||e===E$G.TRANSPARENT_OCCLUDER_MATERIAL;const r=i$A(t);if(r===o$19.Color||r===o$19.Alpha){return e===(this.parameters.writeDepth?E$G.TRANSPARENT_MATERIAL:E$G.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)}return e===E$G.OPAQUE_MATERIAL}createGLMaterial(e){return e.output===o$19.Color||e.output===o$19.Alpha||e.output===o$19.Highlight||e.output===o$19.Depth?new W$c(e):null}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0);}}class W$c extends t$1d{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees});}beginSlot(e){return this._output!==o$19.Color&&this._output!==o$19.Alpha||this._updateOccludeeState(e),this.ensureTechnique(I$l,e)}}class V$e extends v$S{constructor(){super(...arguments),this.width=0,this.color=_$y,this.join="miter",this.cap=r$D.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1;}}class Z$8{constructor(e,t){this.parameters=t,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const r=t.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=x$n+r;}}_isClosed(e){return X$8(this.parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=2,r=e.indices.get(O$J.POSITION).length/2+1,i=this._isClosed(e);let s=i?2:2*t;return s+=((i?r:r-1)-(i?0:1))*(2*this.numJoinSubdivisions+4),s+=2,this.parameters.wireframe&&(s=2+4*(s-2)),s}write(e,t,r,i){const s=he$a,n=le$b,o=ce$c,h=t.vertexAttributes.get(O$J.POSITION).data,l=t.indices&&t.indices.get(O$J.POSITION),u=t.vertexAttributes.get(O$J.DISTANCETOSTART)?.data;l&&l.length!==2*(h.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let f=1,T=0;this.parameters.vvSizeEnabled?T=t.vertexAttributes.get(O$J.SIZEFEATUREATTRIBUTE).data[0]:t.vertexAttributes.has(O$J.SIZE)&&(f=t.vertexAttributes.get(O$J.SIZE).data[0]);let E=[1,1,1,1],d=0;this.parameters.vvColorEnabled?d=t.vertexAttributes.get(O$J.COLORFEATUREATTRIBUTE).data[0]:t.vertexAttributes.has(O$J.COLOR)&&(E=t.vertexAttributes.get(O$J.COLOR).data);let A=0;this.parameters.vvOpacityEnabled&&(A=t.vertexAttributes.get(O$J.OPACITYFEATUREATTRIBUTE).data[0]);const v=h.length/3,_=e.transformation,R=new Float32Array(r.buffer),S=this.vertexBufferLayout.stride/4;let O=i*S;const I=O;let g=0;const b=u?(e,t,r)=>g=u[r]:(e,t,r)=>g+=x$H(e,t),C=(e,t,r,i,s,a,n)=>{if(R[O++]=t[0],R[O++]=t[1],R[O++]=t[2],R[O++]=i,R[O++]=n,R[O++]=s,R[O++]=e[0],R[O++]=e[1],R[O++]=e[2],R[O++]=r[0],R[O++]=r[1],R[O++]=r[2],this.parameters.vvSizeEnabled?R[O++]=T:R[O++]=f,this.parameters.vvColorEnabled)R[O++]=d;else {const e=Math.min(4*a,E.length-4);R[O++]=E[e+0],R[O++]=E[e+1],R[O++]=E[e+2],R[O++]=E[e+3];}this.parameters.vvOpacityEnabled&&(R[O++]=A);};O+=S,o$W(n,h[0],h[1],h[2]),_&&L$E(n,n,_);const L=this._isClosed(t);if(L){const e=h.length-3;o$W(s,h[e],h[e+1],h[e+2]),_&&L$E(s,s,_);}else o$W(o,h[3],h[4],h[5]),_&&L$E(o,o,_),C(n,n,o,1,B$i.LEFT_CAP_START,0,0),C(n,n,o,1,B$i.RIGHT_CAP_START,0,0),r$V(s,n),r$V(n,o);const N=L?0:1,P=L?v:v-1;for(let p=N;p<P;p++){const e=(p+1)%v*3;o$W(o,h[e+0],h[e+1],h[e+2]),_&&L$E(o,o,_),b(s,n,p),C(s,n,o,0,B$i.LEFT_JOIN_END,p,g),C(s,n,o,0,B$i.RIGHT_JOIN_END,p,g);const t=this.numJoinSubdivisions;for(let r=0;r<t;++r){const e=(r+1)/(t+1);C(s,n,o,e,B$i.LEFT_JOIN_END,p,g),C(s,n,o,e,B$i.RIGHT_JOIN_END,p,g);}C(s,n,o,1,B$i.LEFT_JOIN_START,p,g),C(s,n,o,1,B$i.RIGHT_JOIN_START,p,g),r$V(s,n),r$V(n,o);}L?(o$W(o,h[3],h[4],h[5]),_&&L$E(o,o,_),g=b(s,n,P),C(s,n,o,0,B$i.LEFT_JOIN_END,N,g),C(s,n,o,0,B$i.RIGHT_JOIN_END,N,g)):(g=b(s,n,P),C(s,n,n,0,B$i.LEFT_CAP_END,P,g),C(s,n,n,0,B$i.RIGHT_CAP_END,P,g)),k$j(R,I+S,R,I,S);O=k$j(R,O-S,R,O,S),this.parameters.wireframe&&this._addWireframeVertices(r,I,O,S);}_addWireframeVertices(e,t,r,i){const s=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),a=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,r-t);let n=0;const o=e=>n=k$j(a,e,s,n,i);for(let h=0;h<a.length-1;h+=2*i)o(h),o(h+2*i),o(h+1*i),o(h+2*i),o(h+1*i),o(h+3*i);}}function k$j(e,t,r,i,s){for(let a=0;a<s;a++)r[i++]=e[t++];return i}function X$8(e,t,r){return Y$9(e,t.get(O$J.POSITION).data,r?r.get(O$J.POSITION):null)}function Y$9(e,t,r){return !!e.isClosed&&(r?r.length>2:t.length>6)}const Q$b=n$16(),K$d=n$16(),$$c=n$16(),ee$5=n$16(),te$5=n$16(),re$4=x$J(),ie$6=x$J(),se$6=n$16(),ae$9=n$16(),ne$8=v$T(),oe$b=v$T(),he$a=n$16(),le$b=n$16(),ce$c=n$16(),ue$d=[x$J(),x$J(),x$J(),x$J()],pe$b=[n$16(),n$16(),n$16(),n$16()],me$b=p$Y(),fe$a=p$Y(),Te$1=p$Y(),Ee$1=p$Y();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class j$r{constructor(t,r=125e4){this._originSR=t,this._gridSize=r,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+e$1e();}getOrigin(i){const r=this._origins.get(this._rootOriginId);if(null==r){const r=n$J.rootOrigin;if(r$W(r))return this._origins.set(this._rootOriginId,c$z(r[0],r[1],r[2],this._rootOriginId)),this.getOrigin(i);const o=c$z(i[0]+Math.random()-.5,i[1]+Math.random()-.5,i[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,o),o}const s=this._gridSize,e=Math.round(i[0]/s),a=Math.round(i[1]/s),n=Math.round(i[2]/s),h=`${e}/${a}/${n}`;let c=this._origins.get(h);const g=.5*s;if(e$15(p$p,i,r.vec3),p$p[0]=Math.abs(p$p[0]),p$p[1]=Math.abs(p$p[1]),p$p[2]=Math.abs(p$p[2]),p$p[0]<g&&p$p[1]<g&&p$p[2]<g){if(c){const t=Math.max(...p$p);e$15(p$p,i,c.vec3),p$p[0]=Math.abs(p$p[0]),p$p[1]=Math.abs(p$p[1]),p$p[2]=Math.abs(p$p[2]);if(Math.max(...p$p)<t)return c}return r}return c||(c=c$z(e*s,a*s,n*s,h),this._origins.set(h,c)),c}_drawOriginBox(t,i=r$Z(1,1,0,1)){const o=window.view,s=o._stage,m=i.toString();if(!this._objects.has(m)){this._material=new H$d({width:2,color:i}),s.add(this._material);const t=new l$t({isPickable:!1}),r=new O$t({castShadow:!1});s.add(r),t.add(r),s.add(t),this._objects.set(m,r);}const d=this._objects.get(m),j=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=j.length,b=new Array(3*p),l=new Uint16Array(2*(p-1)),u=.5*this._gridSize;for(let r=0;r<p;r++)b[3*r+0]=t[0]+(1&j[r]?u:-u),b[3*r+1]=t[1]+(2&j[r]?u:-u),b[3*r+2]=t[2]+(4&j[r]?u:-u),r>0&&(l[2*r+0]=r-1,l[2*r+1]=r);Un(b,this._originSR,0,b,o.renderSpatialReference,0,p);const M=new g$S([[O$J.POSITION,{size:3,data:b,exclusive:!0}]],[[O$J.POSITION,l]],c$12.Line);s.add(M),d.addGeometry(M,this._material,o$1g);}}const p$p=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class n$H{constructor(t,n,c,l=null){this.rctx=t,this.sliceHelper=l,this.lastFrameCamera=new K$h,this.pass=A$D.MATERIAL,this.renderOccludedMask=i$z,this.bindParameters=new h$L(n,c,r$W(l)?l.plane:null);}resetRenderOccludedMask(){this.renderOccludedMask=i$z;}get isHighlightPass(){return this.pass===A$D.MATERIAL_HIGHLIGHT}}class c$x extends n$H{constructor(e,s,r,t,a){super(e,r,t,a),this.offscreenRenderingHelper=s,this.sliceHelper=a;}}const i$z=h$Z.Occlude|h$Z.OccludeAndTransparent|h$Z.OccludeAndTransparentStencil;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var J$a;!function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default";}(J$a||(J$a={}));class K$c{constructor(){this.camera=new K$h,this.lightMat=e$10();}}class Q$a{constructor(t,e,s=0){this.rctx=t,this.viewingMode=e,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=n$1a(),this._cascades=[new K$c,new K$c,new K$c,new K$c],this.maxTextureSize=this.rctx.parameters.maxTextureSize,this.snapshotCount=s;}get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get cascadeDistances(){return r$17(this._usedCascadeDistances,this._cascadeDistances[0],this.numCascades>1?this._cascadeDistances[1]:1/0,this.numCascades>2?this._cascadeDistances[2]:1/0,this.numCascades>3?this._cascadeDistances[3]:1/0)}dispose(){this._discardDepthTexture(),this._discardAllSnapshots();}set maxCascades(e){this.maxNumCascades=o$X(Math.floor(e),1,4);}get maxCascades(){return this.maxNumCascades}set enabled(t){this._enabled=t,t||(this._discardDepthTexture(),this._discardAllSnapshots());}get enabled(){return this._enabled}get ready(){return this._enabled&&r$W(this._depthTexture)}get snapshotCount(){return this._snapshots.length}set snapshotCount(t){const e=this._snapshots.length;if(t>e){const s=t-e;this._snapshots.length=t;for(let t=0;t<s;++t)this._snapshots[e+t]=null;}else if(t<this.snapshotCount){const s=e-t;for(let e=0;e<s;++e)this._discardSnapshot(t+e);this._snapshots.length=t;}}getSnapshot(t){return this.enabled?this._snapshots[t]:null}getCascades(){for(let t=0;t<this.numCascades;++t)dt$2[t]=this._cascades[t];return dt$2.length=this.numCascades,dt$2}start(t,e,s){e$18(this.enabled),this._textureSize=this._computeTextureSize(t.fullWidth,t.fullHeight),this._ensureDepthTexture();const{near:a,far:i}=this._clampNearFar(s);this._computeCascadeDistances(i,a),this._setupMatrices(t,e);const r=t.viewMatrix,h=t.projectionMatrix;for(let c=0;c<this.numCascades;++c)this._constructCascade(c,h,r,e);this.lastOrigin=null,this.clear();}finish(t){e$18(this.enabled),this.rctx.bindFramebuffer(t);}getShadowMapMatrices(t){if(!this.lastOrigin||!F$t(t,this.lastOrigin)){this.lastOrigin=this.lastOrigin||n$16(),r$V(this.lastOrigin,t);for(let e=0;e<this.numCascades;++e){c$17(pt$3,this._cascades[e].lightMat,t);for(let t=0;t<16;++t)lt$3[16*e+t]=pt$3[t];}}return lt$3}takeCascadeSnapshotTo(t,e){e$18(this.enabled);const s=this._ensureSnapshot(e);this._bindFbo();const a=this.rctx,i=a.bindTexture(s,u$X.TEXTURE_UNIT_FOR_UPDATES);a.gl.copyTexSubImage2D(M$v.TEXTURE_2D,0,t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[2],t.camera.viewport[3]),a.bindTexture(i,u$X.TEXTURE_UNIT_FOR_UPDATES);}clear(){const t=this.rctx;this._bindFbo(),t.setClearColor(1,1,1,1),t.clearSafe(_$z.COLOR_BUFFER_BIT|_$z.DEPTH_BUFFER_BIT);}_computeTextureSize(t,e){const s=.5*Math.log(t*t+e*e)*Math.LOG2E,a=.35,i=2**Math.round(s+a);return Math.min(this.maxTextureSize,2*i)}_ensureDepthTexture(){if(r$W(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const t={target:M$v.TEXTURE_2D,pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,wrapMode:D$q.CLAMP_TO_EDGE,samplingMode:L$C.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new u$X(this.rctx,t),this._fbo=new D$p(this.rctx,{colorTarget:Y$d.TEXTURE,depthStencilTarget:V$q.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture);}_ensureSnapshot(t){let e=this._snapshots[t];if(r$W(e)&&e.descriptor.width===this._textureSize)return e;this._discardSnapshot(t);const s={target:M$v.TEXTURE_2D,pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,wrapMode:D$q.CLAMP_TO_EDGE,samplingMode:L$C.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return e=new u$X(this.rctx,s),this._snapshots[t]=e,e}_discardDepthTexture(){this._fbo=s$1a(this._fbo),this._depthTexture=s$1a(this._depthTexture);}_discardSnapshot(t){this._snapshots[t]=s$1a(this._snapshots[t]);}_discardAllSnapshots(){for(let t=0;t<this.snapshotCount;++t)this._discardSnapshot(t);}_bindFbo(){const t=this.rctx;t.unbindTexture(this._depthTexture),t.bindFramebuffer(this._fbo);}_constructCascade(t,e,s,a){const i=this._cascades[t],r=-this._cascadeDistances[t],o=-this._cascadeDistances[t+1],n=(e[10]*r+e[14])/Math.abs(e[11]*r+e[15]),u=(e[10]*o+e[14])/Math.abs(e[11]*o+e[15]);e$18(n<u);for(let h=0;h<8;++h){r$17(et$3,h%4==0||h%4==3?-1:1,h%4==0||h%4==1?-1:1,h<4?n:u,1),w$z(st$3[h],et$3,tt$4);for(let t=0;t<3;++t)st$3[h][t]/=st$3[h][3];}j$I(mt$2,st$3[0]),c$17(Z$7,ut$3,mt$2),i.camera.viewMatrix=Z$7;for(let h=0;h<8;++h)L$E(st$3[h],st$3[h],i.camera.viewMatrix);r$V(at$3,st$3[0]),r$V(it$3,st$3[0]);for(let h=1;h<8;++h)for(let t=0;t<3;++t)at$3[t]=Math.min(at$3[t],st$3[h][t]),it$3[t]=Math.max(it$3[t],st$3[h][t]);at$3[2]-=200,it$3[2]+=200,i.camera.near=-it$3[2],i.camera.far=-at$3[2],this.warp?this._constructTrapezoidalProjection(s,a,i):this._constructOrthogonalProjection(i),u$Z(i.lightMat,i.camera.projectionMatrix,i.camera.viewMatrix);const m=this._textureSize/2;i.camera.viewport[0]=t%2==0?0:m,i.camera.viewport[1]=0===Math.floor(t/2)?0:m,i.camera.viewport[2]=m,i.camera.viewport[3]=m;}_constructOrthogonalProjection(t){E$N(t.camera.projectionMatrix,at$3[0],it$3[0],at$3[1],it$3[1],t.camera.near,t.camera.far);}_constructTrapezoidalProjection(t,s,a){const i=1/st$3[0][3],r=1/st$3[4][3];e$18(i<r);let h=i+Math.sqrt(i*r);const c=Math.sin(l$U(t[2]*s[0]+t[6]*s[1]+t[10]*s[2]));h/=c,Dt(st$3,h,c,rt$3,ht$3,ct$3,ot$3,nt$3),Ut(rt$3,ht$3,ot$3,nt$3,a.camera.projectionMatrix),a.camera.projectionMatrix[10]=2/(at$3[2]-it$3[2]),a.camera.projectionMatrix[14]=-(at$3[2]+it$3[2])/(at$3[2]-it$3[2]);}_setupMatrices(t,e){u$Z($$b,t.projectionMatrix,t.viewMatrix),h$U(tt$4,$$b);const s=this.viewingMode===l$O.Global?t.eye:o$W(mt$2,0,0,1);F$s(ut$3,[0,0,0],[-e[0],-e[1],-e[2]],s);}_clampNearFar(t){let{near:e,far:s}=t;return e<2&&(e=2),s<2&&(s=2),e>=s&&(e=2,s=4),{near:e,far:s}}_computeCascadeDistances(t,e){this.numCascades=Math.min(1+Math.floor(f$13(t/e,4)),this.maxNumCascades);const a=(t-e)/this.numCascades,i=(t/e)**(1/this.numCascades);let r=e,h=e;for(let c=0;c<this.numCascades+1;++c)this._cascadeDistances[c]=s$1c(r,h,this.splitSchemeLambda),r*=i,h+=a;}get gpuMemoryUsage(){return this._snapshots.reduce(((t,e)=>t+u$14(e)),this._fbo?.gpuMemoryUsage??0)}get test(){const t=this;return {maxNumCascades:this.maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(e){t.splitSchemeLambda=e;},get splitSchemeLambda(){return t.splitSchemeLambda},set warp(e){t.warp=e;},get warp(){return t.warp}}}}const Z$7=e$10(),$$b=e$10(),tt$4=e$10(),et$3=n$1a(),st$3=[];for(let Ft=0;Ft<8;++Ft)st$3.push(n$1a());const at$3=n$16(),it$3=n$16(),rt$3=n$1b(),ht$3=n$1b(),ct$3=n$1b(),ot$3=n$1b(),nt$3=n$1b(),ut$3=e$10(),mt$2=n$16(),dt$2=[],pt$3=e$10(),lt$3=new Float32Array(64),_t=n$1b(),ft$3=n$1b(),xt=[n$1b(),n$1b(),n$1b(),n$1b()],gt$2=n$1b(),Tt=n$1b(),St$1=n$1b(),bt$1=n$1b(),wt=n$1b(),Mt=n$1b(),Ct=n$1b();function Dt(t,e,s,a,i,r,h,c){r$Y(_t,0,0);for(let d=0;d<4;++d)s$1n(_t,_t,t[d]);l$11(_t,_t,.25),r$Y(ft$3,0,0);for(let d=4;d<8;++d)s$1n(ft$3,ft$3,t[d]);l$11(ft$3,ft$3,.25),A$J(xt[0],t[4],t[5],.5),A$J(xt[1],t[5],t[6],.5),A$J(xt[2],t[6],t[7],.5),A$J(xt[3],t[7],t[4],.5);let o=0,n=b$G(xt[0],_t);for(let d=1;d<4;++d){const t=b$G(xt[d],_t);t<n&&(n=t,o=d);}o$1l(gt$2,xt[o],t[o+4]);const u=gt$2[0];let m,w;gt$2[0]=-gt$2[1],gt$2[1]=u,o$1l(Tt,ft$3,_t),j$K(Tt,gt$2)<0&&x$L(gt$2,gt$2),A$J(gt$2,gt$2,Tt,s),v$U(gt$2,gt$2),m=w=j$K(o$1l(St$1,t[0],_t),gt$2);for(let d=1;d<8;++d){const e=j$K(o$1l(St$1,t[d],_t),gt$2);e<m?m=e:e>w&&(w=e);}a$16(a,_t),l$11(St$1,gt$2,m-e),s$1n(a,a,St$1);let M=-1,C=1,D=0,E=0;for(let d=0;d<8;++d){o$1l(bt$1,t[d],a),v$U(bt$1,bt$1);const e=gt$2[0]*bt$1[1]-gt$2[1]*bt$1[0];e>0?e>M&&(M=e,D=d):e<C&&(C=e,E=d);}s$1o(M>0,"leftArea"),s$1o(C<0,"rightArea"),l$11(wt,gt$2,m),s$1n(wt,wt,_t),l$11(Mt,gt$2,w),s$1n(Mt,Mt,_t),Ct[0]=-gt$2[1],Ct[1]=gt$2[0];const j=u$15(a,t[E],Mt,s$1n(St$1,Mt,Ct),1,i),v=u$15(a,t[D],Mt,St$1,1,r),z=u$15(a,t[D],wt,s$1n(St$1,wt,Ct),1,h),R=u$15(a,t[E],wt,St$1,1,c);s$1o(j,"rayRay"),s$1o(v,"rayRay"),s$1o(z,"rayRay"),s$1o(R,"rayRay");}function Et(t,e){return 3*e+t}const jt=n$1b();function vt(t,e){return r$Y(jt,t[e],t[e+3]),jt}const zt=n$1b(),Rt=e$16();function Ut(t,e,s,a,i){o$1l(zt,s,a),l$11(zt,zt,.5),Rt[0]=zt[0],Rt[1]=zt[1],Rt[2]=0,Rt[3]=zt[1],Rt[4]=-zt[0],Rt[5]=0,Rt[6]=zt[0]*zt[0]+zt[1]*zt[1],Rt[7]=zt[0]*zt[1]-zt[1]*zt[0],Rt[8]=1,Rt[Et(0,2)]=-j$K(vt(Rt,0),t),Rt[Et(1,2)]=-j$K(vt(Rt,1),t);let r=j$K(vt(Rt,0),s)+Rt[Et(0,2)],h=j$K(vt(Rt,1),s)+Rt[Et(1,2)],c=j$K(vt(Rt,0),a)+Rt[Et(0,2)],o=j$K(vt(Rt,1),a)+Rt[Et(1,2)];r=-(r+c)/(h+o),Rt[Et(0,0)]+=Rt[Et(1,0)]*r,Rt[Et(0,1)]+=Rt[Et(1,1)]*r,Rt[Et(0,2)]+=Rt[Et(1,2)]*r,r=1/(j$K(vt(Rt,0),s)+Rt[Et(0,2)]),h=1/(j$K(vt(Rt,1),s)+Rt[Et(1,2)]),Rt[Et(0,0)]*=r,Rt[Et(0,1)]*=r,Rt[Et(0,2)]*=r,Rt[Et(1,0)]*=h,Rt[Et(1,1)]*=h,Rt[Et(1,2)]*=h,Rt[Et(2,0)]=Rt[Et(1,0)],Rt[Et(2,1)]=Rt[Et(1,1)],Rt[Et(2,2)]=Rt[Et(1,2)],Rt[Et(1,2)]+=1,r=j$K(vt(Rt,1),e)+Rt[Et(1,2)],h=j$K(vt(Rt,2),e)+Rt[Et(2,2)],c=j$K(vt(Rt,1),s)+Rt[Et(1,2)],o=j$K(vt(Rt,2),s)+Rt[Et(2,2)],r=-.5*(r/h+c/o),Rt[Et(1,0)]+=Rt[Et(2,0)]*r,Rt[Et(1,1)]+=Rt[Et(2,1)]*r,Rt[Et(1,2)]+=Rt[Et(2,2)]*r,r=j$K(vt(Rt,1),e)+Rt[Et(1,2)],h=j$K(vt(Rt,2),e)+Rt[Et(2,2)],c=-h/r,Rt[Et(1,0)]*=c,Rt[Et(1,1)]*=c,Rt[Et(1,2)]*=c,i[0]=Rt[0],i[1]=Rt[1],i[2]=0,i[3]=Rt[2],i[4]=Rt[3],i[5]=Rt[4],i[6]=0,i[7]=Rt[5],i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=Rt[6],i[13]=Rt[7],i[14]=0,i[15]=Rt[8];}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class r$C{constructor(){this.adds=new n$1l,this.removes=new n$1l,this.updates=new n$1l({allocator:e=>e||new s$D,deallocator:e=>(e.renderGeometry=null,e)});}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear();}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune();}}class s$D{}class t$v{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var E$p;!function(E){var I,T;(I=E.Geometry||(E.Geometry={}))[I.ADD=1]="ADD",I[I.UPDATE=2]="UPDATE",I[I.REMOVE=4]="REMOVE",(T=E.State||(E.State={}))[T.VISIBILITIES=1]="VISIBILITIES",T[T.VERTEXATTRS=2]="VERTEXATTRS",T[T.TRANSFORMATION=4]="TRANSFORMATION",T[T.HIGHLIGHTS=8]="HIGHLIGHTS",T[T.OCCLUDEES=16]="OCCLUDEES";}(E$p||(E$p={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function r$B(r){const n=new Map,a=r=>{let t=n.get(r);return t||(t=new t$v,n.set(r,t)),t};return r.removes.forAll((e=>{t$u(e)&&a(e.material).removes.push(e);})),r.adds.forAll((e=>{t$u(e)&&a(e.material).adds.push(e);})),r.updates.forAll((e=>{t$u(e.renderGeometry)&&a(e.renderGeometry.material).updates.push(e);})),n}function t$u(e){return e.data.indexCount>=1}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class i$y extends c$1d{constructor(s=n$16()){super(),this.origin=s,this.slicePlaneLocalOrigin=this.origin;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function r$A(r,c){c.spherical?r.vertex.code.add(n$19`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):r.vertex.code.add(n$19`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),c.spherical?r.vertex.code.add(n$19`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):r.vertex.code.add(n$19`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function o$v(o){o.fragment.code.add(n$19`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`);}function n$G(o){o.fragment.code.add(n$19`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function n$F(n,d){n.include(n$1r,d),n.include(e$V),n.include(n$G),d.hasCloudsReflections&&n.include(v$H,d),d.hasScreenSpaceReflections&&n.include(n$$,d);const c=n.fragment;c.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),c.code.add(n$19`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),c.uniforms.add([new o$_("lightingSpecularStrength",((e,o)=>o.lighting.mainLight.specularStrength)),new o$_("lightingEnvironmentStrength",((e,o)=>o.lighting.mainLight.environmentStrength))]),c.code.add(n$19`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),d.hasCloudsReflections&&c.code.add(n$19`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),d.hasScreenSpaceReflections?c.code.add(n$19`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):c.code.add(n$19`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),d.hasCloudsReflections?d.hasScreenSpaceReflections?c.code.add(n$19`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):c.code.add(n$19`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):c.code.add(n$19`return waterRenderedColor;
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function l$r(t){t.fragment.uniforms.add(new s$10("texWaveNormal")),t.fragment.uniforms.add(new s$10("texWavePerturbation")),t.fragment.uniforms.add([new e$19("waveParams",(e=>r$17(i$x,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset))),new e$$("waveDirection",(t=>r$Y(f$w,t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)))]),t.include(o$v),t.fragment.code.add(n$19`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`);}const i$x=n$1a(),f$w=n$1b();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function L$k(L){const _=new i$_,{vertex:x,fragment:S}=_,D=d$W(_,L);return _.include(r$10),_.attributes.add(O$J.POSITION,"vec3"),_.attributes.add(O$J.UV0,"vec2"),x.uniforms.add(new e$19("waterColor",(e=>e.color))),L.output!==o$19.Color&&L.output!==o$19.Alpha||(_.include(r$A,L),_.include(t$1f,L),_.varyings.add("vuv","vec2"),_.varyings.add("vpos","vec3"),_.varyings.add("vnormal","vec3"),_.varyings.add("vtbnMatrix","mat3"),S.uniforms.add(D),L.hasMultipassTerrain&&_.varyings.add("depth","float"),x.code.add(n$19`
      void main(void) {
        if (waterColor.a < ${n$19.float(t$19)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${L.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${L.output===o$19.Color?"forwardLinearDepth();":""}
      }
    `)),_.include(n$1q,L),L.output===o$19.Alpha&&(_.include(u$$,L),S.uniforms.add(new o$P("waterColor")),S.code.add(n$19`
        void main() {
          discardBySlice(vpos);
          ${L.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),L.output===o$19.Color&&(_.include(o$$,{isGround:!1}),_.include(m$O,{pbrMode:l$Q.Disabled,lightingSphericalHarmonicsOrder:2}),_.include(l$r),_.include(u$$,L),_.include(c$1e,L),_.include(n$F,L),S.uniforms.add([new o$P("waterColor"),new e$_("lightingMainDirection",((e,i)=>i.lighting.lightingMainDirection)),new e$_("lightingMainIntensity",((e,i)=>i.lighting.mainLight.intensity)),new o$_("timeElapsed",(e=>e.timeElapsed)),new o$12("view")]),c$1a(S,L),S.include(e$14),S.code.add(n$19`
      void main() {
        discardBySlice(vpos);
        ${L.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${L.receiveShadows?n$19`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${L.transparencyPassType===O$L.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),L.output===o$19.Normal&&(_.include(r$A,L),_.include(l$r,L),_.include(u$$,L),_.varyings.add("vpos","vec3"),_.varyings.add("vuv","vec2"),x.code.add(n$19`
        void main(void) {
          if (waterColor.a < ${n$19.float(t$19)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),S.uniforms.add(new o$_("timeElapsed",(e=>e.timeElapsed))),S.code.add(n$19`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),L.output===o$19.Draped&&(_.varyings.add("vpos","vec3"),x.code.add(n$19`
        void main(void) {
          if (waterColor.a < ${n$19.float(t$19)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),S.uniforms.add(new o$P("waterColor")),S.code.add(n$19`void main() {
gl_FragColor = waterColor;
}`)),L.output===o$19.Highlight&&(_.include(a$19),_.varyings.add("vpos","vec3"),x.code.add(n$19`
      void main(void) {
        if (waterColor.a < ${n$19.float(t$19)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),_.include(u$$,L),S.code.add(n$19`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),_}const _$l=Object.freeze(Object.defineProperty({__proto__:null,build:L$k},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class S$n extends e$11{constructor(e,t,o){super(e,t,o),this._textureRepository=e.waterTextureRepository;}initializeConfiguration(e,o){o.spherical=e.viewingMode===l$O.Global,o.doublePrecisionRequiresObfuscation=r$1c(e.rctx);}initializeProgram(e){const t=S$n.shader.get().build(this.configuration);return new o$Z(e.rctx,t,E$E)}bindPass(e,t){this.program.bindPass(e,t),this.configuration.output!==o$19.Color&&this.configuration.output!==o$19.Normal||this._textureRepository.bind(this.program);}_setPipelineState(e){const t=this.configuration,r=e===O$L.NONE,i=e===O$L.FrontFace;return W$h({blending:t.output!==o$19.Normal&&t.output!==o$19.Highlight&&t.transparent?r?c$1c:E$J(e):null,depthTest:{func:l$13(e)},depthWrite:r?t.writeDepth&&a$1a:S$H(e),colorWrite:c$10,polygonOffset:r||i?null:i$1c(t.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}S$n.shader=new t$W(_$l,(()=>import('./WaterSurface.glsl-7e85f3b4.js')));class T$o extends i$17{constructor(){super(...arguments),this.output=o$19.Color,this.transparencyPassType=O$L.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1;}}e$Y([e$12({count:o$19.COUNT})],T$o.prototype,"output",void 0),e$Y([e$12({count:O$L.COUNT})],T$o.prototype,"transparencyPassType",void 0),e$Y([e$12()],T$o.prototype,"spherical",void 0),e$Y([e$12()],T$o.prototype,"receiveShadows",void 0),e$Y([e$12()],T$o.prototype,"hasSlicePlane",void 0),e$Y([e$12()],T$o.prototype,"transparent",void 0),e$Y([e$12()],T$o.prototype,"enableOffset",void 0),e$Y([e$12()],T$o.prototype,"writeDepth",void 0),e$Y([e$12()],T$o.prototype,"hasScreenSpaceReflections",void 0),e$Y([e$12()],T$o.prototype,"doublePrecisionRequiresObfuscation",void 0),e$Y([e$12()],T$o.prototype,"hasCloudsReflections",void 0),e$Y([e$12()],T$o.prototype,"isDraped",void 0),e$Y([e$12()],T$o.prototype,"hasMultipassTerrain",void 0),e$Y([e$12()],T$o.prototype,"cullAboveGround",void 0),e$Y([e$12({constValue:l$Q.Water})],T$o.prototype,"pbrMode",void 0),e$Y([e$12({constValue:!0})],T$o.prototype,"useCustomDTRExponentForWater",void 0),e$Y([e$12({constValue:!0})],T$o.prototype,"highStepCount",void 0),e$Y([e$12({constValue:!1})],T$o.prototype,"useFillLights",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class o$u extends t$1d{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled});}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled});}_updateCloudsReflectionState(t){const a=r$W(t.clouds.data);a!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:a});}ensureResources(e){const t=this._techniqueRepository.constructionContext.waterTextureRepository;return t.resourceState===i$1a.NOT_LOADED&&t.loadTextures(e),t.resourceState}beginSlot(e){return this._output===o$19.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this.ensureTechnique(S$n,e)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const f$v=T$C().vec3f(O$J.POSITION),o$t=T$C().vec3f(O$J.POSITION).vec2f(O$J.UV0),u$v=T$C().vec3f(O$J.POSITION).vec4u8(O$J.COLOR);class i$w{constructor(e){this.vertexBufferLayout=e;}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(O$J.POSITION).length}write(e,t,f,o){h$10(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,f,o);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class d$w extends d$X{constructor(e){super(e,new A$j),this._techniqueConfig=new T$o,this.animation=new i$R;}getConfiguration(e,t){return this._techniqueConfig.output=e,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._techniqueConfig.hasCloudsReflections=this.parameters.hasCloudsReflections,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=t.transparencyPassType,this._techniqueConfig.enableOffset=t.camera.relativeElevation<_$A,this._techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this._techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this._techniqueConfig}update(t){const i=Math.min(t.camera.relativeElevation,t.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<R$k;const r=this.animation.advance(t);return this.setParameters({timeElapsed:u$Y(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&r}intersect(e,t,i,r,s,a,n){x$M(e,t,r,s,a,void 0,n);}requiresSlot(e,t){switch(i$A(t)){case o$19.Normal:return e===E$G.DRAPED_WATER;case o$19.Color:if(this.parameters.isDraped)return e===E$G.DRAPED_MATERIAL;break;case o$19.Highlight:return e===E$G.OPAQUE_MATERIAL||e===E$G.DRAPED_MATERIAL}let i=E$G.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?E$G.TRANSPARENT_MATERIAL:E$G.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){if(e.output===o$19.Color&&this.parameters.isDraped)return e.output=o$19.Draped,new o$u(e);switch(e.output){case o$19.Color:case o$19.Normal:case o$19.Highlight:case o$19.Alpha:return new o$u(e)}return null}createBufferWriter(){return new i$w(o$t)}}class A$j extends o$1h{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=r$13(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=r$Z(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1;}}const R$k=35e3;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class t$t{constructor(t){this.first=t.from,this.count=t.to-t.from;}}class s$C{constructor(t=0,s=0){this.from=t,this.to=s;}}class o$s extends s$C{constructor(t,s,o,r,n,i){super(s,o),this.id=t,this.isVisible=r,this.hasHighlights=n,this.hasOccludees=i;}}function r$z(t){return Array.from(t.values()).sort(n$E)}function n$E(t,s){return t.from===s.from?t.to-s.to:t.from-s.from}function i$v(s,o){if(0===s.length)return void s.push(new t$t(o));const r=s[s.length-1];if(c$w(r,o)){const t=o.from-r.first+o.to-o.from;r.count=t;}else s.push(new t$t(o));}function c$w(t,s){return t.first+t.count>=s.from}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class e$y{constructor(e,r){this._pool=e,this._size=0,this._buffer=e.newBuffer(s$B(r));}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0;}release(){this.erase(0,this._size),this.dispose();}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(e){this._resize(this._size+e,!0).dispose();}alloc(e){return this._resize(e,!1)}_resize(e,r){let s;const i=t$s(this._buffer.length,this._size,e);if(this._buffer.length!==i){const e=this._pool.newBuffer(i);r&&(e.array.set(this._buffer.array.subarray(0,Math.min(this._size,i))),e.vao.vertexBuffers.geometry.setSubData(e.array,0,0,e.array.byteLength)),s=this._buffer,this._buffer=e;}const f=this._size;return this._size=e,s?{dispose:()=>{s.array.fill(0,0,f),this._pool.deleteBuffer(s);},copy:(e,r,t)=>this._buffer.array.set(s.array.subarray(r,t),e),hasNewBuffer:!0}:{dispose:()=>{},copy:(e,r,s)=>{e!==r&&this._buffer.array.copyWithin(e,r,s);},hasNewBuffer:!1}}erase(e,r){this._buffer.array.fill(0,e,r);}}const r$y=65536;function s$B(e){return Math.ceil(e/r$y)*r$y}function t$s(e,r,t){return r<=t?e>=t?e:s$B(Math.max(2*e,t)):e<=2*t?e:s$B(t)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$A{constructor(s,o,a,i){this.vao=new f$U(s,o,{geometry:a},{geometry:c$13.createVertex(s,F$r.STATIC_DRAW)}),this.array=new Float32Array(i),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength);}dispose(){this.vao.dispose(!0);}get length(){return this.array.length}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const s$z=s$1p+1;class h$s{constructor(t,e,r){this._rctx=t,this._locations=e,this._layout=r,this._cache=t.newCache(`MergedRenderer pool ${e$1e()}`,i$u);}dispose(){this._cache.destroy();}newBuffer(e){const r=e.toString(),o=this._cache.pop(r);if(r$W(o)){const t=o.pop();return o.length>0&&this._cache.put(r,o,t.array.byteLength*o.length,s$z),t}return new s$A(this._rctx,this._locations,this._layout,e)}deleteBuffer(e){const r=e.array.byteLength,o=e.array.length.toString(),c=this._cache.pop(o);return r$W(c)?(c.push(e),this._cache.put(o,c,r*c.length,-1)):this._cache.put(o,[e],r,-1),null}}function i$u(t,r){if(r===i$1d.ALL)return void t.forEach((t=>t.dispose()));const o=t.pop(),c=t.length*o.array.byteLength;return o.dispose(),c}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class A$i{constructor(e,t,r){this._rctx=e,this._materialRepository=t,this._material=r,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new n$1l,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new a$y(this._material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._bufferPool=new h$s(e,r.vertexAttributeLocations,o$13(this._bufferWriter.vertexBufferLayout));}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach((e=>e.buffer.dispose())),this._dataByOrigin.clear(),this._bufferPool.dispose();}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return !this.isEmpty&&this._material instanceof d$w}get rendersOccluded(){return !this.isEmpty&&this._material.renderOccluded!==h$Z.Occlude}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateRenderCommands();}_addAndRemoveGeometries(e,t){const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,i=this._dataByOrigin,a=R$j(e,t);a.forEach(((e,t)=>{a.delete(t);const o=e.toAdd.reduce(((e,t)=>e+r.elementCount(t.data)),0);let n=i.get(t);if(null==n)e$18(0===e.toRemove.length),n=new D$e(e.origin,new e$y(this._bufferPool,o*s)),i.set(t,n);else if(0===e.toAdd.length&&n.instances.size===e.toRemove.length)return n.buffer.dispose(),void i.delete(t);let d=0;n.instances.forEach((e=>d+=e.to-e.from));const h=e.toRemove.reduce(((e,t)=>e+r.elementCount(t.data)),0),l=n.buffer.size,m=(d+o-h)*s,f=T$n;if(m<l/2?this._removeAndRebuild(n,e.toRemove,s,m,f):e.toRemove.length>0&&this._remove(n,e.toRemove,s,f),e.toAdd.length>0){const t=L$j;h$11(t,-e.origin[0],-e.origin[1],-e.origin[2]),this._add(n,e.toAdd,s,t,f);}const g=n.buffer.vao.vertexBuffers.geometry;B$h(f),f.forAll((({from:e,to:t})=>{if(e<t){const r=n.buffer.array,s=4,i=e*s,a=t*s;g.setSubData(r,i,i,a);}})),f.clear(),n.drawCommandsDirty=!0;}));}_updateGeometries(e){const t=this._bufferWriter,r=t.vertexBufferLayout.stride/4;for(const s of e){const e=s.renderGeometry,i=this._dataByOrigin.get(e.origin.id),a=i&&i.instances.get(e.id);if(!a)return;const o=s.updateType;if(o&E$p.State.VISIBILITIES&&(a.isVisible=e.instanceParameters.visible),o&(E$p.State.HIGHLIGHTS|E$p.State.VISIBILITIES)){const t=e.instanceParameters.visible;a.hasHighlights=!!e.instanceParameters.highlights&&t;}if(o&E$p.State.OCCLUDEES&&(a.hasOccludees=!!e.instanceParameters.occludees),o&(E$p.State.VERTEXATTRS|E$p.State.TRANSFORMATION)){const{array:s,vao:o}=i.buffer;l$16(e,P$i,j$q),t.write({transformation:P$i,invTranspTransformation:j$q},e.data,t.vertexBufferLayout.createView(s.buffer),a.from),e$18(a.from+t.elementCount(e.data)===a.to,"material VBO layout has changed"),o.vertexBuffers.geometry.setSubData(s,a.from*r*4,a.from*r*4,a.to*r*4);}i.drawCommandsDirty=!0;}}_updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((t=>{t.hasHiddenInstances=!1,t.hasHighlights=!1,t.hasOccludees=!1,n$1m(t.instances,(e=>(e.isVisible?(e.hasHighlights&&(this._hasHighlights=!0,t.hasHighlights=!0),e.hasOccludees&&(this._hasOccludees=!0,t.hasOccludees=!0)):t.hasHiddenInstances=!0,t.hasHiddenInstances&&t.hasHighlights&&t.hasOccludees)));}));const t=e=>{if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.drawCommandsShadowHighlightRest=null,0===e.instances.size)return;if(!I$k(e)){const t=this._bufferWriter.vertexBufferLayout.stride,r=4*e.buffer.size/t;return void(e.drawCommandsDefault=[{first:0,count:r}])}const t=r$z(e.instances);e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[],e.drawCommandsShadowHighlightRest=[];for(const r of t)r.isVisible&&(r.hasOccludees?i$v(e.drawCommandsOccludees,r):i$v(e.drawCommandsDefault,r),r.hasHighlights?i$v(e.drawCommandsHighlight,r):i$v(e.drawCommandsShadowHighlightRest,r));};this._dataByOrigin.forEach((e=>{e.drawCommandsDirty&&(t(e),e.drawCommandsDirty=!1);}));}updateAnimation(e){return this._material.update(e)}requiresSlot(e,t){return null==e||this._material.requiresSlot(e,t)}render(e,s){if(!this.requiresSlot(s.slot,e))return !1;const i=e===A$D.MATERIAL_HIGHLIGHT||e===A$D.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(i&&!this._hasHighlights)return !1;const a=e===A$D.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,o=!(i||a);if(this._dataByOrigin.forEach((e=>{if(i&&!e.hasHighlights)return;const r=(i?e.drawCommandsHighlight:a&&I$k(e)?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,s=o&&e.drawCommandsOccludees||null;(r$W(r)||r$W(s))&&this._renderCommandData.push(new M$h(e.origin,e.buffer,r,s));})),0===this._renderCommandData.length)return !1;const n=this._rctx,d=this._glMaterials.load(n,e);if(t$V(d))return this._renderCommandData.clear(),!1;const h=d.beginSlot(s);return n.bindTechnique(h,this._material.parameters,s,!1),this._renderCommandData.forAll((e=>{h.bindDraw(e,s);const{buffer:r,renderCommands:i,occludeeCommands:a}=e;h.ensureAttributeLocations(r.vao),n.bindVAO(r.vao);const o=h.primitiveType;r$W(i)&&this._renderCommands(n,o,i),r$W(a)&&(h.bindPipelineState(n,s.slot,!0),this._renderCommands(n,o,a),h.bindPipelineState(n,s.slot,!1));})),this._renderCommandData.clear(),!0}_renderCommands(e,t,r){for(let s=0;s<r.length;s++)e.drawArrays(t,r[s].first,r[s].count);}_removeAndRebuild(e,t,r,s,i){for(const h of t)e.instances.delete(h.id);const a=r$z(e.instances);e.instances.clear();const o=e.buffer.size,n=e.buffer.alloc(s);let d=0;for(const h of a){const t=h.from*r,s=h.to*r;n.copy(d,t,s),h.from=d/r,d+=s-t,h.to=d/r,e.instances.set(h.id,h);}i.push(new s$C(0,n.hasNewBuffer?e.buffer.array.length:o)),n.dispose(),e.buffer.erase(d,i.back().to),e.holes.clear();}_remove(e,t,r,s){for(const i of t){const t=i.id,a=e.instances.get(t),o=a.from*r,n=a.to*r;e.buffer.erase(o,n),e.holes.push(new s$C(a.from,a.to)),e.instances.delete(t),s.push(new s$C(o,n));}B$h(e.holes);}_add(e,s,n,d,h){if(0===s.length)return;const l=this._bufferWriter;let m=l.vertexBufferLayout.createView(e.buffer.array.buffer);const f=e.holes.length>0;let u=Number.MAX_SAFE_INTEGER,g=Number.MIN_SAFE_INTEGER;for(const _ of s){const s=r$W(_.transformation)?u$Z(P$i,d,_.transformation):d;h$U(j$q,s);const p=o$15(j$q,j$q),y=l.elementCount(_.data),C=y*n;let H=E$o(e.holes,y);t$V(H)&&(H=e.buffer.size/n,e.buffer.grow(C),m=l.vertexBufferLayout.createView(e.buffer.array.buffer)),l.write({transformation:s,invTranspTransformation:p},_.data,m,H);const v=_.instanceParameters.visible,A=!!_.instanceParameters.highlights&&v,O=!!_.instanceParameters.occludees,R=new o$s(_.id,H,H+y,v,A,O);e$18(null==e.instances.get(_.id)),e.instances.set(_.id,R),f?h.push(new s$C(R.from*n,R.to*n)):(u=Math.min(R.from,u),g=Math.max(R.to,g));}f||h.push(new s$C(u*n,g*n));}get test(){return {material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class O$q{constructor(e){this.origin=e,this.toAdd=new Array,this.toRemove=new Array;}}function R$j(e,t){const r=new Map;for(const s of e)S$m(r,s,!0);for(const s of t)S$m(r,s,!1);return r}function S$m(e,t,s){const i=t.origin;if(t$V(i))return;let a=e.get(i.id);null==a&&(a=new O$q(i.vec3),e.set(i.id,a)),s?a.toAdd.push(t):a.toRemove.push(t);}function I$k(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function E$o(e,t){let r;if(!e.some((e=>!(e.to-e.from<t)&&(r=e,!0))))return null;const s=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),s}function B$h(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let r=!0;for(;r;)r=!1,e.forEach((s=>{const i=t.get(s.to);i&&(s.to=i.to,t.delete(i.from),e.removeUnordered(i),r=!0);}));}class D$e{constructor(e,t){this.origin=e,this.buffer=t,this.instances=new Map,this.holes=new n$1l({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1;}}class M$h extends i$y{constructor(e,t,r,s){super(e),this.buffer=t,this.renderCommands=r,this.occludeeCommands=s;}}const T$n=new n$1l({deallocator:null}),L$j=e$10(),P$i=e$10(),j$q=e$10();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let y$p=class extends y$F{constructor(e){super(e),this._pending=new f$u,this._changes=new r$C,this._materialRenderers=new Map,this._sortedMaterialRenderers=new n$1l,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1;}destroy(){this._changes.prune(),this._materialRenderers.forEach((e=>e.dispose())),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear();}get updating(){return !this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return n$1m(this._materialRenderers,(e=>e.rendersOccluded))}get isEmpty(){return !this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}commitChanges(){if(!this.updating)return !1;this._processAddsRemoves();const e=r$B(this._changes);let r=!1,s=!1,i=!1;return e.forEach(((e,t)=>{let a=this._materialRenderers.get(t);if(!a&&e.adds.length>0&&(a=new A$i(this.rctx,this._materialRepository,t),this._materialRenderers.set(t,a),r=!0,s=!0,i=!0),!a)return;const n=s||a.hasHighlights,o=i||a.hasWater;a.modify(e),s=s||n!==a.hasHighlights,i=i||o!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(t),a.dispose(),r=!0);})),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),s&&(this._hasHighlights=n$1m(this._materialRenderers,(e=>e.hasHighlights))),i&&(this._hasWater=n$1m(this._materialRenderers,(e=>e.hasWater))),this.notifyChange("updating"),!0}addGeometries(e,r){if(0===e.length)return;const t=this._validateRenderGeometries(e);for(const i of t)this._geometries.set(i.id,i);const s=this._pending.empty;for(const i of t)this._pending.adds.add(i);s&&this.notifyChange("updating"),r===E$p.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e);}removeGeometries(e,r){const t=this._pending.empty,i=this._pending.adds;for(const a of e)i.has(a)?(this._pending.removed.add(a),i.delete(a)):this._pending.removed.has(a)||this._pending.removes.add(a),this._geometries.delete(e$X(a.id));t&&!this._pending.empty&&this.notifyChange("updating"),r===E$p.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e);}modifyGeometries(e,r){const t=0===this._changes.updates.length;for(const s of e){const e=this._changes.updates.pushNew();e.renderGeometry=this._validateRenderGeometry(s),e.updateType=r;}switch(t&&this._changes.updates.length>0&&this.notifyChange("updating"),r){case E$p.State.TRANSFORMATION:case E$p.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(e);case E$p.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let r=!1;return this._sortedMaterialRenderers.forAll((({materialRenderer:t})=>r=t.updateAnimation(e)||r)),r}render(e,r){for(let t=0;t<this._sortedMaterialRenderers.length;t++){const s=this._sortedMaterialRenderers.data[t];s.material.shouldRender(e)&&s.materialRenderer.render(e.pass,r);}}intersect(e,r,t,s,i){return this._geometries.forEach((a=>{if(s&&!s(a))return;this._intersectRenderGeometry(a,t,r,0,e,i);const n=this.rendererContext.longitudeCyclical;n&&(a.boundingSphere[0]-a.boundingSphere[3]<n.min&&this._intersectRenderGeometry(a,t,r,n.range,e,i),a.boundingSphere[0]+a.boundingSphere[3]>n.max&&this._intersectRenderGeometry(a,t,r,-n.range,e,i)),i++;})),i}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach(((r,t)=>{t.insertOrder=e++,this._sortedMaterialRenderers.push({material:t,materialRenderer:r});})),this._sortedMaterialRenderers.sort(((e,r)=>{const t=r.material.renderPriority-e.material.renderPriority;return 0!==t?t:e.material.insertOrder-r.material.insertOrder}));}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const r=this._changes.updates.data[e];this._pending.has(r.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++;}this._pending.clear();}_intersectRenderGeometry(e,r,t,s,a,n){if(!e.instanceParameters.visible)return;let o=0;r$W(e.transformation)&&(s+=e.transformation[12],o=e.transformation[13]),G$d[0]=t[0]-s,G$d[1]=t[1]-o,G$d[2]=1,S$l[0]=t[0]-s,S$l[1]=t[1]-o,S$l[2]=0,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),a,G$d,S$l,((t,s,i)=>{R$i(r,i,e.material.renderPriority,n,a,e.layerUid,e.graphicUid);}),e.calculateShaderTransformation,r);}_notifyGraphicGeometryChanged(e){if(t$V(this.drapeSource.notifyGraphicGeometryChanged))return;let r;for(const t of e){const e=t.graphicUid;r$W(e)&&e!==r&&(this.drapeSource.notifyGraphicGeometryChanged(e),r=e);}}_notifyGraphicVisibilityChanged(e){if(t$V(this.drapeSource.notifyGraphicVisibilityChanged))return;let r;for(const t of e){const e=t.graphicUid;r$W(e)&&e!==r&&(this.drapeSource.notifyGraphicVisibilityChanged(e),r=e);}}_validateRenderGeometries(e){for(const r of e)this._validateRenderGeometry(r);return e}_validateRenderGeometry(e){return t$V(e.origin)&&(e.origin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return {sortedMaterialRenderers:this._sortedMaterialRenderers}}};e$Y([d$R()],y$p.prototype,"drapeSource",void 0),e$Y([d$R()],y$p.prototype,"updating",null),e$Y([d$R()],y$p.prototype,"rctx",null),e$Y([d$R()],y$p.prototype,"rendererContext",void 0),e$Y([d$R()],y$p.prototype,"_materialRepository",null),e$Y([d$R()],y$p.prototype,"_localOriginFactory",null),y$p=e$Y([n$18("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],y$p);class f$u{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set;}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear();}}function R$i(e,r,t,s,i,a,n){const o={layerUid:a,graphicUid:n,triangleNr:r},d=r=>{r.set(i$1e.OVERLAY,o,e.dist,e.normal,e.transformation,t,s);};if((null==i.results.min.drapedLayerOrder||t>=i.results.min.drapedLayerOrder)&&(null==i.results.min.dist||i.results.ground.dist<=i.results.min.dist)&&d(i.results.min),i.options.store!==t$1g.MIN&&(null==i.results.max.drapedLayerOrder||t<i.results.max.drapedLayerOrder)&&(null==i.results.max.dist||i.results.ground.dist>i.results.max.dist)&&d(i.results.max),i.options.store===t$1g.ALL){const e=U$v(i.ray);d(e),i.results.all.push(e);}}const G$d=n$16(),S$l=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function n$D(r){r.fragment.uniforms.add(new e$19("projInfo",((r,o)=>f$t(o)))),r.fragment.uniforms.add(new e$$("zScale",((r,o)=>i$t(o)))),r.fragment.code.add(n$19`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`);}function f$t(r){const o=r.camera.projectionMatrix;return 0===o[11]?r$17(m$s,2/(r.camera.fullWidth*o[0]),2/(r.camera.fullHeight*o[5]),(1+o[12])/o[0],(1+o[13])/o[5]):r$17(m$s,-2/(r.camera.fullWidth*o[0]),-2/(r.camera.fullHeight*o[5]),(1-o[8])/o[0],(1-o[9])/o[5])}const m$s=n$1a();function i$t(o){return 0===o.camera.projectionMatrix[11]?r$Y(d$v,0,1):r$Y(d$v,1,0)}const d$v=n$1b();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var u$u;!function(o){o[o.SSAO=0]="SSAO",o[o.Blur=1]="Blur",o[o.COUNT=2]="COUNT";}(u$u||(u$u={}));class e$x extends t$X{constructor(){super(...arguments),this.output=u$u.SSAO;}}e$Y([e$12({count:u$u.COUNT})],e$x.prototype,"output",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const f$s={samples:16,filterRadius:4};function u$t(u){const p=new i$_,m=p.fragment;if(p.include(o$M),u.output===u$u.Blur){const e=(f$s.filterRadius+1)/2,o=1/(2*e*e);m.include(a$Y),m.uniforms.add([new s$10("normalMap"),new s$10("depthMap"),new s$10("tex"),new o$R("blurSize"),new r$R("projScale"),new e$$("nearFar",((e,r)=>r.camera.nearFar))]),m.code.add(n$19`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${n$19.float(o)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),m.code.add(n$19`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${n$19.int(f$s.filterRadius)}; r <= ${n$19.int(f$s.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `);}return u.output===u$u.SSAO&&(m.include(a$Y),p.include(n$D),m.uniforms.add(new s$10("normalMap")),m.uniforms.add(new s$10("depthMap")),m.uniforms.add(new s$10("rnm")),m.uniforms.add(new r$R("intensity")),m.uniforms.add(new r$R("projScale")),m.uniforms.add(new r$R("radius")),m.uniforms.add(new e$$("nearFar",((e,r)=>r.camera.nearFar))),m.uniforms.add(new o$R("screenSize")),m.uniforms.add(new o$R("rnmScale")),m.code.add(n$19`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),m.code.add(n$19`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),p.fragment.uniforms.add(new e$$("zScale",((e,r)=>i$t(r)))),m.code.add(n$19`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${n$19.int(f$s.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
          vec2 tcTap = tc / screenSize;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${n$19.int(f$s.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `)),p}const p$o=Object.freeze(Object.defineProperty({__proto__:null,build:u$t},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class n$C extends e$11{initializeProgram(e){const r=n$C.shader.get().build(this.configuration);return new o$Z(e.rctx,r,E$E)}initializePipeline(){return W$h({colorWrite:c$10})}}n$C.shader=new t$W(p$o,(()=>import('./SSAO.glsl-483b389e.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class x$m{constructor(e,t,s){this._techniqueRep=e,this._rctx=t,this._requestRender=s,this._enabled=!1,this._ssaoTechniqueConfig=new e$x,this.quadVAO=null,this._blurSizePx=2,this._attenuation=.5;}dispose(){this.quadVAO=s$1a(this.quadVAO);}disposeOffscreenBuffers(){o$1m(this._ssaoFBO,(e=>e.resize(0,0))),o$1m(this._blur0FBO,(e=>e.resize(0,0))),o$1m(this._blur1FBO,(e=>e.resize(0,0)));}set enabled(e){e?this._enable():this._disable();}get enabled(){return this._enabled}get ready(){return this.enabled&&r$W(this._noiseTexture)&&r$W(this._ssaoFBO)&&r$W(this._blur0FBO)&&r$W(this._blur1FBO)}get colorTexture(){return r$W(this._blur1FBO)?this._blur1FBO.colorTexture:null}get width(){return r$W(this._ssaoFBO)?this._ssaoFBO.width:-1}get height(){return r$W(this._ssaoFBO)?this._ssaoFBO.height:-1}computeSSAO(e,t,s){if(!this.enabled||t$V(t)||t$V(s)||t$V(this._noiseTexture)||t$V(this._ssaoFBO)||t$V(this._blur0FBO)||t$V(this._blur1FBO))return;const h=this._rctx,o=e.camera,n=o.fullViewport,a=n[2],_=n[3],b=a/this._blurSizePx,d=_/this._blurSizePx;this._ssaoFBO.resize(a,_),this._blur0FBO.resize(b,d),this._blur1FBO.resize(b,d);const c=1,m=1,O=a*c,T=_*m;h.bindFramebuffer(this._ssaoFBO),h.setViewport(0,0,a,_);const p=h.bindTechnique(this._ssaoTechnique,g$r,e);p.setUniform2f("rnmScale",a/this._noiseTexture.descriptor.width,_/this._noiseTexture.descriptor.height);let f=1/o.computeRenderPixelSizeAtDist(1);p.setUniform1f("projScale",f*c),p.setUniform2f("screenSize",O,T);const B=x$H(o.eye,o.center);let x=20*o.computeRenderPixelSizeAtDist(B);x=Math.max(.1,x),p.setUniform1f("radius",x),p.setUniform1f("intensity",4*this._attenuation/x**6),p.bindTexture("rnm",this._noiseTexture),p.bindTexture("normalMap",s),p.bindTexture("depthMap",t),t$V(this.quadVAO)&&(this.quadVAO=u$V(this._rctx)),h.bindVAO(this.quadVAO),h.drawArrays(E$F.TRIANGLE_STRIP,0,n$1d(this.quadVAO,"geometry"));const q=h.bindTechnique(this._blurTechnique,g$r,e);q.bindTexture("tex",this._ssaoFBO.colorTexture),q.bindTexture("normalMap",s),q.bindTexture("depthMap",t),h.setViewport(0,0,O/this._blurSizePx,T/this._blurSizePx),h.bindFramebuffer(this._blur0FBO),q.setUniform2f("screenSize",O,T),q.setUniform2f("blurSize",0,this._blurSizePx*c/T),B>5e4&&(f=Math.max(0,f-(B-5e4))),q.setUniform1f("projScale",f),h.drawArrays(E$F.TRIANGLE_STRIP,0,n$1d(this.quadVAO,"geometry")),q.setUniform2f("blurSize",this._blurSizePx*m/O,0),h.bindFramebuffer(this._blur1FBO),q.bindTexture("tex",this._blur0FBO.colorTexture),h.drawArrays(E$F.TRIANGLE_STRIP,0,n$1d(this.quadVAO,"geometry")),h.setViewport(n[0],n[1],n[2],n[3]);}_selectPrograms(){this._ssaoTechniqueConfig.output=u$u.SSAO,this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(n$C,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=u$u.Blur,this._blurTechnique=this._techniqueRep.releaseAndAcquire(n$C,this._ssaoTechniqueConfig,this._blurTechnique);}_enable(){this.enabled||(this._enabled=!0,this._loadResources((()=>{this._enabled&&this._initialize();})));}_loadResources(e){this._data?e():import('./SSAOHelperData-3d619aea.js').then((t=>{this._data=t,e();}));}_initialize(){const e={target:M$v.TEXTURE_2D,pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,samplingMode:L$C.LINEAR,wrapMode:D$q.CLAMP_TO_EDGE,width:0,height:0},t={colorTarget:Y$d.TEXTURE,depthStencilTarget:V$q.NONE};t$10(this._data.noiseTexture).then((s=>{this._enabled&&(this._ssaoFBO=new D$p(this._rctx,t,e),this._blur0FBO=new D$p(this._rctx,t,e),this._blur1FBO=new D$p(this._rctx,t,e),this._noiseTexture=new u$X(this._rctx,{target:M$v.TEXTURE_2D,pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,hasMipmap:!0,width:s.width,height:s.height},s),this._requestRender());})),this._selectPrograms();}_disable(){this._enabled=!1,this._noiseTexture=s$1a(this._noiseTexture),this._blur1FBO=s$1a(this._blur1FBO),this._blur0FBO=s$1a(this._blur0FBO),this._ssaoFBO=s$1a(this._ssaoFBO);}get gpuMemoryUsage(){return (r$W(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(r$W(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(r$W(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return {ssao:this._ssaoFBO,blur:this._blur1FBO}}}const g$r=new t$Y;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function s$y(){const s=new i$_;return s.include(o$M),s.fragment.uniforms.add([new s$10("tex"),new o$P("uColor")]),s.fragment.code.add(n$19`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),s}const t$r=Object.freeze(Object.defineProperty({__proto__:null,build:s$y},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class m$r extends e$11{initializeProgram(e){const r=m$r.shader.get().build();return new o$Z(e.rctx,r,E$E)}initializePipeline(){return this.configuration.hasAlpha?W$h({blending:l$P(R$u.SRC_ALPHA,R$u.ONE,R$u.ONE_MINUS_SRC_ALPHA,R$u.ONE_MINUS_SRC_ALPHA),colorWrite:c$10}):W$h({colorWrite:c$10})}}m$r.shader=new t$W(t$r,(()=>import('./TextureOnly.glsl-ff244914.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class r$x extends t$X{constructor(){super(...arguments),this.hasAlpha=!1;}}e$Y([e$12()],r$x.prototype,"hasAlpha",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class c$v{constructor(e){this._rctx=e,this.cache=new Map;}dispose(){this.cache.forEach((e=>e.texture=s$1a(e.texture))),this.cache.clear();}_acquire(e){if(t$V(e))return null;const t=this._patternId(e),i=this.cache.get(t);if(i)return i.refCount++,i.bind;const c=e.pixelRatio,{encodedData:h,sdfNormalizer:l,pixels:p,paddedPixels:d}=u$s(e.pattern,c),f=p/c,x={refCount:1,texture:null,bind:e=>(t$V(x.texture)&&(x.texture=new u$X(this._rctx,{width:d,height:1,internalFormat:P$w.RGBA,pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,wrapMode:D$q.CLAMP_TO_EDGE},h)),e.bindTexture("stipplePatternTexture",x.texture),{pixelSize:f,sdfNormalizer:l,pixels:p})};return this.cache.set(t,x),x.bind}release(e){if(t$V(e))return;const t=this._patternId(e),o=this.cache.get(t);o&&(o.refCount--,0===o.refCount&&(r$W(o.texture)&&o.texture.dispose(),this.cache.delete(t)));}swap(e,t){const r=this._acquire(t);return this.release(e),r}_patternId(e){return `${e.pattern.join(",")}-r${e.pixelRatio}`}}function u$s(t,r){const i=t.map((e=>Math.round(e*r))),o=1/r,a=Math.floor(i.reduce(((e,t)=>e+t))),n=i.reduce(((e,t)=>Math.max(e,t))),s=(Math.floor(.5*(n-1))+.5)*o,c=[];let u=1;for(const e of i){for(let t=0;t<e;t++){const r=u*(Math.min(t,e-1-t)+.5)*o/s*.5+.5;c.push(r);}u=-u;}const h=Math.round(i[0]/2),l=[...c.slice(h),...c.slice(0,h)],p=a+2,d=new Uint8Array(4*p);let f=4;for(const x of l)o$18(x,d,f),f+=4;return d.copyWithin(0,f-4,f),d.copyWithin(f,4,8),{encodedData:d,sdfNormalizer:s,paddedPixels:p,pixels:a}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var n$B,o$r;!function(a){a[a.Standard=0]="Standard",a[a.TransparentToHUDVisibility=1]="TransparentToHUDVisibility",a[a.Transparency=2]="Transparency",a[a.OverlayWithTransparency=3]="OverlayWithTransparency",a[a.COUNT=4]="COUNT";}(n$B||(n$B={})),function(a){a[a.None=0]="None",a[a.Alpha=1]="Alpha",a[a.PremultipliedAlpha=2]="PremultipliedAlpha",a[a.COUNT=3]="COUNT";}(o$r||(o$r={}));class i$s extends t$X{constructor(){super(...arguments),this.function=n$B.Standard,this.alphaMode=o$r.None,this.hasOpacityFactor=!1;}}e$Y([e$12({count:n$B.COUNT})],i$s.prototype,"function",void 0),e$Y([e$12({count:o$r.COUNT})],i$s.prototype,"alphaMode",void 0),e$Y([e$12()],i$s.prototype,"hasOpacityFactor",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let he$9=class extends(s$G(y$F)){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new u$U,this._frameTask=Q$k,this._drapeSourceRenderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers=new n$1l,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.worldToPCSRatio=1,this.events=new n$17,this.longitudeCyclical=null;}get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const r=e.waterTextureRepository;this._stippleTextureRepository=new c$v(e.renderingContext),this._shaderTechniqueRepository=new s$H({rctx:this._rctx,viewingMode:l$O.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:r}),this._renderContext=new n$H(this._rctx,new Q$a(this._rctx,this.view.state.viewingMode),new x$m(this._shaderTechniqueRepository,this._rctx,(()=>{}))),this._handles.add([l$M((()=>r.updating),(()=>this.events.emit("content-changed")),w$x),l$M((()=>this.spatialReference),(e=>this._localOriginFactory=new j$r(e)),w$x),a$Z((()=>this.view.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0))]),this._materialRepository=new l$u(e.textureRepository,this._shaderTechniqueRepository,(e=>{(e.renderOccluded&ge$7)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating");}),(()=>this.events.emit("content-changed"))),this._bindParameters.slot=E$G.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=p$12(this._rctx),this._bindParameters.camera=pe$a,this._bindParameters.transparencyPassType=O$L.NONE,this._bindParameters.lighting.groundLightingFactor=1,this._bindParameters.lighting.globalFactor=0,this._bindParameters.lighting.set([new i$10(r$X(1,1,1))]),this._frameTask=this.view.resourceController.scheduler.registerTask(L$D.STAGE,this),this._handles.add(this._frameTask);}dispose(){this._handles.destroy(),this._drapeSourceRenderers.forEach((e=>e.destroy())),this._drapeSourceRenderers.clear(),this._debugTextureTechnique=p$X(this._debugTextureTechnique),this._debugPatternTexture=s$1a(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=s$1a(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=s$1a(this._shaderTechniqueRepository),this._temporaryFBO=s$1a(this._temporaryFBO),this._quadVAO=s$1a(this._quadVAO),this.disposeOverlays();}get updating(){return this._sortedDrapeSourceRenderersDirty||this._frameTask.updating||n$1m(this._drapeSourceRenderers,(e=>e.updating))}get hasOverlays(){return r$W(this._overlays)&&r$W(this._overlayRenderTarget)}get gpuMemoryUsage(){return r$W(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,y$p)}createDrapeSourceRenderer(e,r,t){const s=this._drapeSourceRenderers.get(e);r$W(s)&&s.destroy();const i=new r({...t,rendererContext:this,drapeSource:e});return this._drapeSourceRenderers.set(e,i),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(l$M((()=>e.fullOpacity),(()=>this.events.emit("content-changed"))),e),i}removeDrapeSourceRenderer(e){if(t$V(e))return;const r=this._drapeSourceRenderers.get(e);t$V(r)||(this._sortedDrapeSourceRenderersDirty=!0,this._drapeSourceRenderers.delete(e),this._handles.remove(e),r.destroy());}collectUnusedRenderTargetMemory(e){let r=!1;if(r$W(this._overlayRenderTarget))for(const t of this._overlayRenderTarget.renderTargets){const s=this.overlays[0].validTargets[t.type]||!this.overlays[1].validTargets[t.type];r=this._overlayRenderTarget.validateUsageForTarget(s,t,e)||r;}return r}get overlays(){return c$$(this._overlays,[])}ensureDrapeTargets(e){r$W(this._overlays)&&this._overlays.forEach((r=>{r.hasTargetWithoutRasterImage=n$1s(e,(e=>e.drapeTargetType===t$y.WithoutRasterImage));}));}ensureDrapeSources(e){r$W(this._overlays)&&this._overlays.forEach((r=>{r.hasDrapedFeatureSource=n$1s(e,(e=>e.drapeSourceType===e$D.Features)),r.hasDrapedRasterSource=n$1s(e,(e=>e.drapeSourceType===e$D.RasterImage));}));}ensureOverlays(e,r){t$V(this._overlays)&&(this._overlayRenderTarget=new t$x(this._rctx),this._overlays=[new l$v(T$p.INNER,this._overlayRenderTarget),new l$v(T$p.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(r);}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=s$1a(this._overlayRenderTarget),this.events.emit("textures-disposed");}get running(){return this.updating}runTask(e,r=(()=>!0)){this._frameTask.processQueue(e),e.done||this._processDrapeSources(e,r);}_processDrapeSources(e,r){let t=!1;for(const[s,i]of this._drapeSourceRenderers){if(e.done)break;(s.destroyed||r(s))&&(i.commitChanges()&&(t=!0,e.madeProgress()));}this._updateSortedDrapeSourceRenderers(),t&&(r$W(this._overlays)&&0===this._drapeSourceRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater());}processSyncDrapeSources(){this._processDrapeSources(w$C,(e=>e.updatePolicy===o$1j.SYNC));}isEmpty(){if(t$E.OVERLAY_DRAW_DEBUG_TEXTURE)return !1;for(const e of this._drapeSourceRenderers.values())if(!e.isEmpty)return !1;return !0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let r=!1;return this._drapeSourceRenderers.forEach((t=>r=t.updateAnimation(e)||r)),r}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0;}drawTarget(e,r,t){const s=e.canvasGeometries;if(0===s.numViews)return !1;this._screenToWorldRatio=t*e.mapUnitsPerPixel;const i=r.renderPass;if(this.isEmpty()||i===A$D.MATERIAL_HIGHLIGHT&&!this.hasHighlights||i===A$D.MATERIAL_NORMAL&&!this.hasWater||!e.hasSomeSizedView())return !1;const o=r.fbo;if(!o.isValid())return !1;const a=2*e.resolution,d=e.resolution;o.resize(a,d);const h=this._rctx;pe$a.pixelRatio=e.pixelRatio*t,this._renderContext.pass=i,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=i===A$D.MATERIAL_NORMAL?E$G.DRAPED_WATER:E$G.DRAPED_MATERIAL,e.applyViewport(this._rctx),o.bind(h),e.index===T$p.INNER&&(h.setClearColor(0,0,0,0),h.clearSafe(_$z.COLOR_BUFFER_BIT));const c=r.type===H$e.ColorNoRasterImage?ce$b.ExcludeRasterImage:r.type===H$e.Occluded?ce$b.OccludedOnly:ce$b.Normal;if(c===ce$b.OccludedOnly&&(this._renderContext.renderOccludedMask=ge$7),t$E.OVERLAY_DRAW_DEBUG_TEXTURE&&c!==ce$b.OccludedOnly)for(let n=0;n<s.numViews;n++)this._setViewParameters(s.extents[n],e,pe$a),this._drawDebugTexture(e.resolution,ue$c[e.index]);return this._drapeSourceRenderers.size>0&&this._sortedDrapeSourceRenderers.forAll((({drapeSource:r,renderer:t})=>{if(c===ce$b.ExcludeRasterImage&&r.drapeSourceType===e$D.RasterImage)return;const{fullOpacity:l}=r,u=r$W(l)&&l<1&&i===A$D.MATERIAL;u&&(this.bindTemporaryFramebuffer(this._rctx,a,d),h.clearSafe(_$z.COLOR_BUFFER_BIT));for(let i=0;i<s.numViews;i++)this._setViewParameters(s.extents[i],e,pe$a),t.render(this._renderContext,this._bindParameters);u&&r$W(this._temporaryFBO)&&(o.bind(h),this.view._stage.renderView.compositingHelper.composite(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),o$r.PremultipliedAlpha,l,n$B.OverlayWithTransparency,e.index));})),h.bindFramebuffer(null),o.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,r,t){t$V(this._temporaryFBO)&&(this._temporaryFBO=new b$o(e,!1)),this._temporaryFBO.resize(r,t),this._temporaryFBO.bind(e);}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll();}notifyContentChanged(){this.events.emit("content-changed");}intersect(e,r,t,s){let i=0;for(const o of this._drapeSourceRenderers.values())i=o.intersect?.(e,r,t,s,i)??i;}_updateSortedDrapeSourceRenderers(){if(!this._sortedDrapeSourceRenderersDirty)return;if(this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers.clear(),0===this._drapeSourceRenderers.size)return;const e=this.view.map.allLayers;this._drapeSourceRenderers.forEach(((r,t)=>{const s=e.indexOf(t.layer);this._sortedDrapeSourceRenderers.push(new le$a(t,r,s<0?1/0:s));})),this._sortedDrapeSourceRenderers.sort(((e,r)=>e.index-r.index));}_setViewParameters(e,r,t){t.viewport[0]=t.viewport[1]=0,t.viewport[2]=t.viewport[3]=r.resolution,E$N(t.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],t.near,t.far),x$N(t.viewMatrix,[-e[0],-e[1],0]),this._bindParameters.camera=t;}_updateHasWater(){const e=n$1m(this._drapeSourceRenderers,(e=>e.hasWater));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e));}_updateHasHighlights(){const e=n$1m(this._drapeSourceRenderers,(e=>e.hasHighlights));e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e));}_updateRendersOccluded(){const e=n$1m(this._drapeSourceRenderers,(e=>e.rendersOccluded));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e));}_drawDebugTexture(e,r){this._ensureDebugPatternResources(e,e);const t=this._rctx,s=t.bindTechnique(this._debugTextureTechnique);s.setUniform4f("uColor",r[0],r[1],r[2],1),s.bindTexture("tex",this._debugPatternTexture),t.bindVAO(this._quadVAO),t.drawArrays(E$F.TRIANGLE_STRIP,0,n$1d(this._quadVAO,"geometry"));}_ensureDebugPatternResources(e,r){if(this._debugPatternTexture)return;const t=new Uint8Array(e*r*4);let s=0;for(let o=0;o<r;o++)for(let i=0;i<e;i++){const a=Math.floor(i/10),n=Math.floor(o/10);a<2||n<2||10*a>e-20||10*n>r-20?(t[s++]=255,t[s++]=255,t[s++]=255,t[s++]=255):(t[s++]=255,t[s++]=255,t[s++]=255,t[s++]=1&a&&1&n?1&i^1&o?0:255:1&a^1&n?0:128);}this._debugPatternTexture=new u$X(this._rctx,{target:M$v.TEXTURE_2D,pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,samplingMode:L$C.NEAREST,width:e,height:r},t);const i=new r$x;i.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(m$r,i),this._quadVAO=u$V(this._rctx);}get test(){return {drapeSourceRenderers:this._drapeSourceRenderers,getDrapeSourceRenderer:e=>this._drapeSourceRenderers.get(e)}}};var ce$b;e$Y([d$R()],he$9.prototype,"_frameTask",void 0),e$Y([d$R()],he$9.prototype,"_sortedDrapeSourceRenderersDirty",void 0),e$Y([i$B()],he$9.prototype,"_shaderTechniqueRepository",void 0),e$Y([i$B()],he$9.prototype,"_stippleTextureRepository",void 0),e$Y([d$R({constructOnly:!0})],he$9.prototype,"view",void 0),e$Y([d$R()],he$9.prototype,"worldToPCSRatio",void 0),e$Y([d$R()],he$9.prototype,"spatialReference",void 0),e$Y([d$R({type:Boolean,readOnly:!0})],he$9.prototype,"updating",null),he$9=e$Y([n$18("esri.views.3d.terrain.OverlayRenderer")],he$9),function(e){e[e.Normal=0]="Normal",e[e.OccludedOnly=1]="OccludedOnly",e[e.ExcludeRasterImage=2]="ExcludeRasterImage";}(ce$b||(ce$b={}));class le$a{constructor(e,r,t){this.drapeSource=e,this.renderer=r,this.index=t;}}const ue$c=[[1,.5,.5],[.5,.5,1]],pe$a=new K$h;pe$a.near=1,pe$a.far=1e4,pe$a.relativeElevation=null;const _e$8=-2,ge$7=h$Z.OccludeAndTransparent;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function c$u(i){const o=[[O$J.POSITION,i.indices]],e=[[O$J.POSITION,{size:3,data:i.attributeData.position,exclusive:!0}]];return r$W(i.attributeData.color)&&(e.push([O$J.COLOR,{size:4,data:i.attributeData.color,exclusive:!0}]),o.push([O$J.COLOR,new Uint32Array(i.indices.length)])),r$W(i.attributeData.uvMapSpace)&&(e.push([O$J.UVMAPSPACE,{size:4,data:i.attributeData.uvMapSpace,exclusive:!0}]),o.push([O$J.UVMAPSPACE,i.indices])),r$W(i.attributeData.boundingRect)&&(e.push([O$J.BOUNDINGRECT,{size:9,data:i.attributeData.boundingRect,exclusive:!0}]),o.push([O$J.BOUNDINGRECT,i.indices])),r$W(i.attributeData.mapPosition)&&(e.push([O$J.MAPPOS,{size:3,data:i.attributeData.mapPosition,exclusive:!0}]),o.push([O$J.MAPPOS,i.indices])),new g$S(e,o)}function l$q(i){const o=[[O$J.POSITION,i.indices],[O$J.UV0,i.indices]],e=[[O$J.POSITION,{size:3,data:i.attributeData.position,exclusive:!0}],[O$J.UV0,{size:2,data:i.attributeData.uv0,exclusive:!0}]];return r$W(i.attributeData.mapPosition)&&(e.push([O$J.MAPPOS,{size:3,data:i.attributeData.mapPosition,exclusive:!0}]),o.push([O$J.MAPPOS,i.indices])),new g$S(e,o)}function m$q(t){switch(t.type){case"extent":if(t instanceof M$u)return v$R.fromExtent(t);break;case"polygon":return t}return null}function d$u(t,i,s,a){const r=l$17(t.rings,t.hasZ,c$1f.CCW_IS_HOLE),u=new Float64Array(r.position.length),p=f$C(r.position,t.spatialReference,0,u,0,r.position,0,r.position.length/3,i,s,a),c=null!=p;return {position:r.position,mapPosition:u,polygons:b$m(r.polygons,r.position,u),outlines:g$q(r.outlines,r.position,u),projectionSuccess:c,sampledElevation:p}}function f$r(t,n){const a=l$17(t.rings,!1,c$1f.CCW_IS_HOLE),r=Un(a.position,t.spatialReference,0,a.position,n,0,a.position.length/3);for(let i=2;i<a.position.length;i+=3)a.position[i]=_e$8;return {position:a.position,polygons:b$m(a.polygons,a.position),outlines:g$q(a.outlines,a.position),projectionSuccess:r}}function g$q(t,i,o){const e=new Array;for(const{index:n,count:s}of t){if(s<=1)continue;const t=3*n,a=t+3*s;e.push({index:n,count:s,position:i.subarray(t,a),mapPosition:o?o.subarray(t,a):void 0});}return e}function b$m(t,i,o){const e=new Array;for(const{index:n,count:s,holeIndices:a,pathLengths:r}of t){if(s<=1)continue;const t=3*n,u=t+3*s,p=a.map((t=>t-n));e.push({index:n,count:s,holeIndices:p,pathLengths:r,position:i.subarray(t,u),mapPosition:o?o.subarray(t,u):void 0});}return e}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const q$e=["polygon","extent"];class J$9 extends y$r{constructor(e,t,r,s){super(e,t,r,s),this.ensureDrapedStatus(!1);}async doLoad(){if(!this._drivenProperties.size){const t=O$w(this._getSymbolSize());if(t)throw new s$16("graphics3dextrudesymbollayer:invalid-size",t)}const r=m$V(this.symbolLayer,"material","color"),s=this._getCombinedOpacityAndColor(r),n=e$1d(s),a=s[3],i=a<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:n,ambient:n,opacity:a,transparent:i,cullFace:i?n$1t.None:n$1t.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new R$w(o),this._bottomMaterial=new R$w({...o,cullFace:n$1t.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial);}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial));}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,q$e,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(t,new h$x);return this._createAs3DShape(t,e.renderingInfo,r,s,t.uid)}layerOpacityChanged(e,s){const n=m$V(this.symbolLayer,"material","color"),a=this._getCombinedOpacity(n),i=a<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:a,transparent:i}),this._bottomMaterial.setParameters({opacity:a,transparent:i});const o=this._getLayerOpacity();return e.forEach((e=>{const t=s(e);r$W(t)&&t.layerOpacityChanged(o,this._context.isAsync);})),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,v$u)}slicePlaneEnabledChanged(e,t){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach((e=>{const s=t(e);r$W(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync);})),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return !0}_getExtrusionSize(e){let t;return t=e.size&&this._drivenProperties.size?u$x(e.size,2)??0:this._getSymbolSize(),t/=this._context.renderCoordsHelper.unitInMeters,t}applyRendererDiff(e,t){return this._drivenPropertiesChanged(t)?e$I.Recreate_Symbol:e$I.Recreate_Graphics}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,t,h,m,p){const d=m$q(e.geometry);if(t$V(d))return null;const u=d$u(d,this._context.elevationProvider,this._context.renderCoordsHelper,m);if(this._logGeometryCreationWarnings(u,d.rings,"rings","ExtrudeSymbol3DLayer"),0===d.rings.length||!d.rings.some((e=>e.length>0)))return null;const f=w$p(d);if(t$V(f))return null;const g=new Array,j=new Array,M=new Array,O=a$1d(),B=e$10(),I=n$16(),R=this._context.renderCoordsHelper.viewingMode===l$O.Global;R||this._context.renderCoordsHelper.worldUpAtPosition(null,I),qn(d.spatialReference,[f.x,f.y,0],B,this._context.renderCoordsHelper.spatialReference);const z=e$10();h$U(z,B);const k=e$16();j$L(k,z);const{polygons:N,mapPosition:F,position:V}=u,H=V.length/3,Z=new Float64Array(3*H*6),W=new Float64Array(3*H*6),q=new Float64Array(3*H*6),J=new Float64Array(1*H*6);let X=0;for(let r=0;r<N.length;++r){const e=N[r],s=e.count;if(this._context.clippingExtent&&(B$t(O),M$y(O,e.mapPosition),!R$x(O,this._context.clippingExtent)))continue;const a=x$O(e.mapPosition,e.holeIndices,3);if(0===a.length)continue;const i=3*s*2+a.length,o=new Uint32Array(i),c=new Uint32Array(a.length),m=6*s,p=3*Z.BYTES_PER_ELEMENT,d=new T$F(Z.buffer,X*p,p,(X+m)*p),u=3*W.BYTES_PER_ELEMENT,f=new T$F(W.buffer,X*u,u,(X+m)*u),y=new Float64Array(q.buffer,3*X*q.BYTES_PER_ELEMENT,3*m),_=new Float64Array(J.buffer,1*X*J.BYTES_PER_ELEMENT,1*m),b=this._getExtrusionSize(t);Q$9(V,F,a,e,d.typedBuffer,y,f.typedBuffer,_,0,o,c,b,I,R),t$1h(d,d,z),r$1d(f,f,k),X+=6*s;const A=K$b(o,o.length-c.length,{positions:d.typedBuffer,elevation:y,normals:f.typedBuffer,heights:_},h);g.push(A),j.push(this._material),M.push(o$1g);const L=K$b(c,0,{positions:d.typedBuffer,elevation:y,normals:f.typedBuffer,heights:_},h);g.push(L),j.push(this._bottomMaterial),M.push(o$1g);}if(0===g.length)return null;const $=new O$t({geometries:g,materials:j,transformations:M,metadata:{layerUid:this._context.layer.uid,graphicUid:p,isElevationSource:!0}});$.transformation=B;const ee=f$z(this.symbolLayer,{opacity:this._getLayerOpacity()}),te=r$W(ee)?{baseMaterial:this._material,edgeMaterials:[ee],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,re=new p$s(this,$,g,null,null,ce$a,m,te);return re.alignedSampledElevation=u.sampledElevation,re.needsElevationUpdates=v$u(m.mode),re}}function K$b(e,t,r,s){const n=new Uint32Array(e.length),a=[[O$J.POSITION,{size:3,data:r.positions,exclusive:!0}],[O$J.NORMAL,{size:3,data:r.normals,exclusive:!0}],[O$J.COLOR,{size:4,data:s,exclusive:!0}],[O$J.SIZE,{size:1,data:r.heights,exclusive:!0}]],i=[[O$J.POSITION,e],[O$J.NORMAL,e],[O$J.COLOR,n]];return r.elevation&&(a.push([O$J.MAPPOS,{size:3,data:r.elevation}]),i.push([O$J.MAPPOS,e])),new g$S(a,i,c$12.Triangle,t)}function Q$9(e,t,r,s,n,a,i,o,l,c,h,m,p,d){const u=r.length/3;let f=0,g=2*s.count;X$7(e,t,s.index,s.count,r,0,u,n,a,i,o,l,c,h,g,m,p,d),l+=2*s.count,g=0,te$4(n,a,o,i,f,s.pathLengths[0],s.count,l,c,g,m),l+=4*s.pathLengths[0],g+=2*s.pathLengths[0],f+=s.pathLengths[0];for(let y=1;y<s.pathLengths.length;++y)te$4(n,a,o,i,f,s.pathLengths[y],s.count,l,c,g,m),l+=4*s.pathLengths[y],g+=2*s.pathLengths[y],f+=s.pathLengths[y];}function X$7(e,t,r,s,n,a,i,o,l,c,p,d,u,f,g,y,_,b){r$V(me$a,_);const E=y>0?1:-1;let x=3*r,P=d,S=3*P,v=d+s,w=3*v;for(let h=0;h<s;++h)b&&(me$a[0]=e[x+0],me$a[1]=e[x+1],me$a[2]=e[x+2],z$s(me$a,me$a)),o[S+0]=e[x+0],o[S+1]=e[x+1],o[S+2]=e[x+2],l[S+0]=t[x+0],l[S+1]=t[x+1],l[S+2]=t[x+2],c[S+0]=-E*me$a[0],c[S+1]=-E*me$a[1],c[S+2]=-E*me$a[2],p[P]=0,o[w+0]=e[x+0]+y*me$a[0],o[w+1]=e[x+1]+y*me$a[1],o[w+2]=e[x+2]+y*me$a[2],l[w+0]=t[x+0],l[w+1]=t[x+1],l[w+2]=t[x+2],c[w+0]=E*me$a[0],c[w+1]=E*me$a[1],c[w+2]=E*me$a[2],p[v]=y,S+=3,w+=3,x+=3,P+=1,v+=1;x=3*a,S=0,w=3*g;const j=y<0?ue$b:de$9,A=y<0?de$9:ue$b;for(let h=0;h<i;++h)f[S+0]=n[x+j[0]],f[S+1]=n[x+j[1]],f[S+2]=n[x+j[2]],u[w+0]=n[x+A[0]]+s,u[w+1]=n[x+A[1]]+s,u[w+2]=n[x+A[2]]+s,S+=3,w+=3,x+=3;}function $$a(e,t,r,s,n,a,i){s[a]=s[i],i*=3,e[(a*=3)+0]=e[i+0],e[a+1]=e[i+1],e[a+2]=e[i+2],t[a+0]=t[i+0],t[a+1]=t[i+1],t[a+2]=t[i+2],r[a+0]=n[0],r[a+1]=n[1],r[a+2]=n[2];}const ee$4=n$16();function te$4(e,t,r,s,n,a,i,o,l,c,h){let m=n,p=n+1,d=n+i,u=n+i+1,f=o,g=o+1,y=o+2*a,_=o+2*a+1;h<0&&(m=n+i+1,u=n),c*=3;for(let b=0;b<a;++b)b===a-1&&(h>0?(p=n,u=n+i):(p=n,m=n+i)),oe$a(e,m,p,d,ee$4),$$a(e,t,s,r,ee$4,f,m),$$a(e,t,s,r,ee$4,g,p),$$a(e,t,s,r,ee$4,y,d),$$a(e,t,s,r,ee$4,_,u),l[c++]=f,l[c++]=y,l[c++]=_,l[c++]=f,l[c++]=_,l[c++]=g,m++,p++,d++,u++,f+=2,g+=2,y+=2,_+=2;}const re$3=n$16(),se$5=n$16(),ne$7=n$16(),ae$8=n$16(),ie$5=n$16();function oe$a(e,t,r,s,n){t*=3,r*=3,s*=3,o$W(re$3,e[t++],e[t++],e[t++]),o$W(se$5,e[r++],e[r++],e[r++]),o$W(ne$7,e[s++],e[s++],e[s++]),e$15(ae$8,se$5,re$3),e$15(ie$5,ne$7,re$3),_$v(n,ie$5,ae$8),z$s(n,n);}const le$9=n$16();function ce$a(e,t,r,s){const n=e.stageObject,a=n.geometryRecords,i=a.length,l="absolute-height"!==t.mode;let h=0;const m=n.transformation,d=h$U(e$10(),m);for(let o=0;o<i;o+=2){const e=a[o].geometry,i=e.getMutableAttribute(O$J.POSITION).data,c=e.vertexAttributes.get(O$J.SIZE).data,u=e.vertexAttributes.get(O$J.MAPPOS).data,g=new t$1c(u),y=i.length/3;let _=0,b=!1,E=0;const x=r.spatialReference;for(let n=0;n<y;n++){le$9[0]=i[_],le$9[1]=i[_+1],le$9[2]=i[_+2],d$D(g,r,t,s,pe$9),l&&(E+=pe$9.sampledElevation),t$E.TESTS_DISABLE_OPTIMIZATIONS?(o$W(he$8,g.array[g.offset+0],g.array[g.offset+1],pe$9.z+c[_/3]),s.toRenderCoords(he$8,x,he$8),L$E(he$8,he$8,d)):(o$W(he$8,i[_+0],i[_+1],i[_+2]),L$E(he$8,he$8,m),s.setAltitude(he$8,pe$9.z+c[_/3]),L$E(he$8,he$8,d)),i[_]=he$8[0],i[_+1]=he$8[1],i[_+2]=he$8[2];const e=fe$9/s.unitInMeters;(Math.abs(le$9[0]-i[_])>=e||Math.abs(le$9[1]-i[_+1])>=e||Math.abs(le$9[2]-i[_+2])>=e)&&(b=!0),g.offset+=3,_+=3;}b&&(e.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(a[o]),a[o+1].geometry.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(a[o+1])),h+=E/y;}return h/i}const he$8=n$16(),me$a=n$16(),pe$9=new j$s,de$9=[0,2,1],ue$b=[0,1,2],fe$9=.01;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const c$t=1,r$w=1.2,t$q=l$W,a$x=_$y;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class u$r{constructor(e,t,r,i){this.graphics3DSymbolLayer=e,this.renderGeometries=t,this.boundingBox=r,this._drapeSourceRenderer=i,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1;}initialize(e){this.stage=e;}setVisibility(e){if(null!=this.stage&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,E$p.Geometry.ADD);if(e||this._addedToStage){for(const e of this.renderGeometries)e.instanceParameters.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,E$p.State.VISIBILITIES);}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,E$p.Geometry.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null;}getCenterObjectSpace(e=n$16()){return o$W(e,0,0,0)}getBoundingBoxObjectSpace(e=a$1d()){return B$t(e)}addObjectState(e,t){e===u$11.Highlight&&(this.renderGeometries.forEach((e=>{const r=e.addHighlight();t.addRenderGeometry(e,r,this);})),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,E$p.State.HIGHLIGHTS));}removeObjectState(e){this.renderGeometries.forEach((t=>{e.removeRenderGeometry(t);}));}removeRenderGeometryObjectState(e,t){e.removeHighlight(t),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,E$p.State.HIGHLIGHTS);}computeAttachmentOrigin(e){for(const t of this.renderGeometries)t.computeAttachmentOrigin(S$k)&&(e.draped.origin[0]+=S$k[0],e.draped.origin[1]+=S$k[1],e.draped.num++);}async getProjectedBoundingBox(t,r,i,n,a){B$t(a);for(let e=0;e<this.renderGeometries.length;e++){const r=this.renderGeometries[e];this._getRenderGeometryProjectedBoundingRect(r,t,l$p,i),c$1g(a,l$p);}if(r){let t;p$11(a,S$k);const i=V$g(a,r);try{t=await r.service.queryElevation(S$k[0],S$k[1],n,i,"ground");}catch(h){}r$W(t)&&(a[2]=Math.min(a[2],t),a[5]=Math.max(a[5],t));}return a}_getRenderGeometryProjectedBoundingRect(e,t,r,i){if(this.boundingBox)A$H(p$n,this.boundingBox);else {const t=e.boundingSphere,r=t[3];p$n[0]=t[0]-r,p$n[1]=t[1]-r,p$n[2]=t[2]-r,p$n[3]=t[0]+r,p$n[4]=t[1]+r,p$n[5]=t[2]+r;}return t(p$n,0,2),this.calculateRelativeScreenBounds&&i.push({location:p$11(p$n),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),G$p(p$n,r)}}const l$p=u$T(),p$n=a$1d(),S$k=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$x{constructor(t,e,i,n=2048){this.text=t,this._alignment=e,this._parameters=i,this.maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._displayWidth=null,this._heightMetrics=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${t}`,this._lines=t.split(/\r?\n/);}get displayWidth(){return Math.ceil(this._ensureTextWidth()+2*this.backgroundHorizontalPadding)}get displayHeight(){const t=this.lineSpacing*(this._lines.length-1),e=this.lineHeight;return Math.ceil(t+e+2*this.haloSize+this.backgroundTopPadding+this.backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this.firstLineYOffset+this.baselinePosition)}get firstLineYOffset(){return this.backgroundTopPadding+this.haloSize}get heightMetrics(){return this._ensureHeightMetrics()}get lineSpacing(){return (this.lineHeight+this.linePadding)*this._parameters.definition.lineSpacingFactor}get lineHeight(){return this.heightMetrics.lineHeight}get linePadding(){return this.lineHeight*d$t}get baselinePosition(){return this.heightMetrics.baselinePosition}get renderedFontSize(){return this._toRenderUnit(this.fontSize)}get fontSize(){return this._parameters.definition.size}get renderedHaloSize(){return this._toRenderUnit(this.haloSize)}get haloSize(){return this._parameters.haloSize}get backgroundHorizontalPadding(){return this.hasBackground?this._parameters.definition.background.padding[0]:0}get backgroundVerticalPadding(){return this.hasBackground?this._parameters.definition.background.padding[1]:0}get backgroundTopPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingTop)}get backgroundBottomPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingBottom)}get hasBackground(){return !!this._parameters.backgroundStyle}get renderPixelRatio(){if(t$V(this._renderPixelRatio)){const t=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(t,Math.min(this.maxSize/this.displayWidth,this.maxSize/this.displayHeight)):this._renderPixelRatio=t;}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case h$r.Left:return this.backgroundHorizontalPadding;case h$r.Center:return (this.displayWidth-this._lineWidths[t])/2;case h$r.Right:return this.displayWidth-this.backgroundHorizontalPadding-this._lineWidths[t]}}render(t,e=0,i=0){t.save();const s=e/=this.renderPixelRatio,r=i/=this.renderPixelRatio,h=this.haloSize,o=this.firstLineYOffset;e+=h,i+=o+this.baselinePosition;const a=this.haloSize>0;a&&this._renderHalo(t,s,r,h,o),this._setFontProperties(t,this.renderedFontSize);for(let n=0;n<this._lines.length;++n){const s=this._lines[n],r=this._getLineXOffset(n);a&&(t.globalCompositeOperation="destination-out",t.fillStyle="rgb(0, 0, 0)",this._fillText(t,s,e+r,i),this._renderLineDecoration(t,e+r,i,this._textWidths[n])),t.globalCompositeOperation="source-over",t.fillStyle=this._parameters.textStyle,this._fillText(t,s,e+this._getLineXOffset(n),i),this._renderLineDecoration(t,e+r,i,this._textWidths[n]),i+=this.lineSpacing;}if(t$E.TEXT_SHOW_BASELINE){t.strokeStyle=g$p,t.setLineDash([2,2]),t.lineWidth=1;let e=r+o;for(let i=0;i<this._lines.length;++i){const i=e+this.baselinePosition;this._drawLine(t,[s,i],[s+this.displayWidth,i]),e+=this.lineSpacing;}}if(t$E.TEXT_SHOW_BORDER&&(t.strokeStyle=g$p,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[s,r],[this.displayWidth,this.displayHeight])),this.hasBackground){const e=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,s,r,e),t.globalCompositeOperation="destination-over",t.fillStyle=this._parameters.backgroundStyle,t.fill();}t.restore();}_renderLineDecoration(t,e,i,n,s=!1){if("none"===this._parameters.definition.font.decoration||0===n)return;const r=1,h=Math.max(this._parameters.definition.size/16,r);switch(this._parameters.definition.font.decoration){case"underline":i+=2*h;break;case"line-through":i-=.33*this.baselinePosition;}const o=s?this.haloSize:0;t.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(h+2*o),t.beginPath(),t.moveTo(this._toRenderUnit(e-o),this._toRenderUnit(i)),t.lineTo(this._toRenderUnit(e+n+o),this._toRenderUnit(i)),t.stroke();}_roundedRect(e,i,n,s){i=this._toRenderUnit(i),n=this._toRenderUnit(n);const r=this.renderedWidth,h=this.renderedHeight;0!==s?(s=o$X(s,0,Math.floor(h/2)),e.beginPath(),e.moveTo(i,n+s),e.arcTo(i,n,i+s,n,s),e.lineTo(i+r-s,n),e.arcTo(i+r,n,i+r,n+s,s),e.lineTo(i+r,n+h-s),e.arcTo(i+r,n+h,i+r-s,n+h,s),e.lineTo(i+s,n+h),e.arcTo(i,n+h,i,n+h-s,s),e.closePath()):e.rect(i,n,r,h);}_renderHalo(t,e,i,n,s){const r=this.renderedWidth,h=this.renderedHeight,d=o$q(a$w,Math.max(r,l$o),Math.max(h,l$o)),g=d.getContext("2d");g.clearRect(0,0,r,h),this._setFontProperties(g,this.renderedFontSize),g.fillStyle=this._parameters.haloStyle,g.strokeStyle=this._parameters.haloStyle;const c=this.renderedHaloSize<3;g.lineJoin=c?"miter":"round",c?this._renderHaloEmulated(g,n,s):this._renderHaloNative(g,n,s);let _=s+this.baselinePosition;for(let o=0;o<this._lines.length;++o){const t=this._getLineXOffset(o);this._renderLineDecoration(g,n+t,_,this._textWidths[o],!0),_+=this.lineSpacing;}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(d,0,0,r,h,this._toRenderUnit(e),this._toRenderUnit(i),r,h),t.globalAlpha=1;}_renderHaloEmulated(t,e,i){i+=this.baselinePosition;for(let n=0;n<this._lines.length;++n){const s=this._lines[n],h=this._getLineXOffset(n);for(const[n,o]of r$v)this._fillText(t,s,e+h+this.haloSize*n,i+this.haloSize*o);i+=this.lineSpacing;}}_renderHaloNative(t,e,i){const n=2*this.haloSize;i+=this.baselinePosition;for(let s=0;s<this._lines.length;++s){const r=this._lines[s],h=this._getLineXOffset(s),o=5,a=.1;for(let s=0;s<o;s++){const d=1-(o-1)*a+s*a;t.lineWidth=this._toRenderUnit(d*n),this._strokeText(t,r,e+h,i);}i+=this.lineSpacing;}}_setFontProperties(t,e){t.font=this._parameters.fontString(e),t.textAlign="left",t.textBaseline="alphabetic";}_ensureTextWidth(){if(r$W(this._displayWidth))return this._displayWidth;const t=o$q(a$w,l$o,l$o).getContext("2d");this._setFontProperties(t,this.fontSize);let e=2*this.haloSize;const n=this._parameters.definition.font;"italic"!==n.style&&"oblique"!==n.style&&"bold"!==n.weight&&"bolder"!==n.weight||(e+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s=0;for(const i of this._lines){const n=t.measureText(i).width,r=n+e;this._textWidths.push(n),this._lineWidths.push(r),s=Math.max(s,r);}return this._displayWidth=s,this._displayWidth}_ensureHeightMetrics(){if(t$V(this._heightMetrics)){const t=o$q(a$w,l$o,l$o).getContext("2d");this._setFontProperties(t,this.fontSize);const e=t.measureText(this.text+c$s),i=this.hasBackground?t.measureText(this._lines[0]):e,n=1===this._lines.length?i:this.hasBackground?t.measureText(this._lines[this._lines.length-1]):e,s=e.actualBoundingBoxAscent+e.actualBoundingBoxDescent;this._heightMetrics={paddingTop:e.actualBoundingBoxAscent-i.actualBoundingBoxAscent,paddingBottom:e.actualBoundingBoxDescent-n.actualBoundingBoxDescent,lineHeight:s,baselinePosition:e.actualBoundingBoxAscent};}return this._heightMetrics}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,e,i,n){t.fillText(e,this._toRenderUnit(i),this._toRenderUnit(n));}_strokeText(t,e,i,n){t.strokeText(e,this._toRenderUnit(i),this._toRenderUnit(n));}_drawLine(t,e,i){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(e[0])+.5,this._toRoundedRenderUnit(e[1])+.5),t.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.stroke();}_drawBox(t,e,i){const n=this._toRenderUnit(e[0]),s=this._toRenderUnit(e[1]),r=this._toRenderUnit(i[0]),h=this._toRenderUnit(i[1]),o=Math.floor(n)+.5,a=Math.ceil(n+r)-.5,d=Math.floor(s)+.5,l=Math.ceil(s+h)-.5;t.beginPath(),t.moveTo(o,d),t.lineTo(a,d),t.lineTo(a,l),t.lineTo(o,l),t.lineTo(o,d),t.stroke();}}const r$v=[];{const t=16;for(let e=0;e<360;e+=360/t)r$v.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);}var h$r;function o$q(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}!function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right";}(h$r||(h$r={}));const a$w={canvas:null},d$t=.2,l$o=512,g$p="rgb(255, 0, 255, 0.5)",c$s=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const r$u={left:0,center:.5,right:1},o$p={"bottom-left":r$13(0,0),bottom:r$13(.5,0),"bottom-right":r$13(1,0),left:r$13(0,.5),center:r$13(.5,.5),right:r$13(1,.5),"top-left":r$13(0,1),top:r$13(.5,1),"top-right":r$13(1,1)};function c$r(t){switch(t){case"left":return h$r.Left;case"right":return h$r.Right;default:return h$r.Center}}function n$A(t){switch(t){case"bottom-left":case"left":case"top-left":return "left";case"bottom":case"center":case"top":return "center";case"bottom-right":case"right":case"top-right":return "right"}}function s$w(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return "bottom";case"left":case"center":case"right":return "center";case"top-left":case"top":case"top-right":return "top"}}function i$r(t,e){switch(e){case"bottom":return "left"===t?"bottom-left":"right"===t?"bottom-right":"bottom";case"center":return t;case"top":return "left"===t?"top-left":"right"===t?"top-right":"top"}}function f$q(t){return "middle"===t?"center":t}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var S$j,y$o,h$q;function x$l(e){return null!=e}function b$l(e){return "number"==typeof e}function C$l(e){return "string"==typeof e}function g$o(e){return null==e||C$l(e)}function M$g(e,o){e&&e.push(o);}function V$d(e,o,t,i=e$10()){const n=e||0,r=o||0,s=t||0;return 0!==n&&m$P(i,i,-n/180*Math.PI),0!==r&&b$C(i,i,r/180*Math.PI),0!==s&&l$S(i,i,s/180*Math.PI),i}function D$d(e,o,t,i,n){const r=e.minSize,s=e.maxSize;if(e.expression)return M$g(n,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const e=i.symbolSize[t];return o.minSize[t]=e,o.maxSize[t]=e,o.offset[t]=o.minSize[t],o.factor[t]=0,o.type[t]=S$j.DefinedSize,!0}if(x$l(e.field))return x$l(e.stops)?2===e.stops.length&&b$l(e.stops[0].size)&&b$l(e.stops[1].size)?(T$m(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,o,t),o.type[t]=S$j.DefinedSize,!0):(M$g(n,"Could not convert size info: stops only supported with 2 elements"),!1):b$l(r)&&b$l(s)&&x$l(e.minDataValue)&&x$l(e.maxDataValue)?(T$m(r,s,e.minDataValue,e.maxDataValue,o,t),o.type[t]=S$j.DefinedSize,!0):null!=m$W[e.valueUnit]?(o.minSize[t]=-1/0,o.maxSize[t]=1/0,o.offset[t]=0,o.factor[t]=1/m$W[e.valueUnit],o.type[t]=S$j.DefinedSize,!0):"unknown"===e.valueUnit?(M$g(n,"Could not convert size info: proportional size not supported"),!1):(M$g(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!x$l(e.field)){if(e.stops&&e.stops[0]&&b$l(e.stops[0].size))return o.minSize[t]=e.stops[0].size,o.maxSize[t]=e.stops[0].size,o.offset[t]=o.minSize[t],o.factor[t]=0,o.type[t]=S$j.DefinedSize,!0;if(b$l(r))return o.minSize[t]=r,o.maxSize[t]=r,o.offset[t]=r,o.factor[t]=0,o.type[t]=S$j.DefinedSize,!0}return M$g(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function T$m(e,o,t,i,n,r){const s=Math.abs(i-t)>0?(o-e)/(i-t):0;n.minSize[r]=s>0?e:o,n.maxSize[r]=s>0?o:e,n.offset[r]=e-t*s,n.factor[r]=s;}function U$f(e,o,t,i){if(e.normalizationField||e.valueRepresentation)return M$g(i,"Could not convert size info: unsupported property"),null;if(!g$o(e.field))return M$g(i,"Could not convert size info: field is not a string"),null;if(o.size){if(e.field)if(o.size.field){if(e.field!==o.size.field)return M$g(i,"Could not convert size info: multiple fields in use"),null}else o.size.field=e.field;}else o.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[S$j.Undefined,S$j.Undefined,S$j.Undefined]};let n;switch(e.axis){case"width":return n=D$d(e,o.size,0,t,i),n?o:null;case"height":return n=D$d(e,o.size,2,t,i),n?o:null;case"depth":return n=D$d(e,o.size,1,t,i),n?o:null;case"width-and-depth":return n=D$d(e,o.size,0,t,i),n&&D$d(e,o.size,1,t,i),n?o:null;case null:case void 0:case"all":return n=D$d(e,o.size,0,t,i),n=n&&D$d(e,o.size,1,t,i),n=n&&D$d(e,o.size,2,t,i),n?o:null;default:return M$g(i,`Could not convert size info: unknown axis "${e.axis}""`),null}}function E$n(e,o,t){for(let n=0;n<3;++n){let t=o.unitInMeters;e.type[n]===S$j.DefinedSize&&(t*=o.modelSize[n],e.type[n]=S$j.DefinedScale),e.minSize[n]=e.minSize[n]/t,e.maxSize[n]=e.maxSize[n]/t,e.offset[n]=e.offset[n]/t,e.factor[n]=e.factor[n]/t;}let i;if(e.type[0]!==S$j.Undefined)i=0;else if(e.type[1]!==S$j.Undefined)i=1;else {if(e.type[2]===S$j.Undefined)return M$g(t,"No size axis contains a valid size or scale"),!1;i=2;}for(let n=0;n<3;++n)e.type[n]===S$j.Undefined&&(e.minSize[n]=e.minSize[i],e.maxSize[n]=e.maxSize[i],e.offset[n]=e.offset[i],e.factor[n]=e.factor[i],e.type[n]=e.type[i]);return !0}function O$p(e,o,t){e[4*o+0]=t.r/255,e[4*o+1]=t.g/255,e[4*o+2]=t.b/255,e[4*o+3]=t.a;}function j$p(e,o,t){if(e.normalizationField)return M$g(t,"Could not convert color info: unsupported property"),null;if(C$l(e.field)){if(!e.stops)return M$g(t,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return M$g(t,"Could not convert color info: too many color stops"),null;o.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const i=e.stops;for(let e=0;e<8;++e){const t=i[Math.min(e,i.length-1)];o.color.values[e]=t.value,O$p(o.color.colors,e,t.color);}}}else {if(!(e.stops&&e.stops.length>=0))return M$g(t,"Could not convert color info: no field and no colors/stops"),null;{const t=e.stops&&e.stops.length>=0&&e.stops[0].color;o.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)o.color.values[e]=1/0,O$p(o.color.colors,e,t);}}return o}function k$i(e,o,t){if(e.normalizationField)return M$g(t,"Could not convert opacity info: unsupported property"),null;if(C$l(e.field)){if(!e.stops)return M$g(t,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return M$g(t,"Could not convert opacity info: too many opacity stops"),null;o.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const i=e.stops;for(let e=0;e<8;++e){const t=i[Math.min(e,i.length-1)];o.opacity.values[e]=t.value,o.opacity.opacityValues[e]=t.opacity;}}}else {if(!(e.stops&&e.stops.length>=0))return M$g(t,"Could not convert opacity info: no field and no opacities/stops"),null;{const t=e.stops&&e.stops.length>=0&&e.stops[0].opacity;o.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)o.opacity.values[e]=1/0,o.opacity.opacityValues[e]=t;}}return o}function w$o(e,o,t){const i=2===t&&"arithmetic"===e.rotationType;o.offset[t]=i?90:0,o.factor[t]=i?-1:1,o.type[t]=1;}function F$i(e,o,t){if(!C$l(e.field))return M$g(t,"Could not convert rotation info: field is not a string"),null;if(o.rotation){if(e.field)if(o.rotation.field){if(e.field!==o.rotation.field)return M$g(t,"Could not convert rotation info: multiple fields in use"),null}else o.rotation.field=e.field;}else o.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return w$o(e,o.rotation,0),o;case"roll":return w$o(e,o.rotation,1),o;case null:case void 0:case"heading":return w$o(e,o.rotation,2),o;default:return M$g(t,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}function A$h(e,o,t){if(!e)return null;const i=!o.supportedTypes||!!o.supportedTypes.size,n=!o.supportedTypes||!!o.supportedTypes.color,r=!o.supportedTypes||!!o.supportedTypes.rotation,s=!!o.supportedTypes&&!!o.supportedTypes.opacity,l=e.reduce(((e,l)=>{if(!e)return e;if(l.valueExpression)return M$g(t,"Could not convert visual variables: arcade expressions not supported"),null;switch(l.type){case"size":return i?U$f(l,e,o,t):e;case"color":return n?j$p(l,e,t):e;case"opacity":return s?k$i(l,e,t):null;case"rotation":return r?F$i(l,e,t):e;default:return null}}),{size:null,color:null,opacity:null,rotation:null});return !(e.length>0&&l)||l.size||l.color||l.opacity||l.rotation?l&&l.size&&!E$n(l.size,o,t)?null:l:null}function I$j(e){return e&&null!=e.size}function P$h(e,o){if(!e)return {enabled:!1};if(t$E.TESTS_DISABLE_FAST_UPDATES)return {enabled:!1};const t=A$h(e.visualVariables,o);return t?{enabled:!0,visualVariables:t,materialParameters:q$d(t,o),requiresShaderTransformation:I$j(t)}:{enabled:!1}}function R$h(e,o,t){if(!o||!e.enabled)return !1;const i=e.visualVariables,n=A$h(o.visualVariables,t);return !!n&&(!!(_$k(i.size,n.size,"size")&&_$k(i.color,n.color,"color")&&_$k(i.rotation,n.rotation,"rotation")&&_$k(i.opacity,n.opacity,"opacity"))&&(e.visualVariables=n,e.materialParameters=q$d(n,t),e.requiresShaderTransformation=I$j(n),!0))}function _$k(e,o,t){if(!!e!=!!o)return !1;if(e&&e.field!==o.field)return !1;if(e&&"rotation"===t){const t=e,i=o;for(let e=0;e<3;e++)if(t.type[e]!==i.type[e]||t.offset[e]!==i.offset[e]||t.factor[e]!==i.factor[e])return !1}return !0}function q$d(e,n){const r={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},s=I$j(e);return e&&e.size?(r.vvSizeEnabled=!0,r.vvSizeMinSize=e.size.minSize,r.vvSizeMaxSize=e.size.maxSize,r.vvSizeOffset=e.size.offset,r.vvSizeFactor=e.size.factor):e&&s&&(r.vvSizeValue=n.transformation.scale),e&&s&&(r.vvSymbolAnchor=n.transformation.anchor,r.vvSymbolRotationMatrix=e$16(),r$12($$9),V$d(n.transformation.rotation[2],n.transformation.rotation[0],n.transformation.rotation[1],$$9),a$13(r.vvSymbolRotationMatrix,$$9)),e&&e.color&&(r.vvColorEnabled=!0,r.vvColorValues=e.color.values,r.vvColorColors=e.color.colors),e&&e.opacity&&(r.vvOpacityEnabled=!0,r.vvOpacityValues=e.opacity.values,r.vvOpacityOpacities=e.opacity.opacityValues),r}!function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale";}(S$j||(S$j={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle";}(y$o||(y$o={})),function(o){const t=e$10(),i=n$16();function u(o,u,f){if(!o.vvSizeEnabled)return f;n$15(t,f);const c=o.vvSymbolRotationMatrix;s$1q($$9,c[0],c[1],c[2],0,c[3],c[4],c[5],0,c[6],c[7],c[8],0,0,0,0,1),u$Z(t,t,$$9);for(let t=0;t<3;++t){const n=o.vvSizeOffset[t]+u[0]*o.vvSizeFactor[t];i[t]=o$X(n,o.vvSizeMinSize[t],o.vvSizeMaxSize[t]);}return i$1f(t,t,i),c$17(t,t,o.vvSymbolAnchor),t}function f(o,t,i){if(!t.vvSizeEnabled)return o$W(o,1,1,1);for(let n=0;n<3;++n){const r=t.vvSizeOffset[n]+i[0]*t.vvSizeFactor[n];o[n]=o$X(r,t.vvSizeMinSize[n],t.vvSizeMaxSize[n]);}return o}o.evaluateModelTransform=u,o.evaluateModelTransformScale=f;}(h$q||(h$q={}));const $$9=e$10(),B$g=h$q.evaluateModelTransform,L$i=h$q.evaluateModelTransformScale;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$v{constructor(){this.visible=!0;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class T$l{constructor(r,i,a={}){this.data=r,this.material=i,this.boundingSphere=n$1a(),this.instanceParameters=new s$v,this._transformation=e$10(),this._shaderTransformationDirty=!0,this.layerUid=c$$(a.layerUid,null),this.graphicUid=c$$(a.graphicUid,null),this.id=a.id?a.id:e$1e(),this.boundingInfo=c$$(a.boundingInfo,null),this.calculateShaderTransformation=c$$(a.calculateShaderTransformation,null),this.castShadow=!!a.castShadow&&a.castShadow;}get transformation(){return this._transformation}updateTransformation(t){t(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere);}shaderTransformationChanged(){this._shaderTransformationDirty=!0;}computeBoundingSphere(t,i,s=l$10(t)){t$V(this.boundingInfo)||(L$E(i,this.boundingInfo.getCenter(),t),i[3]=this.boundingInfo.getBSRadius()*s);}get hasShaderTransformation(){return r$W(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return t$V(this.calculateShaderTransformation)?c$$(this.transformation,o$1g):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=e$10()),n$15(this._shaderTransformation,this.calculateShaderTransformation(c$$(this.transformation,o$1g))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(t){if(this.material.computeAttachmentOrigin)return !!this.material.computeAttachmentOrigin(this,t)&&(r$W(this._transformation)&&L$E(t,t,this._transformation),!0);const r=this.indices.get(O$J.POSITION),s=this.vertexAttributes.get(O$J.POSITION);return !!u$16(s,r,t)&&(r$W(this._transformation)&&L$E(t,t,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const t=new r$G(u$11.Highlight),r=this.instanceParameters;return r.highlights=c$1b(r.highlights,t),t}removeHighlight(t){const r=this.instanceParameters;r.highlights=f$$(r.highlights,t);}}class S$i extends T$l{}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const ae$7=e$10(),oe$9=r$X(0,0,1),ne$6=16,le$8=1.5,ce$9=a$G,he$7=[ce$9/2,ce$9/2,1-ce$9/2,1-ce$9/2],me$9=[e$J*ce$9,e$J*ce$9];class ue$a extends y$r{constructor(e,t,r,i){super(e,t,r,i),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};}getCachedSize(){return {size:this._getIconSize()}}async doLoad(e){this._validateOrThrow();const t=this._prepareMaterialParameters(),r=this._getPrimitive();if(r$W(r))this._prepareResourcesPrimitive(t,r);else {const r=g$Z(this.symbol,this.symbolLayer),i=nt$5(r);i&&"application/json"===i.mediaType?await this._prepareResourcesCIM(t,JSON.parse(i.data),e):await this._prepareResourcesHref(t,r,e);}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=O$w(this._getIconSize());if(e)throw new s$16("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,t=Math.round(null!=e.size?u$12(e.size):ne$6);return this._drivenProperties.size?Math.max(t,64):t}_generateTextureCIM(e){const t=this._getGraphicHash(e);let r=""===t?null:this._cimSymbolTextures.get(t);if(!r){const i={scaleFactor:this._cimScaleFactorOrFunction},s=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,e,"esriGeometryPoint",i,null,null);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",s.anchorPosition);const a={width:s.imageData.width,height:s.imageData.height,powerOfTwoResizeMode:l$18.PAD};r=new L$H(s.imageData,a),this._cimSymbolTextures.set(t,r),this._context.stage.add(r);}return r}_computeSize(e,t){const r=e.width/e.height;return r>1?[t,Math.round(t/r)]:[Math.round(t*r),t]}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},t=this.symbol;if(de$8(t)){const{screenLength:r,minWorldLength:i,maxWorldLength:s}=t.verticalOffset;e.verticalOffset={screenLength:u$12(r),minWorldLength:i||0,maxWorldLength:null!=s?s:1/0};}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,t){const r=this._getOutlineSize();if(_e$7(t)&&0===r)throw new Error("Nothing to render");this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize;const i=this._context.sharedResources.textures.fromData(t,(()=>o$A(t)));this._texture=i.texture,this._releaseTexture=i,e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=he$7,e.textureId=this._texture.id;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/ce$9,this._createMaterialAndAddToStage(e,this._context.stage);}async _prepareResourcesHref(e,s,a){if(!a$12("esri-canvas-svg-support")&&It$1(s)){throw new s$16("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)")}this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const o=this._getIconSize(),n=o*this._context.graphicsCoreOwner.view.state.pixelRatio,l=await a$1g(this._context.sharedResources.textures.fromUrl(s,n,{signal:a}));if(!1===l.ok){w$D(l.error);throw new s$16("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${s})`)}this._releaseTexture=l.value;const c=l.value.texture,m=c.params;this._size=this._computeSize(m,o),e.textureId=c.id,this._createMaterialAndAddToStage(e,this._context.stage);}async _prepareResourcesCIM(e,t,r){const i=new d$10({data:t});if(!this._context.sharedResources.cimSymbolRasterizer){const e=(await import('./CIMSymbolRasterizer-fe061580.js')).CIMSymbolRasterizer;f$V(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new e(this._context.renderCoordsHelper.spatialReference,!0));}const s=this._context.layer.fields?this._context.layer.fields.map((e=>e.toJSON())):null;let a,o;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(i,s,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression){const e=this._context.renderer;if(isNaN(e.scaleExpression)){const t=e.scaleExpression,r=await i$1g(t,this._context.layer.spatialReference,s);o=(e,t,i)=>{const s=s$1r(r,e,{$view:i},"esriGeometryPoint",t);return null!==s?s:1};}else a=Number(e.scaleExpression);}this._cimScaleFactorOrFunction=a||o||1;const n=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];f$V(r);const l=this._context.layer.fieldsIndex;this._cimRequiredFields=n.map((e=>l.get(e).name)),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1;}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||j$M}_getOutlineSize(){let e=0;const t=this.symbolLayer;if(r$W(t.outline)&&null!=t.outline.size)return Math.max(u$12(t.outline.size),0);return e=_e$7(this._getPrimitive())?le$8:0,Math.max(e,0)}_getOutlineColor(){const t=this._getLayerOpacity(),r=this.symbolLayer,i=m$V(r,"outline","color");if(r$W(i)){const r=l$T.toUnitRGB(i),s=i.a*t;return [r[0],r[1],r[2],s]}return [0,0,0,0]}_getFillColor(){if(_e$7(this._getPrimitive()))return t$q;const e=t$V(this._getPrimitive()),t=m$V(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(t,{hasIntrinsicColor:e})}_getAnchorPos(e,t){return "relative"===e?r$13((t.x||0)+.5,.5-(t.y||0)):e in o$p?o$p[e]:o$p.center}_createMaterialAndAddToStage(e,t){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=P$h(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(e,this._fastUpdates.materialParameters),this._cimLayers){let r=r$W(e.textureId)?this._cimSymbolMaterials.get(e.textureId):null;return r||(r=new J$c(e),this._cimSymbolMaterials.set(c$$(e.textureId,0),r),t.add(r)),r}return this._material=new J$c(e),t.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial((e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped});})),this.layerOpacityChanged());}destroy(){super.destroy(),this._forEachMaterial((e=>this._context.stage.remove(e))),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach((e=>this._context.stage.remove(e))),this._cimSymbolTextures.clear(),this._releaseTexture=p$X(this._releaseTexture);}_getScaleFactor(e,t){if(this._drivenProperties.size&&e.size){for(let t=0;t<3;t++){const r=e.size[t];r&&"symbol-value"!==r&&"proportional"!==r&&(e.size[t]=u$12(r));}if("symbol-value"===e.size[0])return 1;if(isFinite(+e.size[0]))return +e.size[0]/t;if(isFinite(+e.size[2]))return +e.size[2]/t}return 1}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;let r,i;if(this._cimLayers){if(!this._cimLayers.length)return null;const e=this._generateTextureCIM(t),s={textureId:e.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(s,this._context.stage),r=[e.params.width,e.params.height];}else r=this._size,i=e$X(this._material);const s=d$y(t.geometry);if(t$V(s))return this.logger.warn(`unsupported geometry type for icon symbol: ${t.geometry.type}`),null;const a=e.renderingInfo,n=this._getVertexOpacityAndColor(a);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const e=r[0]>r[1]?r[0]:r[1];l=this._getScaleFactor(a,e);}l*=this._symbolTextureRatio;const h=[r[0]*l,r[1]*l],m=this.setGraphicElevationContext(t,new h$x);return this.ensureDrapedStatus("on-the-ground"===m.mode)&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(t,s,i,n,h,e.layer.uid):this._createAs3DShape(t,s,i,n,h,m,t.uid)}layerOpacityChanged(){const e=this._getFillColor(),t=this._getOutlineColor();return this._forEachMaterial((r=>{r.setParameters({color:e}),r.setParameters({outlineColor:t});})),!0}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,s=p$v(ue$a.elevationModeChangeTypes,r,i);if(s!==x$p.UPDATE)return s;const a=g$y(i)||"absolute-height"===i;return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>a))}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial((e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});})),!0}physicalBasedRenderingChanged(){return !0}pixelRatioChanged(){return !!this._getPrimitive()}applyRendererDiff(e,t){for(const r in e.diff){if("visualVariables"!==r)return e$I.Recreate_Symbol;if(!R$h(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return e$I.Recreate_Symbol;r$W(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters);}return e$I.Fast_Update}_defaultElevationInfoNoZ(){return pe$8}_createAs3DShape(e,t,r,i,s,a,o){const n=this.getFastUpdateAttrValues(e),l=n?e=>B$g(this._fastUpdates.materialParameters,n,e):null,c=[T$z.createPointGeometry(oe$9,null,i,s,fe$8,null,n)],h=f$x(this._context,t,c,[r],a,this._context.layer.uid,o,l);if(null===h)return null;const m=new p$s(this,h.object,c,null,null,d$C,a);return m.alignedSampledElevation=h.sampledElevation,m.needsElevationUpdates=g$y(a.mode)||"absolute-height"===a.mode,m.getScreenSize=this._createScreenSizeGetter(s,l),m.calculateRelativeScreenBounds=e=>r.calculateRelativeScreenBounds(m.getScreenSize(),1,e),g$u(m,t,this._context.elevationProvider),m}_createAsOverlay(e,t,r,i,a,o){r.renderPriority=this._renderPriority;const n=n$1a();Hn(t,n,this._context.overlaySR),n[2]=_e$8;const l=this._context.clippingExtent;if(r$W(l)&&!E$M(l,n))return null;const c=this.getFastUpdateAttrValues(e),h=c?e=>B$g(this._fastUpdates.materialParameters,c,e):null,m=T$z.createPointGeometry(oe$9,n,i,a,null,null,c),u=new T$l(m,r,{layerUid:o,graphicUid:e.uid,calculateShaderTransformation:h});n[3]=0,a$15(u.boundingSphere,n);const d=new u$r(this,[u],null,this._context.drapeSourceRenderer);return d.getScreenSize=this._createScreenSizeGetter(a,h),d.calculateRelativeScreenBounds=e=>r.calculateRelativeScreenBounds(d.getScreenSize(),1,e),d}_createScreenSizeGetter(e,t){const r=this._outlineSize+2;if(this._fastUpdates.enabled){const i=e[0]/this._symbolTextureRatio,s=e[1]/this._symbolTextureRatio;return (e=n$1b())=>{const a=t(ae$7);return e[0]=a[0]*i+r,e[1]=a[5]*s+r,e}}{const t=e[0]/this._symbolTextureRatio+r,i=e[1]/this._symbolTextureRatio+r;return (e=n$1b())=>(e[0]=t,e[1]=i,e)}}_fastVisualVariableConvertOptions(){const e=this._size[0]>this._size[1]?this._size[0]:this._size[1],t=r$X(e,e,e),r=e$1j(1),i=e*r;return {modelSize:t,symbolSize:r$X(i,i,i),unitInMeters:r,transformation:{anchor:f$_,scale:l$$,rotation:f$_}}}_getGraphicHash(e){let t="";for(const r of this._cimRequiredFields)t+=r+e.attributes[r];return t}_forEachMaterial(e){r$W(this._material)&&e(this._material),this._cimSymbolMaterials.forEach(e);}test(){return {...super.test(),material:this._material}}}function de$8(e){return e&&"point-3d"===e.type&&e.hasVisibleVerticalOffset()}function _e$7(e){return !t$V(e)&&("cross"===e||"x"===e)}ue$a.PRIMITIVE_SIZE=me$9,ue$a.elevationModeChangeTypes={definedChanged:x$p.UPDATE,staysOnTheGround:x$p.NONE,onTheGroundChanged:x$p.RECREATE};const pe$8={mode:"relative-to-ground",offset:0},fe$8=r$Z(0,0,0,1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function O$o(t){const e=[],o=[];I$i(t,o,e);const n=o[0][1].data,r=e[0][1].length,i=new Uint16Array(r);return j$o(t,o,e),S$h(t,o,e,i),w$n(t,o,e,i),U$e(t,o,e,i),F$h(t,o,e,i),v$o(t,o,e,i),C$k(t,o,e,n),new g$S(o,e,c$12.Line)}function R$g(t,e,o,n){const r="polygon"===t.type?c$1f.CCW_IS_HOLE:c$1f.NONE,i="polygon"===t.type?t.rings:t.paths,{position:a,outlines:s}=l$17(i,t.hasZ,r),u=new Float64Array(a.length),c=f$C(a,t.spatialReference,0,u,0,a,0,a.length/3,e,o,n),f=null!=c;return {lines:f?b$k(s,a,u):[],projectionSuccess:f,sampledElevation:c}}function b$k(t,e,o){const n=new Array;for(const{index:r,count:i}of t){if(i<=1)continue;const t=3*r,a=t+3*i;n.push({position:e.subarray(t,a),mapPosition:o?o.subarray(t,a):void 0});}return n}function d$s(t,e){const o="polygon"===t.type?c$1f.CCW_IS_HOLE:c$1f.NONE,n="polygon"===t.type?t.rings:t.paths,{position:r,outlines:i}=l$17(n,!1,o),a=Un(r,t.spatialReference,0,r,e,0,r.length/3);for(let s=2;s<r.length;s+=3)r[s]=_e$8;return {lines:a?b$k(i,r):[],projectionSuccess:a}}function I$i(t,e,o){const{attributeData:{position:r},removeDuplicateStartEnd:i}=t,a=D$c(r)&&i===P$g.REMOVE,s=r.length/3-(a?1:0),u=new Uint32Array(2*(s-1)),c=a?t$1i(r,0,r.length-3):r;let l=0;for(let n=0;n<s-1;n++)u[l++]=n,u[l++]=n+1;e.push([O$J.POSITION,{size:3,data:c,exclusive:a}]),o.push([O$J.POSITION,u]);}function j$o(e,o,n){const r=e.attributeData.mapPosition;t$V(r)||(n.push([O$J.MAPPOS,n[0][1]]),o.push([O$J.MAPPOS,{size:3,data:r}]));}function S$h(t,n,r,i){if(r$W(t.attributeData.colorFeature))return;const a=t.attributeData.color;n.push([O$J.COLOR,{size:4,data:c$$(a,a$x)}]),r.push([O$J.COLOR,i]);}function U$e(e,o,n,r){const i=e.attributeData.colorFeature;t$V(i)||(o.push([O$J.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([i])}]),n.push([O$J.COLOR,r]));}function w$n(t,n,r,i){if(r$W(t.attributeData.sizeFeature))return;const a=t.attributeData.size;n.push([O$J.SIZE,{size:1,data:[c$$(a,1)]}]),r.push([O$J.SIZE,i]);}function F$h(e,o,n,r){const i=e.attributeData.sizeFeature;t$V(i)||(o.push([O$J.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([i])}]),n.push([O$J.SIZEFEATUREATTRIBUTE,r]));}function v$o(e,o,n,r){const i=e.attributeData.opacityFeature;t$V(i)||(o.push([O$J.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([i])}]),n.push([O$J.OPACITYFEATUREATTRIBUTE,r]));}function C$k(e,o,n,a){if(t$V(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==l$O.Global||!e.overlayInfo.spatialReference.isGeographic)return;const s=new Float64Array(a.length),l=p$T(e.overlayInfo.spatialReference);for(let t=0;t<s.length;t+=3)ne$b(a,t,s,t,l);const p=a.length/3,m=new Float32Array(p+1);let h=z$f,E=N$j,T=0,g=0;o$W(h,s[g++],s[g++],s[g++]),m[0]=0;for(let t=1;t<p+1;++t)t===p&&(g=0),o$W(E,s[g++],s[g++],s[g++]),T+=H$q(h,E),m[t]=T,[h,E]=[E,h];o.push([O$J.DISTANCETOSTART,{size:1,data:m}]),n.push([O$J.DISTANCETOSTART,n[0][1]]);}function D$c(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}var P$g;!function(t){t[t.KEEP=0]="KEEP",t[t.REMOVE=1]="REMOVE";}(P$g||(P$g={}));const z$f=n$16(),N$j=n$16();function L$h(t){switch(t){case"butt":return r$D.BUTT;case"square":return r$D.SQUARE;case"round":return r$D.ROUND;default:return null}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const n$z=64,o$o=n$z/2,i$q=o$o/5;function e$w(t,n){return r$W(n)?m$p(t,f$p(n.style)):null}function m$p(r,e){return r.fromData(e,(()=>o$A(e,n$z,o$o,i$q)))}function f$p(r){return "diamond"===r?"kite":r}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function b$j(b){const x=new i$_,P=b.hasMultipassTerrain&&(b.output===o$19.Color||b.output===o$19.Alpha);x.include(s$F,b),b.output===o$19.Depth&&x.include(e$1h,b);const{vertex:S,fragment:j}=x;return j.include(a$10),d$W(x,b),x.attributes.add(O$J.POSITION,"vec3"),x.attributes.add(O$J.UV0,"vec2"),x.attributes.add(O$J.AUXPOS1,"vec3"),x.varyings.add("vColor","vec4"),x.varyings.add("vpos","vec3"),x.varyings.add("vUV","vec2"),x.varyings.add("vSize","float"),x.varyings.add("linearDepth","float"),P&&x.varyings.add("depth","float"),S.code.add(n$19`#define PERPENDICULAR(v) vec2(v.y, -v.x)
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}`),S.uniforms.add([new e$$("nearFar",((e,r)=>r.camera.nearFar)),new e$19("viewport",((e,r)=>r.camera.fullViewport))]),S.code.add(n$19`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),S.code.add(n$19`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
}`),b.draped||(S.uniforms.add(new e$Z("inverseProjectionMatrix",((e,r)=>r.camera.inverseProjectionMatrix))),S.code.add(n$19`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),S.code.add(n$19`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),S.uniforms.add(new o$_("perScreenPixelRatio",((e,r)=>r.camera.perScreenPixelRatio))),S.code.add(n$19`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${b.hasCap?"\n                if(prev.z > posLeft.z) {\n                  vec2 diff = posLeft.xy - posRight.xy;\n                  planeOrigin.xy += PERPENDICULAR(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),S.uniforms.add(new o$_("pixelRatio",((e,r)=>r.camera.pixelRatio))),S.code.add(n$19`
    void main(void) {
      float coverage = 1.0;

      // Check for special value of uv0.y which is used by the Renderer when graphics
      // are removed before the VBO is recompacted. If this is the case, then we just
      // project outside of clip space.
      if (uv0.y == 0.0) {
        // Project out of clip space
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      }
      else {
        float lineSize = getSize();
        float lineWidth = max(lineSize, 1.0) * pixelRatio;

        vec4 pos  = view * vec4(position.xyz, 1.0);
        vec4 prev = view * vec4(auxpos1.xyz, 1.0);
        clip(pos, prev);

        vec4 posScreen = projectAndScale(pos);
        vec4 prevScreen = projectAndScale(prev);

        vec2 segment = posScreen.xy - prevScreen.xy;

        // normalize vector along line segment
        float segmentLen = length(segment);
        segment = (segmentLen > 0.001) ? segment / segmentLen : vec2(0.0, 0.0);

        // displace according to position in the texture
        vec2 displacementDirU = PERPENDICULAR(segment);
        vec2 displacementDirV = segment;

        float displacementLen = ${n$19.float(n$z/i$q)} * lineWidth;

        vec4 displacedPosScreen = posScreen;
        displacedPosScreen.xy += uv0.x * displacementDirU * displacementLen + uv0.y * displacementDirV * displacementLen;
  `),b.draped||S.code.add(n$19`vec3 posRight = inverseProject(posScreen + vec4(displacementDirU.xy, 0.0, 0.0) * lineWidth);
vec3 posLeft = pos.xyz + (pos.xyz - posRight);
pos = toFront(displacedPosScreen, posLeft, posRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`),S.code.add(n$19`
        ${P?"depth = pos.z;":""}
        linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1] and cancel out perspective correct interpolation
        vUV = (uv0 + 1.0) / 2.0;
        vUV *= displacedPosScreen.w;

        vSize = displacementLen;

        vColor = getColor();
        vColor.a *= coverage;

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),P&&x.include(n$1q,b),x.include(u$$,b),j.uniforms.add([new e$19("intrinsicColor",(e=>e.color)),new c$11("tex",(e=>e.texture))]),j.include(e$14),j.code.add(n$19`
  void main() {
    discardBySlice(vpos);
    ${P?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    // Offset texture coordinate s.t. we sample texel centers
    float texelSize = ${n$19.float(1/n$z)};
    vec2 samplePos = vUV * gl_FragCoord.w + vec2(0.5, -0.5) * texelSize;

    // Evaluate sdf
    float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
    float distance = sdf * vSize;

    // Grow by a halfpixel to make sure the line is fully covered by the cross marker
    // (otherwise there will be a halo if they are different colours)
    distance -= 0.5;

    finalColor.a *= clamp(0.5 - distance, 0.0, 1.0);

    if (finalColor.a < ${n$19.float(t$19)}) {
      discard;
    }

    ${b.output===o$19.Alpha?n$19`gl_FragColor = vec4(finalColor.a);`:""}
    ${b.output===o$19.Color?n$19`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${b.output===o$19.Color&&b.transparencyPassType===O$L.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${b.output===o$19.Highlight?n$19`gl_FragColor = vec4(1.0);`:""}
    ${b.output===o$19.Depth?n$19`outputDepth(linearDepth);`:""}
  }
  `),x}const x$k=Object.freeze(Object.defineProperty({__proto__:null,build:b$j},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const A$g=new Map([[O$J.POSITION,0],[O$J.UV0,2],[O$J.AUXPOS1,3],[O$J.SIZE,6],[O$J.SIZEFEATUREATTRIBUTE,6],[O$J.COLOR,5],[O$J.COLORFEATUREATTRIBUTE,5],[O$J.OPACITYFEATUREATTRIBUTE,7]]);class R$f extends e$11{initializeProgram(e){const t=R$f.shader.get().build(this.configuration);return new o$Z(e.rctx,t,A$g)}_makePipelineState(t,i){const c=this.configuration,a=t===O$L.NONE;return W$h({blending:c.output===o$19.Color||c.output===o$19.Alpha?a?c$1c:E$J(t):null,depthTest:{func:l$13(t)},depthWrite:a?c.writeDepth&&a$1a:S$H(t),colorWrite:c$10,stencilWrite:c.hasOccludees?e$1i:null,stencilTest:c.hasOccludees?i?o$1k:f$11:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=W$h({blending:c$1c,depthTest:s$1m,depthWrite:null,colorWrite:c$10,stencilWrite:null,stencilTest:m$U}),this._occluderPipelineOpaque=W$h({blending:c$1c,depthTest:s$1m,depthWrite:null,colorWrite:c$10,stencilWrite:l$14,stencilTest:P$y}),this._occluderPipelineMaskWrite=W$h({blending:null,depthTest:i$1b,depthWrite:null,colorWrite:null,stencilWrite:e$1i,stencilTest:o$1k})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?e===E$G.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===E$G.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,t)}}R$f.shader=new t$W(x$k,(()=>import('./LineMarker.glsl-ad0b3a2f.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$u extends i$17{constructor(){super(...arguments),this.output=o$19.Color,this.transparencyPassType=O$L.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.draped=!1,this.hasCap=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1;}}e$Y([e$12({count:o$19.COUNT})],s$u.prototype,"output",void 0),e$Y([e$12({count:O$L.COUNT})],s$u.prototype,"transparencyPassType",void 0),e$Y([e$12()],s$u.prototype,"occluder",void 0),e$Y([e$12()],s$u.prototype,"hasSlicePlane",void 0),e$Y([e$12()],s$u.prototype,"writeDepth",void 0),e$Y([e$12()],s$u.prototype,"draped",void 0),e$Y([e$12()],s$u.prototype,"hasCap",void 0),e$Y([e$12()],s$u.prototype,"vvSize",void 0),e$Y([e$12()],s$u.prototype,"vvColor",void 0),e$Y([e$12()],s$u.prototype,"vvOpacity",void 0),e$Y([e$12()],s$u.prototype,"hasOccludees",void 0),e$Y([e$12()],s$u.prototype,"hasMultipassTerrain",void 0),e$Y([e$12()],s$u.prototype,"cullAboveGround",void 0),e$Y([e$12({constValue:!0})],s$u.prototype,"hasVvInstancing",void 0),e$Y([e$12({constValue:!0})],s$u.prototype,"hasSliceTranslatedView",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class T$k extends d$X{constructor(e){super(e,new v$n),this._vertexAttributeLocations=A$g,this.techniqueConfig=new s$u,this.layout=this.createLayout();}dispose(){}getConfiguration(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.draped=t.slot===E$G.DRAPED_MATERIAL,this.techniqueConfig.hasCap=this.parameters.cap!==r$D.BUTT,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.occluder=this.parameters.renderOccluded===h$Z.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(){}createLayout(){const e=T$C().vec3f(O$J.POSITION).vec2f(O$J.UV0).vec3f(O$J.AUXPOS1);return this.parameters.vvSizeEnabled?e.f32(O$J.SIZEFEATUREATTRIBUTE):e.f32(O$J.SIZE),this.parameters.vvColorEnabled?e.f32(O$J.COLORFEATUREATTRIBUTE):e.vec4f(O$J.COLOR),this.parameters.vvOpacityEnabled&&e.f32(O$J.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new C$j(this.layout,this.parameters)}requiresSlot(e,t){if(e===E$G.DRAPED_MATERIAL)return !0;if(this.parameters.renderOccluded===h$Z.OccludeAndTransparentStencil)return e===E$G.OPAQUE_MATERIAL||e===E$G.OCCLUDER_MATERIAL||e===E$G.TRANSPARENT_OCCLUDER_MATERIAL;const r=i$A(t);if(r===o$19.Color||r===o$19.Alpha){return e===(this.parameters.writeDepth?E$G.TRANSPARENT_MATERIAL:E$G.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)}return e===E$G.OPAQUE_MATERIAL}createGLMaterial(e){return e.output===o$19.Color||e.output===o$19.Alpha||e.output===o$19.Highlight||e.output===o$19.Depth?new f$o(e):null}}class f$o extends h$Y{_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(R$f,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees});}beginSlot(e){return this._output!==o$19.Color&&this._output!==o$19.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}}class v$n extends v$S{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=r$D.BUTT,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1;}}class C$j{constructor(e,t){this.vertexBufferLayout=e,this.parameters=t;}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(){return "begin-end"===this.parameters.placement?12:6}write(s,a,i,n){const h=a.vertexAttributes.get(O$J.POSITION).data,o=h.length/3;let u=1,c=0;this.parameters.vvSizeEnabled?c=a.vertexAttributes.get(O$J.SIZEFEATUREATTRIBUTE).data[0]:a.vertexAttributes.has(O$J.SIZE)&&(u=a.vertexAttributes.get(O$J.SIZE).data[0]);let p=[1,1,1,1],d=0;this.parameters.vvColorEnabled?d=a.vertexAttributes.get(O$J.COLORFEATUREATTRIBUTE).data[0]:a.vertexAttributes.has(O$J.COLOR)&&(p=a.vertexAttributes.get(O$J.COLOR).data);let m=0;this.parameters.vvOpacityEnabled&&(m=a.vertexAttributes.get(O$J.OPACITYFEATUREATTRIBUTE).data[0]);const E=s.transformation,A=new Float32Array(i.buffer);let T=n*(this.vertexBufferLayout.stride/4);const f=(e,t,r,s)=>{if(A[T++]=e[0],A[T++]=e[1],A[T++]=e[2],A[T++]=r[0],A[T++]=r[1],A[T++]=t[0],A[T++]=t[1],A[T++]=t[2],this.parameters.vvSizeEnabled?A[T++]=c:A[T++]=u,this.parameters.vvColorEnabled)A[T++]=d;else {const e=Math.min(4*s,p.length-4);A[T++]=p[e+0],A[T++]=p[e+1],A[T++]=p[e+2],A[T++]=p[e+3];}this.parameters.vvOpacityEnabled&&(A[T++]=m);};let v;!function(e){e[e.ASCENDING=1]="ASCENDING",e[e.DESCENDING=-1]="DESCENDING";}(v||(v={}));const C=(s,a)=>{const i=o$W(b$i,h[3*s],h[3*s+1],h[3*s+2]),n=O$n;let u=s+a;do{o$W(n,h[3*u],h[3*u+1],h[3*u+2]),u+=a;}while(G$l(i,n)&&u>=0&&u<o);E&&(L$E(i,i,E),L$E(n,n,E)),f(i,n,[-1,-1],s),f(i,n,[1,-1],s),f(i,n,[1,1],s),f(i,n,[-1,-1],s),f(i,n,[1,1],s),f(i,n,[-1,1],s);},R=this.parameters.placement;"begin"!==R&&"begin-end"!==R||C(0,v.ASCENDING),"end"!==R&&"begin-end"!==R||C(o-1,v.DESCENDING);}}const b$i=n$16(),O$n=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const d$r={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},s$t={dash:d$r.dash,"dash-dot":[...d$r.dash,...d$r.dot],dot:d$r.dot,"long-dash":d$r["long-dash"],"long-dash-dot":[...d$r["long-dash"],...d$r.dot],"long-dash-dot-dot":[...d$r["long-dash"],...d$r.dot,...d$r.dot],none:null,"short-dash":d$r["short-dash"],"short-dash-dot":[...d$r["short-dash"],...d$r["short-dot"]],"short-dash-dot-dot":[...d$r["short-dash"],...d$r["short-dot"],...d$r["short-dot"]],"short-dot":d$r["short-dot"],solid:null},h$p=8;function n$y(t,d=2){return t$V(t)?t:{pattern:t.slice(),pixelRatio:d}}function r$t(o,t=2){return {pattern:[o,o],pixelRatio:t}}function a$v(o){return r$W(o)&&"style"===o.type?l$n(o.style):null}function l$n(o){return r$W(o)?n$y(s$t[o],h$p):null}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const q$c=["polyline","polygon","extent"];class K$a extends y$r{constructor(e,t,r,i){super(e,t,r,i),this._uniformSize=1;}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=P$h(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size){const t=null!=this.symbolLayer.size?this.symbolLayer.size:e$1j(1);if(t<0)throw new s$16("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=t;}this._markerTexture=e$w(this._context.sharedResources.textures,this.symbolLayer.marker);}_getMaterialParameters(e,t=!1){const r=this._getCombinedOpacityAndColor(t&&this._markerColor||this._materialColor);this._patternHidesLine&&!t&&(r[3]=0);const i={width:this._computeMaterialWidth(this.symbolLayer?.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:L$h(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:a$v(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...i,...this._fastUpdates.materialParameters}:i}get _materialColor(){return o$1m(this.symbolLayer.material,(e=>e.color))}get _markerColor(){return o$1m(this.symbolLayer.marker,(e=>e.color))}get lineMaterial(){return t$V(this._lineMaterial)&&(this._lineMaterial=new H$d(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}get ringMaterial(){return t$V(this._ringMaterial)&&(this._ringMaterial=new H$d(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}get wireframeLineMaterial(){return t$V(this._wireframeLineMaterial)&&(this._wireframeLineMaterial=new H$d({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterial)),this._wireframeLineMaterial}get wireframeRingMaterial(){return t$V(this._wireframeRingMaterial)&&(this._wireframeRingMaterial=new H$d({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterial)),this._wireframeRingMaterial}get markerMaterial(){return t$V(this._markerMaterial)&&r$W(this.symbolLayer.marker)&&r$W(this._markerTexture)&&(this._markerMaterial=new T$k({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterial)),this._markerMaterial}destroy(){super.destroy(),this._forEachMaterial((e=>this._context.stage.remove(e))),this._lineMaterial=null,this._ringMaterial=null,this._wireframeLineMaterial=null,this._wireframeRingMaterial=null,this._markerMaterial=null,this._markerTexture=p$X(this._markerTexture);}_getDrivenSize(e){return this._drivenProperties.size&&e.size?u$12(c$A(e.size)):1}_getSizeFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?v$r(this._fastUpdates.visualVariables.size.field,e):null}_getDrivenColor(e){const t=r$Z(1,1,1,1);return this._drivenProperties.color&&e.color&&(t[0]=e.color[0],t[1]=e.color[1],t[2]=e.color[2],e.color.length>0&&(t[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(t[3]=e.opacity),t}_getColorFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?v$r(this._fastUpdates.visualVariables.color.field,e):null}_getOpacityFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?v$r(this._fastUpdates.visualVariables.opacity.field,e):null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,q$c,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t,new h$x);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,t.uid)}applyRendererDiff(e,t){for(const r in e.diff){if("visualVariables"!==r)return e$I.Recreate_Symbol;if(!R$h(this._fastUpdates,t,this._vvConvertOptions))return e$I.Recreate_Symbol;this._forEachMaterial((e=>e.setParameters(this._fastUpdates.materialParameters)));}return e$I.Fast_Update}prepareSymbolLayerPatch(e){if("partial"!==e.diff.type)return;const t=e.diff.diff,r={};"complete"===t.size?.type&&(r.width=this._computeMaterialWidth(t.size.newValue),delete t.size),"complete"===t.cap?.type&&(r.cap=L$h(c$$(t.cap.newValue,"butt")),delete t.cap);const i=this._prepareMarkerPatch(e,t);this._prepareMaterialPatch(e,t,i),e.symbolLayerStatePatches.push((()=>this._forEachMaterial((e=>e.setParameters(r)))));}layerOpacityChanged(){return this._forEachMaterial(((e,t)=>this._updateMaterialLayerOpacity(e,t))),!0}_forEachMaterial(e){r$W(this._lineMaterial)&&e(this._lineMaterial),r$W(this._ringMaterial)&&e(this._ringMaterial),r$W(this._wireframeLineMaterial)&&e(this._wireframeLineMaterial),r$W(this._wireframeRingMaterial)&&e(this._wireframeRingMaterial),r$W(this._markerMaterial)&&e(this._markerMaterial,!0);}_updateMaterialLayerOpacity(e,t=!1){const r=e.parameters.color,i=m$V(this.symbolLayer,"material","color"),a=this._patternHidesLine&&!t?0:this._getCombinedOpacity(i),s=r$Z(r[0],r[1],r[2],a);e.setParameters({color:s});}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,a=p$v(K$a.elevationModeChangeTypes,r,i);if(a!==x$p.UPDATE)return a;const s=g$y(i);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>s))}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial((t=>t.setParameters(e))),!0}physicalBasedRenderingChanged(){return !0}pixelRatioChanged(){return !0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof M$u)return v$R.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,t,r){const a=e.graphic,s=this._getGeometryAsPolygonOrPolyline(a.geometry),o="polygon"===s.type?s.rings:s.paths,n=new Array,l=new Array,h=new Array,m=a$1d(),c=R$g(s,this._context.elevationProvider,this._context.renderCoordsHelper,t),d="polygon"===s.type?"rings":"paths";this._logGeometryCreationWarnings(c,o,d,"LineSymbol3DLayer");for(let _=0;_<c.lines.length;_++){const{position:t,mapPosition:r}=c.lines[_];if(r$W(this._context.clippingExtent)&&(B$t(m),M$y(m,r),!R$x(m,this._context.clippingExtent)))continue;const a=this._createGeometry(e,t,r,s.type,J$8.ELEVATED);n.push(a),l.push("polygon"===s.type?this.ringMaterial:this.lineMaterial),h.push(o$1g),t$E.LINE_WIREFRAMES&&(n.push(a.cloneShallow()),l.push("polygon"===s.type?this.wireframeRingMaterial:this.wireframeLineMaterial),h.push(o$1g));const o=this.markerMaterial;r$W(o)&&(n.push(a.cloneShallow()),l.push(o),h.push(o$1g));}if(0===n.length)return null;const f=new O$t({geometries:n,materials:l,transformations:h,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),M=new p$s(this,f,n,null,null,b$r,t);return M.alignedSampledElevation=c.sampledElevation,M.needsElevationUpdates=g$y(t.mode),M}_createGeometry(e,t,r,i,a){const s="polygon"===i?P$g.REMOVE:P$g.KEEP,o=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,n=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return O$o({overlayInfo:a===J$8.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:s,uniformSize:this._uniformSize,attributeData:{position:t,mapPosition:r,size:n?null:this._getDrivenSize(e.renderingInfo),color:o?null:this._getDrivenColor(e.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(e.graphic),colorFeature:this._getColorFeatureAttributeData(e.graphic),opacityFeature:this._getOpacityFeatureAttributeData(e.graphic)}})}_createAsOverlay(e,t){const r=e.graphic,a=this._getGeometryAsPolygonOrPolyline(r.geometry),s="polygon"===a.type?a.rings:a.paths,o="polygon"===a.type?this.ringMaterial:this.lineMaterial;o.renderPriority=this._renderPriority;const l=t$E.LINE_WIREFRAMES?"polygon"===a.type?this.wireframeRingMaterial:this.wireframeLineMaterial:null,h=this.markerMaterial;r$W(l)&&(l.renderPriority=this._renderPriority-.001),r$W(h)&&(h.renderPriority=this._renderPriority-.002);const p=new Array,m=a$1d(),c=B$t(),d=d$s(a,this._context.overlaySR),M="polygon"===a.type?"rings":"paths";this._logGeometryCreationWarnings(d,s,M,"LineSymbol3DLayer");for(const _ of d.lines){if(B$t(m),M$y(m,_.position),!R$x(m,this._context.clippingExtent))continue;f$10(c,m);const s=this._createGeometry(e,_.position,null,a.type,J$8.DRAPED),d=e=>{const i=new T$l(s,e,{layerUid:t,graphicUid:r.uid});return p.push(i),i};if(r$W(h)){const e=d(h),t=e$X(this.symbolLayer.marker).placement;"begin"!==t&&"begin-end"!==t||M$y(m,_.position,0,1),"end"!==t&&"begin-end"!==t||M$y(m,_.position,_.position.length-3,1),this._updateBoundingSphere(e,m);}const M=d(o);if(this._updateBoundingSphere(M,m),t$E.LINE_WIREFRAMES){const e=d(l);this._updateBoundingSphere(e,m);}}return new u$r(this,p,c,this._context.drapeSourceRenderer)}_updateBoundingSphere(e,t){r$17(e.boundingSphere,.5*(t[0]+t[3]),.5*(t[1]+t[4]),0,.5*Math.sqrt((t[3]-t[0])*(t[3]-t[0])+(t[4]-t[1])*(t[4]-t[1])));}get _patternHidesLine(){const e=this.symbolLayer.pattern;return r$W(e)&&"style"===e.type&&"none"===e.style}_computeMaterialWidth(e){return e=c$$(e,e$1j(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?u$12(1):1:u$12(e)}_prepareMaterialPatch(e,i,a){const s=i.material;if(t$V(s))return void(a.changed&&a.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterial,e));if("collection"===s.type)return;const o="complete"===s.type?o$1m(s.newValue,(e=>e.color)):"complete"===s.diff.color.type?s.diff.color.newValue:null,n=this._getCombinedOpacityAndColor(o);a.useMaterialColor&&this._patchMaterialColor(t$1a(n),this._markerMaterial,e),this._patternHidesLine&&(n[3]=0),this._patchMaterialColor(n,this._lineMaterial,e),delete i.material;}_prepareMarkerPatch(e,t){const a=t.marker;if(t$V(a)||"partial"!==a.type||r$W(a.diff.style)||r$W(a.diff.placement)||r$W(a.diff.color)&&"complete"!==a.diff.color.type)return {changed:!1,useMaterialColor:t$V(this._markerColor)};const s=a.diff.color;if(t$V(s))return delete t.marker,{changed:!1,useMaterialColor:t$V(this._markerColor)};const o=e$X(s.newValue);return t$V(o)?(delete t.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(o),this._markerMaterial,e),delete t.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(e,t,i){t$V(t)||i.symbolLayerStatePatches.push((()=>t.setParameters({color:e})));}}var J$8;K$a.elevationModeChangeTypes={definedChanged:x$p.RECREATE,staysOnTheGround:x$p.NONE,onTheGroundChanged:x$p.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED";}(J$8||(J$8={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function m$o(m){const u=new i$_;u.include(r$10),u.include(e$1k,m),u.include(p$q,m),d$W(u,m);const{vertex:v,fragment:h}=u;return m.stippleEnabled&&(u.attributes.add(O$J.UV0,"vec2"),u.attributes.add(O$J.AUXPOS1,"vec3"),v.uniforms.add(new e$19("viewport",((e,o)=>o.camera.fullViewport)))),u.attributes.add(O$J.POSITION,"vec3"),u.varyings.add("vpos","vec3"),v.code.add(n$19`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),m.stippleEnabled&&(v.code.add(n$19`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),m.draped?v.uniforms.add(new o$_("worldToScreenRatio",((e,o)=>1/o.screenToPCSRatio))):v.code.add(n$19`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),v.code.add(n$19`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),m.draped?v.code.add(n$19`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):v.code.add(n$19`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),v.code.add(n$19`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),v.code.add(n$19`}`),m.output===o$19.Highlight&&u.include(a$19),u.include(u$$,m),h.uniforms.add(new o$_("alphaCoverage",((e,o)=>Math.min(1,e.width*o.camera.pixelRatio)))),m.hasVertexColors||h.uniforms.add(new e$19("constantColor",(e=>e.color))),h.code.add(n$19`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${m.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${n$19.float(t$19)}) {
      discard;
    }

    ${m.output===o$19.Color?n$19`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${m.output===o$19.Highlight?n$19`outputHighlight();`:""}
  }
  `),u}const u$q=Object.freeze(Object.defineProperty({__proto__:null,build:m$o},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class g$n extends e$11{constructor(e,t,i){super(e,t,i),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=e.stippleTextureRepository;}get stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==o$19.Highlight}initializeProgram(e){const t=g$n.shader.get().build(this.configuration);return new o$Z(e.rctx,t,E$E)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null;}bindPass(t,i){if(this.program.bindPass(t,i),this.stipplePattern!==t.stipplePattern){const e=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,e),this.stipplePattern=e;}if(this.stippleEnabled){const{pixelSize:t,sdfNormalizer:i,pixels:r}=r$W(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",i),this.program.setUniform1f("stipplePatternTextureSize",r),this.program.setUniform1f("stipplePatternPixelSize",t),this.program.setUniform1f("stipplePatternPixelSizeInv",1/t);}}initializePipeline(){const e=this.configuration,i=l$P(R$u.SRC_ALPHA,R$u.ONE,R$u.ONE_MINUS_SRC_ALPHA,R$u.ONE_MINUS_SRC_ALPHA),r=(t,i=null,r=null)=>W$h({blending:i,depthTest:i$1b,depthWrite:r,colorWrite:c$10,stencilWrite:e.hasOccludees?e$1i:null,stencilTest:e.hasOccludees?t?o$1k:f$11:null});return e.output===o$19.Color?(this._occludeePipelineState=r(!0,e.transparent||this.stippleEnabled?i:null,a$1a),r(!1,e.transparent||this.stippleEnabled?i:null,a$1a)):r(!1)}get primitiveType(){return E$F.LINES}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}g$n.shader=new t$W(u$q,(()=>import('./NativeLine.glsl-e06bf803.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class r$s extends i$17{constructor(){super(...arguments),this.output=o$19.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1;}}e$Y([e$12({count:o$19.COUNT})],r$s.prototype,"output",void 0),e$Y([e$12()],r$s.prototype,"hasSlicePlane",void 0),e$Y([e$12()],r$s.prototype,"hasVertexColors",void 0),e$Y([e$12()],r$s.prototype,"transparent",void 0),e$Y([e$12()],r$s.prototype,"draped",void 0),e$Y([e$12()],r$s.prototype,"stippleEnabled",void 0),e$Y([e$12()],r$s.prototype,"stippleOffColorEnabled",void 0),e$Y([e$12()],r$s.prototype,"stipplePreferContinuous",void 0),e$Y([e$12()],r$s.prototype,"hasOccludees",void 0),e$Y([e$12({constValue:!1})],r$s.prototype,"stippleRequiresClamp",void 0),e$Y([e$12({constValue:!1})],r$s.prototype,"stippleScaleWithLineWidth",void 0),e$Y([e$12({constValue:!1})],r$s.prototype,"stippleRequiresStretchMeasure",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const X$6=s$17.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var F$g;!function(e){e[e.START=0]="START",e[e.END=1]="END";}(F$g||(F$g={}));class W$b extends d$X{constructor(e){super(e,new z$e),this._techniqueConfig=new r$s;}getConfiguration(e,r){this._techniqueConfig.output=e,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=r.slot===E$G.DRAPED_MATERIAL;const s=r$W(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=s,this._techniqueConfig.stippleOffColorEnabled=s&&r$W(this.parameters.stippleOffColor),this._techniqueConfig.hasOccludees=this.parameters.hasOccludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}intersect(e,r,s,i,o,n,a,c,u){r$W(u)?E$O(e,i,u,n,1,a):this._intersectLineGeometry(e,r,s,i,a);}_intersectLineGeometry(e,t,r,s,p){if(!s.options.selectionMode||u$10(t))return;if(!M$x(r))return void X$6.error("intersection assumes a translation-only matrix");const h=e.vertexAttributes.get(O$J.POSITION).data,d=s.camera,A=oe$8;a$16(A,s.point);const T=2;o$W(ne$5[0],A[0]-T,A[1]+T,0),o$W(ne$5[1],A[0]+T,A[1]+T,0),o$W(ne$5[2],A[0]+T,A[1]-T,0),o$W(ne$5[3],A[0]-T,A[1]-T,0);for(let i=0;i<4;i++)if(!d.unprojectFromRenderScreen(ne$5[i],ae$6[i]))return;j$J(d.eye,ae$6[0],ae$6[1],ce$8),j$J(d.eye,ae$6[1],ae$6[2],ue$9),j$J(d.eye,ae$6[2],ae$6[3],fe$7),j$J(d.eye,ae$6[3],ae$6[0],le$7);let y=Number.MAX_VALUE,P=0;for(let i=0;i<h.length-5;i+=3){if(J$7[0]=h[i]+r[12],J$7[1]=h[i+1]+r[13],J$7[2]=h[i+2]+r[14],K$9[0]=h[i+3]+r[12],K$9[1]=h[i+4]+r[13],K$9[2]=h[i+5]+r[14],W$i(ce$8,J$7)<0&&W$i(ce$8,K$9)<0||W$i(ue$9,J$7)<0&&W$i(ue$9,K$9)<0||W$i(fe$7,J$7)<0&&W$i(fe$7,K$9)<0||W$i(le$7,J$7)<0&&W$i(le$7,K$9)<0)continue;if(d.projectToRenderScreen(J$7,$$8),d.projectToRenderScreen(K$9,ee$3),$$8[2]<0&&ee$3[2]>0){e$15(Y$8,J$7,K$9);const e=d.frustum,t=-W$i(e[k$C.NEAR],J$7)/P$u(Y$8,Z$g(e[k$C.NEAR]));q$p(Y$8,Y$8,t),u$W(J$7,J$7,Y$8),d.projectToRenderScreen(J$7,$$8);}else if($$8[2]>0&&ee$3[2]<0){e$15(Y$8,K$9,J$7);const e=d.frustum,t=-W$i(e[k$C.NEAR],K$9)/P$u(Y$8,Z$g(e[k$C.NEAR]));q$p(Y$8,Y$8,t),u$W(K$9,K$9,Y$8),d.projectToRenderScreen(K$9,ee$3);}else if($$8[2]<0&&ee$3[2]<0)continue;$$8[2]=0,ee$3[2]=0;const e=b$F(l$15($$8,ee$3,se$4),A);e<y&&(y=e,r$V(te$3,J$7),r$V(re$2,K$9),P=i/3);}const v=s.rayBegin,x=s.rayEnd;if(y<T*T){let e=Number.MAX_VALUE;if(k$D(l$15(te$3,re$2,se$4),l$15(v,x,ie$4),Z$6)){e$15(Z$6,Z$6,v);const t=s$1b(Z$6);q$p(Z$6,Z$6,1/t),e=t/x$H(v,x);}p(e,Z$6,P,!1);}}computeAttachmentOrigin(e,t){const r=e.vertexAttributes;if(!r)return !1;const s=r.get(O$J.POSITION);return h$$(s,null,!1,t)}requiresSlot(e){return e===E$G.OPAQUE_MATERIAL||e===E$G.DRAPED_MATERIAL}createGLMaterial(e){return e.output===o$19.Color||e.output===o$19.Highlight?new H$c(e):null}createBufferWriter(){const e=this.parameters.hasVertexColors?u$v:f$v;return t$V(this.parameters.stipplePattern)?new i$w(e):new Q$8(e.clone().vec3f(O$J.AUXPOS1).vec2f(O$J.UV0))}}class H$c extends t$1d{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees});}beginSlot(e){return this._output===o$19.Color&&this._updateOccludeeState(e),this.ensureTechnique(g$n,e)}}class Q$8{constructor(e){this.vertexBufferLayout=e;}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(O$J.POSITION).length}write(e,t,r,s){h$10(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,s),this._writeAuxpos1(e,t,r,s),this._writeUV0(e,t,r,s);}_writeAuxpos1(e,t,r,s){const i=r.getField(O$J.AUXPOS1,i$1h),o=t.indices.get(O$J.POSITION),n=t.vertexAttributes.get(O$J.POSITION).data,a=e.transformation,c=i.typedBufferStride,u=i.typedBuffer;s*=c;for(let f=0;f<o.length-1;f+=2)for(const e of [1,0]){const t=3*o[f+e],r=n[t],i=n[t+1],l=n[t+2],m=a[0]*r+a[4]*i+a[8]*l+a[12],p=a[1]*r+a[5]*i+a[9]*l+a[13],h=a[2]*r+a[6]*i+a[10]*l+a[14];u[s]=m,u[s+1]=p,u[s+2]=h,s+=c;}}_writeUV0(e,t,r,s){const i=r.getField(O$J.UV0,u$17),n=t.indices.get(O$J.POSITION),a=t.vertexAttributes.get(O$J.POSITION).data,c=t.vertexAttributes.get(O$J.DISTANCETOSTART)?.data,u=e.transformation,l=i.typedBufferStride,h=i.typedBuffer;let d=0;h[s*=l]=F$g.START,h[s+1]=d,s+=l;const g=3*n[0],A=o$W(J$7,a[g],a[g+1],a[g+2]);u&&L$E(A,A,u);const O=K$9,S=n.length-1;let j=1;const T=c?(e,t,r)=>d=c[r]:(e,t,r)=>d+=x$H(e,t);for(let m=1;m<S;m+=2){const e=3*n[m];o$W(O,a[e],a[e+1],a[e+2]),u&&L$E(O,O,u),T(A,O,j++);for(let t=0;t<2;++t)h[s]=1-t,h[s+1]=d,s+=l;r$V(A,O);}const _=3*n[S];o$W(O,a[_],a[_+1],a[_+2]),u&&L$E(O,O,u),T(A,O,j),h[s]=F$g.END,h[s+1]=d;}}class z$e extends o$1h{constructor(){super(...arguments),this.color=_$y,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1;}}const J$7=n$16(),K$9=n$16(),Y$8=n$16(),Z$6=n$16(),$$8=x$J(),ee$3=x$J(),te$3=n$16(),re$2=n$16(),se$4=v$T(),ie$4=v$T(),oe$8=n$16(),ne$5=[x$J(),x$J(),x$J(),x$J()],ae$6=[n$16(),n$16(),n$16(),n$16()],ce$8=p$Y(),ue$9=p$Y(),fe$7=p$Y(),le$7=p$Y();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const ue$8=["mesh"];class me$8 extends y$r{constructor(e,t,r,a){super(e,t,r,a),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1);}async doLoad(){t$E.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new W$b({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new W$b({color:[0,1,1,1]}));}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),(e=>e.material))),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear();}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,ue$8,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(t,new h$x),a=e.renderingInfo;return this._createAs3DShape(t,a,r,t.uid)}layerOpacityChanged(e,r){const a=this._getLayerOpacity();return this._materials.forEach((e=>{e.material.setParameters({layerOpacity:a});const t=e.material.parameters;this._setMaterialTransparentParameter(t,e),e.material.setParameters({transparent:t.transparent});})),e.forEach((e=>{const o=r(e);r$W(o)&&o.layerOpacityChanged(a,this._context.isAsync);})),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,v$u)}slicePlaneEnabledChanged(e,r){return this._materials.forEach((e=>{e.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});})),e.forEach((e=>{const a=r(e);r$W(a)&&a.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync);})),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._materials.forEach((t=>t.material.setParameters({usePBR:e}))),!0}pixelRatioChanged(){return !0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(t){return t$V(t)?"-":t instanceof l$T?t.toHex():t.contentHash}_materialPropertiesDefault(e,t){const r=this._requiresSymbolVertexColors(),a=!!e.vertexAttributes.color,o=!!e.vertexAttributes.tangent;return {hasSymbolVertexColors:r,hasVertexColors:a,hasVertexTangents:o,uid:`vc:${a},vt:${o},vct${t},svc:${r}`}}_materialProperties(e,t,r){const a=this._materialPropertiesDefault(e,r);if(!t.material)return a;const{color:o,colorTexture:s,normalTexture:n,doubleSided:i,alphaCutoff:l,alphaMode:c}=t.material,u=this._colorOrTextureUid(o),m=this._colorOrTextureUid(s),h=this._colorOrTextureUid(n);if(a.color=o,a.colorTexture=s,a.normalTexture=n,a.uid=`${a.uid},cmuid:${u},ctmuid:${m},ntmuid:${h},ds:${i},ac:${l},am:${c}`,t.material instanceof c$1h){const{metallic:e,roughness:r,metallicRoughnessTexture:o,emissiveColor:s,emissiveTexture:n,occlusionTexture:i}=t.material,l=this._colorOrTextureUid(o),c=this._colorOrTextureUid(s),u=this._colorOrTextureUid(n),m=this._colorOrTextureUid(i);a.metallic=e,a.roughness=r,a.metallicRoughnessTexture=o,a.emissiveColor=s,a.emissiveTexture=n,a.occlusionTexture=i,a.uid=`${a.uid},mrm:${e},mrr:${r},mrt:${l},emuid:${c},etmuid:${u},otmuid:${m}`;}return a}_setInternalColorValueParameters(t,r){r.diffuse=l$T.toUnitRGB(t),r.opacity=t.a;}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const r=this._getInternalTexture(e,C$z.Opaque);return r$W(r)?r.id:null}_getInternalTexture(e,t){const r=this._getLoadableTextureResource(e);if(!r)return null;const a=`${e.contentHash}/${t}`;let o=this._textures.get(a);return o||(o=new L$H(r,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:t!==C$z.Opaque}),this._textures.set(a,o),this._context.stage.add(o),this._context.stage.loadImmediate(o)),o}_castTextureWrap(e="repeat"){if("string"==typeof e){const t=this._castTextureWrapIndividual(e);return {s:t,t}}return {s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return D$q.CLAMP_TO_EDGE;case"mirror":return D$q.MIRRORED_REPEAT;default:return D$q.REPEAT}}_setInternalMaterialParameters(r,a){if(r$W(r.color)&&this._setInternalColorValueParameters(r.color,a),r$W(r.colorTexture)){const e=this._getInternalTexture(r.colorTexture,a.textureAlphaMode);r$W(e)?(a.textureId=e.id,a.textureAlphaPremultiplied=!!e.params.preMultiplyAlpha):a.textureId=void 0;}r$W(r.normalTexture)&&(a.normalTextureId=this._getInternalTextureId(r.normalTexture)),r$W(r.emissiveColor)&&(a.emissiveFactor=l$T.toUnitRGB(r.emissiveColor)),r$W(r.emissiveTexture)&&(a.emissiveTextureId=this._getInternalTextureId(r.emissiveTexture)),r$W(r.occlusionTexture)&&(a.occlusionTextureId=this._getInternalTextureId(r.occlusionTexture)),r$W(r.metallicRoughnessTexture)&&(a.metallicRoughnessTextureId=this._getInternalTextureId(r.metallicRoughnessTexture));}_setExternalMaterialParameters(r){const a=this._drivenProperties.color;let o=r$W(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(a)r.externalColor=_$y;else {const a=r$W(this.symbolLayer.material)?this.symbolLayer.material.color:null;r$W(a)?r.externalColor=l$T.toUnitRGBA(a):(o=null,r.externalColor=_$y);}o&&(r.colorMixMode=o),r.castShadows=!!this.symbolLayer.castShadows;}_hasTransparentVertexColors(e){const t=e.vertexAttributes.color;if(t$V(t))return !1;for(let r=3;r<t.length;r+=4)if(255!==t[r])return !0;return !1}_getOrCreateMaterial(e,r){const a=r.material?.color,o=r.material?.colorTexture,s=r.material?.alphaMode,n="blend"===s,i=!("opaque"===s)&&(this._hasTransparentVertexColors(e)||r$W(a)&&a.a<1||r$W(o)&&o.transparent||n),l=this._materialProperties(e,r,i),c=this._materials.get(l.uid);if(c)return c.material;const u={material:null,isComponentTransparent:i,alphaMode:r.material?r.material.alphaMode:"opaque"},m=null==l.metallicRoughnessTexture&&null==l.metallic&&null==l.roughness,h={usePBR:this._usePBR(),isSchematic:m,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:f$_,diffuse:l$$,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:n$1t.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};m||(h.mrrFactors=[null!=l.metallic?l.metallic:1,null!=l.roughness?l.roughness:1,.5]),r.material&&(h.doubleSided=r.material.doubleSided,h.cullFace=r.material.doubleSided?n$1t.None:n$1t.Back,h.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(h),this._setMaterialTransparentParameter(h,u),this._setInternalMaterialParameters(l,h);const p=new R$w(h);return u.material=p,this._materials.set(l.uid,u),this._context.stage.add(p),p}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,t){e.transparent=this.needsDrivenTransparentPass||t.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,"auto"===t.alphaMode?e.textureAlphaMode=e.transparent?C$z.MaskBlend:C$z.Opaque:e.textureAlphaMode="opaque"===t.alphaMode?C$z.Opaque:"mask"===t.alphaMode?C$z.Mask:C$z.Blend;}_addDebugNormals(e,t,r,a){const o=t.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),i=[],l=[],c=[],u=[];for(let m=0;m<o;m++){const e=t[m],r=e.vertexAttributes.get(O$J.POSITION),a=e.vertexAttributes.get(O$J.NORMAL),o=e.indices.get(O$J.POSITION),s=e.indices.get(O$J.NORMAL),h=r.data,d=a.data;for(let t=0;t<o.length;t++){const e=3*o[t],r=3*s[t];for(let t=0;t<3;t++)i.push(h[e+t]);for(let t=0;t<3;t++)i.push(h[e+t]+d[r+t]*n);if(l.push(l.length),l.push(l.length),t%3==0){this._calculateFaceNormal(h,o,t,ge$6),this._getFaceVertices(h,o,t,pe$7,fe$6,de$7),u$W(pe$7,pe$7,fe$6),u$W(pe$7,pe$7,de$7),q$p(pe$7,pe$7,1/3);for(let e=0;e<3;e++)c.push(pe$7[e]);for(let e=0;e<3;e++)c.push(pe$7[e]+ge$6[e]*n);u.push(u.length),u.push(u.length);}}}const h=new g$S([[O$J.POSITION,{data:i,size:3,exclusive:!0}]],[[O$J.POSITION,new Uint32Array(l)]],c$12.Line);t.push(h),r.push(this._debugVertexNormalMaterial),a.push(r$1a(a[0]));const d=new g$S([[O$J.POSITION,{data:c,size:3,exclusive:!0}]],[[O$J.POSITION,new Uint32Array(u)]],c$12.Line);t.push(d),r.push(this._debugFaceNormalMaterial),a.push(r$1a(a[0]));}_createAs3DShape(e,r,a,o){const s=e.geometry;if("mesh"!==s.type)return null;const n=this._createGeometryInfo(s,r);if(!n)return null;const{geometries:i,materials:l,transformations:c,objectTransformation:u}=n;t$E.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(s,i,l,c);const m=new O$t({geometries:i,materials:l,transformations:c,metadata:{layerUid:this._context.layer.uid,graphicUid:o}});m.transformation=u;const h=this._createEdgeMaterial(),p=r$W(h)?{baseMaterial:l[0],edgeMaterials:[h],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,f=new p$s(this,m,i,null,null,d$C,a,p);return f.needsElevationUpdates=v$u(a.mode),f.useObjectOriginAsAttachmentOrigin=!0,f.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(m),f.alignedSampledElevation=d$C(f,f.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),f}_getCenterPointInElevationSR(e){const t=v$Q(0,0,0,this._context.elevationProvider.spatialReference);return dn([e.transformation[12],e.transformation[13],e.transformation[14]],this._context.renderCoordsHelper.spatialReference,t),t}_createComponentNormals(e,t,r,a){switch(r.shading||"flat"){case"source":return this._createComponentNormalsSource(e,t,r,a);case"flat":return this._createComponentNormalsFlat(e,a);case"smooth":return this._createComponentNormalsSmooth(e,a);default:return}}_createComponentNormalsSource(e,t,a,o){if(t$V(t))return this._createComponentNormalsFlat(e,o);let s=!1;if(!a.trustSourceNormals)for(let r=0;r<o.length;r+=3){this._calculateFaceNormal(e,o,r,ge$6);for(let e=0;e<3;e++){const a=3*o[r+e];pe$7[0]=t[a+0],pe$7[1]=t[a+1],pe$7[2]=t[a+2],P$u(ge$6,pe$7)<0&&(t[a+0]=-t[a+0],t[a+1]=-t[a+1],t[a+2]=-t[a+2],s=!0);}}return {normals:t,indices:o,didFlipNormals:s}}_createComponentNormalsFlat(e,t){const r=new Float32Array(t.length),a=new Uint32Array(3*t.length);for(let o=0;o<t.length;o+=3){const s=this._calculateFaceNormal(e,t,o,ge$6);for(let e=0;e<3;e++)r[o+e]=s[e],a[o+e]=o/3;}return {normals:r,indices:a,didFlipNormals:!1}}_createComponentNormalsSmooth(e,t){const r={};for(let s=0;s<t.length;s+=3){const a=this._calculateFaceNormal(e,t,s,ge$6);for(let e=0;e<3;e++){const o=t[s+e];let n=r[o];n||(n={normal:n$16(),count:0},r[o]=n),u$W(n.normal,n.normal,a),n.count++;}}const a=new Float32Array(3*t.length),o=new Uint32Array(3*t.length);for(let s=0;s<t.length;s++){const e=r[t[s]];1!==e.count&&(z$s(e.normal,e.normal),e.count=1);for(let t=0;t<3;t++)a[3*s+t]=e.normal[t];o[s]=s;}return {normals:a,indices:o,didFlipNormals:!1}}_getFaceVertices(e,t,r,a,o,s){const n=3*t[r+0],i=3*t[r+1],l=3*t[r+2];a[0]=e[n+0],a[1]=e[n+1],a[2]=e[n+2],o[0]=e[i+0],o[1]=e[i+1],o[2]=e[i+2],s[0]=e[l+0],s[1]=e[l+1],s[2]=e[l+2];}_calculateFaceNormal(e,t,r,a){return this._getFaceVertices(e,t,r,pe$7,fe$6,de$7),e$15(fe$6,fe$6,pe$7),e$15(de$7,de$7,pe$7),_$v(pe$7,fe$6,de$7),z$s(a,pe$7),a}_getOrCreateComponents(e){return c$$(e.components,be$3)}_createPositionBuffer(e,r){let a=e.vertexAttributes.position;const o=r.reprojection===ve$2.ECEF?r.transformBeforeProject:null;if(r$W(o)&&(a=R$y(a,new Float64Array(a.length),o)),r.reprojection===ve$2.NONE)return r.needsBufferCopy?new Float64Array(a):a;const s=r$W(o)?a:new Float64Array(a.length);return Un(a,e.spatialReference,0,s,this._context.renderCoordsHelper.spatialReference,0,a.length/3),s}_createNormalBuffer(e,a,o){let s=e.vertexAttributes.normal;if(t$V(s))return null;const n=o.reprojection===ve$2.ECEF?o.transformBeforeProject:null;r$W(n)&&(s=v$V(s,new Float32Array(s.length),n));if("local"===this._context.graphicsCoreOwner.view.viewingMode||o.reprojection===ve$2.NONE)return o.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const i=e.vertexAttributes.position,l=r$W(n)?s:new Float32Array(s.length);return j$N(s,i,a,e.spatialReference,l)}_createTangentBuffer(e,a,o){let s=e.vertexAttributes.tangent;if(t$V(s))return null;const n=o.reprojection===ve$2.ECEF?o.transformBeforeProject:null;r$W(n)&&(s=V$r(s,new Float32Array(s.length),n));if("local"===this._context.graphicsCoreOwner.view.viewingMode||o.reprojection===ve$2.NONE)return o.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const i=e.vertexAttributes.position,l=r$W(n)?s:new Float32Array(s.length);return k$E(s,i,a,e.spatialReference,l)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const t=this._getVertexOpacityAndColor(e),r=n$1u(m$V(this.symbolLayer,"material","colorMixMode")),a=new Uint8Array(4);return o$1n(t,r,a),a}return null}_createBuffers(e,r){const a=e.vertexAttributes&&e.vertexAttributes.position;if(!a)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const o=e.vertexAttributes.normal,s=e.vertexAttributes.uv,n=e.vertexAttributes.tangent;if(r$W(o)&&o.length!==a.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(r$W(n)&&n.length/4!=a.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(r$W(s)&&s.length/2!=a.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const i=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,i),c=this._createColorBuffer(e),u=this._createSymbolColorBuffer(r),m=this._createNormalBuffer(e,l,i),p=this._createTangentBuffer(e,l,i);return {positionBuffer:l,normalBuffer:m,tangentBuffer:p,uvBuffer:s,colorBuffer:c,symbolColorBuffer:u,objectTransformation:i.reprojection===ve$2.NONE&&r$W(i.objectTransformation)?i.objectTransformation:this._transformOriginLocal(e,l,m,p),geometryTransformation:i.reprojection===ve$2.NONE&&r$W(i.geometryTransformation)?i.geometryTransformation:e$10()}}_computeReprojectionInfo(e){const r=r$W(e.transform),a=r&&e.transform.geographic||this._context.renderCoordsHelper.viewingMode===l$O.Local?ve$2.NONE:ve$2.ECEF;if(r){if(a===ve$2.NONE){const t=e$10();qn(e.spatialReference,e.transform.origin,t,this._context.renderCoordsHelper.spatialReference);return {reprojection:a,objectTransformation:t,geometryTransformation:r$1a(e.transform.localMatrix),needsBufferCopy:!1}}const t=x$N(e$10(),e.transform.origin);return u$Z(t,t,e.transform.localMatrix),{reprojection:a,transformBeforeProject:t,needsBufferCopy:!0}}return {reprojection:a,needsBufferCopy:!0}}_transformOriginLocal(e,r,a,o){const i=this._context.renderCoordsHelper.spatialReference,l=e.anchor;he$6[0]=l.x,he$6[1]=l.y,he$6[2]=l.z;const c=e$10();qn(e.spatialReference,he$6,c,i);const m=T$F.fromTypedArray(r);if(h$U(xe$2,c),t$1h(m,m,xe$2),r$W(a)||r$W(o)){if(a$13(_e$6,c),o$14(_e$6,_e$6),r$W(a)){const e=i$1h.fromTypedArray(a);r$1d(e,e,_e$6);}if(r$W(o)){const e=i$1h.fromTypedArray(o,4*o.BYTES_PER_ELEMENT);r$1d(e,e,_e$6);}}return c}_validateFaces(e,t){const r=e.vertexAttributes.position.length/3,a=t.faces;if(a){let e=-1;for(let t=0;t<a.length;t++){const r=a[t];r>e&&(e=r);}if(r<=e)return this.logger.warn(`Vertex index ${e} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return !0}_getOrCreateFaces(e,t){return t.faces?t.faces:l$R(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return !1;const t=e.vertexAttributes&&e.vertexAttributes.position;if(!t)return !1;const r=this._context.elevationProvider.spatialReference;let a;const o=t.length/3;return e.spatialReference.equals(r)?a=t:(a=new Float64Array(t.length),Un(e.vertexAttributes.position,e.spatialReference,0,a,r,0,o)),B$t(ye$6),M$y(ye$6,a,0,o),!R$x(ye$6,this._context.clippingExtent)}_createGeometryInfo(e,a){if(!An(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const o=this._createBuffers(e,a);if(t$V(o))return null;const{positionBuffer:s,uvBuffer:n,colorBuffer:i,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:u,objectTransformation:m,geometryTransformation:h}=o,p=this._getOrCreateComponents(e),f=[],d=[],g=[];let x=!1;for(const r of p){if(!this._validateFaces(e,r))return null;const a=this._getOrCreateFaces(e,r);if(0===a.length)continue;const o=this._createComponentNormals(s,c,r,a);o.didFlipNormals&&(x=!0);const m=[[O$J.POSITION,{size:3,data:s,exclusive:!0}],[O$J.NORMAL,{size:3,data:o.normals,exclusive:!0}]],p=[[O$J.POSITION,a],[O$J.NORMAL,o.indices]];r$W(i)&&(m.push([O$J.COLOR,{size:4,data:i,exclusive:!0}]),p.push([O$J.COLOR,a])),r$W(l)&&(m.push([O$J.SYMBOLCOLOR,{size:4,data:l,exclusive:!0}]),p.push([O$J.SYMBOLCOLOR,new Uint16Array(a.length)])),r$W(n)&&(m.push([O$J.UV0,{size:2,data:n,exclusive:!0}]),p.push([O$J.UV0,a])),r$W(u)&&(m.push([O$J.TANGENT,{size:4,data:u,exclusive:!0}]),p.push([O$J.TANGENT,a]));const _=new g$S(m,p);f.push(_),d.push(h),g.push(this._getOrCreateMaterial(e,r));}return x&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:f,transformations:d,materials:g,objectTransformation:m}}_createEdgeMaterial(){const e={opacity:this._getLayerOpacity()};return f$z(this.symbolLayer,e)}}const he$6=n$16(),pe$7=n$16(),fe$6=n$16(),de$7=n$16(),ge$6=n$16(),xe$2=e$10(),_e$6=e$16(),ye$6=a$1d(),be$3=[new f$14];var ve$2;!function(e){e[e.NONE=0]="NONE",e[e.ECEF=1]="ECEF";}(ve$2||(ve$2={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class f$n{constructor(e,t,i,n){this.graphics3DSymbolLayer=e,this.instanceIndex=t,this.elevationAligner=i,this.elevationContext=n,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1;}initialize(){}setVisibility(e){const t=this.lodRenderer.instanceData;e!==t.getVisible(this.instanceIndex)&&t.setVisible(this.instanceIndex,e);}destroy(){null!=this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this));}alignWithElevation(t,i,n){if(this.elevationAligner){s$K(this.elevationContext.featureExpressionInfoContext,n);const s=this.elevationAligner(this,this.elevationContext,t,i);r$W(s)&&(this.alignedSampledElevation=s);}}getCenterObjectSpace(e=n$16()){return this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,I$h),L$E(e,this.lodRenderer.baseBoundingSphere.center,I$h)}getBoundingBoxObjectSpace(e=a$1d()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,I$h);const t=this.lodRenderer.baseBoundingBox;B$t(e);for(let s=0;s<8;++s)o$W(x$j,0==(1&s)?t[0]:t[3],0==(2&s)?t[1]:t[4],0==(4&s)?t[2]:t[5]),L$E(x$j,x$j,I$h),h$12(e,x$j);return e}computeAttachmentOrigin(e){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,I$h),e.render.origin[0]+=I$h[12],e.render.origin[1]+=I$h[13],e.render.origin[2]+=I$h[14],e.render.num++;}async getProjectedBoundingBox(t,n,s,r,o){const d=this.getBoundingBoxObjectSpace(o),m=v$m,u=S$G(d)?1:m.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,I$h);for(let e=0;e<u;e++){const t=m[e];x$j[0]=d[t[0]],x$j[1]=d[t[1]],x$j[2]=d[t[2]],L$E(x$j,x$j,I$h),p$m[3*e+0]=x$j[0],p$m[3*e+1]=x$j[1],p$m[3*e+2]=x$j[2];}if(!t(p$m,0,u))return null;B$t(d);let f=null;this.calculateRelativeScreenBounds&&(f=this.calculateRelativeScreenBounds());for(let e=0;e<3*u;e+=3){for(let t=0;t<3;t++)d[t]=Math.min(d[t],p$m[e+t]),d[t+3]=Math.max(d[t+3],p$m[e+t]);f&&s.push({location:p$m.slice(e,e+3),screenSpaceBoundingRect:f});}if(n&&(p$11(d,b$h),"absolute-height"!==this.elevationContext.mode)){let t;const i=V$g(d,n);try{t=await n.service.queryElevation(b$h[0],b$h[1],r,i,"ground");}catch(S){}r$W(t)&&V$p(d,0,0,-this.alignedSampledElevation+t);}return d}addObjectState(e,t){if(e===u$11.Highlight){const i=new r$G(e);this._addHighlightId(i),t.addExternal((e=>{this._removeHighlightId(e);}),i);}}removeObjectState(e){this._highlights.forEach((t=>e.remove(t)));}_addHighlightId(e){this._highlights.add(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0);}_removeHighlightId(e){this._highlights.delete(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0);}get lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const p$m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x$j=n$16(),b$h=n$16(),v$m=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],I$h=e$10();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function t$p(e){const t=[];return e.stageResources.geometries.forEach(((s,n)=>{const o=e.stageResources.materials[n],r=e.stageResources.textures;t.push({material:o,geometry:s,textures:r});})),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}function s$s(e){return {levels:e.map((e=>t$p(e)))}}function n$x(t,s=r$r){const n=c$B(t);return Math.sqrt(n/(s*Math.PI))}function o$n(e){e.levels.forEach((e=>{e.minScreenSpaceRadius||(e.minScreenSpaceRadius=n$x(e));}));}const r$r=.05;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var E$m;function F$f(t){let e=T$C().mat4f64(O$J.LOCALTRANSFORM).mat4f64(O$J.GLOBALTRANSFORM).vec4f64(O$J.BOUNDINGSPHERE).vec3f64(O$J.MODELORIGIN).mat3f(O$J.MODEL).mat3f(O$J.MODELNORMAL).vec2f(O$J.MODELSCALEFACTORS);return t.includes("color")&&(e=e.vec4f(O$J.COLOR)),t.includes("featureAttribute")&&(e=e.vec4f(O$J.FEATUREATTRIBUTE)),e=e.u8(O$J.STATE).u8(O$J.LODLEVEL).alignTo(8),e}!function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE";}(E$m||(E$m={}));class O$m{constructor(t){this.localTransform=t.getField(O$J.LOCALTRANSFORM,b$H),this.globalTransform=t.getField(O$J.GLOBALTRANSFORM,b$H),this.modelOrigin=t.getField(O$J.MODELORIGIN,T$F),this.model=t.getField(O$J.MODEL,l$19),this.modelNormal=t.getField(O$J.MODELNORMAL,l$19),this.modelScaleFactors=t.getField(O$J.MODELSCALEFACTORS,u$17),this.boundingSphere=t.getField(O$J.BOUNDINGSPHERE,h$13),this.color=t.getField(O$J.COLOR,c$1i),this.featureAttribute=t.getField(O$J.FEATUREATTRIBUTE,c$1i),this.state=t.getField(O$J.STATE,d$11),this.lodLevel=t.getField(O$J.LODLEVEL,d$11);}}class S$g extends n$17{constructor(t,e){super(),this._capacity=0,this._size=0,this._next=0,this._layout=F$f(t),this._shaderTransformation=e;}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const t=this._findSlot();return this._view.state.set(t,E$m.ALLOCATED),this._size++,this.emit("instance-added",{index:t}),t}removeInstance(t){const e=this._view.state;e$18(t>=0&&t<this._capacity&&e.get(t)&E$m.ALLOCATED,"invalid instance handle"),this._getStateFlag(t,E$m.ACTIVE)?this._setStateFlags(t,E$m.REMOVE):this.freeInstance(t),this.emit("instance-removed",{index:t});}freeInstance(t){const e=this._view.state;e$18(t>=0&&t<this._capacity&&e.get(t)&E$m.ALLOCATED,"invalid instance handle"),e.set(t,0),this._size--;}setLocalTransform(t,e,s=!0){this._view.localTransform.setMat(t,e),s&&this.updateModelTransform(t);}getLocalTransform(t,e){this._view.localTransform.getMat(t,e);}setGlobalTransform(t,e,s=!0){this._view.globalTransform.setMat(t,e),s&&this.updateModelTransform(t);}getGlobalTransform(t,e){this._view.globalTransform.getMat(t,e);}updateModelTransform(t){const a=this._view,o=M$f,h=I$g;a.localTransform.getMat(t,b$g),a.globalTransform.getMat(t,w$m);const l=u$Z(w$m,w$m,b$g);o$W(o,l[12],l[13],l[14]),a.modelOrigin.setVec(t,o),a$13(h,l),a.model.setMat(t,h);const c=p$13(M$f,l);c.sort(),a.modelScaleFactors.set(t,0,c[1]),a.modelScaleFactors.set(t,1,c[2]),u$18(h,h),o$14(h,h),a.modelNormal.setMat(t,h),this._setStateFlags(t,E$m.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:t});}getModelTransform(t,e){const s=this._view;s.model.getMat(t,I$g),s.modelOrigin.getVec(t,M$f),e[0]=I$g[0],e[1]=I$g[1],e[2]=I$g[2],e[3]=0,e[4]=I$g[3],e[5]=I$g[4],e[6]=I$g[5],e[7]=0,e[8]=I$g[6],e[9]=I$g[7],e[10]=I$g[8],e[11]=0,e[12]=M$f[0],e[13]=M$f[1],e[14]=M$f[2],e[15]=1;}applyShaderTransformation(t,e){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,e);}getCombinedModelTransform(t,e){return this.getModelTransform(t,e),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,e),e}getCombinedLocalTransform(t,e){return this._view.localTransform.getMat(t,e),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,e),e}getCombinedMaxScaleFactor(t){let e=this._view.modelScaleFactors.get(t,1);if(this._shaderTransformation){const s=this._shaderTransformation.scaleFactor(M$f,this,t);e*=Math.max(s[0],s[1],s[2]);}return e}getCombinedMedianScaleFactor(t){let e=this._view.modelScaleFactors.get(t,0);if(this._shaderTransformation){const s=this._shaderTransformation.scaleFactor(M$f,this,t);s.sort(),e*=s[1];}return e}getModel(t,e){this._view.model.getMat(t,e);}setFeatureAttribute(t,e){this._view.featureAttribute.setVec(t,e);}getFeatureAttribute(t,e){this._view.featureAttribute.getVec(t,e);}setColor(t,e){this._view.color.setVec(t,e);}getColor(t,e){this._view.color.getVec(t,e);}setVisible(t,e){e!==this.getVisible(t)&&(this._setStateFlag(t,E$m.VISIBLE,e),this.emit("instance-visibility-changed",{index:t}));}getVisible(t){return this._getStateFlag(t,E$m.VISIBLE)}setHighlight(t,e){e!==this.getHighlight(t)&&(this._setStateFlag(t,E$m.HIGHLIGHT,e),this.emit("instance-highlight-changed",{index:t}));}getHighlight(t){return this._getStateFlag(t,E$m.HIGHLIGHT)}getState(t){return this._view.state.get(t)}getLodLevel(t){return this._view.lodLevel.get(t)}countFlags(t){let e=0;for(let s=0;s<this._capacity;++s){this.getState(s)&t&&++e;}return e}_setStateFlags(t,e){const s=this._view.state;e=s.get(t)|e,s.set(t,e);}_clearStateFlags(t,e){const s=this._view.state;e=s.get(t)&~e,s.set(t,e);}_setStateFlag(t,e,s){s?this._setStateFlags(t,e):this._clearStateFlags(t,e);}_getStateFlag(t,e){return !!(this._view.state.get(t)&e)}_grow(){const t=Math.max(v$l,Math.floor(this._capacity*p$l)),e=this._layout.createBuffer(t);if(this._buffer){const t=new Uint8Array(this._buffer.buffer);new Uint8Array(e.buffer).set(t);}this._capacity=t,this._buffer=e,this._view=new O$m(this._buffer);}_findSlot(){const t=this._view.state;let e=this._next;for(;t.get(e)&E$m.ALLOCATED;)e=(e+1)%this._capacity;return this._next=(e+1)%this._capacity,e}}const v$l=1024,p$l=2,M$f=n$16(),I$g=e$16(),b$g=e$10(),w$m=e$10();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class n$w extends G$q{constructor(e,r){super((t=>C$A(this._instanceData.view.boundingSphere.getVec(t,this._tmpSphere))),{maximumDepth:25}),this._tmpSphere=_$x(),this._tmpMat4=e$10(),this._instanceData=e,this._boundingSphere=r;}addInstance(t){const s=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(t,this._tmpMat4);L$E(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*l$10(i),s.setVec(t,this._tmpSphere),this.add([t]);}removeInstance(t){this.remove([t]);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class t$o{constructor(t,s){this.thresholdScale=1,this._camera=new K$h,this._worldSpaceRadius=t,this._thresholds=s.map((e=>e));}updateCamera(e){this._camera.copyFrom(e);}selectLevel(e,t){const s=this._camera.computeScreenPixelSizeAt(e),r=this._worldSpaceRadius*t/s,a=this._thresholds;let h=-1;for(let o=0;o<a.length;++o)r>=a[o]*this.thresholdScale&&(h=o);return h}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class m$n{constructor(s,o){const i=s.renderContext.rctx,{geometry:m,material:u}=o;this._materialRepository=s.materialRep,u.setParameters({instancedDoublePrecision:!0});const f=u.createBufferWriter(),d=f.vertexBufferLayout,p=f.elementCount(m),c=f.allocate(p);f.write({},m,c,0),this.geometry=m,this.material=u,this.glMaterials=new a$y(u,this._materialRepository),this.vertexBufferLayout=d,this.vbo=c$13.createVertex(i,F$r.STATIC_DRAW,c.buffer),this.vao=new f$U(i,E$E,{geometry:o$13(d)},{geometry:this.vbo}),this.vertexCount=p;}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose();}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(r,e,t,a,n,l,m,u){const f=this.geometry.id;this.material.intersect(this.geometry,null,r.transform.transform,r,t,a,((t,a,d,p,c)=>{if(t>=0){if(null!=e&&!e(r.rayBegin,r.rayEnd,t))return;const p={layerUid:l.layerUid,graphicUid:l.graphicUid(n),geometryId:f,triangleNr:d,baseBoundingSphere:m,numLodLevels:u};if((null==r.results.min.drapedLayerOrder||c>=r.results.min.drapedLayerOrder)&&(null==r.results.min.dist||t<r.results.min.dist)&&r.results.min.set(i$1e.LOD,p,t,a,r.transform.transform,c),r.options.store!==t$1g.MIN&&(null==r.results.max.drapedLayerOrder||c>=r.results.max.drapedLayerOrder)&&(null==r.results.max.dist||t>r.results.max.dist)&&r.results.max.set(i$1e.LOD,p,t,a,r.transform.transform,c),r.options.store===t$1g.ALL){const e=U$v(r.results.min.ray);e.set(i$1e.LOD,p,t,a,r.transform.transform,c),r.results.all.push(e);}}}));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class h$o{constructor(n,o){this.minScreenSpaceRadius=n,this.components=o;}static async create(n,o,i){const r=await Promise.allSettled(o.components.map((o=>n.schedule((()=>new m$n(n,o)),i)))),s=r.map((n=>"fulfilled"===n.status?n.value:null)).filter((n=>n));if(p$V(i)||s.length!==r.length){s.forEach((n=>n.destroy())),f$V(i);for(const n of r)if("rejected"===n.status)throw n.reason}return new h$o(o.minScreenSpaceRadius,s)}destroy(){this.components.forEach((n=>n.destroy()));}intersect(n,o,t,e,i,r,s){this.components.forEach((c=>c.intersect(n,o,t,e,i,r,this.boundingSphere,s)));}get boundingBox(){if(t$V(this._boundingBox)){const n=B$t();this.components.forEach((t=>{r$W(t.boundingInfo)&&(h$12(n,t.boundingInfo.bbMin),h$12(n,t.boundingInfo.bbMax));})),this._boundingBox=n;}return this._boundingBox}get boundingSphere(){if(t$V(this._boundingSphere)){const n=this.boundingBox,o=n$16();p$11(n,o),this._boundingSphere={center:o,radius:.5*g$_(n)};}return this._boundingSphere}get triangleCount(){return this.components.reduce(((n,o)=>n+o.triangleCount),0)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class r$q{constructor(r,i,s){this._elementSize=i,this._buffer=c$13.createVertex(r,F$r.STATIC_DRAW),this.resize(s);}destroy(){this._buffer.dispose();}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return {cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,t,r,i=0){const s=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(r.array,i*this.elementSize).set(s);}transferAll(){this._buffer.setData(this._array);}transferRange(e,t){const r=e*this._elementSize,i=t*this._elementSize;this._buffer.setSubData(this._array,r,r,i);}resize(e){const t=e*this._elementSize,r=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(t),this._capacity=e;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class h$n{constructor(s){this.modelOriginHi=s.getField(O$J.MODELORIGINHI,i$1h),this.modelOriginLo=s.getField(O$J.MODELORIGINLO,i$1h),this.model=s.getField(O$J.MODEL,l$19),this.modelNormal=s.getField(O$J.MODELNORMAL,l$19),this.color=s.getField(O$J.INSTANCECOLOR,c$1i),this.featureAttribute=s.getField(O$J.INSTANCEFEATUREATTRIBUTE,c$1i);}}class n$v{constructor(t,i){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=t,this._instanceBufferLayout=i,this._elementSize=i.stride,this._capacity=1;}destroy(){this._buffer&&this._buffer.destroy();}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const t=this._headIndex,i=this._tailIndex;return t>=i?t-i:t+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null;}startUpdateCylce(){this._captureFirstIndex=!0;}beginUpdate(){e$18(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex;}endUpdate(){e$18(this._updating,"not updating"),this.size<c$q*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1;}allocateHead(){e$18(this._updating,"not updating"),this.isFull&&this._grow();const t=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=t,this._captureFirstIndex=!1),this._incrementHead(),e$18(this._headIndex!==this._tailIndex,"invalid pointers"),t}freeTail(){e$18(this._updating,"not updating"),e$18(this.size>0,"invalid size");const t=this._tailIndex===this._firstIndex;this._incrementTail(),t&&(this._firstIndex=this._tailIndex);}_grow(){const t=Math.max(_$j,Math.floor(this._capacity*d$q));this._resize(t);}_shrink(){const t=Math.max(_$j,Math.floor(this._capacity*f$m));this._resize(t);}_resize(t){if(e$18(this._updating,"not updating"),t===this._capacity)return;const i=new r$q(this._rctx,this._elementSize,t);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const t=this.size,e=this._compactInstances(i);e$18(e===t,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=e,this._prevHeadIndex=0;}this._resized=!0,this._capacity=t,this._buffer=i,this._view=new h$n(this._instanceBufferLayout.createView(this._buffer.array));}_compactInstances(t){const i=this._headIndex,e=this._tailIndex;return e<i?(this._buffer.copyRange(e,i,t),i-e):e>i?(this._buffer.copyRange(e,this._capacity,t),i>0&&this._buffer.copyRange(0,i,t,this._capacity-e),i+(this._capacity-e)):0}_incrementHead(t=1){this._headIndex=(this._headIndex+t)%this._capacity;}_incrementTail(t=1){this._tailIndex=(this._tailIndex+t)%this._capacity;}_transferRange(t,i){t<i?this._buffer.transferRange(t,i):t>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(t,this._capacity));}}const _$j=1024,d$q=2,c$q=.3,f$m=.5;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let O$l=e=>{const t=e.baseBoundingSphere.radius,s=e.levels.map((e=>e.minScreenSpaceRadius));return new t$o(t,s)};function U$d(e){O$l=e;}class M$e{constructor(e,t,s,a){this.type=i$1e.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new K$h,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[E$G.OPAQUE_MATERIAL,E$G.TRANSPARENT_MATERIAL],this.canRender=!0,this._symbol=e,this._optionalFields=t,this._metadata=s,this._instanceBufferLayout=B$u({instancedDoublePrecision:!0,instanced:t}),this._glInstanceBufferLayout=o$13(this._instanceBufferLayout,1),this._instanceData=new S$g(this._optionalFields,a),this._instanceData.on("instance-added",(()=>this._requestUpdateCycle())),this._instanceData.on("instance-removed",(()=>this._requestUpdateCycle())),this._instanceData.on("instance-transform-changed",(e=>{this._requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(e.index);})),this._instanceData.on("instance-visibility-changed",(e=>{this._requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(e.index);})),this._instanceData.on("instance-highlight-changed",(()=>this._requestUpdateCycle(!0))),this._enableLevelSelection=this._symbol.levels.length>1;}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e;}get layerUid(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach((t=>{const s=t.memoryUsage;e.cpu+=s.cpu,e.gpu+=s.gpu;})),this._highlightRenderInstanceData.forEach((t=>{const s=t.memoryUsage;e.cpu+=s.cpu,e.gpu+=s.gpu;})),e}get renderStats(){const e=this._instanceData.size,t=[];return this._levels.forEach(((e,s)=>{const a=this._defaultRenderInstanceData[s],n=this._highlightRenderInstanceData[s],i=a.size+n.size,r=e.triangleCount;t.push({renderedInstances:i,renderedTriangles:i*r,trianglesPerInstance:r});})),{totalInstances:e,renderedInstances:t.reduce(((e,t)=>e+t.renderedInstances),0),renderedTriangles:t.reduce(((e,t)=>e+t.renderedTriangles),0),levels:t}}async initializeRenderContext(e,a){this._context=e;const n=e.renderContext.rctx,i=await Promise.allSettled(this._symbol.levels.map((t=>(this._defaultRenderInstanceData.push(new n$v(n,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new n$v(n,this._instanceBufferLayout)),h$o.create(e,t,a))))),r=i.map((e=>"fulfilled"===e.status?e.value:null)).filter((e=>e));if(p$V(a)||r.length!==i.length){r.forEach((e=>e.destroy())),f$V(a);for(const e of i)if("rejected"===e.status)throw e.reason}this._levels=r,this._levelSelector=O$l(this);}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach((e=>e.destroy())),this._defaultRenderInstanceData.forEach((e=>e.destroy())),this._highlightRenderInstanceData.forEach((e=>e.destroy()));}get needsTransparentPass(){return this._levels.some((e=>e.components.some((e=>e.material.requiresSlot(E$G.TRANSPARENT_MATERIAL)))))}get needsHighlight(){return this._highlightRenderInstanceData.some((e=>e.size>0))}prepareRender(e){if(t$E.LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const t=e.bindParameters.contentCamera.equals(this._lastCamera);this._lastCamera.copyFrom(e.bindParameters.contentCamera),t||this._requestUpdateCycle();}const t=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this._updateInstances(e.bindParameters.contentCamera,t),this.needsUpdates&&this._context.requestRender();}render(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(e.pass))return;e.rctx.bindVAO();const t=e.pass!==A$D.MATERIAL_HIGHLIGHT&&e.pass!==A$D.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,s=e.pass!==A$D.MATERIAL_DEPTH_SHADOWMAP_DEFAULT;t&&this._renderComponents(e,this._defaultRenderInstanceData),s&&this._renderComponents(e,this._highlightRenderInstanceData);}intersect(e,t,s,a){if(!this.baseMaterial.isVisible())return;const i=n$16();e$15(i,a,s);const l=n=>{this._instanceData.getCombinedModelTransform(n,P$f),e.transform.set(P$f),L$E(F$e,s,e.transform.inverse),L$E(w$l,a,e.transform.inverse);const i=this._instanceData.getState(n),o=this._instanceData.getLodLevel(n),l=this._levels.length;e$18(i&E$m.ACTIVE,"invalid instance state"),e$18(o>=0&&o<l,"invaid lod level"),this._levels[o].intersect(e,t,F$e,w$l,n,this._metadata,l);};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(l):this.octree.forEachAlongRay(s,i,l);}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree();}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,e&&(this._needFullCycle=!0),this.needsUpdates&&this._context.requestRender();}get needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get octree(){return this._octree||(this._octree=this._buildOctree()),this._octree}_invalidateOctree(){this._octree&&(this._octree.destroy(),this._octree=null);}_buildOctree(){const e=new n$w(this._instanceData,this.baseBoundingSphere),t=this._instanceData,s=t.view?t.view.state:null;for(let a=0;a<this._instanceData.capacity;++a){s.get(a)&E$m.ACTIVE&&e.addInstance(a);}return e}_queryDepthRangeOctree(e){const t=e.eye,s=e.viewForward,a=this.octree.findClosest(s,G$q.DepthOrder.FRONT_TO_BACK,e.frustum),r=this.octree.findClosest(s,G$q.DepthOrder.BACK_TO_FRONT,e.frustum);if(null!=a&&null!=r){this._instanceData.view.boundingSphere.getVec(a,V$c),e$15(V$c,V$c,t);const o=P$u(V$c,s)-V$c[3];this._instanceData.view.boundingSphere.getVec(r,V$c),e$15(V$c,V$c,t);const l=P$u(V$c,s)+V$c[3];return {near:Math.max(e.near,o),far:Math.min(e.far,l)}}return {near:1/0,far:-1/0}}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach((e=>{e.startUpdateCylce();})),this._highlightRenderInstanceData.forEach((e=>{e.startUpdateCylce();})),this.needsUpdates&&this._context.requestRender();}_updateInstances(e,t){const s=this._enableLevelSelection,a=this._levelSelector;a.updateCamera(e),this._defaultRenderInstanceData.forEach((e=>{e.beginUpdate();})),this._highlightRenderInstanceData.forEach((e=>{e.beginUpdate();}));const n=this._instanceData,i=this._instanceData.view,r=n.size,o=n.capacity;let l=this._instanceIndex;t=Math.min(r,t);for(let c=0;c<t;++c){0===l&&this._startUpdateCycle();const e=i.state.get(l);let r=0;if(!(e&E$m.ALLOCATED)){l=(l+1)%o,t++;continue}const c=i.lodLevel.get(l);if(e&E$m.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[c].freeTail(),e&E$m.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[c].freeTail(),e&E$m.REMOVE)n.freeInstance(l);else if(e&E$m.VISIBLE){let t=0;s&&(i.modelOrigin.getVec(l,H$b),t=a.selectLevel(H$b,n.getCombinedMedianScaleFactor(l))),r=e&~(E$m.ACTIVE|E$m.TRANSFORM_CHANGED),t>=0&&(e&E$m.HIGHLIGHT?(x$i(this._highlightRenderInstanceData[t],i,l),r|=E$m.HIGHLIGHT_ACTIVE):(x$i(this._defaultRenderInstanceData[t],i,l),r|=E$m.DEFAULT_ACTIVE)),i.state.set(l,r),i.lodLevel.set(l,t);}else r=e&~(E$m.ACTIVE|E$m.TRANSFORM_CHANGED),i.state.set(l,r);if(this._octree){const t=!!(e&E$m.ACTIVE),s=!!(r&E$m.ACTIVE);!t&&s?this._octree.addInstance(l):t&&!s?this._octree.removeInstance(l):t&&s&&e&E$m.TRANSFORM_CHANGED&&(this._octree.removeInstance(l),this._octree.addInstance(l));}l=(l+1)%o;}this._instanceIndex=l,this._defaultRenderInstanceData.forEach((e=>{e.endUpdate();})),this._highlightRenderInstanceData.forEach((e=>{e.endUpdate();}));}_renderComponents(e,t){this.levels.forEach(((s,a)=>{s.components.forEach((s=>{this._renderComponent(e,t[a],s,a);}));}));}_renderComponent(t,s,a,n){const i=t.bindParameters;if(0===s.size||!a.material.requiresSlot(i.slot))return;const{rctx:r,pass:o}=t,l=a.glMaterials.load(r,o);if(t$V(l))return;const h=l.beginSlot(i),d=r.bindTechnique(h,a.material.parameters,i);r.bindVAO(a.vao),h.ensureAttributeLocations(a.vao),h.bindDraw(q$b,i),t$E.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&t.pass===A$D.MATERIAL&&(d.setUniform4fv("externalColor",N$i[Math.min(n,N$i.length-1)]),d.setUniform1i("colorMixMode",U$w.replace));const u=r.capabilities.instancing,m=s.capacity,p=s.headIndex,I=s.tailIndex,D=s.firstIndex,C=this._glInstanceBufferLayout,R=(e,t)=>{R$v(r,E$E,s.buffer,C,e),u.drawArraysInstanced(h.primitiveType,0,a.vertexCount,t-e),E$H(r,E$E,s.buffer,C);};a.material.parameters.transparent&&null!=D?p>I?(e$18(D>=I&&D<=p,"invalid firstIndex"),R(D,p),R(I,D)):p<I&&(D<=p?(e$18(D>=0&&D<=p,"invalid firstIndex"),R(D,p),R(I,m),R(0,D)):(e$18(D>=I&&D<=m,"invalid firstIndex"),R(D,m),R(0,p),R(I,D))):p>I?R(I,p):p<I&&(R(0,p),R(I,m)),r.bindVAO(null);}}function x$i(e,t,s){const a=e.allocateHead();j$n(t,s,e.view,a);}function j$n(e,t,s,a){p$14(e.modelOrigin,t,s.modelOriginHi,s.modelOriginLo,a),s.model.copyFrom(a,e.model,t),s.modelNormal.copyFrom(a,e.modelNormal,t),e.color&&s.color&&s.color.copyFrom(a,e.color,t),e.featureAttribute&&s.featureAttribute&&s.featureAttribute.copyFrom(a,e.featureAttribute,t);}const H$b=n$16(),V$c=n$1a(),P$f=e$10(),F$e=n$16(),w$l=n$16(),N$i=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]],q$b=new _$B;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class me$7 extends y$r{constructor(e,t,s,r){super(e,t,s,r),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this.hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this.hasLoadedPBRTextures=s.physicalBasedRenderingEnabled;}getCachedSize(){const[e,s,r]=r$W(this._resources)?this._resources.symbolSize:[1,1,1];return {width:e,depth:s,height:r}}async doLoad(e){if(!this._drivenProperties.size){if(O$w(this.symbolLayer))throw new Error}const t=this.symbolLayer;if(this.isPrimitive){const s=t.resource?t.resource.primitive:d$$;this._resources=await this._createResourcesForPrimitive(s,e);}else this._resources=await this._createResourcesForUrl(t.resource.href,e);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity();}get extentPadding(){return r$W(this._resources)?this._resources.extentPadding:0}get isPrimitive(){return !(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return m$V(this._resources,"lodRenderer")}_setMaterialTransparencyParams(e,t=m$V(this.symbolLayer,"material","color")){const r=this._getCombinedOpacity(t),a=r<1||this.needsDrivenTransparentPass;return e.transparent=a,e.opacity=r,e.cullFace=a?n$1t.None:n$1t.Back,e}async _createResourcesForPrimitive(s,a){if(!n$P(s))throw new Error(`Unknown object symbol primitive: ${s}`);const i=this.symbolLayer,n=a$1d(c$1j(s)),c=e$1d(F$u(n)),l=e$1d(t$1j(c,i)),h=s$1b(l),d=!1,m=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:l$$,diffuse:l$$,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},y=u.usePBR;this._setMaterialTransparencyParams(u);const f=this.symbol;if("point-3d"===f.type&&f.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:s}=f.verticalOffset;u.verticalOffset={screenLength:u$12(e),minWorldLength:t||0,maxWorldLength:null!=s?s:1/0},u.castShadows=!1;}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=_$y;else {const s=r$W(i.material)&&i.material.color,r=r$W(s)?l$T.toUnitRGBA(s):_$y;u.externalColor=r;}this._fastUpdates=P$h(this._context.renderer,this._fastVisualVariableConvertOptions(n,l,c,n$1v)),u.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(u,this._fastUpdates.materialParameters),u.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(u.instanced.push("color"),this._optionalFields.push("color"));const _=new R$w(u),P=t$C(s,_);if(!P)throw new Error(`Unknown object symbol primitive: ${s}`);const R=r$H(P).map((e=>({opacity:1,transparent:e.parameters.transparent}))),v=await this._createStageResources(P,y);return {lodResources:P,lodRenderer:await this._createLodRenderer(P,a),stageResources:v,symbolSize:l,extentPadding:h,isEsriSymbolResource:d,isWosr:m,originalMaterialParameters:R,physicalBasedRenderingEnabled:y,resourceBoundingBox:n,resourceSize:c,pivotOffset:n$1v}}async _createResourcesForUrl(e,t){const a=["transformation"],i={materialParamsMixin:{instanced:a,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=P$h(this._context.renderer,this._fastVisualVariableConvertOptions(n$1v,n$1v,n$1v,n$1v)),this._fastUpdates.enabled?(Object.assign(i.materialParamsMixin,this._fastUpdates.materialParameters),a.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(a.push("color"),this._optionalFields.push("color"));const n=this.symbol;if("point-3d"===n.type&&n.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:s}=n.verticalOffset;i.materialParamsMixin.verticalOffset={screenLength:u$12(e),minWorldLength:t||0,maxWorldLength:null!=s?s:1/0},i.materialParamsMixin.castShadows=!1;}i.signal=t,i.usePBR=this._context.physicalBasedRenderingEnabled;const c=i.usePBR,l=await J$i(e,i),h=l.isEsriSymbolResource,d=l.isWosr;this._addDisposeResource((()=>l.remove()));const m=s$s(l.lods);o$n(m),m.levels.sort(((e,t)=>e.minScreenSpaceRadius-t.minScreenSpaceRadius)),m.levels[0].minScreenSpaceRadius=Math.min(2,m.levels[0].minScreenSpaceRadius);const u=this._context,y=this.symbolLayer.material,f=this._getExternalColorParameters(y),_=m$V(this.symbolLayer,"material","color"),g=this._getCombinedOpacity(_,{hasIntrinsicColor:!0}),P=this.needsDrivenTransparentPass,R=r$H(m),v=r$H(m).map((e=>({opacity:e.parameters.opacity||1,transparent:e.parameters.transparent})));R.forEach((e=>{const t=e.parameters;e.setParameters(f);const s=t.opacity*g,r=s<1||P||t.transparent;e.setParameters({opacity:s,transparent:r}),u.screenSizePerspectiveEnabled&&e.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings});}));const x=l.referenceBoundingBox,S=e$1d(F$u(x)),L=e$1d(m.levels[0].pivotOffset),C=e$1d(t$1j(S,this.symbolLayer)),w=s$1b(C);R$h(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(x,C,S,L))&&R.forEach((e=>e.setParameters(this._fastUpdates.materialParameters)));const U=await this._createStageResources(m,c);return {lodResources:m,lodRenderer:await this._createLodRenderer(m,t),stageResources:U,symbolSize:C,extentPadding:w,isEsriSymbolResource:h,isWosr:d,originalMaterialParameters:v,physicalBasedRenderingEnabled:c,resourceBoundingBox:x,resourceSize:S,pivotOffset:L}}_addDisposeResource(e){this._disposeResourceHandles.push(e);}async _createStageResources(e,t){const s=this._context.stage,r=r$H(e);t!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(r),this._addDisposeResource((()=>s.removeMany(r)));const a=e$F(e);s.addMany(a),this._addDisposeResource((()=>s.removeMany(a))),await s.load(a);const i=t$A(e);return s.addMany(i),this._addDisposeResource((()=>s.removeMany(i))),{materials:r,textures:a,geometries:i}}async _createLodRenderer(e,t){const s=this._context.stage,r={layerUid:this._context.layer.uid,graphicUid:e=>this._instanceIndexToGraphicUid.get(e),notifyGraphicGeometryChanged:e=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(e)),notifyGraphicVisibilityChanged:e=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(e))},a=this._fastUpdates.enabled?{applyTransform:(e,t,s)=>{e.getFeatureAttribute(t,_e$5),n$15(s,B$g(this._fastUpdates.materialParameters,_e$5,s));},scaleFactor:(e,t,s)=>(t.getFeatureAttribute(s,_e$5),L$i(e,this._fastUpdates.materialParameters,_e$5))}:null,i=new M$e(e,this._optionalFields,r,a);return i.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource((()=>{s.removeRenderPlugin(i);})),await s.addRenderPlugin(i.slots,i,t),i}_getExternalColorParameters(s){const r={};return this._drivenProperties.color?r.externalColor=_$y:r$W(s)&&r$W(s.color)?r.externalColor=l$T.toUnitRGBA(s.color):(r.externalColor=_$y,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources();}_cleanupResources(){this._disposeResourceHandles.forEach((e=>e())),this._disposeResourceHandles.length=0,this._resources=null;}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;const s=d$y(t.geometry);if(t$V(s))return this.logger.warn(`unsupported geometry type for icon symbol: ${t.geometry.type}`),null;const r=this.setGraphicElevationContext(t,new h$x),i=e.renderingInfo;return this._createAs3DShape(t,s,i,r,t.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex);}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(t$V(this._resources))return !0;const e=this._drivenProperties.opacity,t=!this.isPrimitive,r=this._resources.stageResources.materials,i=this._resources.originalMaterialParameters;for(let a=0;a<r.length;a++){const o=r[a],n=m$V(this.symbolLayer,"material","color"),c=i[a],l=this._getCombinedOpacity(n,{hasIntrinsicColor:t})*c.opacity,h=l<1||e||c.transparent;o.setParameters({opacity:l,transparent:h}),this.isPrimitive&&o.setParameters({cullFace:h?n$1t.None:n$1t.Back});}return !0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,v$u)}slicePlaneEnabledChanged(){if(t$V(this._resources))return !0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return !0}physicalBasedRenderingChanged(){if(t$V(this._resources))return !0;const{stageResources:e,isWosr:t}=this._resources;for(const s of e.materials)this.isPrimitive?s.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):t||s.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return !1!==this.hasLoadedPBRTextures||!0!==this._context.physicalBasedRenderingEnabled||(this.hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return !0}applyRendererDiff(e,t){if(t$V(this._resources))return e$I.Recreate_Symbol;const{stageResources:{materials:s},lodRenderer:r,resourceBoundingBox:i,symbolSize:o,resourceSize:n,pivotOffset:c}=this._resources;for(const a in e.diff){if("visualVariables"!==a)return e$I.Recreate_Symbol;if(!R$h(this._fastUpdates,t,this._fastVisualVariableConvertOptions(i,o,n,c)))return e$I.Recreate_Symbol;for(const e of s)e.setParameters(this._fastUpdates.materialParameters);r.notifyShaderTransformationChanged();}return e$I.Fast_Update}computeComplexity(){if(t$V(this._resources))return super.computeComplexity();return {primitivesPerFeature:n$O(this._resources.lodResources.levels[0]).reduce(((e,t)=>e+t.indices.get(O$J.POSITION).length),0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:l$x(this.symbol,this.symbolLayer)}}_hasLodRenderer(){return r$W(this._resources)}_createAs3DShape(e,s,r,i,o){if(!this._hasLodRenderer()||t$V(this._resources))return null;const n=this.getFastUpdateAttrValues(e),c=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?z$i(r.color,r.opacity):null,l=this._context.clippingExtent;if(Hn(s,ue$7,this._context.elevationProvider.spatialReference),r$W(l)&&!E$M(l,ue$7))return null;const h=this._requiresTerrainElevation(i),d=this._computeGlobalTransform(s,i,fe$5,be$2),p=this._computeLocalTransform(this._resources,this.symbolLayer,r,ye$5),m=this._resources.lodRenderer.instanceData,u=m.addInstance();this._instanceIndexToGraphicUid.set(u,o),m.setLocalTransform(u,p,!1),m.setGlobalTransform(u,d),n&&m.setFeatureAttribute(u,n),c&&m.setColor(u,c);const y=new f$n(this,u,I$m,i);return h&&(y.alignedSampledElevation=be$2.sampledElevation),y.needsElevationUpdates=v$u(i.mode),g$u(y,s,this._context.elevationProvider),y}_computeGlobalTransform(e,t,s,r){return d$D(e,this._context.elevationProvider,t,this._context.renderCoordsHelper,r),ue$7[0]=e.x,ue$7[1]=e.y,ue$7[2]=r.z,qn(e.spatialReference,ue$7,s,this._context.renderCoordsHelper.spatialReference),s}_computeLocalTransform(e,t,s,r){return r$12(r),this._applyObjectRotation(s,!1,r),this._applyObjectRotation(t,!0,r),this._applyObjectScale(e,s,r),this._applyAnchor(e,t,r),r}_applyObjectScale(e,t,s){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const r=this._drivenProperties.size&&t.size?t.size:e.symbolSize,a=D$f(r,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);1===a[0]&&1===a[1]&&1===a[2]||i$1f(s,s,a);}prepareSymbolLayerPatch(e){if("partial"!==e.diff.type)return;const t=e.diff.diff;this._preparePatchTransform(e,t),this._preparePatchColor(e,t);}updateGeometry(e,t){if(t$V(this._resources))return !0;const s=t&&d$y(t);if(t$V(s))return !1;const r=this.getGeometryElevationMode(t);return e.elevationContext.mode===r&&(this._computeGlobalTransform(s,e.elevationContext,fe$5,be$2),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=be$2.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,fe$5,!0),g$u(e,s,this._context.elevationProvider),!0)}_preparePatchTransform(e,t){if(!(t.heading||t.tilt||t.roll||t.width||t.height||t.depth||t.anchor||t.anchorPosition))return;if(t$V(this._resources))return;const s=(e,t,s)=>c$$(null!=e&&"complete"===e.type?e.newValue:t,s),r=s(t.heading,this.symbolLayer.heading,0),o=s(t.tilt,this.symbolLayer.tilt,0),n=s(t.roll,this.symbolLayer.roll,0),c=s(t.width,this.symbolLayer.width,void 0),l=s(t.height,this.symbolLayer.height,void 0),h=s(t.depth,this.symbolLayer.depth,void 0),d=s(t.anchor,this.symbolLayer.anchor,void 0),p=s(t.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete t.heading,delete t.tilt,delete t.roll,delete t.width,delete t.height,delete t.depth,delete t.anchor,delete t.anchorPosition;const m={heading:r,tilt:o,roll:n,anchor:d,anchorPosition:p},u=this._resources;this.loadStatus===e$H.LOADED&&e.symbolLayerStatePatches.push((()=>{u.symbolSize=e$1d(t$1j(u.resourceSize,{width:c,height:l,depth:h,isPrimitive:this.symbolLayer.isPrimitive}));})),e.graphics3DGraphicPatches.push(((e,t)=>{const s=this._computeLocalTransform(u,m,t,ye$5),r=e.instanceIndex;u.lodRenderer.instanceData.setLocalTransform(r,s,!0);}));}_preparePatchColor(s,r){if(!r.material||"partial"!==r.material.type)return;const i=r.material.diff;if(!i.color||"complete"!==i.color.type||null==i.color.newValue||null==i.color.oldValue)return;const o=i.color.newValue,n=r$W(o)?l$T.toUnitRGBA(o):_$y;delete i.color;const c=this._resources;t$V(c)||s.graphics3DGraphicPatches.push((e=>{let t;this._hasPerInstanceColor()?(c.lodRenderer.instanceData.setColor(e.instanceIndex,n),t=this._setMaterialTransparencyParams({},o)):t=this._setMaterialTransparencyParams({externalColor:n},o);for(const s of c.stageResources.materials)s.setParameters(t);}));}_requiresTerrainElevation(e){return "absolute-height"!==e.mode}_applyObjectRotation(e,t,s){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&t))return S$u(e.heading,e.tilt,e.roll,s)}_computeAnchor(e,s,r){const a=n$16();switch(r.anchor){case"center":r$V(a,p$11(e)),j$I(a,a);break;case"top":{const t=p$11(e);o$W(a,-t[0],-t[1],-e[5]);break}case"bottom":{const t=p$11(e);o$W(a,-t[0],-t[1],-e[2]);break}case"relative":{const t=p$11(e),s=F$u(e),i=r.anchorPosition,o=i?r$X(i.x,i.y,i.z):f$_;c$1k(a,s,o),u$W(a,a,t),j$I(a,a);break}default:r$W(s)?j$I(a,s):r$V(a,f$_);}return a}_applyAnchor(e,t,s){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const r=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,t);r&&c$17(s,s,r);}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,s,r,a){const i=r$W(e)?e$1d(F$u(e)):l$$,o=r$W(e)?this._computeAnchor(e,a,this.symbolLayer):f$_,n=this._context.renderCoordsHelper.unitInMeters,c=D$f(r$W(s)?s:void 0,s,r,n),l=r$X(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return {modelSize:i,symbolSize:r$W(s)?s:l$$,unitInMeters:n,transformation:{anchor:o,scale:c,rotation:l}}}}const ue$7=n$16(),ye$5=e$10(),fe$5=e$10(),_e$5=n$1a(),be$2=new j$s;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function n$u(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function a$u(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function r$p(t,n,a,r,s){return t[0]=n,t[1]=a,t[2]=r,t[3]=s,t}function s$r(t,n){if(t===n){const a=n[1];t[1]=n[2],t[2]=a;}else t[0]=n[0],t[1]=n[2],t[2]=n[1],t[3]=n[3];return t}function u$p(t,n){const a=n[0],r=n[1],s=n[2],u=n[3];let o=a*u-s*r;return o?(o=1/o,t[0]=u*o,t[1]=-r*o,t[2]=-s*o,t[3]=a*o,t):null}function o$m(t,n){const a=n[0];return t[0]=n[3],t[1]=-n[1],t[2]=-n[2],t[3]=a,t}function e$v(t){return t[0]*t[3]-t[2]*t[1]}function c$p(t,n,a){const r=n[0],s=n[1],u=n[2],o=n[3],e=a[0],c=a[1],i=a[2],f=a[3];return t[0]=r*e+u*c,t[1]=s*e+o*c,t[2]=r*i+u*f,t[3]=s*i+o*f,t}function i$p(t,n,a){const r=n[0],s=n[1],u=n[2],o=n[3],e=Math.sin(a),c=Math.cos(a);return t[0]=r*c+u*e,t[1]=s*c+o*e,t[2]=r*-e+u*c,t[3]=s*-e+o*c,t}function f$l(t,n,a){const r=n[0],s=n[1],u=n[2],o=n[3],e=a[0],c=a[1];return t[0]=r*e,t[1]=s*e,t[2]=u*c,t[3]=o*c,t}function l$m(t,n){const a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=-a,t[3]=r,t}function h$m(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t}function M$d(t){return "mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function b$f(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function m$m(t,n,a,r){return t[2]=r[2]/r[0],a[0]=r[0],a[1]=r[1],a[3]=r[3]-t[2]*a[1],[t,n,a]}function d$p(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t}function p$k(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t}function y$n(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function x$h(n,a){const r=n[0],s=n[1],u=n[2],o=n[3],e=a[0],c=a[1],i=a[2],f=a[3];return Math.abs(r-e)<=t$1k*Math.max(1,Math.abs(r),Math.abs(e))&&Math.abs(s-c)<=t$1k*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(u-i)<=t$1k*Math.max(1,Math.abs(u),Math.abs(i))&&Math.abs(o-f)<=t$1k*Math.max(1,Math.abs(o),Math.abs(f))}function j$m(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t}function S$f(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t}const g$m=c$p,q$a=p$k,_$i=Object.freeze(Object.defineProperty({__proto__:null,copy:n$u,identity:a$u,set:r$p,transpose:s$r,invert:u$p,adjoint:o$m,determinant:e$v,multiply:c$p,rotate:i$p,scale:f$l,fromRotation:l$m,fromScaling:h$m,str:M$d,frob:b$f,LDU:m$m,add:d$p,subtract:p$k,exactEquals:y$n,equals:x$h,multiplyScalar:j$m,multiplyScalarAndAdd:S$f,mul:g$m,sub:q$a},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class e$u extends g$S{constructor(t,e,r,i,n,s){super(t,e),this.path=r,this.geometrySR=i,this.upVectorAlignment=n,this.stencilWidth=s;}}function r$o(t){return "upVectorAlignment"in t}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function e$t(){return [1,0,0,1]}function r$n(e){return [e[0],e[1],e[2],e[3]]}function t$n(e,r,t,n){return [e,r,t,n]}function n$t(e,r){return new Float64Array(e,r,4)}const o$l=Object.freeze(Object.defineProperty({__proto__:null,create:e$t,clone:r$n,fromValues:t$n,createView:n$t},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function k$h(){return {up:n$16(),right:n$16()}}function E$l(t,e,i){L$E(t.up,e.up,i),L$E(t.right,e.right,i);}function B$f(t,e,i){t[0]=i[0]*e.right[0]+i[1]*e.up[0],t[1]=i[0]*e.right[1]+i[1]*e.up[1],t[2]=i[0]*e.right[2]+i[1]*e.up[2];}function w$k(t,e,i){r$Y(t,P$u(i,e.right),P$u(i,e.up));}class G$c{constructor(){this.pos=n$16(),this.posES=n$16(),this.posGS=n$16(),this.vRight=n$16(),this.vLeft=n$16(),this.frame=k$h(),this.rotationFrame=k$h(),this.rotationRight=n$1b(),this.rotationAngle=0,this.miterStretch=e$t();}setFrameFromUpVector(t){r$V(this.frame.up,t),u$W(at$2,this.vLeft,this.vRight),z$s(at$2,at$2),q$p(nt$2,this.frame.up,P$u(at$2,this.frame.up)),e$15(pt$2,at$2,nt$2),z$s(pt$2,pt$2),_$v(this.frame.right,pt$2,this.frame.up);}computeRotationAxisAndAngleFromUpVector(){r$V(this.rotationFrame.up,this.frame.up),r$V(this.rotationFrame.right,this.frame.right),r$Y(this.rotationRight,1,0),q$p(nt$2,this.frame.up,P$u(this.frame.up,this.vLeft)),e$15(nt$2,this.vLeft,nt$2),j$I(nt$2,nt$2),z$s(nt$2,nt$2),q$p(at$2,this.frame.up,P$u(this.frame.up,this.vRight)),e$15(at$2,this.vRight,at$2),z$s(at$2,at$2),_$v(lt$2,this.rotationFrame.up,this.vLeft);const s=Math.sign(P$u(lt$2,this.vRight));if(this.rotationAngle=s*(Math.PI-l$U(P$u(nt$2,at$2))),Math.abs(this.rotationAngle)>0){const t=N$s(Math.cos(.5*this.rotationAngle));r$p(this.miterStretch,t-1+1,0,0,1);}const r=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*r));}}class j$l{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null;}addVertex(t,e){return this.vertices.push(t$1l(t)),this.vertexNormals.push(t$1l(e)),this.vertices.length-1}addUV(t){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(t),this.uvs.length-1}addPole(t,e=null){return this.poles.push({position:t$1l(t),normal:e?t$1l(e):null}),this.poles.length-1}addSegment(t,e=null,i=null){this.vertexIndices.push(t.v0),this.vertexIndices.push(t.v1),e&&(this.uvIndices.push(e.v0),this.uvIndices.push(e.v1)),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1));}get numSegments(){return this.vertexIndices.length/2}hasUV(){return null!=this.uvs}translate(t,e){for(const i of this.vertices)i[0]+=t,i[1]+=e;for(const i of this.poles)i.position[0]+=t,i.position[1]+=e;}static circle(t=20){const e=.5,i=new j$l,s={v0:0,v1:0};i.addPole(r$13(0,0));for(let h=0;h<t;++h){const s=2*h*Math.PI/t,r=Math.cos(s),o=Math.sin(s),n=r$13(r*e,o*e),a=r$13(r,o);i.addVertex(n,a),i.addUV(h/t);}i.addUV(1);for(let h=0;h<t-1;++h){const t={v0:h,v1:h+1},e=t;i.addSegment(t,e,s);}const r={v0:t-1,v1:0},o={v0:t-1,v1:t};return i.addSegment(r,o,s),i}static rect(){const t=1,e=1,i=new j$l,s=r$13(.5*-t,.5*-e),r=r$13(.5*t,.5*-e),o=r$13(.5*t,.5*e),h=r$13(.5*-t,.5*e),n=r$13(0,-1),a=r$13(1,0),l=r$13(0,1),u=r$13(-1,0);i.addUV(0),i.addUV(1),i.addPole(r$13(0,.5*e),l),i.addPole(r$13(0,.5*e)),i.addPole(r$13(0,.5*-e)),i.addPole(r$13(0,.5*-e),n);const p={v0:0,v1:1};return i.addVertex(s,n),i.addVertex(r,n),i.addSegment({v0:0,v1:1},p,{v0:3,v1:3}),i.addVertex(r,a),i.addVertex(o,a),i.addSegment({v0:2,v1:3},p,{v0:2,v1:1}),i.addVertex(o,l),i.addVertex(h,l),i.addSegment({v0:4,v1:5},p,{v0:0,v1:0}),i.addVertex(h,u),i.addVertex(s,u),i.addSegment({v0:6,v1:7},p,{v0:1,v1:2}),i}}class z$d{constructor(t){this.vertices=[],this.offset=n$16(),this.xform=e$10(),this.vertices=t;const e=Math.floor((t.length-1)/2);r$V(this.offset,this.vertices[e].pos);for(const i of this.vertices)e$15(i.pos,i.pos,this.offset);c$17(this.xform,this.xform,this.offset),this.updatePathVertexInformation();}updatePathVertexInformation(){const t=this.vertices.length;let e=this.vertices[0];e.index=0,o$W(e.vLeft,0,0,0),e.vLeftLength=0,e$15(e.vRight,this.vertices[1].pos,e.pos),e.vRightLength=s$1b(e.vRight),z$s(e.vRight,e.vRight);let i=e;for(let s=1;s<t;++s)e=this.vertices[s],e.index=s,r$V(e.vLeft,i.vRight),e.vLeftLength=i.vRightLength,s<t-1?(e$15(e.vRight,this.vertices[s+1].pos,e.pos),e.vRightLength=s$1b(e.vRight),z$s(e.vRight,e.vRight)):(r$V(e.vRight,e.vLeft),e.vRightLength=e.vLeftLength),i=e;}}function J$6(t,e){let i=null;const s=t.vertices.length,r=.99619469809,o=n$16(),h=n$16(),n=n$16(),a=n$16(),l=n$16(),u=n$16(),p=p$Y();let f=t.vertices[0];r$V(h,e),o$W(o,0,1,0),T$z.makeOrthoBasisDirUpFallback(f.vRight,h,o,o,n,h,r),r$V(f.frame.up,h),r$V(f.frame.right,n),i=f;for(let c=1;c<s;++c){f=t.vertices[c],u$W(l,f.vLeft,f.vRight);let e=s$1b(l);e>0?(e=1/Math.sqrt(e),l[0]=l[0]*e,l[1]=l[1]*e,l[2]=l[2]*e):(l[0]=f.vRight[0],l[1]=f.vRight[1],l[2]=f.vRight[2]),u$W(u,i.pos,i.frame.up),_$w(f.pos,l,p);q$q(p,j$G(u,f.vLeft),a)?(e$15(a,a,f.pos),z$s(h,a),_$v(n,l,h),z$s(n,n)):T$z.makeOrthoBasisDirUpFallback(l,i.frame.up,i.frame.right,o,n,h,r),r$V(f.frame.up,h),r$V(f.frame.right,n),i=f;}}class H$a{}class X$5{numProfilesPerJoin(){return 1}extrude(t,e,i){for(let s=0;s<e.vertices.length;++s)i(t.index,t.frame,e.vertices[s],e.vertexNormals[s],!1);}}class q$9{constructor(t=.8*Math.PI,e=1){this.cutoffAngle=t,this.numBendSubdivisions=e;}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(t,e,i){const s=ft$2;if(Math.abs(t.rotationAngle)>=this.cutoffAngle)for(let r=0;r<this.numBendSubdivisions+1;++r){p$Z(ct$2,.5*-t.rotationAngle+r*t.rotationAngle/this.numBendSubdivisions,t.rotationFrame.up),E$l(s,t.frame,ct$2);for(let r=0;r<e.vertices.length;++r){j$K(e.vertices[r],t.rotationRight)*t.rotationAngle>=0?i(t.index,s,e.vertices[r],e.vertexNormals[r],!1):(_$C(rt$2,e.vertices[r],t.miterStretch),i(t.index,t.frame,rt$2,e.vertexNormals[r],!0));}}else for(let r=0;r<this.numBendSubdivisions+1;++r)for(let s=0;s<e.vertices.length;++s){const r=j$K(e.vertices[s],t.rotationRight)*t.rotationAngle>=0;_$C(rt$2,e.vertices[s],t.miterStretch),i(t.index,t.frame,rt$2,e.vertexNormals[s],!r);}}}const K$8={generateUV:!1};class Q$7{rebuildConnectingProfileGeometry(t,e,i){for(let s=0;s<e.vertices.length;++s)i(t.index,t.frame,e.vertices[s],e.vertexNormals[s],0,0);}}class W$a extends Q$7{constructor(){super();}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class Y$7 extends Q$7{constructor(t,e=0,i=!1){super(),this.profile=t,this.profilePlaneOffset=e,this.flip=i;}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(t,e,i){for(let s=0;s<e.vertices.length;++s)i(t.index,t.frame,e.vertices[s],e.vertexNormals[s],this.profilePlaneOffset,0);}rebuildCapGeometry(t,e){const i=ot$2;r$Y(i,0,0);const s=this.flip?1:-1;for(let r=0;r<this.profile.vertices.length;++r)e(t.index,t.frame,this.profile.vertices[r],i,this.profilePlaneOffset,s);}buildTopology(t,e){const i=this.vertexBufferStart+this.profile.vertexIndices[0];for(let s=1;s<this.profile.numSegments;++s){const t=this.profile.vertexIndices[2*s+0],r=this.profile.vertexIndices[2*s+1],o=this.vertexBufferStart+t,h=this.vertexBufferStart+r;this.flip?e(h,o,i):e(i,o,h);}}}class Z$5 extends Q$7{constructor(t){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=t.profile,this.flip=t.flip,this.sign=this.flip?1:-1,this.breakNormals=t.breakNormals,this.numSegments=t.subdivisions;}getNumVertices(){let t=0;return t=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(t+=this.profile.vertices.length),t+=this.profile.poles.length,t}getNumIndices(){let t=0;t+=2*this.profile.numSegments*(this.numSegments-1);for(let e=0;e<this.profile.numSegments;++e){const i=this.profile.vertexIndices[2*e+0],s=this.profile.vertexIndices[2*e+1];this.profile.poleIndices[i]===this.profile.poleIndices[s]?t+=1:t+=2;}return 3*t}rebuildCapGeometry(t,e){const i=t.frame,s=.5*this.sign,r=rt$2,o=ot$2;r$Y(o,0,0);for(let h=0;h<this.profile.poles.length;++h){const r=this.profile.poles[h];r.normal?e(t.index,i,r.position,r.normal,s,0):e(t.index,i,r.position,o,s,this.sign);}if(this.breakNormals)for(let h=0;h<this.profile.vertices.length;++h)e(t.index,i,this.profile.vertices[h],this.profile.vertexNormals[h],0,0);for(let h=0;h<this.numSegments-1;++h){const n=(1-(h+1)/this.numSegments)*Math.PI*.5,a=Math.sin(n),l=Math.cos(n);for(let h=0;h<this.profile.vertices.length;++h){const n=this.profile.poles[this.profile.poleIndices[h]];o$1l(r,this.profile.vertices[h],n.position),l$11(r,r,a),n.normal?(s$1n(r,r,n.position),e(t.index,i,r,n.normal,s*l,0)):(v$U(o,r),l$11(o,o,a),s$1n(r,r,n.position),e(t.index,i,r,o,s*l,this.sign*l));}}}buildTopology(t,e){const i=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let r=0;r<this.profile.numSegments;++r){const t=this.profile.vertexIndices[2*r+0],o=this.profile.vertexIndices[2*r+1],h=this.vertexBufferStart+this.profile.poleIndices[t],n=this.vertexBufferStart+this.profile.poleIndices[o];let a=i+t,l=i+o;for(let i=0;i<this.numSegments-1;++i){const r=s+i*this.profile.vertices.length+t,h=s+i*this.profile.vertices.length+o;this.flip?(e(r,l,a),e(l,r,h)):(e(a,l,r),e(h,r,l)),a=r,l=h;}this.flip?(e(h,l,a),h!==n&&e(h,n,l)):(e(a,l,h),h!==n&&e(l,n,h));}}}class $$7{constructor(t,e,i,s,r,o=K$8){this.options=o,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=e,this.path=t,this.extruder=i,this.startCap=s,this.endCap=r;const h=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*h+2,this.numVerticesTotal=e.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const n=this.startCap.getNumVertices();this.numVerticesTotal+=n,this.numNormalsTotal+=n,this.endCap.vertexBufferStart=this.numVerticesTotal;const a=this.endCap.getNumVertices();this.numVerticesTotal+=a,this.numNormalsTotal+=a,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology();}emitVertex(t,e,i,s,r){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=e.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=e.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=e.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=e.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=e.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=e.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,r){const e=this.path.vertices[t];this.profileRightAxisData[4*this._extrusionVertexCount+3]=e.rotationRight[0]*e.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=e.rotationRight[1]*e.maxStretchDistance;}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount;}emitCapVertex(t,e,i,s,r,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=e.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=e.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=e.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=e.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=e.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=e.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,this.profileRightAxisData[4*this._extrusionVertexCount+3]=r,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount;}emitTriangle(t,e,i){this.vertexIndices[3*this._triangleCount+0]=t,this.vertexIndices[3*this._triangleCount+1]=e,this.vertexIndices[3*this._triangleCount+2]=i,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[t],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[e],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[i],this.normalIndices[3*this._triangleCount+0]=t,this.normalIndices[3*this._triangleCount+1]=e,this.normalIndices[3*this._triangleCount+2]=i,++this._triangleCount;}_rebuildGeometry(){const t=(t,e,i,s,r)=>this.emitVertex(t,e,i,s,r),e=(t,e,i,s,r,o)=>this.emitCapVertex(t,e,i,s,r,o);this._extrusionVertexCount=0;for(const i of this.path.vertices)this.originData[3*i.index+0]=i.pos[0],this.originData[3*i.index+1]=i.pos[1],this.originData[3*i.index+2]=i.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,e);for(let i=1;i<this.path.vertices.length-1;++i)this.extruder.extrude(this.path.vertices[i],this.profile,t);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,e),this.startCap.rebuildCapGeometry(this.path.vertices[0],e),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],e),this.profile.hasUV()&&this.options.generateUV)for(let i=0;i<this.profile.uvs.length;++i)this.uvData[2*i+0]=this.profile.uvs[i],this.uvData[2*i+1]=0;}buildTopology(){const t=(t,e,i)=>this.emitTriangle(t,e,i);this._triangleCount=0;const e=this.profile.vertices.length,i=this.profile.numSegments,s=this.numExtrusionProfiles-1;let r=3*(2*(i*s));this.startCap.indexBufferStart=r,this.startCap.firstProfileVertexIndex=0,r+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=r,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1),r+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(r),this.normalIndices=new Uint32Array(r),this.pathVertexIndices=new Uint32Array(r),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(r));for(let o=0;o<i;++o){const i=this.profile.vertexIndices[2*o],r=this.profile.vertexIndices[2*o+1];for(let o=0;o<s;++o){const s=o*e+i,h=(o+1)*e+r,n=o*e+r;t(s,(o+1)*e+i,h),t(s,h,n);}}this.startCap.buildTopology(this.path.vertices[0],t),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],t);}onPathChanged(){this._rebuildGeometry();}}class tt$3{constructor(t){this.builder=t;}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged();}}class et$2 extends tt$3{constructor(t){super(t),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255;}bakeVertexColors(t){this.vertexAttributeColor[0]=255*t[0],this.vertexAttributeColor[1]=255*t[1],this.vertexAttributeColor[2]=255*t[2],this.vertexAttributeColor[3]=255*(t.length>3?t[3]:1);}bake(t){this.size=t;for(let e=0;e<this.builder.numVerticesTotal;++e){let i=this.builder.pathVertexData[e];const s=0===i||i===this.builder.path.vertices.length-1;i*=3;const r=st$2;o$W(r,this.builder.originData[i++],this.builder.originData[i++],this.builder.originData[i]);const o=4*e,h=nt$2,l=rt$2,u=at$2,d=lt$2,v=ut$2;let m=0,g=0;if(o$W(d,this.builder.profileRightAxisData[o],this.builder.profileRightAxisData[o+1],this.builder.profileRightAxisData[o+2]),o$W(v,this.builder.profileUpAxisData[o],this.builder.profileUpAxisData[o+1],this.builder.profileUpAxisData[o+2]),r$Y(l,this.builder.profileVertexAndNormalData[o]*t[0],this.builder.profileVertexAndNormalData[o+1]*t[1]),s)_$v(u,v,d),m=this.builder.profileRightAxisData[o+3]*t[0],g=this.builder.profileUpAxisData[o+3];else {const t=ot$2,e=ht$2;r$Y(t,this.builder.profileRightAxisData[o+3],this.builder.profileUpAxisData[o+3]);const i=q$s(t);v$U(t,t);const s=j$K(l,t);if(Math.abs(s)>i){r$Y(e,-t[1],t[0]);const r=j$K(l,e);l$11(t,t,i*Math.sign(s)),l$11(e,e,r),s$1n(l,t,e);}o$W(u,0,0,0);}o$W(h,d[0]*l[0]+v[0]*l[1],d[1]*l[0]+v[1]*l[1],d[2]*l[0]+v[2]*l[1]),this.vertexAttributePosition[3*e+0]=r[0]+h[0]+u[0]*m,this.vertexAttributePosition[3*e+1]=r[1]+h[1]+u[1]*m,this.vertexAttributePosition[3*e+2]=r[2]+h[2]+u[2]*m;const V=rt$2;r$Y(V,this.builder.profileVertexAndNormalData[o+2],this.builder.profileVertexAndNormalData[o+3]),this.vertexAttributeNormal[3*e+0]=d[0]*V[0]+v[0]*V[1]+u[0]*g,this.vertexAttributeNormal[3*e+1]=d[1]*V[0]+v[1]*V[1]+u[1]*g,this.vertexAttributeNormal[3*e+2]=d[2]*V[0]+v[2]*V[1]+u[2]*g;}}createGeometryData(){const t=[[O$J.POSITION,this.builder.vertexIndices],[O$J.NORMAL,this.builder.normalIndices]],e=[[O$J.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[O$J.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];if(this.vertexAttributeColor){const i=this.builder.vertexIndices.length;t.push([O$J.COLOR,new Uint32Array(i)]),e.push([O$J.COLOR,{size:4,data:this.vertexAttributeColor}]);}return {vertexAttributes:e,indices:t}}onPathChanged(){super.onPathChanged(),this.bake(this.size);}intersect(t,e,i){const s=this.builder.vertexIndices,r={size:3,data:this.vertexAttributePosition},o=s.length/3;v$W(t,e,0,o,s,r,void 0,void 0,i);}}class it$2 extends tt$3{constructor(t,e,i,s){super(t),this.sizeAttributeValue=e,this.colorAttributeValue=i,this.opacityAttributeValue=s,this.vvData=null,this.baked=new et$2(t),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let r=0;r<this.builder.path.vertices.length;++r){this.vvData[4*r+0]=e,this.vvData[4*r+1]=i,this.vvData[4*r+2]=s;const t=0===r||r===this.builder.path.vertices.length-1;this.vvData[4*r+3]=t?1:0;}}createGeometryData(){return {vertexAttributes:[[O$J.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[O$J.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],[O$J.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[O$J.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[O$J.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[O$J.POSITION,this.builder.pathVertexIndices],[O$J.PROFILERIGHT,this.builder.vertexIndices],[O$J.PROFILEUP,this.builder.vertexIndices],[O$J.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[O$J.FEATUREVALUE,this.builder.pathVertexIndices]]}}}const st$2=n$16(),rt$2=n$1b(),ot$2=n$1b(),ht$2=n$1b(),nt$2=n$16(),at$2=n$16(),lt$2=n$16(),ut$2=n$16(),pt$2=n$16(),ft$2=k$h(),ct$2=e$10();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const f$k=8;function n$s(e,c){e.attributes.add(O$J.FEATUREVALUE,"vec4");const n=e.vertex;n.code.add(n$19`bool isCapVertex() {
return featureValue.w == 1.0;
}`),n.uniforms.add(new e$$("size",(e=>e.size))),c.vvSize?(n.uniforms.add(new e$_("vvSizeMinSize",(e=>e.vvSizeMinSize))),n.uniforms.add(new e$_("vvSizeMaxSize",(e=>e.vvSizeMaxSize))),n.uniforms.add(new e$_("vvSizeOffset",(e=>e.vvSizeOffset))),n.uniforms.add(new e$_("vvSizeFactor",(e=>e.vvSizeFactor))),n.code.add(n$19`vec2 getSize() {
return size * clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):n.code.add(n$19`vec2 getSize(){
return size;
}`),c.vvOpacity?(n.constants.add("vvOpacityNumber","int",f$k),n.uniforms.add([new o$1b("vvOpacityValues",(e=>e.vvOpacityValues),f$k),new o$1b("vvOpacityOpacities",(e=>e.vvOpacityOpacities),f$k)]),n.code.add(n$19`vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):n.code.add(n$19`vec4 applyOpacity(vec4 color){
return color;
}`),c.vvColor?(n.constants.add("vvColorNumber","int",o$1a),n.uniforms.add([new o$1b("vvColorValues",(e=>e.vvColorValues),o$1a),new e$1c("vvColorColors",(e=>e.vvColorColors),o$1a)]),n.code.add(n$19`vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):n.code.add(n$19`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(o$1o),e.attributes.add(O$J.PROFILERIGHT,"vec4"),e.attributes.add(O$J.PROFILEUP,"vec4"),e.attributes.add(O$J.PROFILEVERTEXANDNORMAL,"vec4"),n.code.add(n$19`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),n.code.add(n$19`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),n.code.add(n$19`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),n.code.add(n$19`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`);}class p$j extends v$S{constructor(){super(...arguments),this.size=r$13(1,1);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function S$e(S){const M=new i$_,C=d$W(M,S),{vertex:_,fragment:O}=M;return M.varyings.add("vpos","vec3"),M.include(n$s,S),S.output!==o$19.Color&&S.output!==o$19.Alpha||(M.include(r$10),M.include(c$1e,S),M.include(t$1f,S),M.varyings.add("vnormal","vec3"),M.varyings.add("vcolor","vec4"),S.hasMultipassTerrain&&M.varyings.add("depth","float"),_.code.add(n$19`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${S.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${S.output===o$19.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),M.include(n$1q,S),S.output===o$19.Alpha&&(M.include(u$$,S),O.uniforms.add(new o$_("opacity",(e=>e.opacity))),O.code.add(n$19`
      void main() {
        discardBySlice(vpos);
        ${S.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `)),S.output===o$19.Color&&(M.include(u$$,S),M.include(m$X,S),M.include(a$1h,S),M.include(c$1e,S),M.include(e$1l,S),c$1a(O,S),O.uniforms.add([C,new e$_("ambient",(e=>e.ambient)),new e$_("diffuse",(e=>e.diffuse)),new e$_("specular",(e=>e.specular)),new o$_("opacity",(e=>e.opacity)),new o$_("lightingGlobalFactor",((e,o)=>o.lighting.globalFactor)),new e$_("lightingMainIntensity",((e,o)=>o.lighting.mainLight.intensity))]),O.constants.add("ambientBoostFactor","float",c$1l),O.include(e$14),O.code.add(n$19`
      void main() {
        discardBySlice(vpos);
        ${S.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${S.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":S.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${S.transparencyPassType===O$L.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),S.output!==o$19.Depth&&S.output!==o$19.Shadow||(M.include(r$10,{hasModelTransformation:!1,linearDepth:!0}),_.uniforms.add(new e$$("nearFar",((e,o)=>o.camera.nearFar))),M.varyings.add("depth","float"),_.code.add(n$19`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),M.include(u$$,S),M.include(e$1h,S),O.code.add(n$19`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`)),S.output===o$19.Normal&&(M.include(r$10),M.include(r$A,S),_.uniforms.add(new e$Z("viewNormal",((e,o)=>o.camera.viewInverseTransposeMatrix))),M.varyings.add("vnormal","vec3"),_.code.add(n$19`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),M.include(u$$,S),O.uniforms.add(new o$P("waterColor")),O.code.add(n$19`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`)),S.output===o$19.Highlight&&(M.include(r$10),M.include(r$A,S),M.varyings.add("vnormal","vec3"),_.code.add(n$19`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),M.include(u$$,S),M.include(a$19),O.code.add(n$19`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),M}const M$c=Object.freeze(Object.defineProperty({__proto__:null,build:S$e},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const R$e=new Map([[O$J.POSITION,0],[O$J.PROFILERIGHT,1],[O$J.PROFILEUP,2],[O$J.PROFILEVERTEXANDNORMAL,3],[O$J.FEATUREVALUE,4]]);class C$i extends p$j{constructor(){super(...arguments),this.ambient=r$X(.2,.2,.2),this.diffuse=r$X(.8,.8,.8),this.specular=r$X(0,0,0),this.opacity=1;}}class E$k extends e$11{initializeConfiguration(e,o){o.spherical=e.viewingMode===l$O.Global,o.doublePrecisionRequiresObfuscation=r$1c(e.rctx);}initializeProgram(e){const o=E$k.shader.get().build(this.configuration);return new o$Z(e.rctx,o,R$e)}_setPipelineState(e){const o=this.configuration,t=e===O$L.NONE,r=e===O$L.FrontFace,n=e=>!e.hasSlicePlane&&!(e.transparent||e.doubleSidedMode===i$1i.None);return W$h({blending:o.output!==o$19.Color&&o.output!==o$19.Alpha||!o.transparent?null:t?c$1c:E$J(e),culling:n(o)&&o$1p,depthTest:{func:l$13(e)},depthWrite:t||r?a$1a:null,colorWrite:c$10,stencilWrite:o.hasOccludees?e$1i:null,stencilTest:o.hasOccludees?f$11:null,polygonOffset:t||r?null:f$12})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}E$k.shader=new t$W(M$c,(()=>import('./Path.glsl-764d7aa0.js')));class L$g extends i$17{constructor(){super(...arguments),this.output=o$19.Color,this.doubleSidedMode=i$1i.None,this.transparencyPassType=O$L.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1;}}e$Y([e$12({count:o$19.COUNT})],L$g.prototype,"output",void 0),e$Y([e$12({count:i$1i.COUNT})],L$g.prototype,"doubleSidedMode",void 0),e$Y([e$12({count:O$L.COUNT})],L$g.prototype,"transparencyPassType",void 0),e$Y([e$12()],L$g.prototype,"spherical",void 0),e$Y([e$12()],L$g.prototype,"receiveShadows",void 0),e$Y([e$12()],L$g.prototype,"receiveAmbientOcclusion",void 0),e$Y([e$12()],L$g.prototype,"vvSize",void 0),e$Y([e$12()],L$g.prototype,"vvColor",void 0),e$Y([e$12()],L$g.prototype,"vvOpacity",void 0),e$Y([e$12()],L$g.prototype,"hasSlicePlane",void 0),e$Y([e$12()],L$g.prototype,"transparent",void 0),e$Y([e$12()],L$g.prototype,"hasOccludees",void 0),e$Y([e$12()],L$g.prototype,"hasMultipassTerrain",void 0),e$Y([e$12()],L$g.prototype,"cullAboveGround",void 0),e$Y([e$12()],L$g.prototype,"doublePrecisionRequiresObfuscation",void 0),e$Y([e$12({constValue:l$Q.Disabled})],L$g.prototype,"pbrMode",void 0),e$Y([e$12({constValue:!0})],L$g.prototype,"hasVvInstancing",void 0),e$Y([e$12({constValue:!1})],L$g.prototype,"useCustomDTRExponentForWater",void 0),e$Y([e$12({constValue:!1})],L$g.prototype,"useFillLights",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class _$h extends d$X{constructor(e){super(e,new T$j),this.supportsEdges=!0,this._vertexAttributeLocations=R$e,this._configuration=new L$g,this.vertexBufferLayout=_$h.getVertexBufferLayout(this.parameters);}getConfiguration(e,t){return this._configuration.output=e,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==o$19.Color&&e!==o$19.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?i$1i.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?i$1i.WindingOrder:i$1i.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!t.ssaoHelper.ready&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}isVisibleInPass(e){return e!==A$D.MATERIAL_DEPTH_SHADOWMAP_ALL&&e!==A$D.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&e!==A$D.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const e=this.parameters;return !!super.isVisible()&&e.opacity>0}intersect(i,s,a,o,n,u,h){const l=i;if(!r$o(l))return;const p=l.path,d=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const t=this.parameters.vvSizeOffset,r=this.parameters.vvSizeFactor,i=this.parameters.vvSizeMinSize,s=this.parameters.vvSizeMaxSize,a=p.sizeAttributeValue;d[0]*=o$X(t[0]+a*r[0],i[0],s[0]),d[1]*=o$X(t[2]+a*r[2],i[2],s[2]);}const m=Math.max(d[0],d[1]),f=i.boundingInfo;if(t$V(f))return void this._intersectTriangles(p,d,n,u,h);const b=u$19(f.bbMin[0]-m,f.bbMin[1]-m,f.bbMin[2]-m,f.bbMax[0]+m,f.bbMax[1]+m,f.bbMax[2]+m),v=[u[0]-n[0],u[1]-n[1],u[2]-n[2]],S=Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2]),A=[S/v[0],S/v[1],S/v[2]];O$N(b,n,A,o.tolerance)&&this._intersectTriangles(p,d,n,u,h);}_intersectTriangles(e,t,r,i,s){e.baked.size&&e.baked.size[0]===t[0]&&e.baked.size[1]===t[1]||e.baked.bake(t),e.baked.intersect(r,i,s);}computeAttachmentOrigin(e,t){const r=e.vertexAttributes;if(!r)return null;const i=r.get(O$J.POSITION);return h$$(i,null,!1,t)}createBufferWriter(){return new L$f(this.vertexBufferLayout)}requiresSlot(e){return e===(this.parameters.transparent?E$G.TRANSPARENT_MATERIAL:E$G.OPAQUE_MATERIAL)||e===E$G.DRAPED_MATERIAL}createGLMaterial(e){return e.output===o$19.Color||e.output===o$19.Alpha||e.output===o$19.Depth||e.output===o$19.Normal||e.output===o$19.Highlight||e.output===o$19.Shadow&&this.parameters.castShadows?new O$k(e):null}static getVertexBufferLayout(e){let t=T$C().vec3f(O$J.POSITION).vec4f(O$J.PROFILERIGHT).vec4f(O$J.PROFILEUP).vec4f(O$J.PROFILEVERTEXANDNORMAL);return (e.vvColorEnabled||e.vvSizeEnabled||e.vvOpacityEnabled)&&(t=t.vec4f(O$J.FEATUREVALUE)),t}}class O$k extends t$1d{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees});}_updateShadowState(e){(t$V(this.technique)||e.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:e.shadowMap.enabled});}beginSlot(e){return this._output!==o$19.Color&&this._output!==o$19.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(E$k,e)}}class T$j extends C$i{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1;}}class L$f{constructor(e){this.vertexBufferLayout=e;}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(O$J.POSITION).length}write(e,t,r,s){const a=e=>{if(t.vertexAttributes.has(e)){const a=t.vertexAttributes.get(e),o=t.indices.get(e);e$18(4===a.size);const n=r.getField(e,c$1i);if(!n)throw new Error("unable to acquire view for "+e);d$Z(o,a.data,n,s);}};a(O$J.PROFILERIGHT),a(O$J.PROFILEUP),a(O$J.PROFILEVERTEXANDNORMAL),this.vertexBufferLayout.hasField(O$J.FEATUREVALUE)&&a(O$J.FEATUREVALUE),h$10(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,s);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const se$3=["polyline"];class ae$5 extends y$r{constructor(e,t,r,i){super(e,t,r,i),this._intrinsicSize=r$13(1,1),this.upVectorAlignment="path",this.stencilWidth=.1,this.ensureDrapedStatus(!1);}async doLoad(){const t=r$W(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,r=r$W(this.symbolLayer.height)?this.symbolLayer.height:t;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[t,1,r],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=P$h(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const a=this.symbolLayer.anchor||"center";this.upVectorAlignment="path","heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");const l=this.symbolLayer.profile||"circle";switch(l){case"circle":default:this._profile=j$l.circle(_e$4);break;case"quad":this._profile=j$l.rect();}let c=[0,0];"center"!==a&&(c={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[a],this._profile.translate(c[0],c[1]));switch(this.symbolLayer.join||"simple"){case"round":this._extruder=new q$9(0,ge$5);break;case"bevel":this._extruder=new q$9(0,1);break;case"miter":this._extruder=new q$9(.8*Math.PI,1);break;default:this._extruder=new X$5;}const p=this.symbolLayer.cap||"butt";switch(p){case"none":this._startCap=new W$a,this._endCap=new W$a;break;case"butt":default:this._startCap=new Y$7(this._profile,0),this._endCap=new Y$7(this._profile,0,!0);break;case"square":this._startCap=new Y$7(this._profile,-.5),this._endCap=new Y$7(this._profile,.5,!0);break;case"round":{const e="quad"===l;this._startCap=new Z$5({profile:this._profile,flip:!1,breakNormals:e,subdivisions:ye$4}),this._endCap=new Z$5({profile:this._profile,flip:!0,breakNormals:e,subdivisions:ye$4});break}}const m=m$V(this.symbolLayer,"material","color"),f=this._getCombinedOpacityAndColor(m),d=e$1d(f),u=f[3],g=u<1||this.needsDrivenTransparentPass,y={diffuse:d,ambient:d,opacity:u,transparent:g,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:g||"none"===p?n$1t.None:n$1t.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(r$Y(this._intrinsicSize,t,r),!U$j(this._intrinsicSize[0])||!U$j(this._intrinsicSize[1])))throw new s$16("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||l$11(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const e={...y,...this._fastUpdates.materialParameters,size:e$1m(this._intrinsicSize)};this._material=new _$h(e);}else y.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new R$w(y);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material);}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null;}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,se$3,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t,new h$x),i=e.renderingInfo;return this._createAs3DShape(t,i,r,t.uid)}layerOpacityChanged(){const e=m$V(this.symbolLayer,"material","color"),t=this._getCombinedOpacity(e),r=t<1||this.needsDrivenTransparentPass;return this._material.setParameters({opacity:t,transparent:r}),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,v$u)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return !0}applyRendererDiff(e,t){for(const r in e.diff){if("visualVariables"!==r)return e$I.Recreate_Symbol;if(!R$h(this._fastUpdates,t,this._vvConvertOptions))return e$I.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters);}return e$I.Fast_Update}getVertexData(e){let t=0;const r=e.paths,i=[],s=e.spatialReference,a=this._context.elevationProvider.spatialReference,o=this._context.renderCoordsHelper.spatialReference;for(const m of r)t+=m.length;const n=new Float64Array(3*t),l=new Float64Array(3*t),h=new Float64Array(3*t);let c=0;for(const m of r){i.push({index:c,numVertices:m.length});for(const t of m)n[c++]=t[0],n[c++]=t[1],n[c++]=e.hasZ?t[2]:0;}let p=!0;return s.equals(a)?this._copyVertices(n,0,l,0,t):p=Un(n,s,0,l,a,0,t),a.equals(o)?this._copyVertices(l,0,h,0,t):Un(l,a,0,h,o,0,t),{pathVertexDataInfos:i,vertexDataGS:n,vertexDataES:l,vertexDataRS:h,projectionSuccess:p,terrainElevation:0}}_copyVertices(e,t,r,i,s){t*=3,i*=3;for(let a=0;a<s;++a)r[i++]=e[t++],r[i++]=e[t++],r[i++]=e[t++];}_createAs3DShape(e,t,r,s){const a=e.geometry,o=new Array,n=new Array,l=new Array,h=a.spatialReference,p=a$1d(),m=this._context.renderCoordsHelper;pe$6.spatialReference=h;const f=this.getVertexData(a);if(!f.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(f.pathVertexDataInfos.length>0){for(let s=0;s<f.pathVertexDataInfos.length;++s){const a=f.pathVertexDataInfos[s],d=a.index,u=a.numVertices;if(u<2)continue;if(r$W(this._context.clippingExtent)&&(B$t(p),M$y(p,f.vertexDataES,3*d,u),!R$x(p,this._context.clippingExtent)))continue;const g=[];for(let e=d;e<d+3*u;){const t=e++,i=e++,s=e++,a=new G$c;o$W(a.posGS,f.vertexDataGS[t],f.vertexDataGS[i],f.vertexDataGS[s]),o$W(a.posES,f.vertexDataES[t],f.vertexDataES[i],f.vertexDataES[s]);const o=m$x(a.posES,this._context.elevationProvider,r,m);o$W(me$6,f.vertexDataRS[t],f.vertexDataRS[i],f.vertexDataRS[s]),m.setAltitude(me$6,o),o$W(a.pos,me$6[0],me$6[1],me$6[2]),g.push(a);}const y=new z$d(g);oe$7(y,this.upVectorAlignment,this._context.renderCoordsHelper);const _=new $$7(y,this._profile,this._extruder,this._startCap,this._endCap);let b=null;if(this._fastUpdates.enabled){const t=this._fastUpdates.visualVariables,r=t.size?v$r(t.size.field,e):0,i=t.color?v$r(t.color.field,e):0,s=t.opacity?v$r(t.opacity.field,e):0;b=new it$2(_,r,i,s);}else {const e=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(e[0]*=ne$4(t.size[0],"symbol-value"===t.size[2]?this.symbolLayer.height||0:t.size[2],this.symbolLayer.width||0),e[1]*=ne$4(t.size[2],"symbol-value"===t.size[0]?this.symbolLayer.width||0:t.size[0],this.symbolLayer.height||0));let r=null;this._drivenProperties.color&&(r=t.color),this._drivenProperties.opacity&&null!=t.opacity&&(r=r?[r[0],r[1],r[2],t.opacity]:[1,1,1,t.opacity]);const i=new et$2(_);i.bake(e),r&&i.bakeVertexColors(r),b=i;}const{vertexAttributes:v,indices:x}=b.createGeometryData(),w=new e$u(v,x,b,h,this.upVectorAlignment,this.stencilWidth);o.push(w),n.push(this._material),l.push(b.xform);}if(o.length>0){const e={layerUid:this._context.layer.uid,graphicUid:s},t=new O$t({geometries:o,materials:n,transformations:l,metadata:e}),i=new p$s(this,t,o,null,null,he$5,r);return i.alignedSampledElevation=f.terrainElevation,i.needsElevationUpdates=v$u(r.mode),i}}else 0!==a.paths.length&&a.paths.some((e=>e.length>0))||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}}function oe$7(e,i,s){switch(i){case"world":for(const t of e.vertices)u$W(fe$4,t.pos,e.offset),s.worldUpAtPosition(fe$4,me$6),t.setFrameFromUpVector(me$6),t.computeRotationAxisAndAngleFromUpVector();break;case"path":u$W(fe$4,e.vertices[0].pos,e.offset),s.worldUpAtPosition(fe$4,me$6),J$6(e,me$6);for(const i of e.vertices){const e=Math.sign(P$u(i.frame.right,i.vRight));_$v(i.rotationFrame.up,i.vRight,i.vLeft),q$p(i.rotationFrame.up,i.rotationFrame.up,e),z$s(i.rotationFrame.up,i.rotationFrame.up);const s=P$u(i.rotationFrame.up,i.frame.up),o=P$u(i.rotationFrame.up,i.frame.right);if(q$p(fe$4,i.frame.up,-o),q$p(de$6,i.frame.right,s),u$W(fe$4,fe$4,de$6),z$s(i.rotationFrame.right,fe$4),w$k(i.rotationRight,i.frame,i.rotationFrame.right),j$I(fe$4,i.vLeft),i.rotationAngle=-e*(Math.PI-l$U(P$u(fe$4,i.vRight))),Math.abs(i.rotationAngle)>0){const e=N$s(Math.cos(.5*i.rotationAngle));r$p(i.miterStretch,1+(e-1)*i.rotationRight[0]*i.rotationRight[0],(e-1)*i.rotationRight[0]*i.rotationRight[1],(e-1)*i.rotationRight[0]*i.rotationRight[1],1+(e-1)*i.rotationRight[1]*i.rotationRight[1]);}const n=Math.PI-i.rotationAngle;i.maxStretchDistance=Math.abs(Math.min(i.vLeftLength,i.vRightLength)*N$s(Math.cos(.5*n)));}}}function ne$4(e,t,r){switch(e){case"symbol-value":return r;case"proportional":return t;default:return e}}function le$6(e,t,r,i){let s=0;for(const a of e.vertices)d$D(a.posES,r,t,i,ue$6),s+=ue$6.sampledElevation,u$W(me$6,a.pos,e.offset),i.setAltitude(me$6,ue$6.z),e$15(a.pos,me$6,e.offset);return e.updatePathVertexInformation(),s/e.vertices.length}function he$5(e,t,r,i){const s=e.stageObject,a=s.geometryRecords;let o=0;ce$7.spatialReference=i.spatialReference;for(const n of a){const e=n.geometry;if(!r$o(e))continue;const a=e.path,l=a.builder.path,h=e.geometrySR;pe$6.spatialReference=h,o+=le$6(l,t,r,i),"world"!==e.upVectorAlignment&&oe$7(l,e.upVectorAlignment,i),a.onPathChanged(),e.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n);}return o/a.length}const ce$7=v$Q(0,0,0,null),pe$6=v$Q(0,0,0,null),me$6=n$16(),fe$4=n$1c(),de$6=n$1c(),ue$6=new j$s,ge$5=3,ye$4=3,_e$4=10;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function T$i(t,o,r,s,n=1){if(r.isGeographic&&s===l$O.Global){const t=new Float64Array(o.typedBuffer.length),e=3*o.count,s=p$T(r);for(let r=0;r<e;r+=3)ne$b(o.typedBuffer,r,t,r,s);o=T$F.fromTypedArray(t);}r$Y(k$g,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let e=0;e<o.count;e++)o.getVec(e,E$j),k$g[0]=Math.min(k$g[0],E$j[0]),k$g[1]=Math.min(k$g[1],E$j[1]);const c=k$g[0]%n,a=k$g[1]%n;P$e[0]=k$g[0]-c,P$e[1]=k$g[1]-a;for(let e=0;e<o.count;e++)o.getVec(e,E$j),t.setValues(e,(E$j[0]-P$e[0])/n,(E$j[1]-P$e[1])/n,P$e[0]/n,P$e[1]/n);}function M$b(t,o,r,f,i=1){o$W(Y$6,1,0,0),o$W(_$g,0,1,0),o$W(d$o,0,0,1),z$c(y$m,o),O$j(o,F$d)&&S$d(F$d,Y$6,_$g,d$o,r,y$m),r$Y(k$g,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r$Y(A$f,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let e=0;e<o.count;e++){o.getVec(e,E$j);const t=P$u(Y$6,E$j),r=P$u(_$g,E$j);k$g[0]=Math.min(k$g[0],t),k$g[1]=Math.min(k$g[1],r),A$f[0]=Math.max(A$f[0],t),A$f[1]=Math.max(A$f[1],r);}const u=P$u(d$o,y$m);H$9(v$k,k$g[0],k$g[1],u,Y$6,_$g,d$o),H$9(x$g,A$f[0],k$g[1],u,Y$6,_$g,d$o),H$9(G$b,k$g[0],A$f[1],u,Y$6,_$g,d$o),e$15(x$g,x$g,v$k),q$p(x$g,x$g,.5),e$15(G$b,G$b,v$k),q$p(G$b,G$b,.5),u$W(v$k,v$k,x$g),u$W(v$k,v$k,G$b);const I=k$g[0]%i,p=k$g[1]%i;P$e[0]=k$g[0]-I,P$e[1]=k$g[1]-p;for(let e=0;e<o.count;e++){o.getVec(e,E$j),t.setValues(e,(P$u(Y$6,E$j)-P$e[0])/i,(P$u(_$g,E$j)-P$e[1])/i,P$e[0]/i,P$e[1]/i);for(let t=0;t<3;t++)f.set(e,t,v$k[t]),f.set(e,t+3,x$g[t]),f.set(e,t+6,G$b[t]);}}const y$m=n$16(),E$j=n$16(),F$d=p$Y(),Y$6=n$16(),_$g=n$16(),d$o=n$16(),k$g=n$1b(),A$f=n$1b(),P$e=n$1b(),v$k=n$16(),x$g=n$16(),G$b=n$16();function O$j(t,o){const e=t.count-1;return b$I(t,o,0,Math.floor(e/3),Math.floor(e*(2/3)))}function S$d(o,e,r,c,m,p){r$W(m)?(m.basisMatrixAtPosition(p,w$j),o$W(B$e,w$j[0],w$j[1],w$j[2]),o$W(C$h,w$j[4],w$j[5],w$j[6]),o$W(q$8,w$j[8],w$j[9],w$j[10])):(o$W(B$e,1,0,0),o$W(C$h,0,1,0),o$W(q$8,0,0,1));const N=Z$g(o);P$u(N,q$8)<0&&q$p(N,N,-1),r$V(c,N);const l=P$u(N,C$h),h=P$u(N,B$e);Math.abs(l)<Math.abs(h)?(g$$(e,B$e,N,-h),z$s(e,e),_$v(r,e,N),z$s(r,r),q$p(r,r,-1)):(g$$(r,C$h,N,-l),z$s(r,r),_$v(e,r,N),z$s(e,e));}const w$j=e$10(),B$e=n$16(),C$h=n$16(),q$8=n$16();function z$c(t,o){o$W(D$b,0,0,0);for(let e=0;e<o.count-1;e++)o.getVec(e,E$j),u$W(D$b,D$b,E$j);q$p(t,D$b,1/(o.count-1));}const D$b=n$16();function H$9(t,o,e,r,n,c,a){o$W(t,o*n[0]+e*c[0]+r*a[0],o*n[1]+e*c[1]+r*a[1],o*n[2]+e*c[2]+r*a[2]);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function f$j(f){const v=new i$_,w=f.output===o$19.Depth,b=f.hasMultipassTerrain&&(f.output===o$19.Color||f.output===o$19.Alpha);d$W(v,f),v.include(r$10,{hasModelTransformation:!1,linearDepth:w}),v.include(e$1k,f),v.attributes.add(O$J.POSITION,"vec3"),v.varyings.add("vpos","vec3"),b&&v.varyings.add("depth","float");const{vertex:C,fragment:j}=v;return w&&(v.include(e$1h,f),C.uniforms.add(new e$$("nearFar",((e,r)=>r.camera.nearFar))),v.varyings.add("linearDepth","float")),C.code.add(n$19`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${b?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${w?n$19`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:n$19`transformPosition(proj, view, vpos);`}
    }
  `),v.include(u$$,f),b&&v.include(n$1q,f),j.include(e$14),j.uniforms.add(new e$19("eColor",(e=>e.color))),f.output===o$19.Highlight&&v.include(a$19),j.code.add(n$19`
  void main() {
    discardBySlice(vpos);
    ${b?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${f.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${n$19.float(t$19)}) {
      discard;
    }

    ${f.output===o$19.Alpha?n$19`gl_FragColor = vec4(fColor.a);`:""}

    ${f.output===o$19.Color?n$19`gl_FragColor = highlightSlice(fColor, vpos); ${f.transparencyPassType===O$L.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${f.output===o$19.Highlight?n$19`outputHighlight();`:""};
    ${f.output===o$19.Depth?n$19`outputDepth(linearDepth);`:""};
  }
  `),v}const v$j=Object.freeze(Object.defineProperty({__proto__:null,build:f$j},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class P$d extends e$11{initializeProgram(e){const t=P$d.shader.get().build(this.configuration);return new o$Z(e.rctx,t,E$E)}_createPipeline(t,r){const n=this.configuration,c=t===O$L.NONE,f=t===O$L.FrontFace;return W$h({blending:n.output!==o$19.Color&&n.output!==o$19.Alpha||!n.transparent?null:c?c$1c:E$J(t),culling:h$14(n.cullFace),depthTest:{func:l$13(t)},depthWrite:c||f?n.writeDepth&&a$1a:null,colorWrite:c$10,stencilWrite:n.hasOccludees?e$1i:null,stencilTest:n.hasOccludees?r?o$1k:f$11:null,polygonOffset:c||f?n.polygonOffset&&j$k:i$1c(n.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}P$d.shader=new t$W(v$j,(()=>import('./ColorMaterial.glsl-166a345b.js')));const j$k={factor:1,units:1};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class p$i extends i$17{constructor(){super(...arguments),this.output=o$19.Color,this.cullFace=n$1t.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=O$L.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1;}}e$Y([e$12({count:o$19.COUNT})],p$i.prototype,"output",void 0),e$Y([e$12({count:n$1t.COUNT})],p$i.prototype,"cullFace",void 0),e$Y([e$12()],p$i.prototype,"hasSlicePlane",void 0),e$Y([e$12()],p$i.prototype,"hasVertexColors",void 0),e$Y([e$12()],p$i.prototype,"transparent",void 0),e$Y([e$12()],p$i.prototype,"polygonOffset",void 0),e$Y([e$12()],p$i.prototype,"enableOffset",void 0),e$Y([e$12()],p$i.prototype,"writeDepth",void 0),e$Y([e$12()],p$i.prototype,"hasOccludees",void 0),e$Y([e$12({count:O$L.COUNT})],p$i.prototype,"transparencyPassType",void 0),e$Y([e$12()],p$i.prototype,"hasMultipassTerrain",void 0),e$Y([e$12()],p$i.prototype,"cullAboveGround",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class m$l extends d$X{constructor(t){super(t,new d$n),this.supportsEdges=!0,this._configuration=new p$i;}getConfiguration(t,e){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=e.transparencyPassType,this._configuration.enableOffset=e.camera.relativeElevation<_$A,this._configuration.hasMultipassTerrain=e.multipassTerrain.enabled,this._configuration.cullAboveGround=e.multipassTerrain.cullAboveGround,this._configuration}intersect(t,e,r,s,i,a,o){x$M(t,e,s,i,a,void 0,o);}requiresSlot(t,r){if(t===E$G.DRAPED_MATERIAL)return !0;if(i$A(r)===o$19.Highlight)return t===E$G.OPAQUE_MATERIAL;return t===(this.parameters.transparent?this.parameters.writeDepth?E$G.TRANSPARENT_MATERIAL:E$G.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:E$G.OPAQUE_MATERIAL)}createGLMaterial(t){return t.output===o$19.Color||t.output===o$19.Alpha||t.output===o$19.Highlight||t.output===o$19.Depth&&this.parameters.writeLinearDepth?new _$f(t):null}createBufferWriter(){return new i$w(u$v)}}class _$f extends t$1d{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees});}beginSlot(t){return this._output!==o$19.Color&&this._output!==o$19.Alpha||this._updateOccludeeState(t),this.ensureTechnique(P$d,t)}}class d$n extends o$1h{constructor(){super(...arguments),this.color=l$W,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=n$1t.None,this.hasOccludees=!1;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var a$t;!function(a){a[a.Horizontal=0]="Horizontal",a[a.Vertical=1]="Vertical",a[a.Cross=2]="Cross",a[a.ForwardDiagonal=3]="ForwardDiagonal",a[a.BackwardDiagonal=4]="BackwardDiagonal",a[a.DiagonalCross=5]="DiagonalCross",a[a.COUNT=6]="COUNT";}(a$t||(a$t={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const b$e=.70710678118,y$l=b$e,S$c=.08715574274;function j$j(j){const P=new i$_,T=j.hasMultipassTerrain&&(j.output===o$19.Color||j.output===o$19.Alpha);j.draped||P.extensions.add("GL_OES_standard_derivatives");const C=j.output===o$19.Depth,{vertex:D,fragment:R}=P;d$W(P,j),P.include(r$10,{hasModelTransformation:!1,linearDepth:C}),P.include(e$1k,j),C&&(P.include(e$1h,j),D.uniforms.add(new e$$("nearFar",((e,o)=>o.camera.nearFar))),P.varyings.add("linearDepth","float")),j.draped?D.uniforms.add(new o$_("worldToScreenRatio",((e,o)=>1/o.screenToPCSRatio))):P.attributes.add(O$J.BOUNDINGRECT,"mat3"),P.attributes.add(O$J.POSITION,"vec3"),P.attributes.add(O$J.UVMAPSPACE,"vec4"),P.varyings.add("vpos","vec3"),P.varyings.add("vuv","vec2"),T&&P.varyings.add("depth","float");const $=j.style===a$t.ForwardDiagonal||j.style===a$t.BackwardDiagonal||j.style===a$t.DiagonalCross;return $&&D.code.add(n$19`
      const mat2 rotate45 = mat2(${n$19.float(b$e)}, ${n$19.float(-y$l)},
                                 ${n$19.float(y$l)}, ${n$19.float(b$e)});
    `),j.draped||(c$1a(D,j),D.uniforms.add(new o$_("worldToScreenPerDistanceRatio",((e,o)=>1/o.camera.perScreenPixelRatio))),D.code.add(n$19`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),D.code.add(n$19`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),D.code.add(n$19`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${n$19.float(S$c)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),D.code.add(n$19`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${$?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${$?" * rotate45":""};

      ${j.draped?"":n$19`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${n$19.float(j.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),D.code.add(n$19`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${T?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${C?n$19`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:n$19`transformPosition(proj, view, vpos);`}
    }
  `),P.include(u$$,j),R.include(e$14),j.draped&&R.uniforms.add(new o$_("texelSize",((e,o)=>1/o.camera.pixelRatio))),j.output===o$19.Highlight&&P.include(a$19),T&&P.include(n$1q,j),j.output!==o$19.Highlight&&(R.code.add(n$19`
      const float lineWidth = ${n$19.float(j.lineWidth)};
      const float spacing = ${n$19.float(j.patternSpacing)};
      const float spacingINV = ${n$19.float(1/j.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),j.draped||R.code.add(n$19`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),R.uniforms.add(new e$19("uColor",(e=>e.color))),R.code.add(n$19`
    void main() {
      discardBySlice(vpos);
      ${T?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${j.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${j.output!==o$19.Highlight?n$19`color.a *= ${x$f(j)};`:""}

      if (color.a < ${n$19.float(t$19)}) {
        discard;
      }

      ${j.output===o$19.Alpha?n$19`gl_FragColor = vec4(color.a);`:""}

      ${j.output===o$19.Color?n$19`gl_FragColor = color; ${j.transparencyPassType===O$L.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${j.output===o$19.Highlight?n$19`outputHighlight();`:""}
      ${j.output===o$19.Depth?n$19`outputDepth(linearDepth);`:""};
    }
  `),P}function x$f(e){function o(o){return e.draped?n$19`coverage(vuv.${o}, texelSize)`:n$19`sample(vuv.${o})`}switch(e.style){case a$t.ForwardDiagonal:case a$t.Horizontal:return o("y");case a$t.BackwardDiagonal:case a$t.Vertical:return o("x");case a$t.DiagonalCross:case a$t.Cross:return n$19`
        1.0 - (1.0 - ${o("x")}) * (1.0 - ${o("y")})
      `;default:return "0.0"}}const P$c=Object.freeze(Object.defineProperty({__proto__:null,build:j$j},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class j$i extends e$11{initializeProgram(e){const t=j$i.shader.get().build(this.configuration);return new o$Z(e.rctx,t,w$i)}_setPipelineState(e,o){const r=this.configuration,i=e===O$L.NONE,s=e===O$L.FrontFace;return W$h({blending:r.output===o$19.Color||r.output===o$19.Alpha?i?c$1c:E$J(e):null,culling:h$14(r.cullFace),depthTest:{func:l$13(e)},depthWrite:i?r.writeDepth&&a$1a:S$H(e),colorWrite:c$10,stencilWrite:r.hasOccludees?e$1i:null,stencilTest:r.hasOccludees?o?o$1k:f$11:null,polygonOffset:i||s?r.polygonOffset&&C$g:i$1c(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}j$i.shader=new t$W(P$c,(()=>import('./Pattern.glsl-d7b3dcca.js')));const C$g={factor:1,units:1};class N$h extends i$17{constructor(){super(...arguments),this.output=o$19.Color,this.cullFace=n$1t.None,this.transparencyPassType=O$L.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1;}}e$Y([e$12({count:o$19.COUNT})],N$h.prototype,"output",void 0),e$Y([e$12({count:n$1t.COUNT})],N$h.prototype,"cullFace",void 0),e$Y([e$12({count:a$t.COUNT})],N$h.prototype,"style",void 0),e$Y([e$12({count:O$L.COUNT})],N$h.prototype,"transparencyPassType",void 0),e$Y([e$12()],N$h.prototype,"hasSlicePlane",void 0),e$Y([e$12()],N$h.prototype,"hasVertexColors",void 0),e$Y([e$12()],N$h.prototype,"polygonOffset",void 0),e$Y([e$12()],N$h.prototype,"writeDepth",void 0),e$Y([e$12()],N$h.prototype,"hasOccludees",void 0),e$Y([e$12()],N$h.prototype,"patternSpacing",void 0),e$Y([e$12()],N$h.prototype,"lineWidth",void 0),e$Y([e$12()],N$h.prototype,"enableOffset",void 0),e$Y([e$12()],N$h.prototype,"draped",void 0),e$Y([e$12()],N$h.prototype,"hasMultipassTerrain",void 0),e$Y([e$12()],N$h.prototype,"cullAboveGround",void 0);const w$i=new Map([[O$J.POSITION,0],[O$J.COLOR,3],[O$J.UVMAPSPACE,4],[O$J.BOUNDINGRECT,5]]);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class y$k extends d$X{constructor(e){super(e,new R$d),this.supportsEdges=!0,this._vertexAttributeLocations=w$i,this.techniqueConfig=new N$h;}getConfiguration(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.style=this.parameters.style,this.techniqueConfig.patternSpacing=this.parameters.patternSpacing,this.techniqueConfig.lineWidth=this.parameters.lineWidth,this.techniqueConfig.draped=this.parameters.draped,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<_$A,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(e,t,r,i,s,a,n){x$M(e,t,i,s,a,void 0,n);}requiresSlot(e,t){if(e===E$G.DRAPED_MATERIAL)return !0;if(i$A(t)===o$19.Highlight)return e===E$G.OPAQUE_MATERIAL;return e===(this.parameters.writeDepth?E$G.TRANSPARENT_MATERIAL:E$G.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)}createGLMaterial(e){return e.output===o$19.Color||e.output===o$19.Alpha||e.output===o$19.Highlight||e.output===o$19.Depth&&this.parameters.writeLinearDepth?new j$h(e):null}createBufferWriter(){const e=T$C().vec3f(O$J.POSITION).vec4u8(O$J.COLOR).vec4f(O$J.UVMAPSPACE);return this.parameters.draped||e.mat3f(O$J.BOUNDINGRECT),new E$i(e)}}class j$h extends t$1d{_updateParameters(e){return this.ensureTechnique(j$i,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees});}beginSlot(e){return this._output!==o$19.Color&&this._output!==o$19.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}}class E$i extends i$w{write(e,a,n,o){for(const h of this.vertexBufferLayout.fieldNames){const u=a.vertexAttributes.get(h),l=a.indices.get(h);if(u&&l)switch(h){case O$J.POSITION:{e$18(3===u.size);const t=n.getField(h,i$1h);t&&p$10(l,u.data,e.transformation,t,o);break}case O$J.COLOR:{e$18(3===u.size||4===u.size);const e=n.getField(h,x$P);e&&g$X(l,u.data,u.size,e,o);break}case O$J.UVMAPSPACE:{e$18(4===u.size);const e=n.getField(h,c$1i);e&&d$Z(l,u.data,e,o);break}case O$J.BOUNDINGRECT:{e$18(9===u.size);const r=n.getField(h,l$19);r&&this.writeBoundingRect(l,u.data,e.transformation,r,o);break}}}}writeBoundingRect(e,t,r,i,s){const a=r,n=i.typedBuffer,o=i.typedBufferStride,h=e.length;s*=o;for(let u=0;u<h;++u){const r=9*e[u],i=t[r],h=t[r+1],l=t[r+2];n[s]=a[0]*i+a[4]*h+a[8]*l+a[12],n[s+1]=a[1]*i+a[5]*h+a[9]*l+a[13],n[s+2]=a[2]*i+a[6]*h+a[10]*l+a[14];for(let e=3;e<9;++e)n[s+e]=t[r+e];s+=o;}}}class R$d extends o$1h{constructor(){super(...arguments),this.color=r$Z(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=n$1t.None,this.hasOccludees=!1,this.style=a$t.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function f$i(r,e,t){return g$l(u$o(r),e,t)}function u$o(r){return r&&r.pattern||null}function g$l(t,a,o){return r$W(t)?"none"===t.style||"solid"===t.style?("none"===t.style&&(a.color=r$Z(0,0,0,0),a.transparent=!0),new m$l(a)):(a.style=p$h(t.style),a.draped=o.isDraped,new y$k(a)):new m$l(a)}function p$h(r){switch(r){case"horizontal":return a$t.Horizontal;case"vertical":return a$t.Vertical;case"cross":return a$t.Cross;case"forward-diagonal":return a$t.ForwardDiagonal;case"backward-diagonal":return a$t.BackwardDiagonal;case"diagonal-cross":return a$t.DiagonalCross;default:return}}function d$m(r){return r.material instanceof y$k&&!r.material.parameters.draped}function y$j(r,e){if(d$m(r)){const n=r.geometry.vertexAttributes,l=n.get(O$J.POSITION).data,m=n.get(O$J.UVMAPSPACE).data,c=n.get(O$J.BOUNDINGRECT).data;M$b(c$1i.fromTypedArray(m),T$F.fromTypedArray(l),e,a$1i.fromTypedArray(c));}}function w$h(r,e,t,a){const o=p$u(r,e,t,a),i=r.stageObject.geometryRecords;for(let n=0;n<i.length;n++)y$j(i[n],a);return o}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const H$8=["polyline","polygon","extent"];class W$9 extends y$r{constructor(e,t,i,r){super(e,t,i,r),this._needsUV=!1,this._hasOutline=!1;}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial();}_ensureFillMaterial(){if(r$W(this._material))return;const e=m$V(this.symbolLayer,"material","color"),r=this._getCombinedOpacityAndColor(e);this._material=f$i(this.symbolLayer,{color:r,transparent:r[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof y$k,this._context.stage.add(this._material);}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(r$W(this._outlineMaterial)||!this._isValidOutline(e))return;this._hasOutline=!0;const i=t=>{const i=a$v(e.pattern);return new H$d({width:t,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:i,stippleScaleWithLineWidth:!0,cap:L$h(e.patternCap||"butt")})};this._outlineMaterial=i(u$12(e.size)),this._context.stage.add(this._outlineMaterial);}_isValidOutline(e){return r$W(e)&&e.size&&e.size>0&&r$W(e.color)&&(t$V(e.pattern)||"style"!==e.pattern.type||"none"!==e.pattern.style)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null;}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,H$8,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),r=this.setGraphicElevationContext(t,new h$x);return this.ensureDrapedStatus("on-the-ground"===r.mode),this._ensureMaterials(),this.draped?this._createAsOverlay(t,i):this._createAs3DShape(t,i,r)}layerOpacityChanged(){if(r$W(this._material)){const e=this._material.parameters.color,t=m$V(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(t);this._material.setParameters({color:[e[0],e[1],e[2],r],transparent:r<1||this.needsDrivenTransparentPass});}if(r$W(this._outlineMaterial)){const e=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]});}return !0}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,n=p$v(W$9.elevationModeChangeTypes,i,r);if(n!==x$p.UPDATE)return n;const o=g$y(r);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>o))}slicePlaneEnabledChanged(){if(r$W(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),r$W(this._outlineMaterial)){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e);}return !0}physicalBasedRenderingChanged(){return !0}pixelRatioChanged(){return !0}_createAs3DShape(e,t,i){const n=m$q(e.geometry);if(t$V(n))return null;z$b.renderData=d$u(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),z$b.color=t;const o=z$b.renderData.position.length/3;if(this._needsUV&&(z$b.uvMapSpace=new Float32Array(4*o),z$b.boundingRect=new Float64Array(9*o)),z$b.outNum=0,z$b.outGeometries=[],z$b.outTransforms=[],z$b.outMaterials=[],this._createAs3DShapeFill(z$b),this._hasOutline&&this._createAs3DShapeOutline(z$b),this._logGeometryCreationWarnings(z$b.renderData,n.rings,"rings","FillSymbol3DLayer"),0===z$b.outNum)return null;this._needsUV&&M$b(c$1i.fromTypedArray(z$b.uvMapSpace),T$F.fromTypedArray(z$b.renderData.position),this._context.renderCoordsHelper,a$1i.fromTypedArray(z$b.boundingRect));const a=new O$t({geometries:z$b.outGeometries,materials:z$b.outMaterials,transformations:z$b.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e.uid}}),s=new p$s(this,a,z$b.outGeometries,null,null,w$h,i);return s.alignedSampledElevation=z$b.renderData.sampledElevation,s.needsElevationUpdates=g$y(i.mode),s}_createAs3DShapeFill(e){const i=e.renderData.polygons;for(const{position:r,mapPosition:o,holeIndices:l,index:u,count:d}of i){if(r$W(this._context.clippingExtent)&&(B$t(k$f),M$y(k$f,o),!R$x(k$f,this._context.clippingExtent)))continue;const i=x$O(o,l,3);if(0===i.length)continue;const m=new Uint32Array(i),_=c$u({indices:m,attributeData:{position:r,color:e.color,mapPosition:o,uvMapSpace:this._needsUV?new Float32Array(e.uvMapSpace.buffer,4*u*e.uvMapSpace.BYTES_PER_ELEMENT,4*d):null,boundingRect:this._needsUV?new Float64Array(e.boundingRect.buffer,9*u*e.boundingRect.BYTES_PER_ELEMENT,9*d):null}});e.outGeometries.push(_),e.outMaterials.push(e$X(this._material)),e.outTransforms.push(o$1g),e.outNum++;}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const i=e.renderData.outlines;for(let r=0;r<i.length;++r){const{mapPosition:o,position:a}=i[r];if(r$W(this._context.clippingExtent)&&(B$t(k$f),M$y(k$f,o),!R$x(k$f,this._context.clippingExtent)))continue;const l=O$o({overlayInfo:null,removeDuplicateStartEnd:P$g.REMOVE,attributeData:{position:a,mapPosition:o}}),u=l.vertexAttributes.get(O$J.POSITION);u.data===a&&(u.data=new Float64Array(a)),e.outGeometries.push(l),e.outMaterials.push(e$X(this._outlineMaterial)),e.outTransforms.push(o$1g),e.outNum++;}}_createAsOverlay(e,i){const o=m$q(e.geometry);if(t$V(o))return null;e$X(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2,r$W(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),Y$5.renderData=f$r(o,this._context.overlaySR),Y$5.color=i;const a=Y$5.renderData.position.length/3;return this._needsUV&&(Y$5.uvMapSpace=new Float32Array(4*a)),Y$5.outNum=0,Y$5.outGeometries=[],Y$5.outBoundingBox=B$t(),Y$5.layerUid=this._context.layer.uid,Y$5.graphicsUid=e.uid,this._createAsOverlayFill(Y$5),this._hasOutline&&this._createAsOverlayOutline(Y$5),this._logGeometryCreationWarnings(Y$5.renderData,o.rings,"rings","FillSymbol3DLayer"),0===Y$5.outNum?null:(this._needsUV&&T$i(c$1i.fromTypedArray(Y$5.uvMapSpace),T$F.fromTypedArray(Y$5.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode),Y$5.outNum>0?new u$r(this,Y$5.outGeometries,Y$5.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayFill(e){const t=e.renderData.polygons;for(const{position:i,holeIndices:r,index:o,count:s}of t){if(B$t(k$f),M$y(k$f,i),!R$x(k$f,this._context.clippingExtent))continue;const t=x$O(i,r,3);if(0===t.length)continue;f$10(e.outBoundingBox,k$f);const u=new Uint32Array(t),m=c$u({indices:u,attributeData:{position:i,color:e.color,uvMapSpace:this._needsUV?new Float32Array(e.uvMapSpace.buffer,4*o*e.uvMapSpace.BYTES_PER_ELEMENT,4*s):null}}),_=new T$l(m,e$X(this._material),{layerUid:e.layerUid,graphicUid:e.graphicsUid}),y=k$f;r$17(_.boundingSphere,.5*(y[0]+y[3]),.5*(y[1]+y[4]),0,.5*Math.sqrt((y[3]-y[0])*(y[3]-y[0])+(y[4]-y[1])*(y[4]-y[1]))),e.outGeometries.push(_),e.outNum++;}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const t=e.renderData.outlines;for(let i=0;i<t.length;++i){const{position:r}=t[i];if(B$t(k$f),M$y(k$f,r),!R$x(k$f,this._context.clippingExtent))continue;f$10(e.outBoundingBox,k$f);const o=O$o({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:P$g.REMOVE,attributeData:{position:r}}),a=new T$l(o,e$X(this._outlineMaterial),{layerUid:e.layerUid,graphicUid:e.graphicsUid}),s=k$f;r$17(a.boundingSphere,.5*(s[0]+s[3]),.5*(s[1]+s[4]),0,.5*Math.sqrt((s[3]-s[0])*(s[3]-s[0])+(s[4]-s[1])*(s[4]-s[1]))),e.outGeometries.push(a),e.outNum++;}}_getOutlineOpacity(){const e=m$V(this.symbolLayer,"outline","color");return (this.draped?1:this._getLayerOpacity())*(r$W(e)?e.a:0)}_getOutlineColor(){const r=m$V(this.symbolLayer,"outline","color"),n=this._getOutlineOpacity();return z$i(r$W(r)?l$T.toUnitRGB(r):null,n)}test(){return {...super.test(),createAsOverlay:(e,t)=>this._createAsOverlay(e,t),createAs3DShape:(e,t,i)=>this._createAs3DShape(e,t,i)}}}W$9.elevationModeChangeTypes={definedChanged:x$p.RECREATE,staysOnTheGround:x$p.NONE,onTheGroundChanged:x$p.RECREATE};const k$f=a$1d(),z$b={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Y$5={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const s$q=s$17.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters");class a$s{constructor(o){this.definition=o,this.key=JSON.stringify(o),this.haloSize=Math.round(o.halo.size),this.textStyle=this._colorToRGBA(o.color),this.haloStyle=this._colorToRGB(o.halo.color),this.backgroundStyle=0!==o.background.color[3]?this._colorToRGBA(o.background.color):null;}fontString(o){const t=this.definition.font;return `${t.style} ${t.weight} ${o}px ${t.family}, sans-serif`}_colorToRGB(o){return `rgb(${o.slice(0,3).map((o=>Math.floor(255*o))).toString()})`}_colorToRGBA(o){return `rgba(${o.slice(0,3).map((o=>Math.floor(255*o))).toString()},${o[3]})`}static async fromSymbol(t,c=1){const g=m$V(t,"material","color"),f=E$I(g,l$W,l$T.toUnitRGBA),d=E$I(t.size,12,u$12),h=t.lineHeight,m=r$W(t.background)?l$T.toUnitRGBA(t.background.color):l$W,u={family:E$I(t.font,"sans-serif",(o=>o.family)),decoration:E$I(t.font,"none",(o=>o.decoration)),weight:E$I(t.font,"normal",(o=>o.weight)),style:E$I(t.font,"normal",(o=>o.style))},b=t.halo,y=r$W(b)&&r$W(b.color)&&b.size>0?{size:u$12(b.size),color:l$T.toUnitRGBA(b.color)}:{size:0,color:l$W},p=new a$s({color:f,size:d,background:{color:m,padding:r$W(t.background)?[.65*d,.5*d]:[0,0],borderRadius:r$W(t.background)?d*(6/16):0},lineSpacingFactor:h,font:u,halo:y,pixelRatio:c}),S=p.fontString(d);try{await document.fonts.load(S);}catch(R){s$q.warnOnce(`Failed to preload font '${S}'. Some text symbology may be rendered using the default browser font.`);}return p}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class i$o{constructor(e,t,n){this._renderer=new s$x(e,t,n);}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const r=o$q(d$l,this._renderer.renderedWidth,this._renderer.renderedHeight),i=r.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new L$H(r,{wrap:{s:D$q.CLAMP_TO_EDGE,t:D$q.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:l$18.PAD})}}const d$l={canvas:null};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const C$f=[0,0,1];class U$c extends y$r{constructor(e,t,r,n){super(e,t,r,n),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1);}async doLoad(){if(!this._drivenProperties.size){const t=O$w(this.symbolLayer.size);if(t)throw new s$16("graphics3dtextsymbollayer:invalid-size",t)}await this._createTextRenderParameters();}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.pixelRatio;this._textRenderParameters=await a$s.fromSymbol(this.symbolLayer,e);}destroy(){super.destroy();}createGraphics3DGraphic(e){const n=e.graphic,s=d$y(n.geometry);if(t$V(s))return this.logger.warn(`unsupported geometry type for text symbol: ${n.geometry.type}`),null;const i=this.symbolLayer.text;if(t$V(i)||""===i)return null;const o=o$1i(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(r$W(o)&&!i$19(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const a={...A$e,verticalOffset:o,horizontalPlacement:this.symbolLayer.horizontalAlignment,verticalPlacement:f$q(this.symbolLayer.verticalAlignment)};return this._createAs3DShape(n,s,i,a)}createLabel(e,r,n,s){const i=e.graphic,o=d$y(i.geometry);if(t$V(o))return this.logger.warn(`unsupported geometry type for label: ${i.geometry.type}`),null;const a=r.text;return !a||/^\s+$/.test(a)?null:this._createAs3DShape(i,o,a,r,n,s)}setGraphicElevationContext(e,t,r=0){const n=super.setGraphicElevationContext(e,t);return n.addOffsetRenderUnits(r),n}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,t){return D$a(e,t,((e,t)=>{this.updateGraphicElevationContext(t,e);})),x$p.UPDATE}slicePlaneEnabledChanged(e,t){return D$a(e,t,(e=>{for(const t of e.stageObject.geometryRecords)t.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});})),!0}physicalBasedRenderingChanged(){return !0}pixelRatioChanged(){return !1}updateGraphicElevationContext(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata.elevationOffset),t.needsElevationUpdates=g$y(t.elevationContext.mode)||"absolute-height"===t.elevationContext.mode;}_defaultElevationInfoNoZ(){return R$c}_createAs3DShape(e,l,c,m,f,g){const y=this.setGraphicElevationContext(e,new h$x,m.elevationOffset),v="polyline"===m$V(e.geometry,"type"),b=e.uid;let P=null,O=null;if(t$V(g)){const e=c$r(m.horizontalPlacement);P=new i$o(c,e,this._textRenderParameters);let n=null;O=this._context.sharedResources.textures.fromData(P.key,(()=>e$X(P).create()),(()=>{r$W(n)&&n.release();}));const o=this._context.stage.renderView.textureRepository.acquire(O.texture.id);if(t$V(o)||k$F(o))return O.release(),null;n=o;}const w=G$a(P,m),_={occlusionTest:!0,screenOffset:m.screenOffset,anchorPosition:w,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:m.centerOffsetUnits,debugDrawLabelBorder:m.debugDrawLabelBorder,drawInSecondSlot:!0};if(r$W(O)&&(_.textureId=O.texture.id),r$W(g)&&(_.textureId=g.id),r$W(m.verticalOffset)){const{screenLength:e,minWorldLength:t,maxWorldLength:r}=m.verticalOffset;_.verticalOffset={screenLength:u$12(e),minWorldLength:t||0,maxWorldLength:null!=r?r:1/0};}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:e,screenSizePerspectiveSettingsLabels:t}=this._context.sharedResources;_.screenSizePerspective=t.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),_.screenSizePerspectiveAlignment=e;}let U;if(v&&(_.shaderPolygonOffset=1e-4),_.hasSlicePlane=this._context.slicePlaneEnabled,r$W(f)){const e=JSON.stringify(_);U=f.get(e),t$V(U)&&(U=new J$c(_),f.add(e,U));}else U=new J$c(_);const D=[U],R=m.translation,A=r$W(P)?[P.displayWidth,P.displayHeight]:[0,0],T=m.centerOffset,W=C$f,I=[0,0],k=[T$z.createPointGeometry(W,R,null,A,T,I,null)],B=this._context.layer.uid,H=f$x(this._context,l,k,D,y,B,b);if(null===H)return null;const $=new p$s(this,H.object,k,t$V(f)?D:null,O,d$C,y);$.alignedSampledElevation=H.sampledElevation,$.needsElevationUpdates=g$y(y.mode)||"absolute-height"===y.mode;const{displayWidth:V,displayHeight:N}=r$W(P)?P:m;$.getScreenSize=(e=n$1b())=>(e[0]=V,e[1]=N,e);const q={labelText:c,elevationOffset:m.elevationOffset};return $.metadata=q,g$u($,l,this._context.elevationProvider),$}}function D$a(e,t,n){e&&e.forEach((e=>{const s=t(e);r$W(s)&&n(s,e.graphic);}));}function G$a(e,t){if("baseline"===t.verticalPlacement){const n=r$u[t.horizontalPlacement],s=r$W(e)?e.baselineAnchorY:0;return r$13(n,s)}const n=i$r(t.horizontalPlacement,t.verticalPlacement);return o$p[n]}const R$c={mode:"relative-to-ground",offset:0},A$e={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const e$s={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const N$g=["polyline","polygon","extent"];class V$b extends y$r{constructor(e,t,r,o){super(e,t,r,o);}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null;}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,N$g,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t,new h$x);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.ensureMaterial(),this.draped?this._createAsOverlay(t):this._createAs3DShape(t,r,t.uid)}ensureMaterial(){if(r$W(this._material))return;const r=new A$j,o=this.symbolLayer.color;r$W(o)&&(r.color=l$T.toUnitRGBA(o));const i=this._getCombinedOpacity(o,{hasIntrinsicColor:!0});r.color=[r.color[0],r.color[1],r.color[2],i],r.transparent=i<1||this.needsDrivenTransparentPass,r.waveDirection=r$W(this.symbolLayer.waveDirection)?V$b.headingVectorFromAngle(this.symbolLayer.waveDirection):r$13(0,0);const a=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=e$s[a];r.waveStrength=n.waveStrength,r.waveTextureRepeat=n.textureRepeat,r.waveVelocity=n.waveVelocity,r.flowStrength=n.perturbationStrength,r.hasSlicePlane=this._context.slicePlaneEnabled,r.isDraped=this.draped,this._material=new d$w(r),this._context.stage.add(this._material);}layerOpacityChanged(){if(t$V(this._material))return !0;const e=this._material.parameters.color,t=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),o=t<1||this.needsDrivenTransparentPass;return this._material.setParameters({color:[e[0],e[1],e[2],t],transparent:o}),!0}layerElevationInfoChanged(e,t,r){const o=this._elevationContext.mode,i=p$v(V$b.elevationModeChangeTypes,r,o);if(i!==x$p.UPDATE)return i;const a=g$y(o);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>a))}slicePlaneEnabledChanged(){return r$W(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return !0}pixelRatioChanged(){return !0}_createAs3DShape(e,t,o){const i=m$q(e.geometry);if(t$V(i))return null;z$a.renderData=d$u(i,this._context.elevationProvider,this._context.renderCoordsHelper,t);const a=z$a.renderData.position.length/3;if(z$a.uvCoords=new Float64Array(2*a),z$a.outNum=0,z$a.outGeometries=[],z$a.outTransforms=[],z$a.outMaterials=[],this._create3DShapeGeometries(z$a),this._logGeometryCreationWarnings(z$a.renderData,i.rings,"rings","WaterSymbol3DLayer"),0===z$a.outNum)return null;this._createUVCoordsFromVertices(z$a.uvCoords,z$a.renderData.mapPosition,a,this._context.elevationProvider.spatialReference);const n=new O$t({geometries:z$a.outGeometries,materials:z$a.outMaterials,transformations:z$a.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:o}}),s=new p$s(this,n,z$a.outGeometries,null,null,p$u,t);return s.alignedSampledElevation=z$a.renderData.sampledElevation,s.needsElevationUpdates=g$y(t.mode),s}_createUVCoordsFromVertices(e,t,r,o){const a=z$t(o);D$s(I$f);for(let i=0;i<r;i++)r$Y(W$8,t[3*i+0],t[3*i+1]),m$Y(I$f,W$8);l$X(I$f,I$f,a);const n=I$f[0]%V$b.unitSizeOfTexture,l=I$f[1]%V$b.unitSizeOfTexture;F$c[0]=I$f[0]-n,F$c[1]=I$f[1]-l;for(let i=0;i<r;i++)e[2*i+0]=(t[3*i+0]*a-F$c[0])/V$b.unitSizeOfTexture,e[2*i+1]=(t[3*i+1]*a-F$c[1])/V$b.unitSizeOfTexture;}_create3DShapeGeometries(e){const r=e.renderData.polygons,i=e.uvCoords;for(const{count:s,index:l,position:u,mapPosition:c,holeIndices:m}of r){if(r$W(this._context.clippingExtent)&&(B$t(k$e),M$y(k$e,c),!R$x(k$e,this._context.clippingExtent)))continue;const r=x$O(c,m,3);if(0===r.length)continue;const h=new Uint32Array(r),d=new Float64Array(i.buffer,2*l*i.BYTES_PER_ELEMENT,2*s),f=l$q({indices:h,attributeData:{position:u,uv0:d,mapPosition:c}});e.outGeometries.push(f),e.outMaterials.push(e$X(this._material)),e.outTransforms.push(o$1g),e.outNum++;}}_createAsOverlay(e){const t=m$q(e.geometry);if(t$V(t))return null;e$X(this._material).renderPriority=this._renderPriority,Y$4.renderData=f$r(t,this._context.overlaySR);const i=Y$4.renderData.position.length/3;return Y$4.uvCoords=new Float64Array(2*i),Y$4.outNum=0,Y$4.outGeometries=[],Y$4.outBoundingBox=B$t(),Y$4.layerUid=this._context.layer.uid,Y$4.graphicsUid=e.uid,this._createAsOverlayWater(Y$4),this._logGeometryCreationWarnings(Y$4.renderData,t.rings,"rings","WaterSymbol3DLayer"),0===Y$4.outNum?null:(this._createUVCoordsFromVertices(Y$4.uvCoords,Y$4.renderData.position,i,this._context.overlaySR),Y$4.outNum>0?new u$r(this,Y$4.outGeometries,Y$4.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayWater(e){const t=e.uvCoords,r=e.renderData.polygons;for(const{position:i,holeIndices:n,index:s,count:l}of r){if(B$t(k$e),M$y(k$e,i),!R$x(k$e,this._context.clippingExtent))continue;f$10(e.outBoundingBox,k$e);const r=x$O(i,n,3);if(0===r.length)continue;const u=new Uint32Array(r),c=new Float64Array(t.buffer,2*s*t.BYTES_PER_ELEMENT,2*l),h=l$q({indices:u,attributeData:{position:i,uv0:c}}),d=new T$l(h,e$X(this._material),{layerUid:e.layerUid,graphicUid:e.graphicsUid}),_=k$e;r$17(d.boundingSphere,.5*(_[0]+_[3]),.5*(_[1]+_[4]),0,.5*Math.sqrt((_[3]-_[0])*(_[3]-_[0])+(_[4]-_[1])*(_[4]-_[1]))),e.outGeometries.push(d),e.outNum++;}}static headingVectorFromAngle(e){const t=n$1b(),r=o$1q(e);return t[0]=Math.sin(r),t[1]=Math.cos(r),t}test(){return {...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}V$b.unitSizeOfTexture=100,V$b.elevationModeChangeTypes={definedChanged:x$p.RECREATE,staysOnTheGround:x$p.NONE,onTheGroundChanged:x$p.RECREATE};const F$c=n$1b(),I$f=u$T(),W$8=n$1b(),k$e=a$1d(),z$a={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Y$4={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const c$o=s$17.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");function l$l(r,o,e,t){const i=f$h[r.type]&&f$h[r.type][o.type]||n$r[o.type];return i?new i(r,o,e,t):(c$o.error("GraphicsLayerFactory#make",`unknown symbol type ${o.type}`),null)}const n$r={icon:ue$a,object:me$7,line:K$a,path:ae$5,fill:W$9,extrude:J$9,text:U$c,water:V$b};function h$l(r,o){n$r[r]=o;}const f$h={"mesh-3d":{fill:me$8}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class d$k extends a$E{constructor(e,t,s){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=s,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0;}set symbol(e){this._symbol=e;for(let s=0;s<e.symbolLayers.length;s++){const r=this.symbolLayers[s];t$V(r)||(r.symbol=e,r.symbolLayer=e.symbolLayers.items[s]);}}get symbol(){return this._symbol}async doLoad(t){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const n=[];for(let e=0;e<i;e++){const s=r.getItemAt(e);if(!1===s.enabled)continue;p$g.renderPriority=1-(1+e)/i,p$g.renderPriorityStep=1/i,p$g.ignoreDrivers=s._ignoreDrivers;const a=l$l(this.symbol,s,this._context,p$g);n.push(d$12(t,(()=>{this.symbolLayers[e]=null,a.destroy();}))),this.symbolLayers[e]=a;}await n$1o(this.symbolLayers,(async(e,t)=>{if(r$W(e))try{await e.load(),this._extentPadding+=Math.max(this._extentPadding,e.extentPadding);}catch{this.symbolLayers[t]=null;}}));for(const e of n)e?.remove();if(n.length=0,f$V(t),this.symbolLayers.length&&!this.symbolLayers.some((e=>!!e)))throw new Error}getSymbolLayerSize(e){const t=this.symbolLayers[e];return r$W(t)?t.getCachedSize():null}get extentPadding(){return this._extentPadding}createGraphics3DGraphic(e,t){const r=e.graphic,o=new Array(this.symbolLayers.length);for(let i=0;i<this.symbolLayers.length;i++){const t=this.symbolLayers[i];o[i]=r$W(t)?t.createGraphics3DGraphic(e):null;}const a=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new B$j(r,t||this,o,e.layer,a)}get complexity(){return d$z(this.symbolLayers.map((e=>m$V(e,"complexity"))))}globalPropertyChanged(e,t){const r=this.symbolLayers.length;for(let o=0;o<r;o++){const r=this.symbolLayers[o],a=e=>{const t=e.graphics[o];return t instanceof p$s?t:null};if(r$W(r)&&!r.globalPropertyChanged(e,t,a))return !1}return !0}applyRendererDiff(e,t){return this.loadStatus!==e$H.LOADED?e$I.Recreate_Symbol:this.symbolLayers.reduce(((r,o)=>r!==e$I.Recreate_Symbol&&r$W(o)?Math.min(r,o.applyRendererDiff(e,t)):r),e$I.Fast_Update)}prepareSymbolPatch(e){if(this.loadStatus===e$H.FAILED)return;if("partial"!==e.diff.type)return;const r=e.diff.diff;if(!r.symbolLayers||"partial"!==r.symbolLayers.type)return;const o=r.symbolLayers.diff;this.symbolLayers.forEach(((r,a)=>{if(t$V(r))return;const i=o[a];if(i){const t={diff:i,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};r.prepareSymbolLayerPatch(t),e.symbolStatePatches.push(...t.symbolLayerStatePatches),t.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push(((e,r)=>{const o=e.graphics[a];r$W(o)&&t.graphics3DGraphicPatches.forEach((e=>e(o,r)));}));}}));}updateGeometry(e,s){for(let r=0;r<this.symbolLayers.length;r++){const o=this.symbolLayers[r];if(t$V(o))continue;const a=e.graphics[r];if(t$V(a)||!o.updateGeometry(a,s))return !1}return !0}onRemoveGraphic(e){for(let r=0;r<this.symbolLayers.length;r++){const o=this.symbolLayers[r];if(t$V(o))continue;const a=e.graphics[r];r$W(a)&&o.onRemoveGraphic(a);}}getFastUpdateStatus(){let e=0,s=0,r=0;return this.symbolLayers.forEach((o=>{t$V(o)||(o.loadStatus===e$H.LOADING?e++:o.isFastUpdatesEnabled()?r++:s++);})),{loading:e,slow:s,fast:r}}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else {super.destroy();for(const e of this.symbolLayers)r$W(e)&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0;}}get destroyed(){return this._destroyed}}const p$g={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class e$r extends a$E{constructor(t,s,r){super(s),this.symbol=t,this.convert=r,this.graphics3DSymbol=null,this.referenced=0;}getSymbolLayerSize(s){return r$W(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(s):null}get symbolLayers(){return r$W(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return r$W(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(s){const r=await this.symbol.fetchSymbol({signal:s});r.id=this.symbol.id,this.graphics3DSymbol=this.convert(r),r$W(this.graphics3DSymbol)&&await this.graphics3DSymbol.load();}createGraphics3DGraphic(s){return r$W(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(s,this):null}get complexity(){return r$W(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:b$q}globalPropertyChanged(s,r){return !!r$W(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(s,r)}applyRendererDiff(r,i){return r$W(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(r,i):e$I.Recreate_Symbol}prepareSymbolPatch(s){r$W(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(s);}updateGeometry(s,r){return !!r$W(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(s,r)}onRemoveGraphic(){}getFastUpdateStatus(){return r$W(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){r$W(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy();}get destroyed(){return void 0===this.graphics3DSymbol}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function i$n(i){return i instanceof e$r?i.graphics3DSymbol:i instanceof d$k?i:null}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const u$n=s$17.getLogger("esri.views.3d.layers.graphics.labelPlacement");function g$k(e){const r=C$e(e);if(t$V(r))return null;const n=O$i(e,r);if(t$V(n))return null;const c=n.anchor,l=!!r.hasLabelVerticalOffset;return w$g({anchor:c,verticalOffset:r.verticalOffset,screenOffset:n$1b(),centerOffset:r$Z(0,0,0,-1),centerOffsetUnits:"world",translation:n$16(),elevationOffset:0,hasLabelVerticalOffset:l},n,e)}function O$i(e,t){if(t.anchor)return t;const r=e.labelClass.labelPlacement,n=x$e[r],a=n||P$b(e);return r&&!n&&u$n.warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),v$i(a,e)}function d$j(e){const t=e.graphics3DGraphic.graphics3DSymbol,n=i$n(t);return r$W(n)?n.symbol.symbolLayers.getItemAt(0):null}function v$i(e,n){const a=n.graphics3DGraphic.graphic.geometry;if(t$V(a))return null;if(r$W(n.disablePlacement)){return n.labelClass.labelPlacement?(u$n.warnOncePerTick(y$i(e.placement,n.disablePlacement.logEntityDescription)),P$b(n)):e}const c=a.type;switch(c){case"polyline":case"polygon":case"extent":case"multipoint":if(n.labelClass.labelPlacement)return u$n.warnOncePerTick(y$i(e.placement,`'${c}' geometries`)),P$b(n);break;case"point":case"mesh":return e}return e}function y$i(e,t){return `the requested label placement '${e}' is currently unsupported for ${t} in SceneView.`}function P$b(e){const n=e.graphics3DGraphic.graphic.geometry;if(t$V(n))return null;switch(n.type){case"polyline":case"extent":case"multipoint":return {placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const t=d$j(e);return r$W(t)&&"extrude"===t.type?x$e["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return x$e["above-center"];default:return}}function w$g(e,r,n){const a=n.graphics3DGraphic.graphic.geometry;if(t$V(a))return null;switch(a.type){case"point":z$9(e,r,n);break;case"polygon":L$e(e,r,n);break;case"mesh":D$9(e,r,n.graphics3DGraphic.graphics[0]);}return e}function L$e(e,n,a){const l=d$j(a);if(!t$V(l))switch(l.type){case"extrude":{const t=a.graphics3DGraphic.graphics[0];r$W(t)?(t.getBoundingBoxObjectSpace($$6),p$11($$6,e.translation),e.translation[2]=N$t($$6)/2):o$W(e.translation,0,0,0),D$9(e,n,t);break}}}function z$9(e,n,a){const l=d$j(a);if(t$V(l))return;const o=a.graphics3DGraphic.graphics[0];switch(r$W(o)?o.getCenterObjectSpace(e.translation):o$W(e.translation,0,0,0),l.type){case"icon":case"text":j$g(e,n,a,o);break;case"object":D$9(e,n,o);}}function j$g(e,t,n,a){const{graphics3DGraphic:c}=n,l=r$W(a)?a.getScreenSize():null;if(!c.isDraped&&r$W(l)){const r=S$b(n);B$d[0]=l[0]/2*(t.normalizedOffset[0]-r[0]),B$d[1]=l[1]/2*(t.normalizedOffset[1]-r[1]),e.screenOffset[0]=B$d[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=B$d[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=B$d[1];}else e.hasLabelVerticalOffset||"center"===e.anchor||(x$e[n.labelClass.labelPlacement]&&u$n.warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center");}function S$b(e,t=T$h){const{graphics3DGraphic:n}=e,a=n.graphics[0],c=r$W(a)?a.stageObject.geometryRecords[0].material:null;if(c&&c instanceof J$c){const e=c.parameters.anchorPosition;t[0]=2*(e[0]-.5),t[1]=2*(e[1]-.5);}else t[0]=0,t[1]=0;return t}function D$9(e,t,n){const a=r$W(n)?n.getBoundingBoxObjectSpace($$6):$$6,c=r$X(a[3]-a[0],a[4]-a[1],a[5]-a[2]),s=Math.sqrt(c[0]*c[0]+c[1]*c[1]);e.centerOffset[0]=s/2*t.normalizedOffset[0];const i=e.translation[2],f=c[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=i+f;const m=s$1b(c);e.centerOffset[2]=m/2*t.normalizedOffset[2];}function k$d(e){return "above-center"===e}function C$e(e){const a=e.labelClass.labelPlacement,{labelSymbol:c,graphics3DGraphic:l}=e,o=i$n(l.graphics3DSymbol),s=o$1m(o,(e=>"point-3d"===e.symbol.type?e.symbol:null)),i=x$e[a]||P$b(e);return r$W(s)&&s.supportsCallout()&&s.hasVisibleVerticalOffset()&&!l.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:V$a(s.verticalOffset),anchor:null,normalizedOffset:null}:c&&c.hasVisibleVerticalOffset()&&(t$V(s)||!s.supportsCallout()||!s.verticalOffset||l.isDraped)?k$d(i.placement)?{placement:"above-center",verticalOffset:V$a(c.verticalOffset),anchor:"bottom",normalizedOffset:[0,i.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(u$n.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+a+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function V$a(e){const{screenLength:t,minWorldLength:r,maxWorldLength:n}=e;return {screenLength:t,minWorldLength:r,maxWorldLength:n}}const x$e={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},G$9={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const q in G$9){const e=G$9[q],t=x$e[q];e.forEach((e=>{x$e[e]=t;}));}Object.freeze&&(Object.freeze(x$e),Object.keys(x$e).forEach((e=>{Object.freeze(x$e[e]),Object.freeze(x$e[e].normalizedOffset);})));const B$d=[0,0],T$h=[0,0],$$6=a$1d();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$p{constructor(s){this._stage=s,this._materials=new Map;}get(s){return this._materials.get(s)}add(s,t){this._materials.set(s,t),this._stage.add(t);}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const v$h=512,z$8=4096,R$b=.85,w$f=.95;let b$d=class extends y$F{constructor(e){super(e),this.type=e$1g.Texture,this.id=e$1e(),this.events=new n$17,this._glTexture=null,this.needsClear=!1,this.elementsToAddOrUpdate=new Map,this.elementsToRemove=new Map,this.elementsToRender=new Map,this.elements=new Map,this.stageObjects=new Map,this.updating=!1;}initialize(){this.stage=this.view._stage,this.canvas=this._create2DCanvas(),this.ctx=this.canvas.getContext("2d"),this.stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor();}unload(){this._glTexture=s$1a(this._glTexture),this.updating=!1,this.events.emit("unloaded");}get width(){return this.atlas.size.width}get height(){return this.atlas.size.height}get requiresFrameUpdates(){return !1}_createDescriptor(e){return {target:M$v.TEXTURE_2D,pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,wrapMode:D$q.CLAMP_TO_EDGE,flipped:!0,samplingMode:L$C.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return r$W(this._glTexture)||(this._glTexture=new u$X(e,this._createDescriptor(e),this.canvas),this.frameWorker=this.view.resourceController.scheduler.registerTask(L$D.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this.elements=null,this.elementsToAddOrUpdate=null,this.elementsToRemove=null,this.elementsToRender=null,this.frameWorker=a$W(this.frameWorker),this._glTexture&&(this.stage.remove(this),this._glTexture=s$1a(this._glTexture)),this.canvas.width=0,this.canvas.height=0,this.canvas=null,this.ctx=null;}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",v$h.toString()),e.setAttribute("height",v$h.toString()),e}_update2DCanvasSize(){this.canvas.setAttribute("width",this.atlas.size.width.toString()),this.canvas.setAttribute("height",this.atlas.size.height.toString());}_createAtlasRegion(e=v$h){this.atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0};}_computeAtlasResolution(e,t){let s=Math.max(e,t);return s+=256,s=a$1f(s),s=Math.min(s,z$8),s}_resizeAtlas(e,t){t=t||e;const s=this.atlas;s.size.width=e,s.size.height=t,r$W(this._glTexture)&&this._glTexture.resize(e,t),this._update2DCanvasSize();}_resetAtlasCursor(){const e=this.atlas;e.cursor.x=O$h,e.cursor.y=O$h+j$f,e.lineHeight=0,this.needsClear=!0;}_getAtlasUsage(){const e=this.atlas;return (e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this.elementsToRemove.size,t=this.elementsToAddOrUpdate.size,s=this.elements.size;return this._getAtlasUsage()/s*(s+t-e)}_addAtlasElement(e,t,s,i){const r=this.atlas,{renderedWidth:a,renderedHeight:n,displayWidth:h,displayHeight:o}=e.textRenderer;e.placement.offset.x=r.cursor.x,e.placement.offset.y=r.cursor.y,e.placement.size.width=a,e.placement.size.height=n,e.placement.size.displayWidth=h,e.placement.size.displayHeight=o,e.placement.uvMinMax=[e.placement.offset.x/r.size.width,1-(e.placement.offset.y+n)/r.size.height,(e.placement.offset.x+a)/r.size.width,1-e.placement.offset.y/r.size.height],r.cursor.x+=s,r.lineHeight=Math.max(r.lineHeight,i),this.elements.set(t,e);}_removeAtlasElement(e){if(e&&this.elements.has(e.textId)){const t=e.placement.offset,s=e.placement.size;this.ctx.clearRect(t.x,t.y,s.width,s.height),this.elements.delete(e.textId);}}_ensureStageObjects(e){const t=this.stageObjects.get(e);if(t)return t;const s=new Set;return this.stageObjects.set(e,s),s}_addStageObject(e,t){this._ensureStageObjects(e).add(t);}_removeStageObject(e,t){const s=this.stageObjects.get(e);s&&s.delete(t)&&(t.geometries[0].vertexAttributes.get(O$J.SIZE).data=[0,0],t.geometryVertexAttrsUpdated(t.geometryRecords[0]));}_processAddition(e,t){const s=this.atlas,i=e.textId,r=e.textRenderer.renderedWidth,a=e.textRenderer.renderedHeight,n=r+O$h,h=a+O$h+j$f;if(s.cursor.x+n<s.size.width&&s.cursor.y+h<s.size.height)this._addAtlasElement(e,i,n,h),this.elementsToRender.set(i,e),this.elementsToAddOrUpdate.delete(i);else {if(!(s.cursor.y+h+s.lineHeight<s.size.height)){const e=this._getExpectedAtlasUsage(),i=e>R$b&&s.size.width<z$8;return i&&this._resizeAtlas(2*s.size.width,2*s.size.height),!t||!i&&e>w$f&&s.size.width===z$8?(this._processRemovals(),E$h.OK):(this._repack(),E$h.REPACK)}s.cursor.x=O$h,s.cursor.y+=s.lineHeight,s.lineHeight=0,this._addAtlasElement(e,i,n,h),this.elementsToRender.set(i,e),this.elementsToAddOrUpdate.delete(i);}return E$h.OK}_processRemovals(){this.elementsToRemove.forEach(((e,t)=>{const s=this.stageObjects.get(t);s&&0!==s.size||this._removeAtlasElement(e),s&&0===s.size&&this.stageObjects.delete(t);})),this.elementsToRemove.clear();}_repack(){this._processRemovals(),this.elements.forEach(((e,t)=>{e.rendered=!1,this.elementsToAddOrUpdate.set(t,e);})),this.elements.clear(),this._resetAtlasCursor(),this.elementsToRender.clear();}_processRenderingRequest(e){this.ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.placement.size.width,e.placement.size.height),e.textRenderer.render(this.ctx,e.placement.offset.x,e.placement.offset.y);const t=this.stageObjects.get(e.textId);t&&t.forEach((t=>{t.geometries[0].vertexAttributes.get(O$J.UV0).data=new Float32Array(e.placement.uvMinMax),t.geometries[0].vertexAttributes.get(O$J.SIZE).data=[e.placement.size.displayWidth,e.placement.size.displayHeight],t.geometryVertexAttrsUpdated(t.geometryRecords[0]);})),e.rendered=!0;}get running(){return this.updating}runTask(e,t=!0){if(!this._glTexture)return;let s=!1;if(n$1m(this.elementsToAddOrUpdate,((e,i)=>{const r=this.elements.get(i);if(r&&r.rendered){const e=this.stageObjects.get(i);return e&&e.forEach((e=>{const t=e.geometries[0].vertexAttributes,s=this.elements.get(i);t.get(O$J.UV0).data=new Float32Array(s.placement.uvMinMax),t.get(O$J.SIZE).data=new Float32Array([s.placement.size.displayWidth,s.placement.size.displayHeight]),e.geometryVertexAttrsUpdated(e.geometryRecords[0]);})),this.elementsToAddOrUpdate.delete(i),!1}return this._processAddition(this.elementsToAddOrUpdate.get(i),t)===E$h.REPACK&&(s=!0,!0)})),s)return void this.runTask(w$C,!1);let r=!1;this.elementsToRender.size>0&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1),n$1m(this.elementsToRender,((t,s)=>(this._processRenderingRequest(t),this.elementsToRender.delete(s),r=!0,e.madeProgress(),e.done))),r&&r$W(this._glTexture)&&this._glTexture.setData(this.canvas),this.updating=this.elementsToRender.size>0,!this.updating&&e$B.orderedRepackingEnabled&&this.repackOrdered();}addTextTexture(e,t){const s=e.key;this.elementsToAddOrUpdate.has(s)||this.elementsToAddOrUpdate.set(s,{textId:s,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:e,rendered:!1}),this._addStageObject(s,t),this.elementsToRemove.delete(s),this.setDirty();}removeTextTexture(e,t){const s=e.key;this.elementsToRemove.set(s,this.elements.get(s)),this._removeStageObject(s,t);}setDirty(){this._glTexture&&(this.updating=!0);}repackOrdered(){if(0===this.elements.size)return;const e=[];this.elements.forEach(((t,s)=>e.push({element:t,key:s})));let t=!0;for(let s=0;s<e.length-1;s++)if(e[s].key.localeCompare(e[s+1].key)>0){t=!1;break}if(!t||this.elementsToRemove.size){e.sort(((e,t)=>e.key.localeCompare(t.key))),this.elements.clear();for(const{element:t,key:s}of e)this.elements.set(s,t);this._repack(),this.setDirty();}}get test(){const{elements:e,stageObjects:t,elementsToRemove:s,atlas:i}=this,r=this;return {elements:e,stageObjects:t,elementsToRemove:s,atlas:i,_resizeAtlas:(e,t)=>r._resizeAtlas(e,t),run:(e,t)=>r.runTask(e,t)}}};e$Y([d$R({constructOnly:!0})],b$d.prototype,"view",void 0),e$Y([d$R({type:Boolean})],b$d.prototype,"updating",void 0),b$d=e$Y([n$18("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],b$d);const O$h=2,j$f=2;var E$h;!function(e){e[e.OK=0]="OK",e[e.REPACK=1]="REPACK";}(E$h||(E$h={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const V$9=s$17.getLogger("esri.views.3d.layers.graphics.Labeler");let F$b=class extends y$F{constructor(){super(...arguments),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array;}setup(){this.dispose(),this._handles=new u$U,this._handles.add([l$M((()=>this.view.state?.camera),(()=>this.setDirty())),l$M((()=>this.view.state?.pixelRatio),(()=>this._resetAllLabels())),this.view.resourceController.scheduler.registerTask(L$D.LABELER,this)]),this._textTextureAtlas=new b$d({view:this.view}),this._hudMaterialCollection=new s$p(this.view._stage),this._calloutMaterialCollection=new s$p(this.view._stage);}dispose(){this._handles=l$N(this._handles),this._textTextureAtlas=s$1a(this._textTextureAtlas),this._hudMaterialCollection=s$1a(this._hudMaterialCollection),this._calloutMaterialCollection=s$1a(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear();}_activateLabelingContext(e){e.labels.forEach(((e,t)=>{this._labels.set(t,e),e.graphics3DGraphic.setVisibilityFlag(C$q.USER_SETTING,!0,E$v.LABEL);})),e.active=!0;}_deactivateLabelingContext(e){e.labels.forEach(((e,t)=>{e.graphics3DGraphic.setVisibilityFlag(C$q.USER_SETTING,!1,E$v.LABEL),this.setLabelGraphicVisibility(e.graphics3DGraphic,!1),this._labels.delete(t);})),e.active=!1;}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const s=e.textTextureResources.textRenderers[t._labelIndex];r$W(s)&&this._textTextureAtlas.addTextTexture(s,t.stageObject);}e.rendered=!0;}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const s=e.textTextureResources.textRenderers[t._labelIndex];r$W(s)&&this._textTextureAtlas.removeTextTexture(s,t.stageObject);}e.rendered=!1;}get running(){return this.view.ready&&(this._dirty||this._textTextureAtlas?.updating||this.deconflictor.running)}runTask(e){this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e);}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(M$a(t)){if(!B$c(t)){if(k$c(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),z$7(t)){this._dirty=!0;continue}if(!B$c(t))continue}n$1m(t.labelsToInitialize,((s,l)=>(this._ensureGraphics3DResources(s)&&(this._labels.set(l,s),this.deconflictor.setDirty(),e.madeProgress()),(s.visible&&s.textTextureResources.initialized||!s.visible&&s.hasGraphics3DResources)&&(t.labelsToInitialize.delete(l),e.madeProgress()),e.done)))&&(this._dirty=!0);}this._labelsToRemove.forEach((e=>this._removeLabelTextureFromAtlas(e))),this._labelsToAdd.forEach((e=>this._addLabelTextureToAtlas(e))),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating");}}async _createLabelClassContextAsync(e){const t=e.labelClassAbortController.signal;await e.layer.when(),f$V(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,a=i.layer,r=a.labelingInfo&&a.labelingInfo.filter((e=>!!e.symbol));if(!r||0===r.length)return;const o=new Array(r.length);let n=!1;await n$1o(r,(async(s,a)=>{const r=s.symbol,c=i$n(i.getOrCreateGraphics3DSymbol(r));if(t$V(c))return void V$9.error("Failed to create Graphics3DSymbol for label");await c.load(),f$V(t);let b=null;o$1i(r)&&r.hasVisibleCallout()&&(b=e$E(r,i.symbolCreationContext),await b.load(),f$V(t));const p=await a$1g(p$15(s,e.layer.fieldsIndex,this.view.spatialReference));if(f$V(t),!0===p.ok){const e=await this._createTextRenderParameters(c.symbol);f$V(t),o[a]={labelClass:s,labelFunction:p.value,graphics3DSymbol:c,graphics3DCalloutSymbolLayer:b,calloutSymbolLayerIndex:0,textRenderParameters:e};}else V$9.error(`Label expression failed to evaluate: ${p.error}`),n=!0;})),f$V(t),n||(e.labelClassContexts=o);}async _createLabelClassContext(e){return e.labelClassPromise||(e.labelClassPromise=this._createLabelClassContextAsync(e).catch((t=>{if(g$T(t))throw t;e.labelClassContexts=null;})).then((()=>{e.labelClassAbortController=null,this.notifyChange("updating");})).catch((()=>{})),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.getItemAt(0);return t&&"text"===t.type?a$s.fromSymbol(t,this.view.state.pixelRatio):null}_destroyLabelClassContext(e){for(const s of e.labelClassContexts)--s.graphics3DSymbol.referenced,s.graphics3DSymbol=null;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,t&&t.abort(),e.labelClassContexts=[],e.labelClassPromise=null,this.notifyChange("updating");}_createTextSymbolGraphic(e,t,s,l,i){const a={text:e.text,centerOffset:s.centerOffset,translation:s.translation,elevationOffset:s.elevationOffset,screenOffset:s.screenOffset,centerOffsetUnits:s.centerOffsetUnits,horizontalPlacement:n$A(s.anchor),verticalPlacement:s$w(s.anchor),verticalOffset:s.verticalOffset,debugDrawLabelBorder:t$E.LABELS_SHOW_BORDER,displayWidth:e.displayWidth,displayHeight:e.displayHeight};return N$f.graphic=t,N$f.renderingInfo=null,N$f.layer=l,i.createLabel(N$f,a,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,s,l,i){const a={symbol:t,translation:l.translation,elevationOffset:l.elevationOffset,screenOffset:l.screenOffset,centerOffset:l.centerOffset,centerOffsetUnits:l.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};return N$f.graphic=e,N$f.renderingInfo=a,N$f.layer=i,s.createGraphics3DGraphic(N$f)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return !1;const t=e.graphics3DGraphic;if(t.destroyed)return !1;this._ensureTextTextureResources(e);const{textTextureResources:s}=e,l=e.labelingContext,i=l.labelClassContexts;if(!i||0===i.length||!l.emptySymbolLabelSupported&&0===t.graphics.length)return !1;let a=!1;const r=t.graphic,o=l.layer,n=s$1s(l.layer),b=this.view._stage;for(let d=0;d<i.length;d++){const e=s.textRenderers[d],p=s.labelPlacements[d];if(t$V(e)||t$V(p))continue;const u=i[d],g=u.graphics3DSymbol,y=g.symbol&&"label-3d"===g.symbol.type?g.symbol:null,f=g.symbolLayers[0];if(!f)continue;f.setElevationInfoOverride(l.elevationInfoOverride);const m=this._createTextSymbolGraphic(e,r,p,o,f);if(!m)return !1;m._labelClass=u.labelClass,m._labelIndex=d,t.addLabelGraphic(m,b,l.stageLayer),t.setVisibilityFlag(C$q.USER_SETTING,n,E$v.LABEL),t.clearVisibilityFlag(C$q.SCALE_RANGE,E$v.LABEL),t.setVisibilityFlag(C$q.DECONFLICTION,!1,E$v.LABEL),a=!0;const _=u.graphics3DCalloutSymbolLayer;if(_&&p.hasLabelVerticalOffset){_.setElevationInfoOverride(l.elevationInfoOverride);const e=this._createLineCalloutGraphic(r,y,_,p,o);r$W(e)&&(u.calloutSymbolLayerIndex=t.labelGraphics.length,t.addLabelGraphic(e,b,l.stageLayer));}break}return l.scaleVisibility&&a&&l.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const s of e.graphics3DGraphic.labelGraphics){if(null==s._labelClass)continue;const e=t[s._labelIndex].graphics3DSymbol.symbolLayers[0];null!=e&&e.onRemoveGraphic(s);}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1;}_ensureTextTextureResources(e){const{textTextureResources:t}=e;if(t.initialized)return;const s=e.labelingContext,l=s.labelClassContexts;if(!l||0===l.length)return;const i=e.graphics3DGraphic.graphic;for(let r=0;r<l.length;r++){const o=l[r];if(t.textRenderers[r]=null,t.labelPlacements[r]=null,!o.textRenderParameters)continue;const n=o.labelFunction;let c;if("arcade"===n.type)try{const e=n.needsHydrationToEvaluate()?c$D(i,s.layer):i;c=n.evaluate(e);}catch(a){c=null;}else c=n.evaluate(i);if(t$V(c)||""===c||/^\s+$/.test(c))continue;const b=o.graphics3DSymbol,d=b.symbol&&"label-3d"===b.symbol.type?b.symbol:null;if(!b.symbolLayers[0])continue;const p=e.graphics3DGraphic,u=o.labelClass,g=s.disablePlacement,y=g$k({graphics3DGraphic:p,labelSymbol:d,labelClass:u,disablePlacement:g});if(t$V(y))continue;const m=n$A(y.anchor),_=c$r(m);t.textRenderers[r]=new s$x(c,_,o.textRenderParameters),t.labelPlacements[r]=y;}t.initialized=!0;}_destroyTextTextureResources(e){const{textTextureResources:t}=e;t.initialized=!1,t.textRenderers=[],t.labelPlacements=[];}_addGraphic(e,t){const s={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:e,graphics3DGraphic:t,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}},l=t.graphic.uid;e.labels.set(l,s),e.labelsToInitialize.set(l,s),this.setDirty(),this.deconflictor.setDirty();}_removeGraphic(e,t){const s=t.graphic.uid,l=e.labels.get(s);l&&(this._destroyGraphic(l,s),e.labels.delete(s),e.labelsToInitialize.delete(s),this.setDirty(),this.deconflictor.setDirty());}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e);}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const s of t){const t=e.labels.get(s);t&&(this._removeGraphic(e,t.graphics3DGraphic),this._addGraphic(e,t.graphics3DGraphic));}}_globalPropertyChanged(e,t){for(const s of t.labelClassContexts){const l=new Map;t.labels.forEach((e=>{const t=e.graphics3DGraphic;l.set(t.graphic.uid,t);}));const i=e=>e.labelGraphics[0];if(e$X(s.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(e,l,i),s.graphics3DCalloutSymbolLayer){const t=e=>e.labelGraphics[s.calloutSymbolLayerIndex];s.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,l,t);}}}_visibilityInfoChange(e){const t=e.layer.labelsVisible;t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty();}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e);}_resetLabels(e){e.labels.forEach(((t,s)=>{this._destroyGraphic(t,s),t.visible=!1,t.rendered=!1,e.labelsToInitialize.set(s,t);})),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty();}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,s){const l=s&&s.emptySymbolLabelSupported||!1,i=s&&s.elevationInfoOverride||null,a=s&&s.disablePlacement||null;if(this._findLabelingContext(e))return;const r=e.layer,o={graphics3DCore:e,layer:r,scaleVisibility:t,emptySymbolLabelSupported:l,elevationInfoOverride:i,disablePlacement:a,active:r.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new l$t({isPickable:!0},r.uid)};return this.view._stage.add(o.stageLayer),this._labelingContexts.push(o),this.setDirty(),{addGraphic:e=>this._addGraphic(o,e),removeGraphic:e=>this._removeGraphic(o,e),featureReductionChange:()=>{},layerLabelsEnabled:()=>s$1s(o.layer),labelingInfoChange:e=>this._labelingInfoChange(o,e),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",o),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",o),visibilityInfoChange:()=>this._visibilityInfoChange(o),reset:()=>this._resetLabels(o),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const s=this._labelingContexts.indexOf(t);this._labelingContexts.splice(s,1),t.labels.forEach((e=>this._removeGraphic(t,e.graphics3DGraphic))),this.view._stage.remove(t.stageLayer),t.stageLayer=null,this.setDirty();}setLabelGraphicVisibility(e,t){const s=e.graphic.uid,l=this._labels.get(s);l&&l.visible!==t&&(t&&!l.rendered?(this._labelsToAdd.set(s,l),this._labelsToRemove.delete(s),l.textTextureResources.initialized||l.labelingContext.labelsToInitialize.set(s,l)):!t&&l.rendered&&(this._labelsToRemove.set(s,l),this._labelsToAdd.delete(s)),l.visible=t,this.setDirty());}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"));}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some((e=>z$7(e)))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce(((e,t)=>e+(z$7(t)?0:1)),0)/this._labelingContexts.length:1;return (this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return {textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function M$a(e){return e.active&&s$1s(e.layer)}function z$7(e){return e.labelClassPromise&&!!e.labelClassAbortController}function B$c(e){return e.labelClassContexts&&e.labelClassContexts.length}function k$c(e){return null===e.labelClassContexts}e$Y([d$R({constructOnly:!0})],F$b.prototype,"view",void 0),e$Y([d$R({constructOnly:!0})],F$b.prototype,"deconflictor",void 0),e$Y([d$R()],F$b.prototype,"_textTextureAtlas",void 0),e$Y([d$R({type:Boolean,readOnly:!0})],F$b.prototype,"updating",null),F$b=e$Y([n$18("esri.views.3d.layers.graphics.Labeler")],F$b);const N$f=new r$F(null,null,null);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class c$n{constructor(){this.gltfCache=new Map,this.wosrCache=new Map,this.evictHandles=new u$U;}loadGLTF(e,t,r){const o=r?`gltfPBR:${e}`:`gltf:${e}`;return this._fromCache(this.gltfCache,o,(t=>c$1m(new n$1w(t.streamDataRequester),e,t,r)),t)}loadWOSR(e,t){const r=`wosr:${e}:${t.disableTextures}`;return this._fromCache(this.wosrCache,r,(t=>w$E(e,t)),t)}destroy(){this.evictHandles.destroy(),this.gltfCache.clear(),this.wosrCache.clear();}get size(){return this.wosrCache.size+this.gltfCache.size}_fromCache(e,t,a,n){return new Promise(((l,c)=>{if(p$V(n))return void c(m$L());const m=v$X(n,(()=>{this._remove(e,t),c(m$L());})),h=e.get(t);if(h)return this.evictHandles.remove(t),h.refCount++,void h.item.then(l,c);const f=new AbortController,d={...n,signal:f.signal},C={refCount:1,abortController:f,item:a(d).then((r=>(C.abortController=null,r.remove=()=>this._remove(e,t),r)))};e.set(t,C),C.item.then((e=>{r$W(m)&&m.remove(),l(e);}),(e=>{r$W(m)&&m.remove(),c(e);}));}))}_remove(e,o){const s=e.get(o);s&&(s.refCount--,0===s.refCount&&this.evictHandles.add(u$1a((()=>{e.delete(o),r$W(s.abortController)&&s.abortController.abort();}),h$k),o));}}const m$k=1e4;let h$k=m$k;const f$g={overrideEvictDelay:e=>(h$k=e,{remove(){h$k=m$k;}})};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class t$m{constructor(e,t,h,r=null){this.lij=[0,0,0],this.extent=u$T(),this.resolution=0,this.loadPriority=0,this.measures={visibility:s$o.VISIBLE_ON_SURFACE,screenRect:u$T(),distance:0,shouldSplit:!1},this.used=!1,r&&this.acquire(e,t,h,r);}acquire(i,e,s,h){this.tilingScheme=h,this.id=t$m.id(i,e,s),this.lij[0]=i,this.lij[1]=e,this.lij[2]=s,h.getExtent(i,e,s,this.extent),this.resolution=h.resolutionAtLevel(i);}release(){this.tilingScheme=null;}getChildren(i){const e=this.lij[0]+1,s=2*this.lij[1],h=2*this.lij[2];return i?(i[0].acquire(e,s,h,this.tilingScheme),i[1].acquire(e,s+1,h,this.tilingScheme),i[2].acquire(e,s,h+1,this.tilingScheme),i[3].acquire(e,s+1,h+1,this.tilingScheme),i):[new t$m(e,s,h,this.tilingScheme),new t$m(e,s+1,h,this.tilingScheme),new t$m(e,s,h+1,this.tilingScheme),new t$m(e,s+1,h+1,this.tilingScheme)]}copyMeasurementsFrom(i){this.measures.visibility=i.measures.visibility,this.measures.shouldSplit=i.measures.shouldSplit,this.measures.distance=i.measures.distance,a$1e(i.measures.screenRect,this.measures.screenRect);}static id(i,e,t){return `${i}/${e}/${t}`}}var s$o;!function(i){i[i.INVISIBLE=0]="INVISIBLE",i[i.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",i[i.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE";}(s$o||(s$o={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class d$i{constructor(t){this.renderCoordsHelper=t,this.frustum=H$o(),this._points=I$A(),this.lines=new Array(12),this._origin=n$16(),this._direction=n$16(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:n$16(),endpoint:null};}get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}update(i){s$1f(i.viewMatrix,i.projectionMatrix,this.frustum,this._points),r$V(this._origin,i.eye),r$V(this._direction,i.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines();}updatePoints(i){for(let s=0;s<this._points.length;s++)r$V(this._points[s],i[s]);L$J(this.frustum,this._points),this._updateLines();}get altitude(){return this._altitude}intersectsSphere(t){return P$z(this.frustum,t)}intersectsRay(t){return a$1j(this.frustum,t)}intersectsLineSegment(t,i){return p$16(this.frustum,t,i)}intersectsPoint(t){return U$x(this.frustum,t)}_updateLines(){const t=this._points;for(let i=0;i<4;i++){const s=i+4;a$r(this.lines[i],t[i],t[s]),a$r(this.lines[i+4],t[i],3===i?t[0]:t[i+1]),a$r(this.lines[i+8],t[s],3===i?t[4]:t[s+1]);}}}function a$r(t,s,e){t.origin=s,t.endpoint=e,H$n(t.direction,s,e);}d$i.planePointIndices=h$15,d$i.nearFarLineIndices=[[v$Y.NEAR_BOTTOM_LEFT,v$Y.FAR_BOTTOM_LEFT],[v$Y.NEAR_BOTTOM_RIGHT,v$Y.FAR_BOTTOM_RIGHT],[v$Y.NEAR_TOP_RIGHT,v$Y.FAR_TOP_RIGHT],[v$Y.NEAR_TOP_LEFT,v$Y.FAR_TOP_LEFT]];

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const F$a=.5*Math.PI,N$e=F$a/Math.PI*180;class _$e{constructor(t){this.renderCoordsHelper=t.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:n$16(),direction:n$16()};for(let e=0;e<4;e++)this.extent[e]={origin:n$16(),direction:n$16(),cap:{next:null,direction:n$16()}},this.planes[e]=p$Y();this.planes[k$C.NEAR]=p$Y(),this.planes[k$C.FAR]=p$Y(),this.planesWithoutFar=this.planes.slice(0,5);}update(t,e,i,r=!0){const a=this.extent;this._toRenderBoundingExtent(t,e,i),u$W(this.center.origin,a[0].origin,a[2].origin),q$p(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),r||q$p(this.center.direction,this.center.direction,-1);for(let n=0;n<4;n++){const t=a[n];this.renderCoordsHelper.worldUpAtPosition(t.origin,t.direction);const e=a[3===n?0:n+1];t.cap.next=e.origin,H$n(t.cap.direction,t.origin,e.origin),O$O(t.direction,t.cap.direction,t.origin,this.planes[n]),r||q$p(t.direction,t.direction,-1);}O$O(a[0].cap.direction,a[1].cap.direction,a[0].origin,this.planes[k$C.NEAR]),r?P$x(this.planes[k$C.NEAR],this.planes[k$C.FAR]):(A$K(this.planes[k$C.FAR],this.planes[k$C.NEAR]),P$x(this.planes[k$C.NEAR],this.planes[k$C.NEAR])),this.maxSpan=Math.max(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3])),this.maxSpanSpatialReference=e,this.minGlobalAltitude=.9*p$T(this.maxSpanSpatialReference).radius;}isVisibleInFrustum(t,e,i=!1){if(null==t)return !1;if(this.renderCoordsHelper.viewingMode===l$O.Global){const i=this.maxSpanSpatialReference.isGeographic?N$e:F$a*e;if(this.maxSpan>i)return !0;if(t.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(t)}if(0===this.maxSpan){const e=this.extent[0];return !(i||!t.intersectsRay(j$G(e.origin,e.direction)))}for(let n=0;n<this.extent.length;n++){const e=this.extent[n];if(!i&&t.intersectsRay(j$G(e.origin,e.direction)))return !0;if(t.intersectsLineSegment(l$15(e.origin,e.cap.next,V$8),e.cap.direction))return !0}const r=i?this.planes:this.planesWithoutFar;for(let n=0;n<t.lines.length;n++){const e=t.lines[n];if(h$J(r,e.origin,e.endpoint,e.direction))return !0}return !1}_toRenderBoundingExtentGlobal(t,r,n){const o=5;p$17(t,v$g),v$g[2]=n,qn(r,v$g,I$e,this.renderCoordsHelper.spatialReference),h$U(U$b,I$e),B$t(L$d);for(const{x0:i,x1:s,y0:c,y1:p}of k$b)for(let l=0;l<o;l++){const h=l/(o-1);v$g[0]=s$1c(t[i],t[s],h),v$g[1]=s$1c(t[c],t[p],h),v$g[2]=n,Bn(v$g,r,v$g,this.renderCoordsHelper.spatialReference),L$E(v$g,v$g,U$b),h$12(L$d,v$g);}o$W(this.extent[0].origin,L$d[0],L$d[1],L$d[2]),o$W(this.extent[1].origin,L$d[3],L$d[1],L$d[2]),o$W(this.extent[2].origin,L$d[3],L$d[4],L$d[2]),o$W(this.extent[3].origin,L$d[0],L$d[4],L$d[2]);for(let e=0;e<4;++e)L$E(this.extent[e].origin,this.extent[e].origin,I$e);}_toRenderBoundingExtentLocal(t,e,i){zn(t,e,P$a,this.renderCoordsHelper.spatialReference),o$W(this.extent[0].origin,P$a[0],P$a[1],i),o$W(this.extent[1].origin,P$a[2],P$a[1],i),o$W(this.extent[2].origin,P$a[2],P$a[3],i),o$W(this.extent[3].origin,P$a[0],P$a[3],i);}_toRenderBoundingExtent(e,i,r){switch(this.renderCoordsHelper.viewingMode){case l$O.Global:this._toRenderBoundingExtentGlobal(e,i,r);break;case l$O.Local:this._toRenderBoundingExtentLocal(e,i,r);break;default:n$1i(this.renderCoordsHelper.viewingMode);}}_isVisibleInFrustumGlobal(t){if(W$i(t.planes[k$C.NEAR],this.center.origin)<0&&P$u(this.center.direction,t.direction)<0)return !0;for(let e=0;e<4;e++){const i=this.extent[e];if(W$i(t.planes[k$C.NEAR],i.origin)<0&&P$u(i.direction,t.direction)<0)return !0}return !1}}const k$b=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],v$g=n$16(),I$e=e$10(),U$b=e$10(),L$d=a$1d(),P$a=u$T(),V$8=v$T();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class A$d{constructor(e){this.renderCoordsHelper=e,this.surfaceElevation=0,this.cache=new Map,this.frustum=new d$i(e),this.extendedFrustum=new d$i(e),this.intersector=new _$e({renderCoordsHelper:e}),this.renderCoordsHelper=e;}begin(e,t){this.surfaceElevation=t,this.aboveGround=this.renderCoordsHelper.getAltitude(e.eye)>t,this.frustum.update(e),this._shortenFrustumFarPlane(this.frustum),this._updateExtendedFrustum(e);}end(){this.cache.clear();}calculate(e){if(this.allTilesInvisible)return s$o.INVISIBLE;const t=this.renderCoordsHelper.viewingMode===l$O.Global&&e.lij[0]>=R$a&&e.lij[0]<O$g,i=this._getOrCalculateSingleTileVisibility(e,!t);return i!==s$o.INVISIBLE&&t?this._calculateAggregatedChildrenVisibility(e):i}_shortenFrustumFarPlane(e){const t=d$i.nearFarLineIndices,n=e.mutablePoints;for(const o of t){const[e,t]=o,a=n[e],u=n[t];e$15(S$a,u,a),q$p(S$a,S$a,b$c),u$W(n[t],a,S$a);}e.updatePoints(n);}_calculateAggregatedChildrenVisibility(e){let t=s$o.INVISIBLE;const i=this.cache.get(e.id);if(null!=i)return i;const s=H$7.acquire();e.getChildren(s);for(const r of s){const e=this.calculate(r);if(e!==s$o.INVISIBLE&&(t=e,e===s$o.VISIBLE_ON_SURFACE))break}return H$7.release(s),this.cache.set(e.id,t),t}_getOrCalculateSingleTileVisibility(e,t){const i=this.cache.get(e.id);if(null!=i)return i;const s=this._calculateSingleTileVisibility(e);return t&&this.cache.set(e.id,s),s}_calculateSingleTileVisibility(e){if(!this.aboveGround&&this.renderCoordsHelper.viewingMode===l$O.Global&&e.lij[0]<g$j){return this._calculateSingleTileVisibilitySided(e,!1)===s$o.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0}return this._calculateSingleTileVisibilitySided(e,this.aboveGround)}_calculateSingleTileVisibilitySided(e,t){this.intersector.update(e.extent,e.tilingScheme.spatialReference,this.surfaceElevation,t);const i=p$T(e.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,i)?this.intersector.isVisibleInFrustum(this.frustum,i,!0)?s$o.VISIBLE_ON_SURFACE:s$o.VISIBLE_WHEN_EXTENDED:s$o.INVISIBLE}_updateExtendedFrustum(t){this.extendedFrustum.update(t),this._shortenFrustumFarPlane(this.extendedFrustum);const i=this.renderCoordsHelper.worldUpAtPosition(t.eye,S$a);this.aboveGround||j$I(i,i);const r=l$U(-P$u(i,t.viewForward));if(this.allTilesInvisible=r>(Math.PI+t.fovY)/2,this.allTilesInvisible)return;if(this.hasExtendedFrustum=r>t.fovY/2,!this.hasExtendedFrustum)return;const a=this._extendedFrustumParameters(),u=this.extendedFrustum.mutablePoints;for(let e=0;e<4;e++){const t=a.pointIndices[e],i=u[t],r=this.renderCoordsHelper.getAltitude(i);if(a.needsAltitudeAdjustment(r)){switch(this.renderCoordsHelper.worldUpAtPosition(i,S$a),t){case v$Y.FAR_BOTTOM_LEFT:case v$Y.FAR_TOP_LEFT:case v$Y.NEAR_BOTTOM_LEFT:case v$Y.NEAR_TOP_LEFT:Q$l(this.extendedFrustum.planes[k$C.LEFT],S$a,S$a);break;case v$Y.FAR_BOTTOM_RIGHT:case v$Y.FAR_TOP_RIGHT:case v$Y.NEAR_BOTTOM_RIGHT:case v$Y.NEAR_TOP_RIGHT:Q$l(this.extendedFrustum.planes[k$C.RIGHT],S$a,S$a);}q$p(S$a,S$a,a.direction),this.renderCoordsHelper.intersectInfiniteManifold(j$G(i,S$a),a.zWithMargin,i);}}if(this.extendedFrustum.updatePoints(u),j$J(u[v$Y.NEAR_BOTTOM_LEFT],u[v$Y.NEAR_BOTTOM_RIGHT],u[v$Y.NEAR_TOP_RIGHT],N$d),j$J(u[v$Y.NEAR_BOTTOM_RIGHT],u[v$Y.NEAR_TOP_RIGHT],u[v$Y.NEAR_TOP_LEFT],v$f),P$u(Z$g(N$d),Z$g(v$f))<0){const e=this.extendedFrustum.mutablePoints;this.aboveGround?[e[v$Y.NEAR_BOTTOM_LEFT],e[v$Y.NEAR_BOTTOM_RIGHT]]=[e[v$Y.NEAR_BOTTOM_RIGHT],e[v$Y.NEAR_BOTTOM_LEFT]]:[e[v$Y.NEAR_TOP_LEFT],e[v$Y.NEAR_TOP_RIGHT]]=[e[v$Y.NEAR_TOP_RIGHT],e[v$Y.NEAR_TOP_LEFT]],this.extendedFrustum.updatePoints(e);}}_extendedFrustumParameters(){return this.aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this.surfaceElevation-P$9;return {zWithMargin:e,pointIndices:d$i.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:t=>t>e}}_extendedFrustumParametersBelowSurface(){const e=this.surfaceElevation+P$9;return {zWithMargin:e,pointIndices:d$i.planePointIndices.top,direction:1,needsAltitudeAdjustment:t=>t<e}}}const R$a=2,O$g=6,g$j=12,b$c=.95,P$9=1,S$a=n$16(),N$d=p$Y(),v$f=p$Y(),H$7=new e$1f(Array,(e=>{4!==e.length&&(e[0]=new t$m,e[1]=new t$m,e[2]=new t$m,e[3]=new t$m);}),(e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release();}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class j$e{constructor(e){this.camera=new K$h,this.focusOnMap=[0,0],this.screenRect=u$T(),this.tileSize=e.tileSize,this.renderCoordsHelper=e.renderCoordsHelper,this.tilingScheme=e.tilingScheme,this.visibility=new A$d(e.renderCoordsHelper);}begin(e,t,i){this.camera.copyFrom(e),this.surfaceElevation=i,this.focusOnMap[0]=t.x,this.focusOnMap[1]=t.y,o$1r(0,0,e.fullWidth,e.fullHeight,this.screenRect),this.visibility.begin(this.camera,i);}end(){this.visibility.end();}updateTile(e){e.measures.visibility=this.visibility.calculate(e),e.measures.distance=d$13(e.extent,this.focusOnMap),e.measures.visibility!==s$o.INVISIBLE&&this._updateScreenMeasure(e);}_updateScreenMeasure(e){const t=T$g,i=1<<t,r=e.measures.screenRect;D$s(r);let s=0;const o=e.lij[0]+t,n=e.lij[1]<<t,a=e.lij[2]<<t,l=this._tileSizeWithBias(e),h=l*l;for(let c=0;c<i;c++)for(let t=0;t<i;t++)if(s+=this._computeScreenArea(e,o,n+c,a+t,r),s>h)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1;}_tileSizeWithBias(e){return e.measures.visibility===s$o.VISIBLE_WHEN_EXTENDED?this.tileSize*y$h:this.tileSize}_computeScreenArea(e,t,i,r,s){const o=e.measures.visibility===s$o.VISIBLE_WHEN_EXTENDED;this._projectToScreen(t,i,r,o,E$g),D$s(g$i);for(let n=0;n<4;n++)m$Y(g$i,E$g[n]);return h$_(s,g$i,s),S$I(E$g[0],E$g[1],E$g[2])+S$I(E$g[0],E$g[2],E$g[3])}_projectToScreen(e,t,i,r,s){this.tilingScheme.ensureMaxLod(e),this.tilingScheme.getExtent(e,t,i,b$b),this._toRenderCoords(b$b,0,3,R$9[0]),this._toRenderCoords(b$b,2,3,R$9[1]),this._toRenderCoords(b$b,2,1,R$9[2]),this._toRenderCoords(b$b,0,1,R$9[3]),r&&(this._projectToPlane(R$9,this.camera.frustum[k$C.NEAR]),this._projectToPlane(R$9,this.camera.frustum[k$C.TOP]),this._projectToPlane(R$9,this.camera.frustum[k$C.BOTTOM]));for(let o=0;o<4;o++)this.camera.projectToRenderScreen(R$9[o],M$9),this.camera.renderToScreen(M$9,s[o]);}_projectToPlane(e,t){for(let i=0;i<4;i++)C$d[i]=W$i(t,e[i]);const s=Math.max(C$d[0],C$d[1],C$d[2],C$d[3]);if(s>0){const o=q$p(v$e,Z$g(t),-s);for(let t=0;t<4;t++)u$W(e[t],e[t],o);}}_toRenderCoords(e,t,i,r){return v$e[0]=e[t],v$e[1]=e[i],v$e[2]=this.surfaceElevation,this.renderCoordsHelper.toRenderCoords(v$e,this.tilingScheme.spatialReference,r),r}}const g$i=u$T(),T$g=2,y$h=5,E$g=[i$12(),i$12(),i$12(),i$12()],b$b=u$T(),v$e=n$16(),R$9=[n$16(),n$16(),n$16(),n$16()],C$d=[0,0,0,0],M$9=x$J();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function x$d(l,x,e){if(t$V(l)||t$V(e))return !1;let u=!0;return i$m[0]=null!=l.xmin?l.xmin:0,i$m[1]=null!=l.ymin?l.ymin:0,i$m[2]=null!=l.zmin?l.zmin:0,u=u&&Un(i$m,l.spatialReference,0,x,e,0,1),i$m[0]=null!=l.xmax?l.xmax:0,i$m[1]=null!=l.ymax?l.ymax:0,i$m[2]=null!=l.zmax?l.zmax:0,u=u&&Un(i$m,l.spatialReference,0,x,e,3,1),null==l.xmin&&(x[0]=-1/0),null==l.ymin&&(x[1]=-1/0),null==l.zmin&&(x[2]=-1/0),null==l.xmax&&(x[3]=1/0),null==l.ymax&&(x[4]=1/0),null==l.zmax&&(x[5]=1/0),u}function e$q(l,x,e){if(t$V(l)||t$V(e))return !1;let u=!0;return i$m[0]=null!=l.xmin?l.xmin:0,i$m[1]=null!=l.ymin?l.ymin:0,i$m[2]=null!=l.zmin?l.zmin:0,u=u&&Un(i$m,l.spatialReference,0,i$m,e,0,1),x[0]=i$m[0],x[1]=i$m[1],i$m[0]=null!=l.xmax?l.xmax:0,i$m[1]=null!=l.ymax?l.ymax:0,i$m[2]=null!=l.zmax?l.zmax:0,u=u&&Un(i$m,l.spatialReference,0,i$m,e,0,1),x[2]=i$m[0],x[3]=i$m[1],null==l.xmin&&(x[0]=-1/0),null==l.ymin&&(x[1]=-1/0),null==l.xmax&&(x[2]=1/0),null==l.ymax&&(x[3]=1/0),u}const i$m=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const C$c=s$17.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");let j$d=class extends y$F{constructor(e){super(e),this.tiles=new j$F,this.tileSize=512,this._idToTile=new Map,this._handles=new u$U,this._clients=new Set,this._dirty=!1,this._newTiles=new n$1l;}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;if(!e)return null;return e.clone()}set filterExtent(e){if(r$W(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void C$c.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||r$W(t)&&e&&t.equals(e))return;const i=r$W(e)?e.clone():null;this._set("filterExtent",i),this._setDirty();}get filterExtentRect(){if(t$V(this.filterExtent)||!this.tilingScheme)return null;const e=u$T();return e$q(this.filterExtent,e,this.tilingScheme.spatialReference),e}get rootTileIds(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty());}get updating(){return this._dirty||!!this._pendingTiles}initialize(){this._handles.add([l$M((()=>[this.tilingScheme,this.tileSize]),(()=>this._reset()),U$s),l$M((()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,this.focus?.location]),(()=>this._setDirty()),w$x)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(L$D.FEATURE_TILE_TREE,this));}destroy(){this._frameWorker=a$W(this._frameWorker),this._handles=l$N(this._handles);}addClient(){const e=I$d();return this._clients.add(e),1===this._clients.size&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear();}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(w$C));}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating");}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),r$W(this._frameWorker)&&(this._frameWorker.priority=L$D.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&r$W(this._frameWorker)&&(this._frameWorker.priority=L$D.FEATURE_TILE_TREE),this.notifyChange("updating");}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new j$e({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles();}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty();}_getRootTiles(){return this.rootTileIds.map((e=>new t$m(e[0],e[1],e[2],this.tilingScheme)))}_purgeHorizonTiles(e){e.sort(((e,t)=>{const i=e.measures.screenRect,s=t.measures.screenRect;return i[1]+i[3]-(s[1]+s[3])})),D$s(k$a);for(let t=0;t<e.length;t++)if(h$_(k$a,e.data[t].measures.screenRect,k$a),l$Y(k$a)>z$6)return e.data.slice(t,e.length);return []}_subdivideTilesForView(e){if(this._pendingTiles){for(;this._pendingTiles.length>0&&!e.done;){const t=this._pendingTiles.pop();e.madeProgress(),this.filterExtentRect&&!E$L(this.filterExtentRect,t.extent)||(this._tileMeasurements.updateTile(t),t.measures.visibility!==s$o.INVISIBLE&&(t.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(t.lij[0]+1),this._pendingTiles.push(...t.getChildren())):this._newTiles.push(t)));}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null);}}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const t=e.filter((e=>{const t=this._idToTile.get(e.id);return t?(t.copyMeasurementsFrom(e),t.used=!0):this._idToTile.set(e.id,e),!t})),i=this.tiles.items.filter((e=>!e.used&&(this._idToTile.delete(e.id),!0)));this.tiles.removeMany(i),this.tiles.addMany(t),this._sortTiles();}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort(((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===s$o.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance)),this.tiles.forEach(((e,t)=>e.loadPriority=t));}};e$Y([d$R({constructOnly:!0})],j$d.prototype,"scheduler",void 0),e$Y([d$R({constructOnly:!0})],j$d.prototype,"renderCoordsHelper",void 0),e$Y([d$R({constructOnly:!0})],j$d.prototype,"tilingSchemeOwner",void 0),e$Y([d$R({constructOnly:!0})],j$d.prototype,"cameraOnSurface",void 0),e$Y([d$R({constructOnly:!0})],j$d.prototype,"focus",void 0),e$Y([d$R({constructOnly:!0})],j$d.prototype,"viewState",void 0),e$Y([d$R({constructOnly:!0})],j$d.prototype,"terrain",void 0),e$Y([d$R()],j$d.prototype,"tiles",void 0),e$Y([d$R()],j$d.prototype,"tileSize",void 0),e$Y([d$R({readOnly:!0})],j$d.prototype,"tilingScheme",null),e$Y([d$R()],j$d.prototype,"filterExtent",null),e$Y([d$R({readOnly:!0})],j$d.prototype,"filterExtentRect",null),e$Y([d$R({readOnly:!0})],j$d.prototype,"rootTileIds",null),e$Y([d$R({value:!1})],j$d.prototype,"suspended",null),e$Y([d$R({readOnly:!0})],j$d.prototype,"updating",null),j$d=e$Y([n$18("esri.views.3d.layers.support.FeatureTileTree3D")],j$d);let O$f=0;function I$d(){return O$f++}const k$a=u$T(),z$6=10;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let w$e=class extends y$F{constructor(){super(...arguments),this._propertiesPool=new o$1s({camera:K$h},this),this._lastSeenCameraProjectionValues=new K$h,this.events=new n$17,this.viewingMode=l$O.Global,this._cameraChanged=!1,this.updateQueue=new Array,this.processingUpdates=!1;}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new p$R({mode:this.viewingMode}));}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new o$1s({camera:K$h},this);}createInitialCamera(){if(this.viewingMode===l$O.Global){const e=p$T(this.spatialReference).radius;this.camera=new K$h(r$X(4*e,0,0),r$X(e,0,0),r$X(0,0,1));}else this.camera=new K$h(r$X(0,0,100),r$X(0,0,0),r$X(0,1,0));}get animation(){return this.cameraController instanceof a$M&&r$W(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==v$d&&v$d.copyFrom(e),v$d.computeUp(this.viewingMode),j$c.camera=v$d,this.events.emit("before-camera-change",j$c);const t=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,v$d)&&(this._lastSeenCameraProjectionValues.copyFrom(v$d),O$e.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",O$e)),(!t||!t.equals(v$d))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(v$d)),this._cameraChanged=!t||!t.almostEquals(v$d),this._cameraChanged)){const e=U$y((()=>{this._cameraChanged=!1,e.remove();}));}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return r$W(this._contentCamera)?this._contentCamera:this.camera}set contentCamera(e){this._contentCamera=r$W(e)?e.clone():null;}get fixedContentCamera(){return r$W(this._contentCamera)}get isGlobal(){return this.viewingMode===l$O.Global}get isLocal(){return this.viewingMode===l$O.Local}get navigating(){return !(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return !this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.own(l$M((()=>e.state),(t=>{t!==o$F.Finished&&t!==o$F.Stopped||(this._set("cameraController",null),this.updateCamera((t=>e.onControllerEnd(t))));}),U$s)),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=o$F.Rejected);}switchCameraController(e){return this.cameraController=e,e.state!==o$F.Rejected}stopActiveCameraController(){return !(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this.updateQueue.push(e),this._processUpdateQueue();}_processUpdateQueue(){if(0===this.updateQueue.length||this.processingUpdates)return;this.processingUpdates=!0;const e=this.updateQueue.shift();v$d.copyFrom(this._get("camera")),e(v$d),this.camera=v$d,this.processingUpdates=!1,this._processUpdateQueue();}_cameraProjectionChanged(e,t){return e.fov!==t.fov||(e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||(e.padding[et$6.TOP]!==t.padding[et$6.TOP]||e.padding[et$6.RIGHT]!==t.padding[et$6.RIGHT]||e.padding[et$6.BOTTOM]!==t.padding[et$6.BOTTOM]||e.padding[et$6.LEFT]!==t.padding[et$6.LEFT]))}};e$Y([d$R({readOnly:!0,type:n$1j})],w$e.prototype,"animation",null),e$Y([d$R({type:K$h})],w$e.prototype,"camera",null),e$Y([d$R()],w$e.prototype,"pixelRatio",null),e$Y([d$R({})],w$e.prototype,"_contentCamera",void 0),e$Y([d$R({type:K$h})],w$e.prototype,"contentCamera",null),e$Y([d$R({readOnly:!0})],w$e.prototype,"fixedContentCamera",null),e$Y([d$R({readOnly:!0})],w$e.prototype,"constraints",void 0),e$Y([d$R({readOnly:!0})],w$e.prototype,"events",void 0),e$Y([d$R({readOnly:!0})],w$e.prototype,"isGlobal",null),e$Y([d$R({readOnly:!0})],w$e.prototype,"isLocal",null),e$Y([d$R({readOnly:!0})],w$e.prototype,"viewingMode",void 0),e$Y([d$R({readOnly:!0})],w$e.prototype,"spatialReference",void 0),e$Y([d$R({readOnly:!0})],w$e.prototype,"navigating",null),e$Y([d$R({readOnly:!0})],w$e.prototype,"stationary",null),e$Y([d$R()],w$e.prototype,"_cameraChanged",void 0),e$Y([d$R()],w$e.prototype,"cameraController",null),w$e=e$Y([n$18("esri.views.3d.state.ViewState")],w$e);const _$d=w$e,v$d=new K$h,j$c={camera:null},O$e={camera:null};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function c$m(e,t,i){return e===l$O.Global?new M$8(i):new u$m(t,i)}class u$m{constructor(e,t){this.elevationProvider=e,this._referenceEllipsoid=p$T(t),this.unitInMeters=z$t(t,this._referenceEllipsoid.metersPerDegree);}compute(r,o,m,l,x){x||(x={near:0,far:0});let c=r[2]*this.unitInMeters;const u=c,M=c-l,d=this.elevationProvider?this.elevationProvider.elevationBounds:null;d&&(c=M>=0?u-this.unitInMeters*d.min:this.unitInMeters*d.max-u);const E={x:(m=r$W(m)?m:new M$u({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-m.xmin,y:m.ymax-m.ymin,z:4*Math.max(m.xmax-m.xmin,m.ymax-m.ymin)},b=Math.max(E.x,E.y,E.z);e$15(I$c,o,r),v$c[0]=I$c[0]>0?m.xmax:m.xmin,v$c[1]=I$c[1]>0?m.ymax:m.ymin,v$c[2]=I$c[2]>0?b/2:-b/2,e$15(v$c,v$c,r),z$s(I$c,I$c);const g=1.1*P$u(v$c,I$c)*this.unitInMeters,_=Math.sqrt(c*(c+2*this._referenceEllipsoid.radius)),w=Math.max(m.xmax-m.xmin,m.ymax-m.ymin),z=w*y$g*this.unitInMeters,P=w*j$b*this.unitInMeters;let k=o$X((c-P)/(z-P),0,1);k*=k*k;let q=s$1c(_,g,k);return q*=Math.max(Math.log(Math.abs(M)),1),q=Math.min(q,Math.max(34064e4,b)),q/=this.unitInMeters,f$f(q,p$f,this.unitInMeters,x)}}class M$8{constructor(e){this._referenceEllipsoid=p$T(e);}compute(e,i,r,n,s){s||(s={near:0,far:0});const a=s$1b(e)-this._referenceEllipsoid.radius,m=this._referenceEllipsoid.radius+Math.min(0,n),h=Math.abs(a-n),l=Math.max(h,Math.abs(a));return f$f(1.2*Math.sqrt(l*(l+2*m)),o$X(2e4-(Math.log(l)-7.983)/9.011*19e3,1e3,2e4),1,s)}}function f$f(e,t,i,r){const n=d$h/i;return e/t>n?(r.far=e,r.near=r.far/t):(r.near=n,r.far=r.near*t),r}const p$f=2e4,d$h=2,y$g=.001,j$b=1e-4,v$c=n$16(),I$c=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let c$l=class extends y$F{constructor(e){super(e),this.handles=new u$U;}initialize(){this.handles.add(this.view.basemapTerrain.on("elevation-change",(e=>this._handleElevationChangeEvent(e))));}destroy(){this.handles&&(this.handles.destroy(),this.handles=null);}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;p$18(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera();}_applyToCurrentCamera(){this.view.state.updateCamera((e=>{o$J(this.view,e,i$P.EYE_AND_CENTER);}));}};e$Y([d$R({constructOnly:!0})],c$l.prototype,"view",void 0),c$l=e$Y([n$18("esri.views.3d.state.ElevationCollisionConstraint")],c$l);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let M$7=class extends y$F{constructor(t){super(t),this._handles=new u$U,this.nearFarHeuristic=c$m(t.view.state.viewingMode,t.view.basemapTerrain,t.view.renderCoordsHelper.spatialReference);}initialize(){this._handles.add([l$M((()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far]),(()=>this._clipDistanceNearFarChanged())),l$M((()=>this.view.constraints?.clipDistance?.mode),(()=>this._updateNearFar())),this.view.state.events.on("before-camera-change",(t=>this._updateCameraNearFar(t.camera))),l$M((()=>this.view.renderDataExtent),(()=>this._updateNearFar()),U$s),l$M((()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max]),(()=>this._updateAltitude()),U$s),l$M((()=>this.view.constraints?.tilt?.max),(()=>this._updateTiltMax()),U$s),l$M((()=>this.view.constraints?.tilt?.mode),(()=>this._updateTilt()),U$s),l$M((()=>this.view.state?.camera),(()=>this._updateTiltAutoMax()),U$s),l$M((()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled]),(()=>this._updateCollision()),U$s)]),this.view.state.isLocal&&this._handles.add(l$M((()=>this.view.renderDataExtent),(t=>this._updateLocalSurfaceDistance(t)),h$V)),this._updateNearFar(),this.view.state.viewingMode!==l$O.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new c$l({view:this.view}));}destroy(){this._handles=l$N(this._handles),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null));}_clipDistanceNearFarChanged(){const t=this.view.constraints?.clipDistance;t&&"auto"!==t.mode&&this.view.state.updateCamera((i=>(this._updateCameraNearFarManual(i,t),!0)));}_updateNearFar(){this.view.state.updateCamera((t=>(this._updateCameraNearFar(t),!0)));}_updateCameraNearFar(t){const i=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(i?i.mode:"auto")?this._updateCameraNearFarManual(t,i):this._updateCameraNearFarAuto(t,i);}_updateCameraNearFarAuto(t,i){this.nearFarHeuristic.compute(t.eye,t.center,this.view.renderDataExtent,m$R(this.view,t.eye),t),i&&i.autoUpdate(t.near,t.far);}_updateCameraNearFarManual(t,i){i&&(t.near=i.near,t.far=i.far);}_updateCollision(){const t=this.view.map?.ground?.navigationConstraint?.type,i=!t||"stay-above"===t,a=this.view.state.constraints.collision;if(i!==a.enabled){a.enabled=i,i&&this._reapplyConstraints(N$m.COLLISION);const t=this.view.constraints&&this.view.constraints.tilt;t&&"auto"!==t.mode||this._updateTiltAuto();}}_updateAltitude(){const t=this.view.constraints&&this.view.constraints.altitude;t&&this.view.state.viewingMode!==l$O.Local?this.view.state.constraints.altitude={min:t.min,max:t.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints();}_updateTiltMax(){const t=this.view.constraints&&this.view.constraints.tilt;t&&"auto"!==t.mode&&(this._updateTiltManual(t),this._reapplyConstraints());}_updateTilt(){const t=this.view.constraints&&this.view.constraints.tilt;"manual"===(t?t.mode:"auto")?this._updateTiltManual(t):this._updateTiltAuto(),this._reapplyConstraints();}_updateTiltManual(t){const i=this.view.state.constraints;i.tilt=i.createConstantMaxTilt(M$t(t.max));}_updateTiltAuto(){const t=this.view.state.constraints;t.tilt=t.createDefaultTilt(),this._updateTiltAutoMax();}_updateTiltAutoMax(){const t=this.view.constraints&&this.view.constraints.tilt;if(!t||"auto"!==t.mode)return;const i=this.view.state.constraints;if(i.tilt){const a=i.tilt(this.view.state.camera.distance).max;t.autoUpdate(m$M(a));}}_updateLocalSurfaceDistance(t){if(t$V(t))return;let i=Math.max(t.width,t.height);if(i<=0)return;t.hasZ&&(i=Math.max(i,t.zmax-t.zmin));const a=this.view.state,e=3*i/Math.atan(a.camera.fov/2);e!==a.constraints.distance&&(a.constraints.distance=e);}_reapplyConstraints(t=N$m.ALL){this.view.state.updateCamera((i=>E$x(this.view,i,{selection:t,interactionType:i$Q.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:m$H.TUMBLE})));}};e$Y([d$R({constructOnly:!0})],M$7.prototype,"view",void 0),e$Y([d$R({readOnly:!0})],M$7.prototype,"surfaceCollisionConstraint",void 0),M$7=e$Y([n$18("esri.views.3d.state.ConstraintsManager")],M$7);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let c$k=class extends i$K{constructor(e){super(e),this.handles=new u$U;}set desiredCamera(e){this._set("desiredCamera",e.clone());}get canStop(){return !0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=o$F.Running,this.handles.add(this.view.basemapTerrain.on("elevation-change",(e=>this._handleElevationChangeEvent(e)))),this._applyCorrection();}onControllerEnd(){this.handles.removeAll();}stepController(){}_handleElevationChangeEvent(e){p$18(this.view,this.desiredCamera,e.extent,e.spatialReference)&&this._applyCorrection();}_applyCorrection(){this.view.state.updateCamera((e=>{e.copyViewFrom(this.desiredCamera),o$J(this.view,e,i$P.EYE_AND_CENTER)||this.constraintEnabled||(this.state=o$F.Stopped);}));}};e$Y([d$R({constructOnly:!0})],c$k.prototype,"view",void 0),e$Y([d$R({constructOnly:!0})],c$k.prototype,"desiredCamera",null),c$k=e$Y([n$18("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],c$k);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class C$b{constructor(t,i,e){this.target=t,this.options=i,this.view=e,this.state="pending",this.abortController=null,this.animationController=null,this.promise=new Promise(((t,i)=>{this.resolveCallback=t,this.rejectCallback=i;const e=new AbortController;r$W(this.options.signal)&&v$X(this.options.signal,(()=>{this.abort();})),this.abortController=e,this.waitForReady();}));}then(t,i){return this.promise.then(t,i)}catch(t){return this.promise.catch(t)}resolve(t){return this.state="finished",this.resolveCallback(t)}reject(t){return this.state="finished",this.rejectCallback(t)}abort(t=!1){switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":this.reject(m$L());break;case"wait-for-animation-finish":!t&&r$W(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),this.reject(m$L());}}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await j$O((()=>this.view.ready),this.abortController.signal);}catch(t){return this.reject(t)}this.createViewPoint();}createViewPoint(){"finished"!==this.state&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this._getAnimationController():null,he$d(this.view,this.target,this.abortController.signal).then((t=>{if("finished"===this.state)return;const i=this._getCameraFromViewpoint(t);if(!t$V(i))if(this.options.animate){if(t$V(this.animationController))return;this.startAnimation(i,this.animationController);}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve();}),(t=>{this.reject(t);})));}_getCameraFromViewpoint(a){const o=!!(this.target instanceof u$1b&&this.target.camera||this.target instanceof d$14),r=a.camera;if(t$V(r))return null;if(!this.view.stateManager.isCompatible(r)){const t=r.position,i=t&&t.spatialReference,a=i?i.wkid:"none",n=this.view.spatialReference.wkid;return this.reject(new s$16("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${n})`,{camera:r})),null}const s=B$v(this.view,r);return t$V(s)?(this.reject(new s$16("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:a,camera:s,isFullySpecified:o}}startAnimation(t,i){this.state="wait-for-animation-finish";const o=i.viewAnimation;if(t$V(o))return void this.reject(new s$16("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(o.update(t.viewpoint,"running"),!i.active||t$V(i.viewAnimation)||i.viewAnimation.target!==t.viewpoint||this.view.state.cameraController!==i)return this.abort();let r;t.isFullySpecified?(r=new c$k({view:this.view,desiredCamera:t.camera}),o$J(this.view,t.camera,i$P.EYE_AND_CENTER)):E$x(this.view,t.camera),i.begin(t.camera,this.options);const s=()=>{const e=this.view.state.cameraController;r&&(e&&e.active?e instanceof h$D&&r$W(e.viewAnimation)&&e.viewAnimation.target===t.viewpoint&&(this.view.state.cameraController=r):r$W(i.viewAnimation)&&i.viewAnimation.target===t.viewpoint&&"finished"===i.state&&(this.view.state.cameraController=r));},w=t=>{if(!t$V(this.view.state))switch(i.state){case o$F.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve();}break;case o$F.Ready:case o$F.Rejected:case o$F.Running:case o$F.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(t);}}};o.when(s,(t=>w(t))),i.asyncResult={resolve:()=>w(),reject:t=>w(t)};}_getAnimationController(){let t,i=null;const n=this.view.state.cameraController;return n instanceof h$D&&(n.updateStateFromViewAnimation(),n.active&&(t=n,i=t.viewAnimation)),null!=t||(t=new h$D({view:this.view,mode:"animation"}),i=t.viewAnimation,this.view.state.switchCameraController(t))?t:(r$W(i)&&i.stop(),this.reject(new s$16("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const q$7=s$17.getLogger("esri.views.3d.state.ViewStateManager");let W$7=class extends y$F{constructor(e){super(e),this.propertiesPool=new o$1s({frustum:d$i},this),this.handles=new u$U,this.cameraSetByUser=!1,this.gotoOperation=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._maximumPixelRatioOverride=null,this.test={contentCameraResetState:new Map,setDevicePixelRatio:e=>this._devicePixelRatioOverride=e,setMaximumPixelRatio:e=>this._maximumPixelRatioOverride=e};}get camera(){const e=this._get("camera");if(!this.ready)return e;const t=$$k(this.view,this.view.state.camera);return t&&e&&t.equals(e)?e:t}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(B$v(this.view,e),{applyConstraints:!1})||q$7.error("#camera=","Invalid camera",e),this.view.elevationProvider.enableElevationCache(!1));}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=$$k(this.view,this.view.state.contentCamera);return t&&e&&t.equals(e)?e:t}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=B$v(this.view,e);t$V(t)?this.view.state.contentCamera=null:(this._updateElevation(t),this.view.state.contentCamera=t);}installContentCameraReset(e){if(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return !1;const t=this.zoom,i=this.view.state.camera.distance**2,r=e$1d(this.view.state.camera.center),a=e.sticky?this.contentCamera.clone():null;return this.handles.add([l$M((()=>this.contentCamera),(()=>{e.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear());})),l$M((()=>this.zoom),(e=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(e-t)/2),Math.abs(e-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=a);})),l$M((()=>this.view.state.camera),(e=>{const t=p$$(r,e.center);this.test.contentCameraResetState.set("camera.center",t/i),t>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=a);}))],"contentCameraReset"),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():q$7.error("#center=","Invalid center",e):q$7.error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):q$7.error("#center=","Center may not be null or undefined"));}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=ue$f(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return r$W(t)?t:this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||q$7.error("#extent=","Invalid extent",e):q$7.error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):q$7.error("#extent=","Extent may not be null or undefined"));}get frustum(){const e=this.propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return !!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return ee$8(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||q$7.error("#scale=","Invalid scale",e);}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,i=e.pixelRatio,r=this._get("padding"),a=Math.round(t[et$6.TOP]/i),s=Math.round(t[et$6.RIGHT]/i),o=Math.round(t[et$6.BOTTOM]/i),n=Math.round(t[et$6.LEFT]/i);return null!=r&&r.top===a&&r.right===s&&r.bottom===o&&r.left===n?r:{top:a,right:s,bottom:o,left:n}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,$$5),this.view.state.updateCamera((e=>e.padding=$$5)));}_paddingToArray(e,t,i){e?r$17(i,e.top||0,e.right||0,e.bottom||0,e.left||0):r$17(i,0,0,0,0);for(let r=0;r<4;r++)i[r]=Math.round(i[r]*t);}get screenCenter(){const e=this.padding;return c$1n((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?ge$9(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||q$7.error("#viewpoint=","Invalid viewpoint",e);else {const t=r$W(e.camera)?e.camera.position:e.targetGeometry,i=r$W(t)&&t.spatialReference;q$7.error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(i?i.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e);}else q$7.error("#viewpoint=","Viewpoint may not be null or undefined");}get zoom(){return this.ready?xe$3(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||q$7.error("#zoom=","Invalid zoom",e);}get maximumPixelRatio(){if(r$W(this._maximumPixelRatioOverride))return this._maximumPixelRatioOverride;let e=1/0;const{maximumPixelRatio:t,maximumRenderResolution:i}=this.view.qualitySettings;if(null!=t&&(e=Math.min(e,t)),null!=i){const t=i/Math.max(this.view.width,this.view.height);e=Math.min(e,t);}return e}get _devicePixelRatio(){return t$V(this._devicePixelRatioOverride)?Math.min(this._windowDevicePixelRatio,this.maximumPixelRatio):this._devicePixelRatioOverride}initialize(){this.handles.add([a$Z((()=>this.view.state.events),"before-camera-change",(e=>this._updateElevation(e.camera)))]),l$M((()=>this.view.state.camera),(e=>this._updateElevation(e)),{once:!0,sync:!0}),this.handles.add(A$L({prepare:()=>this._prepareFrame()})),this.handles.add(l$M((()=>this.view.state.cameraController),(()=>{this.cameraSetByUser=!0,this.handles.remove(ee$2);}))),this.handles.add(a$Z((()=>this.view.state.events),"camera-projection-changed",(()=>this.notifyChange("scale"))));}destroy(){this.deinit(),this.handles&&(this.handles.destroy(),this.handles=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null);}init(){this.constraintsManager=new M$7({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this.cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this.cameraSetByUser){const e=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;e&&this.isCompatible(e)?this._setInitialView(e):this.view.state.viewingMode===l$O.Local&&this.handles.add(f$R((()=>this.view.basemapTerrain.ready),(()=>{this.handles.remove(ee$2),this._setInitialView(this.view.dataExtent);}),{once:!0,initial:!0}),ee$2);}}deinit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove(ee$2),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null));}async goTo(e,t){const i={animate:!0,...t};return r$W(this.gotoOperation)&&this.gotoOperation.abort(i.animate),this.gotoOperation=new C$b(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this.gotoOperation}debugSetCameraOnContent(){this.setStateCamera(g$10(this.view),{applyConstraints:!1});}step(e){const t=this.view.state,i=t&&this.view.state.cameraController;i&&(t.updateCamera((t=>{i.stepController(e,t);})),i.steppingFinished&&i.finishController());}_cancelGoToOperation(){r$W(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null);}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:i,overrides:r}of Q$6){const a=e.has(i),s=this._isOverridden(i);!a&&s&&t.push({name:i,value:this._get(i)}),this._clearOverride(i),(a||s)&&r.forEach((t=>e.add(t)));}return t}_setInitialView(e){if(t$V(e)||this.cameraSetByUser)return;if(e instanceof d$14)return void this.setStateCamera(B$v(this.view,e),{applyConstraints:!1});if(e instanceof u$1b){if(e.targetGeometry instanceof M$u){const t=fe$c(this.view,e.targetGeometry,0,.5,Y$e.LOCKED);return void(r$W(t)&&this.setStateCamera(B$v(this.view,t),{applyConstraints:!0}))}const t={applyConstraints:!e.camera},i=this._viewpointToCamera(e);return void this.setStateCamera(i,t)}const r=fe$c(this.view,e,0,.5,Y$e.LOCKED);r$W(r)&&this.setStateCamera(B$v(this.view,r),{applyConstraints:!0});}_updatePropertyBeforeReady(e,t){return !this.ready&&(this._override(e,t),t&&K$7.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return !t$V(e)&&(e instanceof u$1b?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof d$14?this.isCompatible(e.position):e.spatialReference&&g$11(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=X$4){return this.cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,i=Z$4){const{heading:r,tilt:a}=this._getPreservingHeadingTilt(),s=ce$f(this.view,r,a,e,t,Y$e.ADJUST);return t$V(s)?null:(i.copyFrom(this.view.state.camera),i.eye=s.eye,i.center=s.center,i.up=s.up,i)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:t,tilt:i}=this._getPreservingHeadingTilt(),r=fe$c(this.view,e,t,i,Y$e.ADJUST,Y$3);return r$W(r)?B$v(this.view,r):null}_scaleToCamera(e){if(null==e)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.renderLocation,r=t.location.latitude,a=_$D(this.view,e,r);return this._centerPointAtDistanceToCamera(i,a)}_zoomToCamera(e){return this._scaleToCamera(je$1(this.view,e))}_viewpointToCamera(e){return B$v(this.view,pe$d(this.view,e))}setStateCamera(e,t){return !(t$V(e)||!this.view.state.stopActiveCameraController())&&(this.cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera((i=>{t.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),t.applyConstraints&&E$x(this.view,i);})),t.applyConstraints||(this.view.state.cameraController=new c$k({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._devicePixelRatio,r=Math.round(e.clientWidth*i),a=Math.round(e.clientHeight*i);if(0!==r&&0!==a&&(t.width===r&&t.height===a||(t.width=r,t.height=a),this.view.state)){const e=this.view.state.camera;e.fullWidth===r&&e.fullHeight===a&&e.pixelRatio===i||(Z$4.copyFrom(e),Z$4.pixelRatio!==i&&(this._paddingToArray(this.padding,i,$$5),Z$4.padding=$$5),Z$4.fullWidth=r,Z$4.fullHeight=a,Z$4.pixelRatio=i,this.view.state.camera=Z$4);}}_updateElevation(e){const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=this.view.renderCoordsHelper.getAltitude(e.eye),r=t?m$R(this.view,e.eye):0;e.relativeElevation=i-r;}};e$Y([d$R({type:d$14,dependsOn:["view.state.camera","ready"]})],W$7.prototype,"camera",null),e$Y([d$R({type:d$14,dependsOn:["view.state.contentCamera","ready"]})],W$7.prototype,"contentCamera",null),e$Y([d$R({type:j$P})],W$7.prototype,"center",null),e$Y([d$R({type:M$u})],W$7.prototype,"extent",null),e$Y([d$R({readOnly:!0})],W$7.prototype,"frustum",null),e$Y([d$R({readOnly:!0})],W$7.prototype,"hasInitialView",null),e$Y([d$R({readOnly:!0,type:Boolean})],W$7.prototype,"ready",void 0),e$Y([d$R({type:Number})],W$7.prototype,"scale",null),e$Y([d$R()],W$7.prototype,"padding",null),e$Y([d$R({readOnly:!0})],W$7.prototype,"screenCenter",null),e$Y([d$R({constructOnly:!0})],W$7.prototype,"view",void 0),e$Y([d$R({type:u$1b})],W$7.prototype,"viewpoint",null),e$Y([d$R({type:Number})],W$7.prototype,"zoom",null),e$Y([d$R()],W$7.prototype,"maximumPixelRatio",null),e$Y([d$R()],W$7.prototype,"_devicePixelRatio",null),e$Y([d$R()],W$7.prototype,"_windowDevicePixelRatio",void 0),e$Y([d$R()],W$7.prototype,"_devicePixelRatioOverride",void 0),e$Y([d$R()],W$7.prototype,"_maximumPixelRatioOverride",void 0),W$7=e$Y([n$18("esri.views.3d.state.ViewStateManager")],W$7);const J$5=W$7,K$7=["camera","viewpoint","extent","scale","center","zoom"],Q$6=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],X$4={heading:0,tilt:0},Y$3=new d$14,Z$4=new K$h,$$5=n$1a(),ee$2="pending-initial-view";

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class H$6{constructor(e,t,r){this.viewingMode=e,this._forEachLayer=t,this.view=r,this.externalIntersectionHandlers=new n$1l,this.tolerance=A$M,this.tmpRay=d$U(),this.tmpRegion=u$T(),this.validateHUDIntersector=x$K(this.viewingMode),this.validateHUDIntersector.options.hud=!1;}intersectScreen(e,t,r){return this.intersectRay(this._getPickRay(e,this.tmpRay),k$9(this.viewingMode),t,r)}intersectScreenFreePointFallback(e,t,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this.tmpRay),t,r)}intersectRayFreePointFallback(e,t,r){return this.intersectRay(e,k$9(this.viewingMode),t,r)||this._intersectRayFreePointLocal(e,t)}intersectRay(e,t,r,i){return t.options.selectionMode=!1,t.options.store=t$1g.MIN,this.computeIntersection(e,t,i),!!t.results.min&&t.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,t,r=.5,i=.5){return e.getRenderCenter(N$c,r,i),N$c[0]+=.0466,N$c[1]-=.0123,g$C(e,N$c,t)}intersectIntersectorScreen(e,t,r){this.computeIntersection(this._getPickRay(e,this.tmpRay),t,r);}intersectToolIntersectorScreen(e,t,r){const i=this._getPickRay(e,this.tmpRay);this.intersectToolIntersectorRay(i,t,r);}intersectToolIntersectorRay(e,t,r){t.options.selectionMode=!0,this.computeIntersection(e,t,r);const i=t.results.min;!!this.view.basemapTerrain&&this.view.basemapTerrain.opaque||c$1o(i)&&i.intersector!==i$1e.TERRAIN||(t.options.selectionMode=!1,this.computeIntersection(e,t,r));}setTolerance(e=A$M){this.tolerance=e;}addIntersectionHandler(e){this.externalIntersectionHandlers.push(e),this.externalIntersectionHandlers.sort(((e,t)=>e.type===i$1e.TERRAIN?1:t.type===i$1e.TERRAIN?-1:0));}removeIntersectionHandler(e){null!=this.externalIntersectionHandlers.removeUnordered(e)&&this.externalIntersectionHandlers.sort(((e,t)=>e.type===i$1e.TERRAIN?1:t.type===i$1e.TERRAIN?-1:0));}_getPickRay(e,t){const r=this.view.state.camera;return s$R(r,e,t)}_intersectRayFreePointLocal(t,r){if(this.viewingMode!==l$O.Local||t$V(t))return !1;const i=this.view.renderDataExtent;if(t$V(i))return u$W(r,t.origin,z$s(c$16.get(),t.direction)),!0;const n={x:i.xmax-i.xmin,y:i.ymax-i.ymin,z:8*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},s=Math.max(n.x,n.y,n.z);if(0===s)return u$W(r,t.origin,z$s(c$16.get(),t.direction)),!0;const h=this.view.state.camera,u=Math.max(0,i.xmin-h.eye[0],h.eye[0]-i.xmax),m=Math.max(0,i.ymin-h.eye[1],h.eye[1]-i.ymax),d=Math.sqrt(u*u+m*m),p=Math.abs(h.relativeElevation)+Number.MIN_VALUE,y=Math.max(0,Math.log(s/p))**2;let g=s/Math.max(1,y);g=Math.max(g,Math.min(d,s));const f=q$p(c$16.get(),t.direction,g/s$1b(t.direction));return u$W(r,t.origin,f),!0}intersectElevationFromScreen(e,t,r=0,i=null){return this._intersectElevation(this._getPickRay(e,this.tmpRay),t,r,i)}_intersectElevation(i,s,a=0,c=null){if(t$V(i))return null;const l=r$W(s)?s.mode:"absolute-height",h=r$W(s)?c$$(s.offset,0):0,u="on-the-ground"!==l?h+a:0,m=u/this.view.renderCoordsHelper.unitInMeters;if("absolute-height"===l){if(this.view.renderCoordsHelper.intersectInfiniteManifold(i,u,S$9)){const e=this.view.computeMapPointFromVec3d(S$9);return e.z-=h,e}return null}const d=this.view.state.camera,p=p$_(c$16.get());d.projectToRenderScreen(i.origin,p);const y=new A$c(null,this._forEachLayer),g=this.view.slicePlane,f=r$W(g)?s$1t(g):null,v=x$K(this.viewingMode);v.options.store=t$1g.MIN,v.options.verticalOffset=m;const x=i.origin,w=u$W(c$16.get(),x,i.direction);v.reset(x,w,d),v.point=p;const b=r$W(c)?"type"in c&&"graphics"===c.type?e=>e.metadata.layerUid!==c.uid:e=>e.metadata.graphicUid!==c.uid:null;switch(l){case"relative-to-scene":{const t=t=>(t$V(b)||b(t))&&t.metadata&&t.metadata.isElevationSource;v.intersect(y.layers,p,this.tolerance,null,t),this.externalIntersectionHandlers.forAll((e=>{if(e.type===i$1e.I3S||e.type===i$1e.TERRAIN){const t=e.slicePlaneEnabled?f:null;e.intersect(v,t,v.rayBegin,v.rayEnd,p);}}));}break;case"on-the-ground":case"relative-to-ground":this.externalIntersectionHandlers.forAll((e=>{if(e.isGround){const t=e.slicePlaneEnabled?f:null;e.intersect(v,t,v.rayBegin,v.rayEnd,p);}}));}if(v.results.min.getIntersectionPoint(S$9)){const e=this.view.computeMapPointFromVec3d(S$9);return e.z=a,e}return null}computeIntersection(i,s,a){if(t$V(i))return;const c=this.view.state.camera,l=p$_(c$16.get());c.projectToRenderScreen(i.origin,l);const h=new A$c(a,this._forEachLayer);s.options.selectOpaqueTerrainOnly=!a||!("include"in a||"exclude"in a);const u=i.origin,m=u$W(c$16.get(),i.origin,i.direction);s.reset(u,m,c),s.intersect(h.layers,l,this.tolerance);const d=this.view.slicePlane,p=r$W(d)?s$1t(d):null;s.intersect(h.sliceableLayers,l,this.tolerance,p);const y=a&&(a.requiresGroundFeedback||a.enableDraped);this.externalIntersectionHandlers.forAll((e=>{if(s.options.isFiltered=!h.filterLayerUid(e.layerUid),e.isGround&&y||!s.options.isFiltered){const t=e.slicePlaneEnabled?p:null;e.intersect(s,t,u,m,l);}}));const g=c$16.get();if(a&&a.enableDraped&&s.results.ground.getIntersectionPoint(g)){const e=this.view.basemapTerrain,t=e.overlayManager.renderer,i=this.view.renderCoordsHelper.spatialReference,n=c$16.get();this.view.renderCoordsHelper.fromRenderCoords(g,n,e.spatialReference),n[2]=c$$(this.view.elevationProvider.getElevation(g[0],g[1],g[2],i,"ground"),0),t.intersect(s,n,s.results.ground,(e=>h.filterRenderGeometry(e)));}s.sortResults(),this._processHUDResults(s);}_processHUDResults(r){const i=r.results.hud;a$1e(this.tmpRegion,K$j);const n=this.view.state.camera,s=[],o=this.tmpRegion,a=e=>{const t=new T$f(e);n.projectToRenderScreen(e.target.center,t.screenPoint),t.screenPoint[0]=Math.floor(t.screenPoint[0]),t.screenPoint[1]=Math.floor(t.screenPoint[1]),s.push(t),m$Y(o,t.screenPoint);};r.sortResults(i.all),r$W(i.min.dist)&&a(i.min);for(const e of i.all)i.min.target.object!==e.target.object&&i.max.target.object!==e.target.object&&a(e);if(r$W(i.max.dist)&&i.max.target.object!==i.min.target.object&&a(i.max),!s.length)return;o[0]===o[2]&&(o[2]+=1),o[1]===o[3]&&(o[3]+=1);const c=n.fullWidth,l=n.fullHeight,h=Math.max(0,o[0]-U$a),u=Math.max(0,o[1]-U$a),f=Math.min(s$1k(o)+2*U$a,c-h),R=Math.min(l$Y(o)+2*U$a,l-u),v=new Uint8Array(f*R*4);this.view._stage.renderView.readHUDVisibility(h,u,f,R,v);let x=!0;const w=t$V(r.results.max.dist);let b=0;for(const e of s)for(const t of L$c){if(v[4*(Math.min(e.screenPoint[0]+t[0],c)-o[0]+(Math.min(e.screenPoint[1]+t[1],l)-o[1])*f)]){x&&(r.results.min.copy(e.result),x=!1),w&&r.results.max.copy(e.result),r.options.store===t$1g.ALL&&r.results.all.splice(b++,0,e.result);break}}}}const U$a=1,L$c=(()=>{const e=[],t=U$a;for(let r=-t;r<=t;r++)for(let i=-t;i<=t;i++)e.push([i+t,r+t]);return e})();class T$f{constructor(e){this.result=e,this.screenPoint=x$J();}}let _$c;function k$9(e){return _$c&&_$c.viewingMode===e||(_$c=x$K(e)),_$c}class A$c{constructor(e,t){this.layers=new Array,this.sliceableLayers=new Array,this.include=e?.include,this.exclude=e?.exclude,t((e=>{e.isPickable&&this.filterLayerUid(e.apiLayerUid)&&(e.isSliceable?this.sliceableLayers:this.layers).push(e);}));}filterLayerUid(t){const{include:r,exclude:i}=this;return t$V(t)?null==r&&null==i:(null==r||r.has(t))&&(null==i||!i.has(t))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}}function F$9(e){return "object"==typeof e&&"intersect"in e}const S$9=n$16(),N$c=x$J();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class n$q{constructor(e,t){this.spatialReference=e,this.view=t;}getElevation(e,t,r){return this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)}async queryElevation(e,t,r,s,i){return this.view.elevationProvider.queryElevation(e,t,0,this.spatialReference,i,r,s)}}class a$q{constructor(e,t,r,s){this.spatialReference=t,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(L$D.ELEVATION_QUERY,this);}destroy(){this._frameTask.remove();}queryElevation(t,i,o,n=0){return new Promise(((a,l)=>{const u={x:t,y:i,minDemResolution:n,result:{resolve:a,reject:l},signal:o};this._queries.push(u),v$X(o,(()=>{F$v(this._queries,u),l(m$L());}));}))}get running(){return this._queries.length>0}runTask(){const e=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return void e.forEach((e=>e.result.reject()));const n=e.map((e=>[e.x,e.y])),a=e.reduce(((e,t)=>Math.min(e,t.minDemResolution)),1/0),l=new m$Z({points:n,spatialReference:this.spatialReference}),u=e.length>1&&e.some((e=>!!e.signal))?new AbortController:null,c=r$W(u)?u.signal:e[0].signal;if(r$W(u)){let t=0;e.forEach((i=>v$X(i.signal,(()=>{t++,i.result.reject(m$L()),t===e.length&&u.abort();}))));}const h={...this._queryOptions,minDemResolution:a,signal:c};i.queryElevation(l,h).then((r=>{e.forEach(((e,i)=>{r$W(e.signal)&&e.signal.aborted?e.result.reject(m$L()):e.result.resolve(r.geometry.points[i][2]);}));})).catch((t=>{e.forEach((e=>e.result.reject(t)));}));}get test(){const e=this;return {update:()=>e._queries.length>0&&e.runTask()}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let u$l=class extends(n$17.EventedMixin(y$F)){constructor(e){super(e),this.im=new Array,this.ground=new Array,this.scene=new Array,this.handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1;}destroy(){this._elevationQuery=l$N(this._elevationQuery);}get elevationQuery(){return t$V(this._elevationQuery)&&(this._elevationQuery=new a$q(this.view.resourceController.scheduler,this.view.spatialReference,(()=>this.view.map&&this.view.map.ground),{maximumAutoTileRequests:4})),this._elevationQuery}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e;}getElevation(e,t,s,r,o){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){const i=this.lastElevationQuery;if(e===i.x&&t===i.y&&s===i.z&&r.equals(i.spatialReference)&&o===i.queryContext)return i.result}let n=null;return n=p$e(n,this.im,e,t,s,r,o),t$V(n)&&(n=p$e(n,this.ground,e,t,s,r,o)),"scene"===o&&(n=p$e(n,this.scene,e,t,s,r,o)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:s,spatialReference:r,queryContext:o,result:n}),n}queryElevation(e,t,s,r,i,o=null,l=0){const c=D$o();return this.elevationQuery.queryElevation(e,t,o,l).then((o=>{"scene"===i&&(o=p$e(o,this.scene,e,t,s,r,i)),c.resolve(o);})).catch((o=>{g$T(o)?c.reject(o):c.resolve(this.getElevation(e,t,s,r,i));})),c.promise}register(e,t){this.handles.set(t,t.on("elevation-change",(e=>this.emit("elevation-change",e)))),this[e].push(t);}unregister(e){this.handles.has(e)&&(this.handles.get(e).remove(),this.handles.delete(e));for(const t of [this.im,this.ground,this.scene]){const s=t.indexOf(e);s>-1&&t.splice(s,1);}}};function p$e(e,t,s,r,i,n,a){for(const l of t){const t=l.getElevation(s,r,i,n,a);r$W(t)&&(e=r$W(e)?Math.max(t,e):t);}return e}e$Y([d$R({constructOnly:!0})],u$l.prototype,"view",void 0),e$Y([d$R({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],u$l.prototype,"spatialReference",void 0),u$l=e$Y([n$18("esri.views.3d.support.CombinedElevationProvider")],u$l);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class a$p{static isValidProfile(e){return e in a$p.profiles}static getDefaultProfile(){return a$12("trident")||a$12("esri-iPhone")?"low":"medium"}static apply(e,i){const o=a$p.profiles[e];i.graphics3D.maxTotalNumberOfFeatures=o.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxTotalNumberOfPrimitives=o.graphics3D.maxTotalNumberOfPrimitives,i.graphics3D.polygonLodFactor=o.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=o.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=o.graphics3D.snapshotAvailable;{const e=i.sceneService["3dObject"],a=o.sceneService["3dObject"];e.lodFactor=a.lodFactor,e.lodCrossfadeinDuration=a.lodCrossfadeinDuration,e.lodCrossfadeoutDuration=a.lodCrossfadeoutDuration,e.lodCrossfadeUncoveredDuration=a.lodCrossfadeUncoveredDuration;}i.sceneService.point.lodFactor=o.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=o.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=o.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=o.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=o.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=o.tiledSurface.angledSplitBias,i.tiledSurface.reduceTileLevelDifferences=o.tiledSurface.reduceTileLevelDifferences,i.tiledSurface.textureFadeDuration=o.tiledSurface.textureFadeDuration,i.heatmap.pixelRatio=o.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=o.heatmap.maxTotalNumberOfFeatures,i.antialiasingEnabled=o.antialiasingEnabled,i.physicallyBasedRenderingEnabled=o.physicalBasedRenderingEnabled,i.highQualityTransparency=o.highQualityTransparency,i.memoryLimit=o.memoryLimit,i.additionalCacheMemory=o.additionalCacheMemory,i.frameRate=o.frameRate,i.maximumRenderResolution=o.maximumRenderResolution,i.maximumPixelRatio=o.maximumPixelRatio;}}function i$l(){const a=!!a$12("esri-mobile"),i=!!a$12("ios");return {low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:a?.8:1,polylineLodFactor:a?1.2:1.5,snapshotAvailable:!i},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:a},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a$12("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:a?600:750,additionalCacheMemory:a?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:a?1.2:2,polylineLodFactor:a?1.2:2,snapshotAvailable:!i},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a$12("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:a?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:a?null:4096,maximumPixelRatio:a?1:null}}}a$p.debug={reset(){const e=i$l();for(const i in e)a$p.profiles[i]=e[i];}},function(e){e.profiles=i$l();}(a$p||(a$p={}));const o$k=a$p;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let e$p=class extends y$F{constructor(){super(...arguments),this.color=new l$T([0,255,255]),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=new l$T([0,0,0]),this.shadowDifference=.2;}static toEngineOptions(o){const r=l$T.toUnitRGBA(o.color),i=r$W(o.haloColor)?l$T.toUnitRGBA(o.haloColor):r,p=l$T.toUnitRGBA(o.shadowColor);return {color:r$1e(r[0],r[1],r[2],r[3]),haloColor:r$1e(i[0],i[1],i[2],i[3]),haloOpacity:o.haloOpacity,haloOpacityOccluded:.25*o.haloOpacity,fillOpacity:o.fillOpacity,fillOpacityOccluded:.25*o.fillOpacity,shadowOpacity:o.shadowOpacity,shadowColor:r$Z(p[0],p[1],p[2],p[3]),occludedShadowOpacity:o.shadowOpacity*(1-o.shadowDifference)}}};e$Y([d$R({type:l$T})],e$p.prototype,"color",void 0),e$Y([d$R({type:l$T})],e$p.prototype,"haloColor",void 0),e$Y([d$R()],e$p.prototype,"haloOpacity",void 0),e$Y([d$R()],e$p.prototype,"fillOpacity",void 0),e$Y([d$R()],e$p.prototype,"shadowOpacity",void 0),e$Y([d$R({type:l$T})],e$p.prototype,"shadowColor",void 0),e$Y([d$R()],e$p.prototype,"shadowDifference",void 0),e$p=e$Y([n$18("esri.views.3d.support.HighlightOptions")],e$p);const l$k=e$p;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class a$o{constructor(i,s){this.spatialReference=s,this.unitInMeters=z$t(this.spatialReference,p$T(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=n$1x(i&&i.get("portalItem")).catch((()=>{throw new s$16("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")}));}async toGeographic(e){const r=await this._geometryServiceURLPromise;let t,o=!0;Array.isArray(e[0])&&"number"!=typeof e[0]?t=e:(t=[e],o=!1);const a=t.map((e=>e instanceof j$P?e:new j$P(e,this.spatialReference))),c=new a$1k({geometries:a,outSpatialReference:k$z.WGS84}),n=(await n$1y(r,c)).map((e=>"point"===e.type?[e.x,e.y]:void 0));return o?n:n[0]}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let s$n=class extends y$F{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1;}};e$Y([d$R()],s$n.prototype,"minTotalNumberOfFeatures",void 0),e$Y([d$R()],s$n.prototype,"maxTotalNumberOfFeatures",void 0),e$Y([d$R()],s$n.prototype,"maxTotalNumberOfPrimitives",void 0),e$Y([d$R()],s$n.prototype,"snapshotAvailable",void 0),e$Y([d$R()],s$n.prototype,"polygonLodFactor",void 0),e$Y([d$R()],s$n.prototype,"polylineLodFactor",void 0),s$n=e$Y([n$18("esri.views.3d.support.QualitySettings.Graphics3DSettings")],s$n);let r$m=class extends y$F{constructor(){super(...arguments),this.lodFactor=1;}};e$Y([d$R()],r$m.prototype,"lodFactor",void 0),r$m=e$Y([n$18("esri.views.3d.support.QualitySettings.LoDFactorSettings")],r$m);let p$d=class extends r$m{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0;}};p$d=e$Y([n$18("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],p$d);let a$n=class extends y$F{constructor(){super(...arguments),this["3dObject"]=new p$d,this.point=new r$m,this.integratedMesh=new r$m,this.pointCloud=new r$m,this.uncompressedTextureDownsamplingEnabled=!1;}};e$Y([d$R({type:p$d})],a$n.prototype,"3dObject",void 0),e$Y([d$R({type:r$m})],a$n.prototype,"point",void 0),e$Y([d$R({type:r$m})],a$n.prototype,"integratedMesh",void 0),e$Y([d$R({type:r$m})],a$n.prototype,"pointCloud",void 0),e$Y([d$R()],a$n.prototype,"uncompressedTextureDownsamplingEnabled",void 0),a$n=e$Y([n$18("esri.views.3d.support.QualitySettings.SceneServiceSettings")],a$n);let n$p=class extends y$F{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=500;}};e$Y([d$R()],n$p.prototype,"lodBias",void 0),e$Y([d$R()],n$p.prototype,"angledSplitBias",void 0),e$Y([d$R()],n$p.prototype,"reduceTileLevelDifferences",void 0),e$Y([d$R()],n$p.prototype,"textureFadeDuration",void 0),n$p=e$Y([n$18("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],n$p);let d$g=class extends y$F{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4;}};e$Y([d$R()],d$g.prototype,"pixelRatio",void 0),e$Y([d$R()],d$g.prototype,"maxTotalNumberOfFeatures",void 0),d$g=e$Y([n$18("esri.views.3d.support.QualitySettings.HeatmapSettings")],d$g);let l$j=class extends y$F{constructor(){super(...arguments),this.graphics3D=new s$n,this.sceneService=new a$n,this.tiledSurface=new n$p,this.heatmap=new d$g,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0;}};e$Y([d$R({type:s$n})],l$j.prototype,"graphics3D",void 0),e$Y([d$R({type:a$n})],l$j.prototype,"sceneService",void 0),e$Y([d$R({type:n$p})],l$j.prototype,"tiledSurface",void 0),e$Y([d$R({type:d$g})],l$j.prototype,"heatmap",void 0),e$Y([d$R()],l$j.prototype,"antialiasingEnabled",void 0),e$Y([d$R()],l$j.prototype,"physicallyBasedRenderingEnabled",void 0),e$Y([d$R()],l$j.prototype,"highQualityTransparency",void 0),e$Y([d$R()],l$j.prototype,"memoryLimit",void 0),e$Y([d$R()],l$j.prototype,"additionalCacheMemory",void 0),e$Y([d$R()],l$j.prototype,"frameRate",void 0),e$Y([d$R()],l$j.prototype,"maximumRenderResolution",void 0),e$Y([d$R()],l$j.prototype,"maximumPixelRatio",void 0),l$j=e$Y([n$18("esri.views.3d.support.QualitySettings.QualitySettings")],l$j);const c$j=l$j;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class x$c{constructor(t,e,r,o){this.viewingMode=t,this.spatialReference=e,this.unitInMeters=r,this.coordinateSystem=o,this._coordinateSystem=h$R(o);}set extent(t){t&&j$D(this.coordinateSystem,t,this.coordinateSystem);}getAltitude(t){return T$B(this.coordinateSystem,t)}setAltitude(t,e,r=t){return Z$f(this.coordinateSystem,r,e,t)}setAltitudeOfTransformation(t,e){q$o(this.coordinateSystem,e,t,e);}worldUpAtPosition(t,e){return R$t(this.coordinateSystem,t,e)}worldBasisAtPosition(t,e,r){return S$D(this.coordinateSystem,t,e,r)}basisMatrixAtPosition(t,e){const o=this.worldBasisAtPosition(t,n$14.X,c$16.get()),s=this.worldBasisAtPosition(t,n$14.Y,c$16.get()),i=this.worldBasisAtPosition(t,n$14.Z,c$16.get());return s$1q(e,o[0],o[1],o[2],0,s[0],s[1],s[2],0,i[0],i[1],i[2],0,0,0,0,1),e}intersectManifoldClosestSilhouette(t,e,r){return w$w(this.coordinateSystem,e,this._coordinateSystem),g$R(this._coordinateSystem,t,r),r}intersectManifold(t,e,r){w$w(this.coordinateSystem,e,this._coordinateSystem);const s=c$16.get();return b$B(this._coordinateSystem,t,s)?r$V(r,s):null}intersectInfiniteManifold(t,e,r){if(this.viewingMode===l$O.Global)return this.intersectManifold(t,e,r);w$w(this.coordinateSystem,e,this._coordinateSystem);const s=this._coordinateSystem.value,i=c$16.get();return q$q(s.plane,t,i)?r$V(r,i):null}toRenderCoords(t,e,r){return t$1b(t)?Hn(t,e,this.spatialReference):Bn(t,e,r,this.spatialReference)}fromRenderCoords(e,r,o=null){return t$1b(r)?(r$W(o)&&(r.spatialReference=o),dn(e,this.spatialReference,r)):r instanceof k$z?In(e,this.spatialReference,r):Bn(e,this.spatialReference,r,o)?r:null}static create(t,r){switch(t){case l$O.Local:return new x$c(l$O.Local,r,z$t(r),y$D());case l$O.Global:return new x$c(l$O.Global,r,1,k$y(r))}}static renderUnitScaleFactor(t,e){return B$b(t)/B$b(e)}}function B$b(t){if(r$1f(t,l$O.Global))return 1;const r=H$m(!1,t);return z$t(r)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var A$b;!function(A){A[A.ELEVATION=0]="ELEVATION",A[A.BASEMAP=1]="BASEMAP",A[A.I3S_INDEX=2]="I3S_INDEX",A[A.I3S_DATA=3]="I3S_DATA",A[A.SYMBOLOGY=4]="SYMBOLOGY";}(A$b||(A$b={}));const E$f=(()=>{const E=new Array;return E[A$b.ELEVATION]=10,E[A$b.BASEMAP]=10,E[A$b.I3S_INDEX]=10,E[A$b.I3S_DATA]=10,E[A$b.SYMBOLOGY]=5,E})(),I$b=30;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function e$o(e){return "function"==typeof e.getUsedMemory}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const y$f=s$17.getLogger("esri.views.3d.support.MemoryController");function l$i(t){return new p$c({view:t})}const n$o=1,d$f=1,u$k=.75,c$i=.6,_$b=1.3;let p$c=class extends y$F{constructor(t){super(t),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new h$16,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100;}destroy(){this._cacheStorage.destroy();}set maxMemory(t){null==t||t<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<t&&this._updateQuality(n$o),this._maxMemory=t);}get maxMemory(){return this._maxMemory}set additionalCacheMemory(t){null!=t&&t>=0&&(this._additionalCacheMemory=t);}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(t,e){return new r$1g(t,this._cacheStorage,e)}resetStableQuality(){this._stableQuality=0;}disableMemCache(){this.additionalCacheMemory=-4096;}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let t=this._layersUpdating();if(this._memoryPredicted<c$i&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(n$o);else if(t)(this._memoryPredicted>1.1*d$f||this._memoryUsed>d$f)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/_$b),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>d$f)this._stableQuality=0,this._canFastRecover=!1,t=this._updateQuality(this._quality/_$b),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<u$k&&this._quality<n$o){this._stableQuality=this._quality;const e=.05;t=this._updateQuality(this._quality+e);}else this._quality<1&&(this._canFastRecover=!0);this._updating=t;}_updateQuality(t){return (t=Math.min(Math.max(t,this.minQuality),n$o))!==this._quality&&(this._quality=t,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some((t=>!!t.updating))}_updateMemory(){let t=0,e=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(t+=this.view.basemapTerrain.getUsedMemory());const i=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderView.edgeView;r$W(i)&&(t+=i.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach((i=>{if(e$o(i)){const s=i.ignoresMemoryFactor()?this._quality:1;t+=i.getUsedMemory()*s,e+=i.getUnloadedMemory()*s;}}));const r=null==this._warnMemoryUsage||Math.round(10*t)!==Math.round(10*this._warnMemoryUsage),a=1048576*this.maxMemory;if(t>a&&r){this._warnMemoryUsage=t;const i=t=>(t/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",s=Math.round(100*this._quality);y$f.warn(`Memory Limit exceeded! Limit: ${i(a)} Current: ${i(t)} Projected: ${i(t+e)} Quality: ${s}%`);}this._memoryUsed=t/a,this._memoryPredicted=(t+e)/a;const o=a-t;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory);}get test(){const t=this;return {cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const e=t._numQualityChanges;return t._numQualityChanges=0,e}}}};e$Y([d$R({constructOnly:!0})],p$c.prototype,"view",void 0),e$Y([d$R()],p$c.prototype,"maxMemory",null),e$Y([d$R()],p$c.prototype,"additionalCacheMemory",null),e$Y([d$R()],p$c.prototype,"memoryFactor",null),e$Y([d$R()],p$c.prototype,"updating",null),e$Y([d$R()],p$c.prototype,"usedMemory",null),e$Y([d$R()],p$c.prototype,"_quality",void 0),e$Y([d$R()],p$c.prototype,"_memoryUsed",void 0),e$Y([d$R()],p$c.prototype,"_updating",void 0),e$Y([d$R()],p$c.prototype,"_stableQuality",void 0),e$Y([d$R()],p$c.prototype,"_maxMemory",void 0),e$Y([d$R()],p$c.prototype,"_additionalCacheMemory",void 0),p$c=e$Y([n$18("esri.views.3d.support.MemoryController")],p$c);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$m{constructor(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0;}}class e$n{constructor(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new r$l;}}class r$l{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0;}}class i$k{constructor(t,s,r,i){this._workerFunc=t,this._callbackFunc=s,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=i.map((t=>new e$n(t)));}hasQuota(t){const s=this._clients[t];return !!s&&(this._totalNumWorkers<this._maxTotalNumWorkers||s.numWorkers+s.tasks.length<s.typeWorkerQuota)}push(t){const s=this._clients[t.client];s&&(this._totalNumWorkers<this._maxTotalNumWorkers?(s.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,((t,s)=>this._taskCallback(t,s)))):s.tasks.push(t));}cancel(t){this._taskFinished(t),t._cancelled=!0;}destroy(){this._clients.length=0;}_taskFinished(s){const e=this._clients[s.client];this._totalNumWorkers--,e.numWorkers--,e.statistics.requests++,e.statistics.size+=s.size||0,e.statistics.duration+=s.duration||0,e.statistics.speed=e.statistics.duration>0?e.statistics.size/e.statistics.duration:0,e$18(e.numWorkers>=0),this._next();}_next(){for(const t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(const t of this._clients)if(t&&this._processQueue(t))return}_processQueue(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),((t,s)=>this._taskCallback(t,s))))return t.numWorkers++,this._totalNumWorkers++,!0;return !1}_taskCallback(t,s){t._cancelled||(this._callbackFunc(t,s),this._taskFinished(t));}getStatsForType(t){const s=this._clients[t];return s?{quota:s.typeWorkerQuota,workers:s.numWorkers,queueSize:s.tasks.length,requestStats:s.statistics}:null}get test(){const t=this;return {set workerFunc(s){t._workerFunc=s;}}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let y$e=class extends y$F{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1;}setup(e,t,s){this._loadQueue=new i$k(((e,t)=>this._startLoading(e,t)),((e,t)=>this._doneLoadingCB(e,t)),e,t),s&&(this._frameTask=s.registerTask(L$D.STREAM_DATA_LOADER,this));}destroy(){this._frameTask=a$W(this._frameTask),this._tasks.forEach((e=>h$T(e.abortController))),this._loadQueue=l$N(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null;}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,s,r={}){const o=D$o();o.__signal=r$W(r)?r.signal:null;const a=this._createOrUpdateTask(e,t,s,r,o);return v$X(r,(()=>this._cancelRequest(a,o))),o.promise}_createTask(e,t,s,r,o,a){const n=new Q$5(e,t,s,r,o);return this._updateTask(n,a),this._tasks.set(o,n),1===this._tasks.size&&this._set("updating",!0),this._loadQueue.push(n),n}_cancelRequest(e,t){A$N(e.resolvers,t),t.reject(m$L()),0===e.resolvers.length&&(e.status===E$e.DOWNLOADING&&(e.status=E$e.CANCELLED,this._loadQueue.cancel(e),e.abortController.abort(),e.request=null,e.abortController=null),e.status=E$e.CANCELLED,this._tasks.delete(e.key),0===this._tasks.size&&this._set("updating",!1));}_updateTask(e,t){e.resolvers.push(t);}_createOrUpdateTask(e,t,s,r,o){const a=T$e(r$W(r)&&r.uid||e,t,s),n=this._tasks.get(a);return n?(this._updateTask(n,o),n):this._createTask(e,r,t,s,a,o)}_doneLoadingCB(e,t){this._loadQueue&&(e$18(e.status===E$e.DOWNLOADING),e.status=E$e.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t));}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();f$V(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress();}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==E$e.DOWNLOADED&&(t.err=t.err||m$L()),this._doneLoading(t.task,t.err),e.madeProgress();}}_doneLoading(e,t){if(t&&!g$T(t)&&e.numRetries>0)return --e.numRetries,void this._loadQueue.push(e);let s=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const r of e.resolvers)if(t)g$T(t)?r.reject(t):r.reject(new s$16("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else {--s;const t=s<=0?e.result:m$N(e.result);r.resolve(t);}this._tasks.delete(e.key),0===this._tasks.size&&this._set("updating",!1);}_startLoading(e,s){if(e.status===E$e.CANCELLED)return !1;let r,o;switch(e.startTime=performance.now(),e.status=E$e.DOWNLOADING,e.docType){case"binary":o="array-buffer",r=0;break;case"image":o="image";break;case"image+type":o="array-buffer";break;default:o="json";}e.abortController=new AbortController;const a=e.abortController.signal;e.request=U$z(e.url,{...e.options,responseType:o,timeout:r,signal:a});let n=()=>{};const i=t=>{e.duration=performance.now()-e.startTime,e.size=t instanceof ArrayBuffer?t.byteLength:e.size||0,e.result=t,this._frameTask?this._onLoadQueue.push({callback:s,task:e}):(e.abortController=null,s(e));},u=t=>{e.status===E$e.DOWNLOADING&&s(e,t),n();};return "image+type"!==e.docType?(e.request.then((e=>i(e.data)),u),!0):(e.request.then((s=>{const l=s.data,h=A$a(l);if(o="image",e.size=l.byteLength,"unknown"===h)return e.request=U$z(e.url,{responseType:o,timeout:r,signal:a}),void e.request.then((e=>i(e.data)),u);const c=new Blob([l],{type:h}),d=window.URL.createObjectURL(c);n=()=>window.URL.revokeObjectURL(d),e.request=U$z(d,{responseType:o,timeout:r,signal:a}),e.request.then((e=>i(new O$d(e.data,h,n))),u);}),u),!0)}get test(){return {loadQueue:this._loadQueue}}};e$Y([d$R({readOnly:!0})],y$e.prototype,"updating",void 0),y$e=e$Y([n$18("esri.views.3d.support.StreamDataLoader")],y$e);const b$a={numRetries:0};function A$a(e){if(e.byteLength<2)return "unknown";const t=new Uint8Array(e,0,e.byteLength);return 137===t[0]&&80===t[1]?"image/png":71===t[0]&&73===t[1]?"image/gif":66===t[0]&&77===t[1]?"image/bmp":255===t[0]&&216===t[1]?"image/jpeg":"unknown"}class O$d{constructor(e,t,s){this.image=e,this.type=t,this.release=s;}get isOpaque(){return "image/jpeg"===this.type}}class Q$5 extends s$m{constructor(e,t,s,r,o){super(r),this.url=e,this.options=t,this.docType=s,this.key=o,this.result=null,this.status=E$e.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=b$a.numRetries;}}function T$e(e,t,s){return `${e}:${t}:${s}`}var E$e;!function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED";}(E$e||(E$e={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let T$d=class extends y$F{constructor(){super(...arguments),this.updating=!1;}};function f$e(e){return new v$b.ResourceController({view:e})}var v$b;e$Y([d$R({readOnly:!0})],T$d.prototype,"updating",void 0),T$d=e$Y([n$18("esri.views.3d.support.ResourceController")],T$d),function(t){let f=class extends T$d{constructor(){super(...arguments),this._scheduler=null,this._memoryController=null,this._streamDataLoader=null,this._scheduleTask=Q$k,this._cameraChangeTime=0,this._handles=new u$U,this._frameTask=null,this._state=N$q.IDLE;}initialize(){this._cameraChangeTime=performance.now(),this._scheduler=A$O(),this._memoryController=l$i(this.view),this._streamDataLoader=new y$e,this._streamDataLoader.setup(I$b,E$f,this._scheduler),this._handles.add([l$M((()=>this.view.state?.camera),((e,t)=>this._cameraChangedHandler(e,t)),U$s),l$M((()=>this.view.stationary),(()=>this._stationaryChangedHandler()))]),this._frameTask=A$L({update:e=>this._frame(e)}),this._scheduleTask=this._scheduler.registerTask(L$D.RESOURCE_CONTROLLER);}destroy(){this._handles=l$N(this._handles),this._scheduleTask.remove(),this._frameTask=a$W(this._frameTask),this._streamDataLoader=l$N(this._streamDataLoader),this._memoryController=l$N(this._memoryController),this._scheduler=l$N(this._scheduler);}get updating(){return !!(this._memoryController?.updating||this._streamDataLoader?.updating||this._scheduleTask?.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}schedule(e,t,r){return this._scheduleTask.schedule(e,t,r)}createStreamDataRequester(e){const t=this._streamDataLoader;return {request:(r,s,a)=>t.request(r,s,e,a),get busy(){return !t.hasDownloadSlots(e)}}}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(u$Y(e.deltaTime)),!this._scheduler)||(this._updateState(),this._scheduler.state=this._state,this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update());}_cameraChangedHandler(e,t){e&&t&&e.almostEquals(t)||(this._cameraChangeTime=performance.now(),this._updateState(),this._scheduler.state=this._state);}_stationaryChangedHandler(){this.memoryController.resetStableQuality();}_updateState(){this.view.animation?this._state=N$q.ANIMATING:this.view.interacting?this._state=N$q.INTERACTING:(this._state===N$q.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=v?this._state=N$q.INTERACTING:this._state=N$q.IDLE);}get test(){return {getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e),state:this._state}}};e$Y([d$R({constructOnly:!0})],f.prototype,"view",void 0),e$Y([d$R()],f.prototype,"_scheduler",void 0),e$Y([d$R()],f.prototype,"_memoryController",void 0),e$Y([d$R()],f.prototype,"_streamDataLoader",void 0),e$Y([d$R()],f.prototype,"_scheduleTask",void 0),e$Y([d$R({readOnly:!0})],f.prototype,"updating",null),f=e$Y([n$18("esri.views.3d.support.ResourceController")],f),t.ResourceController=f;const v=300;}(v$b||(v$b={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function n$n(n){return "performanceInfo"in n}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const M$6=n$16(),x$b=n$16(),S$8=n$16(),j$a=n$16();function v$a(e,o,r=0){const n=e.extent;if(t$V(n))return !1;if(0===r)return b$J(n,o);const i=Math.min(n[2]-n[0],n[3]-n[1]);return q$t(n,o,r*i)}function y$d(e,t,o,l){r$V(M$6,o),M$6[l]=t[l];const c=e$15(M$6,M$6,t),f=e$15(x$b,e,t),u=P$u(f,c),m=P$u(c,c);let p;p=u<=0?t:m<=u?o:u$W(M$6,t,q$p(c,c,u/m));const h=e$15(M$6,e,p);return Math.PI/2-Math.atan(h[2]/Math.sqrt(h[0]*h[0]+h[1]*h[1]))}function T$c(e,o,r){const n=e.extent;if(t$V(n))return 0;S$8[0]=n[0],S$8[1]=n[1],S$8[2]=r,j$a[0]=n[2],j$a[1]=n[3],j$a[2]=r;let i=1/0,s=1/0;return o[0]<S$8[0]?i=y$d(o,S$8,j$a,0):o[0]>j$a[0]&&(i=y$d(o,j$a,S$8,0)),o[1]<S$8[1]?s=y$d(o,S$8,j$a,1):o[1]>j$a[1]&&(s=y$d(o,j$a,S$8,1)),Math.min(i,s)}function w$d(r,n,i){if(t$V(r))return d$P();if(r.spatialReference.isGeographic&&!Ce$1(r.spatialReference))return new s$16("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const s=M$s.checkUnsupported(r);if(r$W(s))return s;if(t$V(i))return new s$16("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const a=R$8(r,i);if(a)return a;const l=r.spatialReference;return r$W(n)&&!(l.equals(n)||n.isWGS84&&l.isWebMercator)?new s$16("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function R$8(t,o){const r=t.lods,n=r[0].resolution*2**r[0].level,i=[n*t.size[0],n*t.size[1]],s=[t.origin.x,t.origin.y],a=c$1p(o),l=u$T();M$s.computeRowColExtent(a,i,s,l);const c=(l[2]-l[0])*(l[3]-l[1]);if(c>t$U){const o=r[0].scale*2**r[0].level;let i=Math.max((a[3]-a[1])/t.size[1],(a[2]-a[0])/t.size[0])*o/n;const s=Math.floor(Math.log(i)/Math.log(10));return i=Math.ceil(i/10**s)*10**s,new s$16("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(o).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+i.toLocaleString()+".",{level0Scale:o,suggestedLevel0Scale:i,requiredNumRootTiles:c,allowedNumRootTiles:t$U})}return null}const b$9=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:v$a,tiltToExtentEdge:T$c,checkIfTileInfoSupportedForViewSR:w$d},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function c$h(){return !0}function a$m(){return 0}function m$j(c,a){if(t$V(c))return d$P();const m=c.lods.length-1,h=c.spatialReference,p=Ce$1(h)||P$v(h)||s$15(h);if(h.isWebMercator){if(!M$s.makeWebMercatorAuxiliarySphere(m).compatibleWith(c))return new s$16("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else {if(!p)return new s$16("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!M$s.makeGCSWithTileSize(c.spatialReference,c.size[0],m).compatibleWith(c))return c.spatialReference.isWGS84?new s$16("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new s$16("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return r$W(a)&&!c.spatialReference.equals(a)?new s$16("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const h$j=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:c$h,tiltToExtentEdge:a$m,checkIfTileInfoSupportedForViewSR:m$j},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const f$d={[l$O.Global]:h$j,[l$O.Local]:b$9};function T$b(e,t){e||console.warn("Terrain: "+t);}const p$b=!1;let m$i=!1;function S$7(e){m$i=e;}function E$d(e,t){}function y$c(e){return O$c(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function H$5(e){return "imagery-tile"===e?.type||"wcs"===e?.type}function O$c(e){return "imagery-tile-3d"===e?.type}function g$h(e){return "tile-3d"===e?.type}function _$a(e){return "vector-tile-3d"===e?.type}function d$e(e){return "wmts-3d"===e?.type}function I$a(e){return "elevation-3d"===e?.type}function R$7(e){return "group"===e?.type}function U$9(e){return e&&(g$h(e)||d$e(e)||O$c(e)||_$a(e))}function W$6(e){return e&&(g$h(e)||O$c(e)||_$a(e)||d$e(e))}function x$a(e){return W$6(e)||I$a(e)}function N$b(e){switch(e.type){case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"line-of-sight":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return !1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return !0;default:return n$1i(e.type),!1}}function b$8(e){const t=e?.sourceLayerInfo?.data;return r$W(t)&&"type"in t&&"raster-tile"===t.type}function h$i(e){const t=e?.sourceLayerInfo?.data;return r$W(t)&&"type"in t&&"vector-tile"===t.type}function A$9(e){const t=e?.sourceLayerInfo?.data;return r$W(t)&&"type"in t&&"tile-texture"===t.type}function w$c(e){const t=e?.sourceLayerInfo?.data;return t instanceof HTMLImageElement||t instanceof O$d||t instanceof HTMLCanvasElement||t instanceof ImageData}function j$9(e){return r$W(e)&&"release"in e&&e.release(),null}function v$9(e){return e.fetchTile&&!1!==e.hasOverriddenFetchTile}function L$b(e,t,n,r){return f$d[r].checkIfTileInfoSupportedForViewSR(e,n,t)}function C$a(e,t,r){let o=null,i=null;if("wmts"===e?.type){const n=k$8(e,t,r);o=n.tileInfo,i=n.fullExtent;}else {i=H$5(e)?e.getCompatibleFullExtent(t):e.fullExtent;const n=r===l$O.Local;if(H$5(e))o=e.getCompatibleTileInfo(t,i,n);else if("vector-tile"===e?.type){const r=n&&!M$5(t)||V$7.force512VTL,i=e.tileInfo.spatialReference.isGeographic;o=r?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,i?1:2);}else o=e.tileInfo;}return r$W(o)&&r$W(i)&&null==L$b(o,i,t,r)?{tileInfo:o,fullExtent:i}:null}function k$8(t,r,o){const c=f$15(t);if(r$W(c)){if(!j$F.isCollection(c))return {tileInfo:c.tileInfo,fullExtent:c.fullExtent};{const e=c.find((e=>null==L$b(e.tileInfo,e.fullExtent,r,o)));if(e)return {tileInfo:e.tileInfo,fullExtent:e.fullExtent}}}return {tileInfo:null,fullExtent:null}}function M$5(e){return e.isWGS84||e.isWebMercator||u$1c(e)||!A$E(e)}const V$7={force512VTL:!1};function F$8(e){return "["+e[0]+","+e[1]+","+e[2]+"]"}function G$8(e){return "("+e[0]+","+e[1]+","+e[2]+")"}function D$8(e,t,n=$$4){return Math.abs(e-t)<n}function P$8(e){return e===E$q.NORTH_EAST?E$q.SOUTH_WEST:e===E$q.NORTH_WEST?E$q.SOUTH_EAST:e===E$q.SOUTH_WEST?E$q.NORTH_EAST:E$q.NORTH_WEST}function q$6(e){return e===E$q.NORTH?E$q.SOUTH:e===E$q.EAST?E$q.WEST:e===E$q.SOUTH?E$q.NORTH:E$q.EAST}function z$5(e){return e===E$q.NORTH_WEST||e===E$q.SOUTH_WEST}function B$a(e){return e===E$q.NORTH_WEST||e===E$q.NORTH_EAST}function J$4(e){return e===E$q.NORTH_WEST||e===E$q.WEST||e===E$q.SOUTH_WEST}function K$6(e){return e===E$q.NORTH_EAST||e===E$q.EAST||e===E$q.SOUTH_EAST}function Q$4(e){return e===E$q.SOUTH_EAST||e===E$q.SOUTH||e===E$q.SOUTH_WEST}function X$3(e){return e===E$q.NORTH_EAST||e===E$q.NORTH||e===E$q.NORTH_WEST}const Y$2=[E$q.NORTH,E$q.EAST,E$q.SOUTH,E$q.WEST],Z$3=[E$q.NORTH_EAST,E$q.SOUTH_EAST,E$q.SOUTH_WEST,E$q.NORTH_WEST],$$4=1e-5;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class t$l{constructor(t,s){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=t.layer,this.memory=x$a(t)?s.basemapTerrain.getUsedMemoryForLayerView(t):t.getUsedMemory(),n$n(t)){const e=t.performanceInfo;this.displayedNumberOfFeatures=e.displayedNumberOfFeatures,this.maximumNumberOfFeatures=e.maximumNumberOfFeatures,this.totalNumberOfFeatures=e.totalNumberOfFeatures;}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class a$l{constructor(a){this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array;const m=a.resourceController.memoryController;this.totalMemory=m.maxMemory*o$1t.MEGABYTES,this.usedMemory=Math.round(m.usedMemory*this.totalMemory),this.quality=m.memoryFactor,this.load=a.resourceController.scheduler.load,this.terrainMemory=a.basemapTerrain?a.basemapTerrain.getUsedMemory():0;const i=a._stage&&a._stage.renderView&&a._stage.renderView.edgeView;this.edgesMemory=r$W(i)?i.usedMemory:0,a.allLayerViews.items.forEach((e=>{(e$o(e)||x$a(e))&&this.layerPerformanceInfos.push(new t$l(e,a));})),this.layerPerformanceInfos.sort(((e,r)=>r.memory-e.memory));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class h$h extends i$1j{constructor(e,t,r,s){super(t,s),this._streamDataRequester=e,this._parameters=r;}async fromUrl(i,o,n){f$V(n);const a=r$W(n)&&n.signal,h=this.makeUid(i,o);let l=this._textureRequests.get(h);if(!l){const e=new AbortController,t=this._streamDataRequester.request(i,"image",{uid:h,signal:e.signal});l={referenceCount:0,texture:null,textureAsync:null,abortController:e},this._textureRequests.set(h,l),l.textureAsync=t.then((async e=>{const t=this._createTexture(i,e,o);return l.texture=t,l.abortController=null,this._stage.add(t),await this._stage.load(t),{uid:h,texture:t,release:()=>this._release(h)}}),(e=>{throw l.abortController=null,e}));}return l.referenceCount++,new Promise(((e,t)=>{v$X(a,(()=>{t(m$L());})),l.textureAsync.then(e,t);})).catch((e=>{throw this._release(h),e}))}_createTexture(e,t,r){const s={...this._parameters,powerOfTwoResizeMode:l$18.PAD};if(It$1(e)){if(r||0===t.width&&0===t.height){const e=t.width?t.height/t.width:1;r=r||64,e>1?(t.width=Math.round(r/e),t.height=r):(t.width=r,t.height=Math.round(r*e));}this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(s.preMultiplyAlpha=!1);}return s.width=t.width,s.height=t.height,new L$H(t,s)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class h$g{constructor(e){this.textures=null,this.streamDataRequester=null,this.graphicsOwners=[],this.screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this.viewState=e.viewState,this.view=e.view,this.pointsOfInterest=e.pointsOfInterest,this.objectResourceCache=e.objectResourceCache,this.streamDataRequester=e.resourceController.createStreamDataRequester(A$b.SYMBOLOGY),this.textures=new h$h(this.streamDataRequester,e.view._stage,{preMultiplyAlpha:!0,wrap:{s:D$q.CLAMP_TO_EDGE,t:D$q.CLAMP_TO_EDGE}},e.resourceController.scheduler);const t=p$T(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=r$1h(e.viewingMode,t),this.screenSizePerspectiveSettingsLabels=n$1z(e.viewingMode,t);}destroy(){this.textures.destroy(),this.textures=null,this.streamDataRequester=null;}addGraphicsOwner(t){if(!t)return n$1A();this.graphicsOwners.push(t);const r=l$M((()=>t.layer?.screenSizePerspectiveEnabled),(()=>this._updateScreenSizePerspectiveEnabled()));return this._updateScreenSizePerspectiveEnabled(),n$1A((()=>{r.remove(),A$N(this.graphicsOwners,t),this._updateScreenSizePerspectiveEnabled();}))}_updateScreenSizePerspectiveEnabled(){const e=this.graphicsOwners.some((e=>!0===e.layer?.screenSizePerspectiveEnabled));if(e&&!this.screenSizePerspectiveHandles){this.screenSizePerspectiveHandles=new u$U;const e=()=>this._updateScreenSizePerspectiveSettings();this.screenSizePerspectiveHandles.add([l$M((()=>this.pointsOfInterest.centerOnSurfaceInfrequent.distance),e,U$s),this.viewState.events.on("camera-projection-changed",e)]),this._updateScreenSizePerspectiveSettings();}else !e&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null);}_updateScreenSizePerspectiveSettings(){const e=this.pointsOfInterest;S$6.distance=e.centerOnSurfaceInfrequent.distance,S$6.fovY=this.viewState.camera.fovY,this.screenSizePerspectiveSettings.update(S$6),this.screenSizePerspectiveSettingsLabels.update(S$6),this.view._stage.renderView.requestRender();}get test(){return {screenSizePerspectiveHandles:this.screenSizePerspectiveHandles}}}const S$6={distance:0,fovY:0};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class c$g{constructor(s,o,i=""){this.graphics=s,this._symbol=new h$17({symbolLayers:[new S$J({material:{color:o},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new j$Q({text:i,halo:{color:"white",size:1/.75},material:{color:o},size:12})]});}show(i,e){if(t$V(e))return;this.hide();const r=new j$P({x:i[0],y:i[1],z:i[2],spatialReference:e});this._graphic=new g$Y({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic);}hide(){r$W(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null);}}class y$b{constructor(s,o,i=""){this.graphics=s,this._graphics=new Array,this._outline=new S$K({symbolLayers:[new f$16({material:{color:[0,0,0,0]},outline:{color:o,size:2}})]}),this._text=new h$17({symbolLayers:[new j$Q({text:i,halo:{color:"white",size:1/.75},material:{color:o},size:12})]});}show(o){this.hide();const i=new j$P({x:o.xmin,y:o.ymin,z:o.zmax,spatialReference:o.spatialReference});this._graphics.push(new g$Y({geometry:v$R.fromExtent(o),symbol:this._outline})),this._graphics.push(new g$Y({geometry:i,symbol:this._text})),this.graphics.addMany(this._graphics);}hide(){this.graphics.removeMany(this._graphics),this._graphics.length=0;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let c$f=class extends y$F{constructor(r){super(r),this.handles=new u$U;}destroy(){this.handles.destroy();}};e$Y([d$R({constructOnly:!0})],c$f.prototype,"renderCoordsHelper",void 0),e$Y([d$R({constructOnly:!0})],c$f.prototype,"surface",void 0),e$Y([d$R({constructOnly:!0})],c$f.prototype,"state",void 0),c$f=e$Y([n$18("esri.views.3d.support.PointOfInterest")],c$f);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const u$j=Array;let m$h=class extends c$f{constructor(t){super(t),this._dirty=!1,this._propertiesPool=new o$1s({location:j$P,renderLocation:u$j},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.cameraName="camera",this.renderLocation=n$16(),this.tmpPoint=new j$P;}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const t=()=>this._setDirty();this.handles.add(a$Z((()=>this.map?.ground?.layers),"change",t,{onListenerAdd:t,onListenerRemove:t}));}this._updateRenderLocation();}destroy(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null;}get _camera(){return this.state[this.cameraName]}get location(){const t=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,t,this.state.spatialReference),t}get scale(){const t=this._camera,e=x$H(t.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:t}};return ee$8(r,e,0)}get updating(){return this._dirty||null!=this._pendingElevationQueryController}updateRenderLocation(){this._setDirty(),this._updateRenderLocation();}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"));}_cancelPendingRequest(){const t=this._pendingElevationQueryController;t&&(this._pendingElevationQueryController=null,t.abort(),this.notifyChange("updating"));}get running(){return !this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return void this._updateSurfaceAltitude(0);this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);let t=new AbortController;this.map.ground.queryElevation(this.tmpPoint,{signal:t.signal,cache:this.cache}).then((t=>this._updateSurfaceAltitude(t.geometry.z))).catch((t=>{g$T(t)||this._updateSurfaceAltitude(0);})).catch((()=>{})).then((()=>{this._pendingElevationQueryController===t&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),t=null;})),this._pendingElevationQueryController=t;}_updateSurfaceAltitude(t){this._estimatedSurfaceAltitude!==t&&(this._estimatedSurfaceAltitude=t,this._updateRenderLocation());}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(y$a,this._estimatedSurfaceAltitude,this._camera.eye),F$t(this._get("renderLocation"),y$a)||this._set("renderLocation",r$V(this._propertiesPool.get("renderLocation"),y$a));}};e$Y([d$R({constructOnly:!0})],m$h.prototype,"scheduler",void 0),e$Y([d$R({constructOnly:!0})],m$h.prototype,"cache",void 0),e$Y([d$R({constructOnly:!0})],m$h.prototype,"task",void 0),e$Y([d$R({constructOnly:!0})],m$h.prototype,"cameraName",void 0),e$Y([d$R({readOnly:!0})],m$h.prototype,"location",null),e$Y([d$R({constructOnly:!0})],m$h.prototype,"map",void 0),e$Y([d$R({readOnly:!0})],m$h.prototype,"renderLocation",void 0),e$Y([d$R({readOnly:!0})],m$h.prototype,"scale",null),e$Y([d$R({readOnly:!0})],m$h.prototype,"updating",null),m$h=e$Y([n$18("esri.views.3d.support.CameraOnSurface")],m$h);const y$a=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const j$8=Array;let k$7=class extends c$f{constructor(t){super(t),this._propertiesPool=new o$1s({location:j$P,renderLocation:j$8},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.cameraName="camera",this.distance=0,this.renderLocation=n$16(),this.updating=!1;}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask();}destroy(){this._frameWorker=a$W(this._frameWorker),this._propertiesPool=l$N(this._propertiesPool);}get _camera(){return this.state[this.cameraName]}get location(){const t=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,t,this.state.spatialReference),t}updateRenderLocation(){this.updating=!0,this._updateRenderLocation();}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1;}_updateRenderLocation(){const t=L$a;let e=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,t);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!e&&r&&(e=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t),e&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=C$9;e&&this._latestSurfaceAltitudeChangesDistanceSignificantly(t,s)&&(r$V(t,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),e?this.distance=x$H(this._camera.eye,t):(q$p(t,this._camera.viewForward,this._get("distance")),u$W(t,t,this._camera.eye)),F$t(this._get("renderLocation"),t)||this._set("renderLocation",r$V(this._propertiesPool.get("renderLocation"),t));}_calculateSurfaceIntersection(t,r){const s=this._camera;if(!this.renderCoordsHelper.intersectManifold(s.ray,t,r))return !1;if(this.state.isGlobal){const e=p$T(this.renderCoordsHelper.spatialReference).radius,i=e+t,o=v$P(s.eye),a=o<i*i,c=x$H(s.eye,r);if(a&&c>e/4){const t=i-Math.sqrt(o);return q$p(r,s.viewForward,t),u$W(r,r,s.eye),!0}}else {const t=this.surface.ready?this.surface.extent:null;r$W(t)&&zn(t,this.surface.spatialReference,O$b,this.renderCoordsHelper.spatialReference)&&(r[0]=o$X(r[0],O$b[0],O$b[2]),r[1]=o$X(r[1],O$b[1],O$b[3]));}return !0}_latestSurfaceAltitudeChangesDistanceSignificantly(t,e){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==t)return !1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e)){if(t$E.TESTS_DISABLE_OPTIMIZATIONS)return !0;const r=this._camera.eye,s=x$H(r,t),i=x$H(r,e);if(Math.abs(i-s)/s>v$8)return !0}return !1}};e$Y([d$R({constructOnly:!0})],k$7.prototype,"scheduler",void 0),e$Y([d$R({constructOnly:!0})],k$7.prototype,"task",void 0),e$Y([d$R({constructOnly:!0})],k$7.prototype,"cameraName",void 0),e$Y([d$R()],k$7.prototype,"distance",void 0),e$Y([d$R({constructOnly:!0})],k$7.prototype,"estimateSurfaceAltitudeAtCenter",void 0),e$Y([d$R({readOnly:!0})],k$7.prototype,"location",null),e$Y([d$R({readOnly:!0})],k$7.prototype,"renderLocation",void 0),e$Y([d$R()],k$7.prototype,"updating",void 0),k$7=e$Y([n$18("esri.views.3d.support.CenterOnSurface")],k$7);const v$8=.05,L$a=n$16(),C$9=n$16(),O$b=u$T();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class t$k{constructor(t){this.handles=new u$U,this.events=new n$17,this.contentLayerViews=t.contentLayerViews,this.handles.add(this.contentLayerViews.on("change",(e=>this._layerViewsChanged(e)))),this._layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews});}destroy(){this.handles&&(this.handles.destroy(),this.handles=null);}_layerViewsChanged(e){e.added.forEach((e=>{"esri.views.3d.layers.SceneLayerView3D"===e.declaredClass&&this.handles.add(e.on("visible-geometry-changed",(()=>this._contentChanged())),e.uid);})),e.removed.forEach((e=>this.handles.remove(e.uid)));}_contentChanged(){this.events.emit("request-update",n$m);}}const n$m={};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const O$a=Array;let j$7=class extends c$f{constructor(e){super(e),this._propertiesPool=new o$1s({location:j$P,renderLocation:O$a},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation");}initialize(){this.handles.add([l$M((()=>this.centerOnSurface.renderLocation),(()=>this.updateRenderLocation())),l$M((()=>this.state.contentCamera),(()=>this.updateRenderLocation()))]),this.scheduler&&this.handles.add(this.scheduler.registerTask(L$D.POINT_OF_INTEREST_FREQUENT,this));}destroy(){this._propertiesPool.destroy(),this._propertiesPool=null;}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),r=this.centerOnSurface.renderLocation,o=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,o.worldUpAtPosition(r,P$7);const i=Math.max(0,(Math.acos(P$u(P$7,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(i)){if(!e||!G$l(e,r)){const e=this._propertiesPool.get("renderLocation");r$V(e,r),this._set("renderLocation",e);}return}const p=1-o$X(i/(.5*Math.PI),0,1),l=p*p*p;this._calculateScreenHorizontalEdgeOnSurface(L$9);const h=this._propertiesPool.get("renderLocation");A$C(h,r,L$9,l),e&&G$l(e,h)||this._set("renderLocation",h);}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,r=t.getRenderCenter(x$J());if(r[1]=t.aboveGround?t.padding[et$6.BOTTOM]:t.fullHeight-t.padding[et$6.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(r,S$5)){e$15(S$5,S$5,t.eye);const r=z$s(S$5,S$5);if(this.renderCoordsHelper.intersectManifold(j$G(t.eye,r),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,t.eye)}updateRenderLocation(){this._dirty=!0;}};e$Y([d$R()],j$7.prototype,"_dirty",void 0),e$Y([d$R({constructOnly:!0})],j$7.prototype,"scheduler",void 0),e$Y([d$R({constructOnly:!0})],j$7.prototype,"centerOnSurface",void 0),e$Y([d$R({constructOnly:!0})],j$7.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),e$Y([d$R({readOnly:!0})],j$7.prototype,"updating",null),e$Y([d$R({readOnly:!0})],j$7.prototype,"location",null),e$Y([d$R({readOnly:!0})],j$7.prototype,"renderLocation",void 0),j$7=e$Y([n$18("esri.views.3d.support.CenterOnSurface")],j$7);const P$7=n$16(),S$5=n$16(),L$9=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let h$f=class extends y$F{constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new u$U;}get renderLocation(){if(!this.location)return null;const e=n$16();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}initialize(){this.view.state.isLocal&&(this._handles.add([l$M((()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent]),(()=>this._update())),a$Z((()=>this.surface?.layers),"change",(()=>this._update()))]),this._update());}destroy(){this._handles.destroy();}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||t$V(this.surfaceView.extent)||!this.surfaceView.spatialReference)return void this._set("location",null);const e=p$17(this.surfaceView.extent),t=new j$P({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then((e=>{this._updateController=null,this._set("location",e.geometry);})).catch((e=>{g$T(e)||e&&"elevation-query:invalid-layer"===e.name||console.error("StableSurfaceCenter failed to update: ",e);}))):this._set("location",t);}};e$Y([d$R({constructOnly:!0})],h$f.prototype,"view",void 0),e$Y([d$R({constructOnly:!0})],h$f.prototype,"cache",void 0),e$Y([d$R({readOnly:!0,aliasOf:"view.map.ground"})],h$f.prototype,"surface",void 0),e$Y([d$R({readOnly:!0,aliasOf:"view.basemapTerrain"})],h$f.prototype,"surfaceView",void 0),e$Y([d$R({readOnly:!0})],h$f.prototype,"location",void 0),e$Y([d$R({readOnly:!0})],h$f.prototype,"renderLocation",null),h$f=e$Y([n$18("esri.views.3d.terrain.StableSurfaceCenter")],h$f);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let u$i=class extends y$F{constructor(){super(...arguments),this.handles=new u$U,this._tileGeometryUpdateExtent=D$s(),this._tileGeometryUpdateSpatialReference=null,this.events=new n$17,this.updating=!1;}initialize(){this.handles.add([this.surface.on("elevation-change",(e=>this._tileGeometryChanged(e))),this.scheduler.registerTask(L$D.SURFACE_GEOMETRY_UPDATES,this)]);}destroy(){this.handles=l$N(this.handles);}get running(){return this.updating}runTask(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",l$h),D$s(this._tileGeometryUpdateExtent),this._set("updating",!1));}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,h$_(this._tileGeometryUpdateExtent,e.tile.extent,this._tileGeometryUpdateExtent),this._set("updating",!0);}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const r=this.centerOnSurfaces[t];r.distance>e.distance&&(e=r);}return e}_centerIntersectsExtent(e,t){const r=this.state.camera.eye,s=f$c,o=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,m$g,t),this.renderCoordsHelper.fromRenderCoords(o.renderLocation,y$9,t),m$g[0]<y$9[0]?(s[0]=m$g[0],s[2]=y$9[0]):(s[0]=y$9[0],s[2]=m$g[0]),m$g[1]<y$9[1]?(s[1]=m$g[1],s[3]=y$9[1]):(s[1]=y$9[1],s[3]=m$g[1]),E$L(s,e)}};e$Y([d$R({constructOnly:!0})],u$i.prototype,"state",void 0),e$Y([d$R({constructOnly:!0})],u$i.prototype,"centerOnSurfaces",void 0),e$Y([d$R({constructOnly:!0})],u$i.prototype,"renderCoordsHelper",void 0),e$Y([d$R({constructOnly:!0})],u$i.prototype,"scheduler",void 0),e$Y([d$R({constructOnly:!0})],u$i.prototype,"surface",void 0),e$Y([d$R({readOnly:!0})],u$i.prototype,"updating",void 0),u$i=e$Y([n$18("esri.views.3d.support.SurfaceGeometryUpdates")],u$i);const l$h={},m$g=n$16(),y$9=n$16(),f$c=D$s();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let E$c=class extends y$F{constructor(e){super(e),this._handles=new u$U,this._tmpRay=d$U(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new o$1s({renderPointOfView:N$a},this),this.renderPointOfView=n$16(),this._pois=new Array,this._debugCenters=new Map;}initialize(){const{state:e,basemapTerrain:t,renderCoordsHelper:r,map:n}=this.view;this._surfaceIntersector=x$K(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=t$1g.MIN,this._contentIntersector=x$K(e.viewingMode);const h=()=>this._estimateSurfaceAltitudeAtCenter(),d=this.view.resourceController.scheduler,f=e$X(this.view.basemapTerrain?.elevationQueryCache),p={state:e,scheduler:d,surface:t,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new k$7({...p,task:L$D.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:h})),this._set("centerOnSurfaceFrequent",new k$7({...p,task:L$D.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:h})),this._set("contentCenterOnSurface",new k$7({...p,task:L$D.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:h,cameraName:"contentCamera"})),this._set("centerOnContent",new k$7({...p,task:L$D.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new m$h({...p,cache:f,task:L$D.POINT_OF_INTEREST_INFREQUENT,map:n})),this._set("contentCameraOnSurface",new m$h({...p,cache:f,task:L$D.POINT_OF_INTEREST_INFREQUENT,map:n,cameraName:"contentCamera"})),this._set("surfaceGeometryUpdates",new u$i({...p,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new t$k({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new h$f({cache:f,view:this.view})),this._set("focus",new j$7({state:e,scheduler:d,surface:t,renderCoordsHelper:r,centerOnSurface:this.contentCenterOnSurface,estimateSurfaceIntersectionAtRenderPoint:(e,t)=>this._estimateSurfaceIntersectionAtRenderPoint(e,this.view.state.contentCamera,t)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);const m=this.view.graphics;this._debugCenters.set(this.centerOnContent,new c$g(m,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new c$g(m,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new c$g(m,"red","CenterOnSurface")),this._debugCenters.set(this.contentCenterOnSurface,new c$g(m,"red","ContentCenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new c$g(m,"blue","CameraOnSurface")),this._debugCenters.set(this.contentCameraOnSurface,new c$g(m,"blue","ContentCameraOnSurface")),this._debugCenters.set(this.focus,new c$g(m,"green","Focus")),this._handles.add([l$M((()=>e.camera),(e=>this._cameraChanged(e)),U$s),l$M((()=>t.extent),(()=>this._updateCenterPointsOfInterest())),f$R((()=>!t.updating),(()=>this._updateCenterPointsOfInterest()),U$s),a$Z((()=>this.surfaceGeometryUpdates.events),"request-update",(()=>this._updateCenterPointsOfInterest())),a$Z((()=>this.contentGeometryUpdates.events),"request-update",(()=>this._updateCenterOnContent())),f$R((()=>t$E.SHOW_POI),(e=>this._setDebug(e)),h$V)]),this._cameraChanged(this.view.state.camera);for(const s of this._pois)s.runTask();}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy();}get updating(){return !(!this.surfaceGeometryUpdates?.updating&&!this._pois.some((e=>e.updating)))}get centerRay(){return this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1),this._centerRay}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this.centerRay;return t$V(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,U$8,D$7)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(U$8):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this.centerRay;if(t$V(e))return this._surfaceAltitudeAtCenter;const t=e.origin,r=u$W(U$8,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.camera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,r),this._surfaceIntersector.results.min.getIntersectionPoint(U$8)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(U$8)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,r){const s=g$C(t,e,F$7);if(t$V(s))return null;const i=s.origin,o=u$W(U$8,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,i,o),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;F$t(this.renderPointOfView,t)||this._set("renderPointOfView",r$V(this._propertiesPool.get("renderPointOfView"),t));}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation();}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation();}_setDebug(e){if(!e)return this._debugCenters.forEach((e=>e.hide())),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(l$M((()=>t.renderLocation),(e=>this._debugCenters.get(t).show(e,t.renderCoordsHelper.spatialReference)),h$V),"debug");}get test(){return {update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask();},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};e$Y([d$R({readOnly:!0})],E$c.prototype,"centerOnContent",void 0),e$Y([d$R({readOnly:!0})],E$c.prototype,"centerOnSurfaceFrequent",void 0),e$Y([d$R({readOnly:!0})],E$c.prototype,"centerOnSurfaceInfrequent",void 0),e$Y([d$R({readOnly:!0})],E$c.prototype,"contentCenterOnSurface",void 0),e$Y([d$R({readOnly:!0})],E$c.prototype,"cameraOnSurface",void 0),e$Y([d$R({readOnly:!0})],E$c.prototype,"contentCameraOnSurface",void 0),e$Y([d$R({readOnly:!0})],E$c.prototype,"focus",void 0),e$Y([d$R({readOnly:!0})],E$c.prototype,"renderPointOfView",void 0),e$Y([d$R({readOnly:!0})],E$c.prototype,"surfaceOrigin",void 0),e$Y([d$R({readOnly:!0})],E$c.prototype,"contentGeometryUpdates",void 0),e$Y([d$R({readOnly:!0})],E$c.prototype,"surfaceGeometryUpdates",void 0),e$Y([d$R({constructOnly:!0})],E$c.prototype,"view",void 0),e$Y([d$R({readOnly:!0})],E$c.prototype,"updating",null),E$c=e$Y([n$18("esri.views.3d.support.PointsOfInterest")],E$c);const N$a=Array,U$8=n$16(),F$7=d$U(),D$7={exclude:new Set([j$H])};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class t$j{constructor(t){this.store=t;}destroy(){this.store.destroy();}get(t){return this.store.get(t)}put(t,s){this.store.put(t,s,s.values.byteLength+256);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const e$m={value:.5,readOnly:!0},t$i={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$l{constructor(s=0,a=0){this.min=s,this.max=a,this.level=0,this.hasNoDataValues=!1;}copyFrom(s){this.min=s.min,this.max=s.max,this.level=s.level,this.hasNoDataValues=s.hasNoDataValues;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class e$l{constructor(t,a,o){this.type="elevation",this.samplerData=null,this.level=t[0],this.i=t[1],this.j=t[2],this.extent=a;const s=o.noDataValue,i=o.values;let e=1/0,l=-1/0,h=!0,r=!1;for(let n=0;n<i.length;n++){const t=i[n];t!==s?(e=t<e?t:e,l=t>l?t:l,h=!1):r=!0;}h&&(e=0,l=0),l=l>-3e38?l:0,this.samplerData={pixelData:o.values,width:o.width,height:o.height,noDataValue:s,safeWidth:.99999999*(o.width-1),dx:(o.width-1)/(a[2]-a[0]),dy:(o.width-1)/(a[3]-a[1]),x0:a[0],y1:a[3]},this.bounds=[e,l],this.hasNoDataValues=r;}release(){this.samplerData=null,this.bounds=null;}computeMinMaxValue(t,a,o,e){e.min=1/0,e.max=-1/0,e.hasNoDataValues=!1;const l=t-this.level;if(l<=0)return e;const h=2**l;if(!(Math.floor(a/h)===this.i&&Math.floor(o/h)===this.j))return e;let r=1/0,n=-1/0;const u=this.samplerData.width,f=this.samplerData.pixelData,m=.5*C$x;let c=(u-1)/h,p=(o-this.j*h)*c,d=(a-this.i*h)*c;if(c<1){const t=Math.floor(p),a=Math.floor(d),o=t+a*u,i=f[o],l=f[o+1],h=f[o+u],r=f[o+u+1];if(i+l+h+r<m){const o=p-t,n=d-a,u=g$12(i,l,h,r,o,n),f=g$12(i,l,h,r,o+c,n),m=g$12(i,l,h,r,o,n+c),x=g$12(i,l,h,r,o+c,n+c);return e.min=Math.min(u,f,m,x),e.max=Math.max(u,f,m,x),e}p=t,d=a,c=1;}else p=Math.floor(p),d=Math.floor(d),c=Math.ceil(c);for(let s=p;s<=p+c;s++)for(let t=d;t<=d+c;t++){const a=f[s+t*u];a<m?(r=Math.min(r,a),n=Math.max(n,a)):e.hasNoDataValues=!0;}return e.min=r,e.max=n,e}}function l$g(o,s,e){if(t$V(e))return null;for(const a of e){if(!a)continue;const e=a.safeWidth;let l=o$X(a.dy*(a.y1-s),0,e),h=o$X(a.dx*(o-a.x0),0,e);const r=Math.floor(l),n=Math.floor(h),u=a.width,f=r*u+n,m=a.pixelData,c=m[f],p=m[f+1],d=f+u,x=m[d],M=m[d+1];if(c+x+p+M<.5*C$x){l-=r,h-=n;const t=c+(p-c)*h;return t+(x+(M-x)*h-t)*l}}return null}function h$e(t,a,s){const i=l$g(t,a,s);return r$W(i)?i:0}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let w$b=class extends y$F{constructor(e){super(e),this._handles=new u$U;}initialize(){this._handles.add([this.layerViews.on("change",(()=>this.notifyChange("stencilEnabledExtents")))]);}destroy(){this._handles.destroy(),this._handles=null;}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach((t=>{const r=t.layer;if("IntegratedMeshLayer"===r.operationalLayerType&&null!=this.viewSpatialReference){const t=j$6(r.fullExtent,this.viewSpatialReference);r$W(t)&&e.push(c$1p(t));}})),e}};function g$g(e,t){return e===l$O.Global?new _$9(t):new L$8(t)}e$Y([d$R({readOnly:!0})],w$b.prototype,"layerViewsExtent",null),e$Y([d$R({readOnly:!0})],w$b.prototype,"tiledLayersExtent",null),e$Y([d$R({readOnly:!0})],w$b.prototype,"stencilEnabledExtents",null),e$Y([d$R()],w$b.prototype,"viewSpatialReference",void 0),e$Y([d$R()],w$b.prototype,"tilingScheme",void 0),e$Y([d$R()],w$b.prototype,"defaultTiledLayersExtent",void 0),e$Y([d$R({constructOnly:!0})],w$b.prototype,"layers",void 0),e$Y([d$R({constructOnly:!0})],w$b.prototype,"layerViews",void 0),w$b=e$Y([n$18("esri.views.3d.terrain.ExtentHelper")],w$b);let _$9=class extends w$b{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?s$14:T$A}};_$9=e$Y([n$18("esri.views.3d.terrain.ExtentHelperGlobal")],_$9);let L$8=class extends w$b{_computeLayerViewsExtent(){const e=D$s(),t=this.viewSpatialReference;this.layerViews.forEach((r=>{const s=r.layer;if(r.isResolved()&&("graphics"!==s.type||!s.internal)){const s=j$6("fullExtentInLocalViewSpatialReference"in r&&r.fullExtentInLocalViewSpatialReference||r.layer.fullExtent,t);h$_(e,s,e);}}));const r=M$w(e)?e:null,s=this._get("layerViewsExtent");return I$B(r,s)?s:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,r=D$s();this.layers.forEach((i=>{if(i.loaded&&t$1m(i)){const o=C$a(i,t,l$O.Local);if(t$V(o))return;const{tileInfo:l,fullExtent:a}=o;r$W(l)&&r$W(a)&&(H$5(i)||e.compatibleWith(l)&&a.spatialReference.equals(e.spatialReference))&&h$_(r,a,r);}})),h$_(r,this.defaultTiledLayersExtent,r);const i=M$w(r)?r:null,o=this._get("tiledLayersExtent");return I$B(i,o)?o:i}};function j$6(e,t){return r$W(e)&&!e.spatialReference.equals(t)?Sn(e,e.spatialReference,t):e}L$8=e$Y([n$18("esri.views.3d.terrain.ExtentHelperLocal")],L$8);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var A$8;!function(A){A[A.ELEVATION=0]="ELEVATION",A[A.MAP=1]="MAP";}(A$8||(A$8={}));const E$b=[A$8.ELEVATION,A$8.MAP];

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function e$k(){const e=globalThis.require?.modules;if(e){const o=Object.keys(e);for(const s of o)-1!==s.search(".glsl")&&delete e[s];}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const ne$3=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let oe$6,le$5=class extends y$F{constructor(e){super(e),this._handles=new u$U,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=a$12("esri-mobile")?2048:4096,this._animationTimeLast=0;}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||t$E.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return r$W(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?p$T(this._spatialReference).metersPerDegree:1}get view(){return this.surface.view}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}initialize(){const e=this.view;this.renderer=new he$9({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=x$K(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",(()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights");})),this.renderer.events.on("has-water",(t=>e._stage?.renderView.setRenderParameters({hasOverlayWater:t}))),this.renderer.events.on("renders-occluded",(()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded");})),this.renderer.events.on("content-changed",(()=>this.setDrawTexturesDirty())),this.renderer.events.on("textures-disposed",(()=>this.updateOverlayResult())),l$M((()=>[e.pointsOfInterest?.renderPointOfView,e.pointsOfInterest?.centerOnSurfaceFrequent?.location]),(()=>this.setPlacementDirty())),l$M((()=>e.state?.pixelRatio),(()=>this.setPlacementDirty()),U$s),this.surface.on("elevation-change",(()=>this.setPlacementDirty())),e.on("resize",(()=>this.setPlacementDirty())),A$L({preRender:e=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(e),this._drawOverlayTextures(this.renderer.overlays,t$1n.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory();}}),e.resourceController.scheduler.registerTask(L$D.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",(e=>{this._updateOverlays(e,t$1n.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,t$1n.BACKGROUND,e);}))]);}destroy(){this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null),r$W(oe$6)&&(oe$6.hide(),oe$6=null);}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this.view.renderSpatialReference;r$W(e)&&r$W(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new i$1k(-20037508.342787,20037508.342787):new i$1k(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays();}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,t,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,t,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,y$p)}_updateDrapeSourceExtent(e){2===this.renderer.overlays.length&&r$W(e.setDrapingExtent)&&r$W(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference);}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"));}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);}updateOverlayResult(){this.view._stage?.renderView.setRenderParameters({overlays:this.renderer.overlays});}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets);}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty();}setPlacementDirty(){this._placementDirty=!0;}runTask(){this._updateOverlays(this.view.state.camera,t$1n.UPDATE);}_updateOverlays(e,t){if(!this._spatialReference)return;const r=g$s(e.fullWidth,e.fullHeight,this._maxResolution);this._computeOverlayExtents(e,r,ue$5);const s=s$1k(ue$5.inner)/s$1k(ue$5.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const i=this._updateOverlay(T$p.INNER,ue$5.inner,r,1*ue$5.pixelRatioAdjustment,ue$5.mapUnitsPerPixel),a=this._updateOverlay(T$p.OUTER,ue$5.outer,r,s*ue$5.pixelRatioAdjustment,ue$5.mapUnitsPerPixel);i!==ye$3.EXTENT&&a!==ye$3.EXTENT||(this._drapeSources.forEach((e=>this._updateDrapeSourceExtent(e))),this.surface.updateTileOverlayParams(t)),i===ye$3.NONE&&a===ye$3.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1;}_updateOverlay(e,t,r,s,i){if(0===this.renderer.overlays.length)return ye$3.NONE;const a=this.renderer.overlays[e],n=a.mapUnitsPerPixel;if(a.mapUnitsPerPixel=i,a.pixelRatio=s,he$4(t,a.extent)&&r===a.resolution)return n===i?ye$3.NONE:ye$3.RERENDER_ONLY;a$1e(a.extent,t),a.resolution=r;const o=p$17(a.extent);return a.renderLocalOrigin=c$z(o[0],o[1],0,"OV_"+this._latestOriginId++),ye$3.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[T$p.INNER],s=this.renderer.overlays[T$p.OUTER],i=U$A(e.extent,this.surface.extent,pe$5);this._rectInsideRect(r.extent,i)||this._rectanglesOverlap(i,r.extent)||this._rectanglesOverlap(i,s.extent)?(this._setTileOverlayData(i,T$p.INNER,t),this._setTileOverlayData(i,T$p.OUTER,t)):(this._clearTileOverlayData(T$p.INNER,t),this._clearTileOverlayData(T$p.OUTER,t));}else this._clearTileOverlayData(T$p.INNER,t),this._clearTileOverlayData(T$p.OUTER,t);}overlayPixelSizeInMapUnits(e){if(0===this.renderer.overlays.length)return 0;const t=this.renderer.overlays[T$p.INNER],r=this.renderer.overlays[T$p.OUTER],s=this._pointIsInExtent(e,t.extent)?t:r;return (s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,t,r){if(0===this.renderer.overlays.length)return;const s=this.renderer.overlays[t].extent,i=s$1k(s),a=l$Y(s);let n=e[0];if(this._longitudeCyclical){n=this._longitudeCyclical.minimalMonotonic(s[0],n);const t=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);n>t&&(n=t-(e[2]-e[0]));}r.setScale(t,s$1k(e)/i,l$Y(e)/a),r.setOffset(t,(n-s[0])/i,(e[1]-s[1])/a);}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1);}async reloadShaders(){e$k(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask();}_dispatchAnimationUpdate(e){const t=n$1e(e.time-this._animationTimeLast);(t>=this.surface.view._stage.renderView.animationTimestep||r$W(this.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)&&(this.renderer.updateAnimation({dt:t,forcedTime:this.forcedAnimationTime,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e.time);}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this.setPlacementDirty();}_intersectGroundFromView(e,t,r,s){const i=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,me$5,t,r);if(t$V(i))return !1;const a=i.origin,n=u$W(de$5,i.origin,i.direction);return this._groundIntersector.reset(a,n,e),this._groundIntersector.intersect([],null),this.view.basemapTerrain.intersect(this._groundIntersector,null,a,n),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,t){let r=.5;const i=.55,a=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,l=1e-5,h=o$X(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:a+l,e.aboveGround?a-l:1/0),c=e.aboveGround;if("global"===this.view.viewingMode){const t=de$5;B$r(T$D($$j,p$T(this.view.spatialReference).radius+h),j$G(e.eye,e.viewForward),t),e$15(t,t,e.eye);const a=r$15.normalize(i$1l(e.viewForward,t,e.viewRight))/e.fovY+.5,n=a<=0||a>=1?.5:i;r=c?n*a:a+n*(1-a);}else {const t=.5*Math.PI-Math.acos(-e.viewForward[2]),s=Math.tan(t),a=r$Z(0,s,1,0),o=w$z(a,a,e.projectionMatrix)[1],l=o$X(.5+.5*o,0,1);r=1===l||0===l?.5:c?l*i:1-(1-l)*i;}return !!this._intersectGroundFromView(e,.5,r,t)&&X$b(t,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,t,r){const s=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,i=n$16();this._findHorizonBasedPointOfInterest(e,i)||r$V(i,s);const a=Math.max(.1,x$H(e.eye,i)),n=n$X(this.view.renderCoordsHelper,s,e.eye),d=Math.PI/2-Math.abs(n-Math.PI/2);t$E.OVERLAY_SHOW_CENTER?(t$V(oe$6)&&(oe$6=new c$g(this.view.graphics,"red")),oe$6.show(i,this._renderSR)):r$W(oe$6)&&oe$6.hide(),this._overlaySREqualsRenderSR||Bn(i,this._renderSR,i,this._spatialReference);const u=this.surface.extent,p=!this._isSpherical&&r$W(this._spatialReference)&&this._spatialReference.isGeographic,_=p&&r$W(this._spatialReference)?1/p$T(this._spatialReference).metersPerDegree:1,m=e.perRenderPixelRatio*a*_;r.mapUnitsPerPixel=m/this._worldToPCSRatio;let y=t*m/2,f=!1,v=p?90:1/0;this._isSpherical&&r$W(u)&&r$W(this._spatialReference)&&(this._spatialReference.isWebMercator?(y/=Math.cos(c$_(i[1])),v=u[3]):(f=!0,y/=p$T(this._spatialReference).metersPerDegree,v=90),y>=v&&(y=v,i[1]=0,this._spatialReference.isWebMercator&&(i[0]=0)));let R=1;f&&(R=1/Math.max(.2,Math.cos(Math.abs(M$t(i[1])))),y*R>180&&(R=180/y),r.mapUnitsPerPixel*=R);const D=Math.log(2)/12;y=Math.exp(Math.round(Math.log(y)/D)*D);const E=y*R,P=32,C=.5*t/(P*E),N=.5*t/(P*y);i[0]=Math.round(i[0]*C)/C,i[1]=Math.round(i[1]*N)/N;const A=r.inner;A[0]=i[0]-E,A[1]=i[1]-y,A[2]=i[0]+E,A[3]=i[1]+y,this._isSpherical&&this._shiftExtentToFitBounds(A,1/0,v);const H=r.outer;if(6*E>s$1k(u))a$1e(H,e$X(u));else if(d<=.25*Math.PI)H[0]=A[0]-E,H[1]=A[1]-y,H[2]=A[2]+E,H[3]=A[3]+y;else {Bn(e.eye,this._renderSR,de$5,this._spatialReference),o$1l(ce$6,i,de$5);let t=-Math.atan2(ce$6[1],ce$6[0])+.125*Math.PI;t<0&&(t+=2*Math.PI);const r=Math.floor(t/(.25*Math.PI));l$X(ce$6,ne$3[r],2*y),ce$6[0]*=R,ce$6[2]*=R,s$1u(H,A,ce$6);}if(this._isSpherical)H[0]=this._longitudeCyclical.clamp(H[0]),H[2]=this._longitudeCyclical.clamp(H[2]),H[1]=Math.max(H[1],-v),H[3]=Math.min(H[3],v);else {const e=U$A(A,u,pe$5),t=U$A(H,u,_e$3);R$z(e,t)&&(H[2]=H[0],H[3]=H[1]);}const L=Math.abs(A[2]-A[0])/t;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,L),r.pixelRatioAdjustment=r.mapUnitsPerPixel/L;}_drawOverlayTextures(e,t,r=this.view.state.camera){if(0===e.length||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const s=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const i=this._drawOverlay(e[T$p.INNER],r),a=this._drawOverlay(e[T$p.OUTER],r);i!==A$I.CHANGED&&a!==A$I.CHANGED||this.surface.updateTileOverlayParams(t$1n.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),s?(this.surface.requestRender(t),t===t$1n.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(t$1n.BACKGROUND);}_drawOverlay(e,t){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,t.pixelRatio)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e);}}_rectanglesOverlap(e,t){return !t$V(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):E$L(e,t))}_rectInsideRect(e,t){return !t$V(t)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:R$z(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const r=e.x,s=e.y;return r>t[0]&&r<t[2]&&s>t[1]&&s<t[3]}_shiftExtentToFitBounds(e,t,r){let s=0,i=0;e[0]<-t?s=e[0]+t:e[2]>t&&(s=t-e[2]),e[1]<-r?i=e[1]+r:e[3]>r&&(i=r-e[3]),z$u(e,s,i);}get test(){return {renderer:this.renderer,update:()=>this.runTask()}}};function he$4(e,t){const r=1e-5,s=t$E.TESTS_DISABLE_OPTIMIZATIONS?0:r*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=s&&Math.abs(t[1]-e[1])<=s&&Math.abs(t[2]-e[2])<=s&&Math.abs(t[3]-e[3])<=s}e$Y([d$R()],le$5.prototype,"_spatialReference",void 0),e$Y([d$R({readOnly:!0})],le$5.prototype,"running",null),e$Y([d$R()],le$5.prototype,"_placementDirty",void 0),e$Y([d$R()],le$5.prototype,"_contentUpdated",void 0),e$Y([d$R()],le$5.prototype,"_isSpherical",null),e$Y([d$R()],le$5.prototype,"_worldToPCSRatio",null),e$Y([d$R()],le$5.prototype,"renderer",void 0),e$Y([d$R({constructOnly:!0})],le$5.prototype,"surface",void 0),e$Y([d$R({readOnly:!0,aliasOf:"surface.suspended"})],le$5.prototype,"suspended",void 0),e$Y([d$R({readOnly:!0})],le$5.prototype,"updating",null),e$Y([d$R({type:Boolean})],le$5.prototype,"hasHighlights",null),e$Y([d$R({type:Boolean})],le$5.prototype,"rendersOccluded",null),le$5=e$Y([n$18("esri.views.3d.terrain.OverlayManager")],le$5);const ce$6=n$1a(),de$5=n$16(),ue$5={inner:u$T(),outer:u$T(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},pe$5=u$T(),_e$3=u$T(),me$5=d$U();var ye$3;!function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY";}(ye$3||(ye$3={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class t$h{constructor(e,t){this._factoryCallback=e,this._lengthCallback=t,this._pool=new Map;}acquire(e){if(!t$h.test.disabled){const t=this._pool.get(e);if(t&&0!==t.length)return t.pop()}try{return this._factoryCallback(e)}catch(o){const t=window.performance&&window.performance.memory;let i="";throw t&&(i=`\n  totalJSHeapSize: ${t.totalJSHeapSize}, usedJSHeapSize: ${t.usedJSHeapSize}, jsHeapSizeLimit: ${t.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+o+i),o}}release(o){if(t$h.test.disabled)return;const i=this._lengthCallback(o);let s=this._pool.get(i);s||(s=new n$1l({shrink:!0}),this._pool.set(i,s)),s.push(o);}clear(){this._pool.clear();}get test(){return {size:this._pool.size}}}t$h.test={disabled:!1};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class h$d{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=B$t(),this.indexCount=0,this.numVerticesPerSide=0,this.uvOffsetAndScale=n$1a(),this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null];}}class n$l{constructor(t,e,s,i,r){this._buf=t,this._localOrigin=e,this.offset0=s,this.stride=i,this.count=r;}getVertexOffset(t){return E$d(0<=t&&t<this.count),this.offset0+this.stride*t}getVertex(t,e){const s=this.getVertexOffset(e)*H$l;t[0]=this._buf[s+0]+this._localOrigin[0],t[1]=this._buf[s+1]+this._localOrigin[1],t[2]=this._buf[s+2]+this._localOrigin[2];}getVertexZ(t){const e=this.getVertexOffset(t)*H$l;return this._buf[e+2]+this._localOrigin[2]}setVertex(t,e,s,i){const f=this.getVertexOffset(t)*H$l;this._buf[f+0]=e[0]-this._localOrigin[0],this._buf[f+1]=e[1]-this._localOrigin[1],this._buf[f+2]=e[2]-this._localOrigin[2],this._buf[f+3]=s,this._buf[f+4]=i;}getNormal(t,e){const s=this.getVertexOffset(e)*H$l;t[0]=this._buf[s+5],t[1]=this._buf[s+6],t[2]=this._buf[s+7];}setVertexRawXYZUV(t,e,s,i,f,u){const h=this.getVertexOffset(t)*H$l;this._buf[h+0]=e,this._buf[h+1]=s,this._buf[h+2]=i,this._buf[h+3]=f,this._buf[h+4]=u;}setVertexRawXYZUVN(t,e,s,i,f,u,h,n,o){const l=this.getVertexOffset(t)*H$l;this._buf[l+0]=e,this._buf[l+1]=s,this._buf[l+2]=i,this._buf[l+3]=f,this._buf[l+4]=u,this._buf[l+5]=h,this._buf[l+6]=n,this._buf[l+7]=o;}setVertexRawNormal(t,e,s,i){const f=this.getVertexOffset(t)*H$l;this._buf[f+5]=e,this._buf[f+6]=s,this._buf[f+7]=i;}getVertexRawNormal(t,e){const s=this.getVertexOffset(e)*H$l;t[0]=this._buf[s+5],t[1]=this._buf[s+6],t[2]=this._buf[s+7];}}const o$j=T$C().vec3f(O$J.POSITION).vec2f(O$J.UV0).vec3f(O$J.NORMAL),l$f=new t$h((t=>o$j.createBuffer(t)),(t=>t.count));function c$e(){l$f.clear();}function b$7(t){return l$f.acquire(t)}function _$8(t){l$f.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null;}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class o$i{constructor(){this.sinLonLUT=new Array(I$w+1),this.cosLonLUT=new Array(I$w+1);}update(s,o){const t=o[0],n=o[2];for(let r=0;r<=s;r++){const o=r/s,i=t*(1-o)+n*o;this.sinLonLUT[r]=Math.sin(i),this.cosLonLUT[r]=Math.cos(i);}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$k{}class e$j{constructor(){this.elevation=0,this.normal=[0,0,1],this.cornerTiles=[null,null,null,null];}}class l$e{constructor(){this.edgeNeighbours=[null,null,null,null],this.cornerNeighborData=[new e$j,new e$j,new e$j,new e$j],this.edgeResolutions=[1,1,1,1],this.modifiedEdgeResolutions=[!1,!1,!1,!1];}}class i$j{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new l$e;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class n$k{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0;}clear(){this._current=l$N(this._current),this._next=l$N(this._next),this._waiting=l$N(this._waiting),this._delayed=l$N(this._delayed);}get current(){if(t$V(this._current))return null;if(!this._isFadingEnabled){const t=this._delayed||this._waiting||this._next||this._current;t!==this._current&&(this._current=null,this.clear(),this._current=t);}let a=n$k.test.fadeMoment;if(r$W(this._delayed)&&(a=a||performance.now(),a>=this._delayedTime&&(this._push(this._delayed,s$j.Immediate),this._delayed=null)),r$W(this._next)){a=a||performance.now();const e=this._fadeDuration,n=r$W(this._current)&&this._next.texture===this._current.texture,s=this._next.type!==A$l.FADING,h=a-this._fadeStart>=e;(n||s||h)&&(l$N(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(a));}return this._current}get next(){return this._next}get fadeFactor(){if(t$V(this._next))return 1;const t=n$k.test.fadeMoment||performance.now(),i=Math.max(0,t-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return r$W(this._next)||r$W(this._delayed)}push(e,i=s$j.Immediate){this._delayed=l$N(this._delayed),this._push(e,i);}_push(i,r){if(this._isFadingEnabled||this.clear(),t$V(this._current))return void(this._current=i);const a=n$k.test.fadeMoment||performance.now();return r!==s$j.Immediate?(this._delayed=i,void(this._delayedTime=a+r)):t$V(this._next)?(this._next=i,void(this._fadeStart=this._alignFadeStart(a))):void(t$V(i)||(l$N(this._waiting),this._waiting=i))}get _fadeDuration(){return t$V(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(t){const e=this._getFadeDuration();return t+e-t%e}get _isFadingEnabled(){return this._getFadeDuration()>0}}var s$j;n$k.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed";}(s$j||(s$j={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class r$k{constructor(){this._queue=new n$1l,this._last=null,this.remove=()=>{};}get done(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}resetOne(t){this._queue.clear(),this._queue.push(t),this._last=null;}reset(e=null){this._queue.clear(),r$W(e)&&this._queue.pushArray(e),this._last=null;}skipSubtree(){this._last=null;}next(){return this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children),this._last=this._queue.pop(),this._last}}class i$i{constructor(){this.q=new n$1l;}get done(){return 0===this.q.length}reset(t){if(this.q.clear(),!t$V(t)){this.q.pushArray(t);for(let t=0;t<this.q.length;++t){const e=this.q.data[t];e.isLeaf||this.q.pushArray(e.children);}}}next(){return this.q.pop()}}function s$i(t,e){if(Array.isArray(t))for(let n=0;n<t.length;n++)l$d(t[n],e);else l$d(t,e);}function l$d(t,e){if(e(t),!t.isLeaf)for(const n of t.children)l$d(n,e);}function u$h(t,n,r){if(t$V(n)||t$V(n.fullExtent))return !1;const i=n.fullExtent,s=t.extent;if(r){if(s[0]<i.xmin||s[1]<i.ymin||s[2]>i.xmax||s[3]>i.ymax)return !1}else if(i.xmin>s[2]||i.ymin>s[3]||i.xmax<s[0]||i.ymax<s[1])return !1;const l=t.surface.tilingScheme.levels[t.level].scale;return !(n.minScale>0&&l>1.00000001*n.minScale)&&!(n.maxScale>0&&l<.99999999*n.maxScale)}function o$h(t,e){return t.lij[0]-e.lij[0]||t.lij[1]-e.lij[1]||t.lij[2]-e.lij[2]}function a$k(t,e){e.sort(((e,n)=>h$c(e,n,t)));}function h$c(t,e,n){const r=t.screenDepth,i=e.screenDepth;return r<i?-n:r>i?n:o$h(t,e)}function c$d(t,e){const n=new Map;t.forAll((t=>n.set(t.lij,t.distanceToSquared(e)))),t.sort(((t,e)=>n.get(t.lij)-n.get(e.lij)||o$h(t,e)));}function f$b(t,e,n){let r=1,i=0,s=0;for(;t!==e;)if(r*=.5,i*=.5,s*=.5,1&t.lij[2]&&(i+=.5),0==(1&t.lij[1])&&(s+=.5),null==(t=t.parent))throw new Error("tile was not a descendant of upsampleTile");n.init(e,i,s,r);}function m$f(t){for(let e=0;e<t.length;e++){const n=t[e],r=n.parent;if(r)for(let t=0;t<4;t++){const e=r.children[t];if(e&&e!==n&&e.loadable)return !0}}return !1}function p$a(t,e){if(!t||!e||t[0]===e[0])return !1;const n=t[0]<e[0],r=n?t:e,i=n?e:t,s=1<<i[0]-r[0];return Math.floor(i[1]/s)===r[1]&&Math.floor(i[2]/s)===r[2]}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class n$j{get updating(){return !!this._tileRequested}init(e,t,s,i){this.tile=e,this._layerIdx=t,this._layerClass=s,this._suspended=i,this._tileLayerInfo=e.getLayerInfo(t,s),this._tileRequested=null;const l=this._findAncestorWithData();this._setUpsampleTile(l);}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null;}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update());}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e){this._setUpsampleTile(e),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,A$l.FADING):this._requestNext();}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext();}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose();}_requestNext(){if(this._suspended)return !0;const t=this._findNextDownload();if(this._tileRequested){if(t===this._tileRequested)return !0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null;}return r$W(t)?t.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=t):this._agentDone(),!!this._tileRequested}_findNextDownload(){const i=this._layerIdx,n=this._layerClass,h=this.tile.surface.layerViewByIndex(i,n),d=y$c(h),{minLevel:_,maxLevel:o}=h.dataLevelRange,u=this._desiredMinLevelDelta,p=this._progressiveLevelModulo+u,y=this._scaleRangeEnabled?u$h:()=>!0;let f=this.tile;const I=f.level;let q;const v=this._tileLayerInfo.upsampleInfo,L=r$W(v)?v.tile.level:-1,m=!!r$W(v)&&L-I>=u,D=m$V(d,"tilemapCache");for(;f&&y(f,d,!1)&&f.level>=_;){const e=f.level,t=I-e,a=f.layerInfo[n][i];if(a.data&&t>=u){(!m||e>L)&&this._setUpsampleTile(f),a.dataInvalidated&&(q=f);break}if((t$V(D)||"unavailable"!==D.getAvailability(f.lij[0],f.lij[1],f.lij[2]))&&e<=o&&!a.data&&!a.dataMissing&&((t$V(q)||f.level===_||e%n$13==0||I-q.level<u)&&(q=f),t>=p))break;f=f.parent;}return r$W(q)&&I-q.level<u&&this._tileLayerInfo.upsampleInfo&&(q=null),q}_findAncestorWithData(){const e=this.tile.vlevel,t=this._desiredMinLevelDelta;let s;for(let i=this.tile;i;i=i.parent)if(i.hasLayerData(this._layerIdx,this._layerClass)){if(e-i.level>=t)return i;s=i;}return s}_setUpsampleTile(e){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,A$l.FADING);}get test(){return {findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class h$b extends n$j{get _desiredMinLevelDelta(){throw d$d}get _progressiveLevelModulo(){throw d$d}dispose(){}}const d$d=new Error("Abstract method called on TileAgent"),_$7=new h$b;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class l$c extends n$j{constructor(){super(...arguments),this._scaleRangeEnabled=!1;}get _desiredMinLevelDelta(){return E$C(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class t$g extends n$j{constructor(){super(),this._scaleRangeEnabled=!0;}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return n$13}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var t$f,e$i;!function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT";}(t$f||(t$f={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT";}(e$i||(e$i={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var t$e,e$h;!function(t){t[t.OneMinusSourceAlpha=0]="OneMinusSourceAlpha",t[t.SourceAlpha=1]="SourceAlpha",t[t.COUNT=2]="COUNT";}(t$e||(t$e={})),function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT";}(e$h||(e$h={}));const o$g={normal:e$h.Normal,average:e$h.Average,lighten:e$h.Lighten,lighter:e$h.Lighter,screen:e$h.Screen,plus:e$h.Plus,"color-dodge":e$h.ColorDodge,darken:e$h.Darken,multiply:e$h.Multiply,"color-burn":e$h.ColorBurn,overlay:e$h.Overlay,"soft-light":e$h.SoftLight,"hard-light":e$h.HardLight,"vivid-light":e$h.VividLight,hue:e$h.Hue,saturation:e$h.Saturation,luminosity:e$h.Luminosity,color:e$h.Color,difference:e$h.Difference,exclusion:e$h.Exclusion,minus:e$h.Minus,invert:e$h.Invert,reflect:e$h.Reflect,"destination-over":e$h.DestinationOver,"destination-atop":e$h.DestinationAtop,"destination-in":e$h.DestinationIn,"destination-out":e$h.DestinationOut,"source-atop":e$h.SourceAtop,"source-in":e$h.SourceIn,"source-out":e$h.SourceOut,xor:e$h.Xor};function i$h(t){return t===e$h.DestinationOver||t===e$h.DestinationAtop||t===e$h.DestinationIn||t===e$h.DestinationOut||t===e$h.SourceAtop||t===e$h.SourceIn||t===e$h.SourceOut||t===e$h.Xor}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function l$b(l){l.fragment.uniforms.add([new c$11("u_colormap",(o=>o.u_colormap)),new o$_("u_colormapOffset",(o=>o.colormap.u_colormapOffset)),new o$_("u_colormapMaxIndex",(o=>o.colormap.u_colormapMaxIndex)),new o$_("u_opacity",(o=>o.common.u_opacity))]),l.fragment.code.add(n$19`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
result = texture2D(u_colormap, clrPosition);
}
return result;
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function t$d(t){t.fragment.uniforms.add(new c$11("u_transformGrid",(r=>r.u_transformGrid))),t.fragment.uniforms.add(new e$$("u_transformSpacing",(r=>r.common.u_transformSpacing))),t.fragment.uniforms.add(new e$$("u_transformGridSize",(r=>r.common.u_transformGridSize))),t.fragment.uniforms.add(new e$$("u_targetImageSize",(r=>r.common.u_targetImageSize))),t.fragment.code.add(n$19`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class i$g extends t$Y{constructor(){super(...arguments),this.scale=1,this.offset=f$S;}}function d$c(s){s.attributes.add(O$J.POSITION,"vec2"),s.attributes.add(O$J.UV0,"vec2"),s.vertex.uniforms.add(new o$_("scale",(s=>s.scale))),s.vertex.uniforms.add(new e$$("offset",(s=>s.offset))),s.varyings.add("uv","vec2"),s.varyings.add("vuv","vec2"),s.vertex.code.add(n$19`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class i$f extends i$g{constructor(o,r,e){super(),this.common=o,this.u_image=r,this.u_transformGrid=e;}}function n$i(r){r.include(t$d),r.fragment.uniforms.add([new c$11("u_image",(o=>o.u_image)),new s$1d("u_flipY",(o=>o.common.u_flipY)),new s$1d("u_applyTransform",(o=>o.common.u_applyTransform))]),r.fragment.code.add(n$19`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function t$c(t){const e=257;t.code.add(n$19`
    float lineFactorAtPosition(float value) {
      float pos = value * ${n$19.float(e)};
      if(pos < 0.5 || pos > ${n$19.float(e-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec4 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec4(vec3(1.0, 0.972, 0.918) * line, 1.0);
    }`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var o$f;!function(o){o[o.LayerOnly=0]="LayerOnly",o[o.ColorComposite=1]="ColorComposite",o[o.GridComposite=2]="GridComposite",o[o.COUNT=3]="COUNT";}(o$f||(o$f={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function l$a(l,b){const e=b.blendMode;e!==e$h.Normal&&(e===e$h.Reflect&&l.code.add(n$19`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),e!==e$h.ColorDodge&&e!==e$h.VividLight||l.code.add(n$19`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),e!==e$h.ColorBurn&&e!==e$h.VividLight||l.code.add(n$19`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),e===e$h.Overlay&&l.code.add(n$19`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),e===e$h.HardLight&&l.code.add(n$19`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),e===e$h.SoftLight&&l.code.add(n$19`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),e===e$h.VividLight&&l.code.add(n$19`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),e!==e$h.Hue&&e!==e$h.Saturation&&e!==e$h.Color&&e!==e$h.Luminosity||(l.code.add(n$19`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),e!==e$h.Hue&&e!==e$h.Saturation||l.code.add(n$19`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),l.code.add(n$19`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${e===e$h.Multiply?n$19`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:e===e$h.Average?n$19`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:e===e$h.Lighten?n$19`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:e===e$h.Darken?n$19`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:e===e$h.Lighter?n$19`return vec4(cl * ol + cb * ob, ol + ob);`:e===e$h.Plus?n$19`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:e===e$h.Minus?n$19`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:e===e$h.Screen?n$19`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:e===e$h.Difference?n$19`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:e===e$h.Invert?n$19`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:e===e$h.DestinationOver?n$19`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:e===e$h.DestinationAtop?n$19`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:e===e$h.DestinationOut?n$19`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:e===e$h.SourceAtop?n$19`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:e===e$h.SourceOut?n$19`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:e===e$h.Xor?n$19`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:e===e$h.DestinationIn?n$19`return vec4(cb * ob * ol, ol * ob);`:e===e$h.SourceIn?n$19`return vec4(cl * ol * ob, ol * ob);`:e===e$h.Hue?n$19`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:e===e$h.Saturation?n$19`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:e===e$h.Color?n$19`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:e===e$h.Luminosity?n$19`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:e===e$h.Exclusion?n$19`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:e===e$h.Reflect?n$19`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:e===e$h.ColorDodge?n$19`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:e===e$h.ColorBurn?n$19`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:e===e$h.Overlay?n$19`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:e===e$h.SoftLight?n$19`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:e===e$h.HardLight?n$19`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:e===e$h.VividLight?n$19`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n$19``}
    }
  `));}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var c$c,g$f;function m$e(m){const u=new i$_,p=m.output===c$c.GridOnly,b=m.output===c$c.GridComposite,f=b||p,y=m.output===c$c.ColorOnly,C=m.output===c$c.ColorComposite,O=C||y,v=b||C;if(u.include(d$c),O&&u.fragment.uniforms.add(new e$_("backgroundColor",(e=>e.backgroundColor))),m.baseOpacityMode!==g$f.One&&u.fragment.uniforms.add(new o$_("baseOpacity",(e=>e.baseOpacity))),f&&(u.extensions.add("GL_OES_standard_derivatives"),u.fragment.include(t$c)),p||y)return u.fragment.code.add(n$19`
    void main() {
      gl_FragColor = ${y?n$19`vec4(backgroundColor, 1.0)`:n$19`gridColor(uv)`};
    }
  `),u;const w=m.blendMode!==e$h.Normal,x=m.baseOpacityMode===g$f.OnBaseLayer,L=m.baseOpacityMode===g$f.OnBackground||m.baseOpacityMode===g$f.OnBaseLayer,T=m.premultipliedSource;return u.fragment.uniforms.add(new c$11("tex",(e=>e.texture))),u.fragment.uniforms.add(new o$_("opacity",(e=>e.opacity))),(w||x||T)&&(u.fragment.uniforms.add(new c$11("fboColor",(e=>e.fboTexture))),u.fragment.uniforms.add(new o$_("tileSize",(o=>r$W(o.fboTexture)?o.fboTexture.descriptor.width:1)))),u.fragment.include(l$a,m),u.fragment.code.add(n$19`
    void main() {
      ${v||x||T?n$19`
      vec4 bgColor = ${C?n$19`vec4(backgroundColor, 1.0)`:b?n$19`gridColor(uv)`:n$19`texture2D(fboColor, gl_FragCoord.xy / tileSize)`};
      ${L?n$19`bgColor *= baseOpacity;`:""}`:""}
      vec4 colorLayer = texture2D(tex, uv);
      ${w?n$19`
          vec4 fboTex = ${v?n$19`bgColor;`:n$19`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${x?" * baseOpacity":""};`}
          vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
          gl_FragColor = applyBlendMode(colorLayer.rgb, colorLayer.a * opacity, Cb, fboTex.a);`:n$19`
          vec4 pmColorLayer = vec4(colorLayer.xyz, 1.0);
          float composeAlpha = colorLayer.a * opacity;
          gl_FragColor = ${T?n$19`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`:v||x?n$19`mix(bgColor, pmColorLayer, composeAlpha);`:n$19`pmColorLayer * composeAlpha;`}`}
    }
  `),u}!function(e){e[e.Composite=0]="Composite",e[e.ColorOnly=1]="ColorOnly",e[e.GridOnly=2]="GridOnly",e[e.ColorComposite=3]="ColorComposite",e[e.GridComposite=4]="GridComposite",e[e.COUNT=5]="COUNT";}(c$c||(c$c={})),function(e){e[e.One=0]="One",e[e.OnBackground=1]="OnBackground",e[e.OnBaseLayer=2]="OnBaseLayer",e[e.COUNT=3]="COUNT";}(g$f||(g$f={}));const u$g=Object.freeze(Object.defineProperty({__proto__:null,get BlendLayersOutput(){return c$c},get BaseOpacityMode(){return g$f},build:m$e},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class w$a extends i$f{constructor(e,o,r,l,i,t){super(e,l,i),this.colormap=o,this.symbolizer=r,this.u_colormap=t,this.backgroundColor=f$_,this.fboTexture=null,this.baseOpacity=1;}}class O$9 extends w$a{}class z$4 extends w$a{}function L$7(a){const r=new i$_;r.include(d$c),r.include(n$i),r.include(l$b),a.tileBlendInput===o$f.GridComposite&&(r.extensions.add("GL_OES_standard_derivatives"),r.fragment.include(t$c));const t=a.tileBlendInput===o$f.ColorComposite;t&&r.fragment.uniforms.add(new e$_("backgroundColor",(e=>e.backgroundColor))),a.baseOpacityMode!==g$f.One&&r.fragment.uniforms.add(new o$_("baseOpacity",(e=>e.baseOpacity)));const f=a.baseOpacityMode===g$f.OnBaseLayer,g=a.baseOpacityMode===g$f.OnBackground||a.baseOpacityMode===g$f.OnBaseLayer,p=a.blendMode!==e$h.Normal;r.fragment.include(l$a,a);const y=a.tileBlendInput!==o$f.LayerOnly;return (p&&!y||f)&&(r.fragment.uniforms.add(new c$11("fboColor",(e=>e.fboTexture))),r.fragment.uniforms.add(new o$_("tileSize",(a=>r$W(a.fboTexture)?a.fboTexture.descriptor.width:1)))),r.fragment.code.add(n$19`
    vec4 applyBackgroundBlend(vec4 layerColor) {
      ${y||f?n$19`
          vec4 bgColor = ${f?n$19`texture2D(fboColor, gl_FragCoord.xy / tileSize)`:t?n$19`vec4(backgroundColor, 1.0)`:n$19`gridColor(vuv)`};
          ${g?n$19`bgColor *= baseOpacity;`:""}`:""}
      ${p?n$19`
            vec3 pmColorLayer = layerColor.rgb * layerColor.a;
            vec4 fboTex = ${y?n$19`bgColor;`:n$19`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${f?" * baseOpacity":""};`}
            vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
            return applyBlendMode(pmColorLayer.rgb, layerColor.a * u_opacity, Cb, fboTex.a);`:y||f?n$19`
            float composeAlpha = layerColor.a * u_opacity;
            vec4 pmColorLayer = vec4(layerColor.rgb, 1.0);
            return mix(bgColor, pmColorLayer, composeAlpha);`:n$19`
            return layerColor * layerColor.a * u_opacity;`}
    }
  `),a.colorizerType===t$f.Stretch?B$9(r,a):a.colorizerType===t$f.Lut?P$6(r):a.colorizerType===t$f.Hillshade&&V$6(r,a),r}function P$6(e){e.fragment.code.add(n$19`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`);}function B$9(e,a){e.fragment.uniforms.add([new e$1n("u_bandCount",(e=>e.symbolizer.u_bandCount)),new o$1b("u_minCutOff",(e=>e.symbolizer.u_minCutOff),3),new o$1b("u_maxCutOff",(e=>e.symbolizer.u_maxCutOff),3),new o$1b("u_factor",(e=>e.symbolizer.u_factor),3),new o$_("u_minOutput",(e=>e.symbolizer.u_minOutput)),new o$_("u_maxOutput",(e=>e.symbolizer.u_maxOutput)),new s$1d("u_useGamma",(e=>e.symbolizer.u_useGamma)),new o$1b("u_gamma",(e=>e.symbolizer.u_gamma),3),new o$1b("u_gammaCorrection",(e=>e.symbolizer.u_gammaCorrection),3),new o$_("u_opacity",(e=>e.common.u_opacity))]),e.fragment.code.add(n$19`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const o=a.applyColormap?n$19`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:n$19`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;e.fragment.code.add(n$19`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${a.stretchType===e$i.Noop?n$19`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:n$19`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${o}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`);}function V$6(e,a){const o=e.fragment;o.uniforms.add([new c$11("u_image",(e=>e.u_image)),new e$1n("u_hillshadeType",(e=>e.symbolizer.u_hillshadeType)),new o$1b("u_sinZcosAs",(e=>e.symbolizer.u_sinZcosAs),6),new o$1b("u_sinZsinAs",(e=>e.symbolizer.u_sinZsinAs),6),new o$1b("u_cosZs",(e=>e.symbolizer.u_cosZs),6),new o$1b("u_weights",(e=>e.symbolizer.u_weights),6),new e$$("u_factor",(e=>e.symbolizer.u_factor)),new o$_("u_minValue",(e=>e.symbolizer.u_minValue)),new o$_("u_maxValue",(e=>e.symbolizer.u_maxValue)),new e$$("u_srcImageSize",(e=>e.common.u_srcImageSize))]),o.include(e$14),o.code.add(n$19`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec3 hsv = rgb2hsv(colormap(vec4(val, val, val, 1.0), false).rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),o.code.add(n$19`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=a.applyColormap?n$19`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:n$19`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;o.code.add(n$19`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `);}const k$6=Object.freeze(Object.defineProperty({__proto__:null,ColorizerUniforms:w$a,ColorizerStretchUniforms:O$9,ColorizerHillshadeUniforms:z$4,build:L$7},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const d$b={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class _$6{constructor(t,e,r=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=t,this.source=e,this.width=r||e.width,this.height=s||e.height;}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=s$1a(this._rasterTexture),this._memoryUsed=null;}get symbolizerParameters(){return this.isRendereredSource?{...d$b,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||d$b}set symbolizerParameters(t){this._symbolizerParameters=t;}get bandIds(){return this._bandIds}set bandIds(t){if(r$W(t)&&t.length>0){this._bandIds&&t.every(((t,e)=>!!this._bandIds[e]&&t===this._bandIds[e]))||(this._bandIds=t,this._dirty=!0);}else this._bandIds=null;}get interpolation(){return this._interpolation||"nearest"}set interpolation(t){if(this._interpolation=t,r$W(this._rasterTexture)){const e=this._getRasterTextureInterpolation(t);this._rasterTexture.setSamplingMode("bilinear"===e?L$C.LINEAR:L$C.NEAREST);}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=s$1a(this._transformGridTexture),this._memoryUsed=null;}bind(t){return !!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((t$V(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(t,this.bandIds),r$W(this._rasterTexture)&&(this._updateColormapTexture(t),this.transformGrid&&t$V(this._transformGridTexture)&&(this._transformGridTexture=E$P(t,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:t,transformGrid:e,width:r,height:i,opacity:o}=this,u=g$13(e,[r,i],[this.source.width,this.source.height],o),m=A$P(t.colormap,t.colormapOffset),d="stretch"===this.symbolizerParameters.type?d$15(this.symbolizerParameters):null,_="hillshade"===this.symbolizerParameters.type?O$P(this.symbolizerParameters):null;return new w$a(u,m,d||_,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(t$V(this._memoryUsed)){const t=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=t.map((t=>r$W(t)?t.descriptor.width*t.descriptor.height*4:0)).reduce(((t,e)=>t+e),0);}return this._memoryUsed}release(){return this._rasterTexture=s$1a(this._rasterTexture),this._transformGridTexture=s$1a(this._transformGridTexture),this._colormapTexture=s$1a(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(s,i){const o=this.source?this.source.extractBands(i):null;if(!(o&&o.pixels&&o.pixels.length>0))return void(this._rasterTexture=s$1a(this._rasterTexture));const a=t$V(i)&&t$V(this.bandIds)||r$W(i)&&r$W(this.bandIds)&&i.join("")===this.bandIds.join("");if(r$W(this._rasterTexture)&&a)return;this._rasterTexture=s$1a(this._rasterTexture);const h=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=_$E(s,o,h,this.isRendereredSource||this.hasStretchTypeNone());}hasStretchTypeNone(){return "stretchType"in this.symbolizerParameters&&"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType}_getRasterTextureInterpolation(t){return "lut"===this.symbolizerParameters.type||"nearest"===t||"majority"===t?"nearest":"bilinear"}_updateColormapTexture(e){const r=this._colormap,s=this.symbolizerParameters.colormap;return s?r?s.length!==r.length||s.some(((t,e)=>t!==r[e]))?(this._colormapTexture=s$1a(this._colormapTexture),this._colormapTexture=T$G(e,s),void(this._colormap=s)):void 0:(this._colormapTexture=T$G(e,s),void(this._colormap=s)):(this._colormapTexture=s$1a(this._colormapTexture),void(this._colormap=null))}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class p$9{constructor(){this.waitingAgents=new n$1l,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0;}static acquire(t){const s=r$j.acquire();return s._init(t),s}release(){this.dispose(),h$a.delete(this),r$j.release(this);}dispose(){this.loadingAgent=s$1a(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=j$9(this._data);}static prune(){r$j.prune(0);}_init(t){this.waitingAgents.clear(),this._data=j$9(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=t,this.elevationBounds=null;}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo();}abortRequest(){this.requestAbort=h$T(this.requestAbort),this.requestPromise=null;}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){r$W(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null);}setUpsampleInfo(t,s){if(t===s||t$V(s))this._unsetUpsampleInfo();else {if(t$V(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else {if(this._upsampleInfo.tile===s)return;this._upsampleInfo.tile.unrefMapData();}s.refMapData(),f$b(t,s,this._upsampleInfo);}}get data(){return this._data}set data(t){j$9(this._data),this._data=t;}}const r$j=new e$1f(p$9,null,(()=>{})),h$a=new Map;function u$f(){h$a.size>0&&(console.log(`${h$a.size} live TilePerLayerInfo allocations:`),h$a.forEach((t=>console.log(t,"\n"))));}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class t$b{constructor(t){this._texture=t,this.type="tile-texture",this._refCount=1;}retain(){++this._refCount;}release(){--this._refCount,0===this._refCount&&this._texture.dispose();}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap();}get descriptor(){return this._texture.descriptor}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var E$a;!function(E){E[E.NONE=0]="NONE",E[E.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",E[E.SPLIT=2]="SPLIT",E[E.VSPLITMERGE=4]="VSPLITMERGE",E[E.MERGE=8]="MERGE",E[E.RENDERDATA=16]="RENDERDATA",E[E.GEOMETRY=32]="GEOMETRY",E[E.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",E[E.TEXTURE_FADING=128]="TEXTURE_FADING";}(E$a||(E$a={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const te$2=n$16(),ie$3=n$16(),se$2=n$16(),ne$2=.1;class re$1{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0;}}class ae$4{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this._dirty=!0,this._previouslyRendered=!1,this.extent=u$T(),this._elevationBounds=n$1b(),this.layerInfo=[[],[]],this.extentInRadians=u$T(),this.centerAtSeaLevel=n$16(),this._center=[n$16(),_$x(),n$16()],this.up=i$1m(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemory=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0;}static prune(){le$4.prune(0),de$4.prune(0),p$9.prune();}get isCached(){return !this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return `${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[ce$5.MIDDLE][3]}get screenDepth(){return this._screenDepth}get visible(){return this._dirty&&this.computeVisibility(),this._visible}computeVisibility(){this._dirty=!1;const e=this._intersectsClippingArea&&this._isVisible(this.surface.frustum);return e!==this._visible&&(this._visible=e,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension()),this._visible}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setNeedsRender()),e}get shouldLoad(){if(!this.loadable)return !1;if(this._surface.lodSnapping===S$o.ON){const e=this.level-this._surface.snapLevel;if(0===e)return !0;if(1===e)return !1}return this.isLeaf}init(e,t,i){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=p$T(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[ce$5.MIDDLE][3]=0,this.vlevel=e?e[0]:0,t&&t.elevationBounds?a$16(this._elevationBounds,t.elevationBounds):r$Y(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=t,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const s of E$b){const e=i.numLayers(s),t=this.layerInfo[s];for(const i of t)i.release();t.length=e;for(let i=0;i<e;i++)t[i]=p$9.acquire(this._surface.upsampleInfoPool),s===A$8.ELEVATION&&this.findElevationBoundsForLayer(i,-1);}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,I$w);}release(){T$b(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of E$b){for(const t of this.layerInfo[e])t.release();this.layerInfo[e].length=0;}this._parent=null,this._surface=null,this.setMemoryDirty();}refMapData(){++this._mapDataRefCount,this.isCached||this._surface.upsampleMapCache.pop(this.key);}unrefMapData(){if(--this._mapDataRefCount,this.isCached){this.setMemoryDirty();const e=this.cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e);}}setMemoryDirty(){this._usedMemory=null;}get usedMemory(){return this._ensureUsedMemory()+(this.isCached?0:this._mapTileMemory)}get cachedMemory(){return this.isCached?this.mapTileMemory:0}get mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[A$8.MAP].reduce(((e,t)=>e+(t instanceof m$_?t.memoryUsage:0)),this._mapTileMemory)}get cpuImageMemorySize(){const e=4,t=this._surface.tilingScheme.pixelSize;return t*t*e}_ensureUsedMemory(){if(r$W(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemory=0;let e=0;for(const{data:t}of this.layerInfo[A$8.MAP])t instanceof m$_?e+=this._getTerrainDataMemory(t):this._mapTileMemory+=this._getTerrainDataMemory(t);const i=this.cpuImageMemorySize;for(const t of this.layerInfo[A$8.ELEVATION])this._usedMemory+=t.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=u$14(this.renderData.textureDescriptor)),this.isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemory+e),this._usedMemory}getUsedMemoryForLayer(e,t){const i=this.layerInfo[e][t];return i?.data?e===A$8.MAP?this.isCached?0:this._getTerrainDataMemory(i.data):e===A$8.ELEVATION?this.cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof t$b?u$14(e.texture):e instanceof HTMLImageElement||e instanceof O$d?this.cpuImageMemorySize:e instanceof m$_||e instanceof _$6?e.memoryUsage:0}updateScreenDepth(e){const t=this._center[ce$5.MIDDLE],i=e,s=t[0],n=t[1],r=t[2],a=i[2]*s+i[6]*n+i[10]*r+i[14];this._screenDepth=a<0?0:a/(i[3]*s+i[7]*n+i[11]*r+i[15]);}shouldSplit(e,i,s){if(r$W(e.frustum)&&(!this._intersectsClippingArea||!this._isVisible(e.frustum)))return E$a.NONE;const n=this.level;e$15(te$2,this._center[ce$5.MIDDLE],i);let r=v$P(te$2),a=ce$5.MIDDLE;e$15(ie$3,this._center[ce$5.TOP],i);const o=v$P(ie$3);o<r&&(r=o,a=ce$5.TOP),e$15(ie$3,this._center[ce$5.BOTTOM],i);const f=v$P(ie$3);if(f<r&&(r=f,a=ce$5.BOTTOM),this._edgeLen2>r&&n<e.maxLod)return E$a.SPLIT;const p=Math.sqrt(r),m=e.fovX*p*2,_=this._edgeLen/m,y=()=>{const t=n+Math.ceil(-Math.log2(e.relativeWidthLimit/_));return t!==this.vlevel?(this.vlevel=t,E$a.VSPLITMERGE):E$a.NONE_HIT_MAXLOD};if(s===S$o.ON){if(1===this._surface.snapLevel-n)return n>=e.maxLod?y():E$a.SPLIT}const A=P$u(this.up,te$2),E=this._elevationBounds[1]-this._elevationBounds[0],T=E/this.edgeLen;if(e.aboveGround&&A>0&&T<.001){if(A/p-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-T>0)return E$a.NONE}if(_<e.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,E$a.VSPLITMERGE):E$a.NONE;if(n>=e.maxLod)return y();if(n>6){e$15(ie$3,this._center[a],i),q$p(se$2,this.up,A),e$15(se$2,se$2,ie$3);const t=v$P(se$2);if(t>this.radius*this.radius){q$p(se$2,se$2,this.radius/Math.sqrt(t)),u$W(se$2,se$2,this._center[a]),e$15(se$2,i,se$2);const s=Math.min(1,(Math.abs(P$u(se$2,this.up))+.5*E+this._curvatureHeight)/s$1b(se$2)),n=ne$2/e.angledSplitBias,r=e.fovY*p*2;if(s*(this._edgeLen/r)<n*e.relativeHeightLimit)return E$a.NONE}}return E$a.SPLIT}setChildren(e,t,i,s){T$b(!!(e&&t&&i&&s),"Null child passed"),this._children[0]=e,this._children[1]=t,this._children[2]=i,this._children[3]=s;}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null;}get isLoaded(){return this.renderData?.hasGeometry??!1}prepareToLoad(e){this.refMapData();for(const t of E$b)this._createOrUpdateAgents(0,t);e.updateTileGeometryState(this);}load(e){this.prepareToLoad(e),this.loadPrepared(e);}loadPrepared(e){e.loadTile(this);}unload(e){e.unloadTile(this);for(const t of E$b){const e=this.layerInfo[t];for(const t of e)t.loadingAgent&&t.loadingAgent!==_$7&&(he$3(t.loadingAgent),t.loadingAgent=null),t.pendingUpdates=0;}this.resetPendingUpdate(E$a.GEOMETRY),this.resetPendingUpdate(E$a.TEXTURE_NOFADING),this.resetPendingUpdate(E$a.TEXTURE_FADING),this.unrefMapData();}unloadMapData(){const e=this.layerInfo[A$8.MAP];for(const t of e)t.loadingAgent&&t.loadingAgent!==_$7&&(he$3(t.loadingAgent),t.loadingAgent=null),t.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty();}updateClippingStatus(e){if(I$B(e,this._clippingArea))return !1;const i=this._intersectsClippingArea,s=this._isWithinClippingArea;r$W(e)?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const n=s&&this._isWithinClippingArea,r=!(s||i||this._isWithinClippingArea||this._intersectsClippingArea);return !this.renderData||n||r||this.setPendingUpdate(E$a.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty();}getLayerInfo(e,t){return this.layerInfo[t][e]}hasLayerData(e,t){const i=this.layerInfo[t][e];return !(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return !0;for(const e of E$b){const t=this.layerInfo[e];for(const e of t)if(e.loadingAgent&&e.loadingAgent!==_$7&&e.loadingAgent.updating)return !0}return !1}_isSuspended(e){return !!this.hasPendingUpdate(E$a.SPLIT)||e!==A$8.ELEVATION&&!this.loadable}get hasPendingUpdates(){return 0!==this._pendingUpdates}hasPendingUpdate(e){return (this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===E$a.SPLIT||e===E$a.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate();}resetPendingUpdate(e){return !!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,t,s){const n=this.layerInfo[t][e];if(n.waitingAgents.has(s))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),s.tile.lij.toString(),t,e),!0;if(n.waitingAgents.push(s),n.data&&!n.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),s.tile.lij.toString(),t,e),s.dataArrived(this),!0;if(n.requestPromise)return !0;h$T(n.requestAbort),n.requestAbort=new AbortController;const r=this._surface.requestTileData(this,e,t,n.requestAbort);if(!r)return n.requestAbort=null,!1;const a=()=>{n.requestPromise===r&&(n.requestPromise=null,n.requestAbort=null);};return n.requestPromise=r,r.then(a,a),!0}get isLeaf(){return null==this._children[0]}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;if(this.isLeaf)return null;const t=this._children[0].findByLij(e)||this._children[1].findByLij(e)||this._children[2].findByLij(e)||this._children[3].findByLij(e);return t||null}distanceToSquared(e){return v$P(e$15(se$2,this._center[ce$5.MIDDLE],e))}containsPoint(e){const t=this.extent;return e[0]>=t[0]&&e[1]>=t[1]&&e[0]<=t[2]&&e[1]<=t[3]}unrequestLayerData(e,t,i){const s=this.layerInfo[t][e],n=s.waitingAgents,r=null!=n.removeUnordered(i);T$b(r,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty());}dataArrived(e,t,i){const s=this.layerInfo[t][e];s.data=i,s.dataInvalidated=!1,s.waitingAgents.forAll((e=>e.dataArrived(this))),s.waitingAgents.clear(),this.setMemoryDirty();}dataMissing(e,t,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${t}/${e} error ${i}`);const s=this.layerInfo[t][e];s.dataMissing=!0,s.waitingAgents.forAll((e=>e.dataMissing())),s.waitingAgents.clear(),this.setMemoryDirty();}updateRenderData(e,t){switch(e){case A$8.MAP:return this._updateTexture(t);case A$8.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===A$l.FADING?E$a.TEXTURE_NOFADING:E$a.TEXTURE_FADING),this.setPendingUpdate(e===A$l.FADING?E$a.TEXTURE_FADING:E$a.TEXTURE_NOFADING));}_updateGeometry(){this.setPendingUpdate(E$a.GEOMETRY);for(const e of this.layerInfo[A$8.ELEVATION])e.pendingUpdates|=E$a.GEOMETRY;}invalidateLayerData(e,t){this.layerInfo[t][e].invalidateSourceData(),this.restartAgents(t);}computeElevationBounds(){const e=this._elevationBounds;r$Y(e,Number.MAX_VALUE,-Number.MAX_VALUE);const i=this.layerInfo[A$8.ELEVATION];let s=!0;for(const n of i)r$W(n.elevationBounds)&&(e[0]=Math.min(e[0],n.elevationBounds.min),e[1]=Math.max(e[1],n.elevationBounds.max),n.elevationBounds.hasNoDataValues||(s=!1));s&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),this.updateRadiusAndCenter(),this._surface.setTileTreeDirty();}_updateCenter(){const e=this._elevationBounds,t=.5*(e[0]+e[1]);q$p(se$2,this.up,t),u$W(this._center[ce$5.MIDDLE],this.centerAtSeaLevel,se$2),q$p(se$2,this.up,e[0]),u$W(this._center[ce$5.TOP],this.centerAtSeaLevel,se$2),q$p(se$2,this.up,e[1]),u$W(this._center[ce$5.BOTTOM],this.centerAtSeaLevel,se$2);}findElevationBoundsForLayer(e,i){const n=this.layerInfo[A$8.ELEVATION][e];if(r$W(n.elevationBounds)&&n.elevationBounds.level>=i)return;const r=this._surface.layerViewByIndex(e,A$8.ELEVATION),a=y$c(r);if(!u$h(this,a,!1))return;const o=ue$4;let h=!1;if(n.data){const e=n.data;o.min=e.bounds[0],o.max=e.bounds[1],o.hasNoDataValues=e.hasNoDataValues,o.level=this.level,h=!0;}else {let t,i,s=0;for(let n=this._parent;n&&(!i||s<E$C(this.level))&&(s=this.vlevel-n.level,t=i||t,i=n.layerInfo[A$8.ELEVATION][e].data,!(!i&&t&&s>=E$C(this.level)));n=n.parent);i=i||t,i&&(i.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],o),o.min!==1/0&&(o.level=i.level,h=!0));}h&&(t$V(n.elevationBounds)&&(n.elevationBounds=new s$l),n.elevationBounds.copyFrom(o));}modifyLayers(e,t,i){const s=this.layerInfo[i];for(const a of s)a.loadingAgent&&a.loadingAgent!==_$7&&(he$3(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)void 0===e[a]&&s[a].release();const n=new Array(...s),r=t.length;s.length=r;for(let a=0;a<r;a++){const e=t[a];s[a]=e>-1?n[e]:p$9.acquire(this._surface.upsampleInfoPool);}this.setMemoryDirty();}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,A$l.FADING));}updateAgents(e){if(this.renderData){const t=this.layerInfo[e];for(const e of t)e.loadingAgent===_$7&&(e.loadingAgent=null);this._createOrUpdateAgents(0,e);}}updateAgentSuspension(){for(const e of E$b){const t=this._isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==_$7&&(i.loadingAgent.setSuspension(t),i.loadingAgent===_$7&&this.updateRenderData(e,A$l.FADING));}}removeLayerAgent(e,t){const i=this.layerInfo[t][e];i.loadingAgent&&i.loadingAgent!==_$7&&i.loadingAgent.dispose(),i.loadingAgent=null;}agentDone(e,t){const i=this.layerInfo[t][e];i.loadingAgent=_$7,!i.data&&t$V(i.upsampleInfo)&&this._createOrUpdateAgents(e+1,t);}_createOrUpdateAgents(e,t){const i=this.layerInfo[t];if(0===i.length)return;const s=(()=>{for(let s=e;s<i.length;++s){const e=this._surface.layerViewByIndex(s,t);if(U$9(e)&&"normal"!==e.layer.blendMode)return !0}return !1})(),n=this._isSuspended(t);for(let r=e;r<i.length;++r){const e=i[r];let a=!1;const o=this._surface.layerViewByIndex(r,t),h=y$c(o);if(e.loadingAgent?u$h(this,h,!1)?(e.loadingAgent!==_$7&&e.loadingAgent.setSuspension(n),e.loadingAgent!==_$7&&(a=e.loadingAgent.update())):e.dispose():u$h(this,h,!1)&&(e.loadingAgent=oe$5(this,r,t,n),a=e.loadingAgent.startLoading(),a?e.loadingAgent===_$7&&this.setPendingUpdate(E$a.GEOMETRY):(he$3(e.loadingAgent),e.loadingAgent=_$7)),e.loadingAgent===_$7&&this.updateRenderData(t,A$l.FADING),!s&&a&&o.isOpaque)return}}_isWithinExtent(e){const t=this.extent;return t[0]>=e[0]&&e[2]>=t[2]&&t[1]>=e[1]&&e[3]>=t[3]}intersectsExtent(e){const t=this.extent;return t[2]>=e[0]&&e[2]>=t[0]&&t[3]>=e[1]&&e[3]>=t[1]}getElevationBasedVerticesPerSide(t){const i=this.vlevel-this.level,s=Math.max(this.level-t,E$C(this.level)-i);return o$X(1+(this.maxTesselation>>s),2,this.maxTesselation+1)}get test(){return {cachedMemory:this.cachedMemory}}_findLIJ(e,i){if(!e)return null;const s=this.surface.rootTiles;if(r$W(s))for(const t of s)if(ge$4(t,e)){let s=t,n=e[0]-s.level-1;for(;n>=0&&!s.isLeaf&&!i(s);){const t=e[1]>>n&1,i=e[2]>>n&1;s=s.children[2*t+i],n--;}return i(s)?s:null}return null}findNeighborTile(e,t){const i=this.lij,s=this.getNeighborLIJ(i,e);return s?fe$3(i,s)?t(this)?this:null:this._findLIJ(s,t):null}findCorner(e,t){const i=e===E$q.NORTH_EAST?1:e===E$q.NORTH_WEST?0:e===E$q.SOUTH_WEST?2:3;let s=this;for(;!(s.isLeaf||t&&t(s));)s=s.children[i];return s}findNeighborCornerTileExact(e,t){return this.findNeighborTile(e,(e=>t(e)||e.level===this.level))?.findCorner(P$8(e),t)}forAllSubtreeOnSide(e,t){const i=e===E$q.NORTH?[0,1]:e===E$q.NORTH_EAST?[1]:e===E$q.EAST?[1,3]:e===E$q.SOUTH_EAST?[3]:e===E$q.SOUTH?[2,3]:e===E$q.SOUTH_WEST?[2]:e===E$q.WEST?[0,2]:[0],s=e=>{t(e)||e.isLeaf||i.forEach((t=>s(e.children[t])));};s(this);}forallNeighbors(e){Z$3.forEach((t=>this.findNeighborCornerTileExact(t,e))),Y$2.forEach((t=>this.findNeighborTile(t,(t=>t.level===this.level||e(t)))?.forAllSubtreeOnSide(q$6(t),e)));}getNeighborEdgeStartVertexIndex(e,t){const i=t??this.findNeighborTile(Y$2[e],(e=>e.isLoaded));if(!i||!this.isLoaded||!i.isLoaded)return 0;const s=this.level-i.level;if(0===s)return 0;const n=2**s,r=1==(1&e),a=r?0:1,o=i.lij[a+1]*n,h=this.lij[a+1]-o;return r?n-1-h:h}_updateNeighborsWithChangedEdgeResolution(){for(let e=0;e<4;++e)if(this.renderData.geometryState.neighborData.modifiedEdgeResolutions[e]){const t=Y$2[e],i=this.findNeighborTile(t,(e=>e.isLoaded||e.level===this.level));if(!i)continue;if(!i.isLoaded){E$d(!i.isLeaf);const s=(e+2)%4,n=q$6(t);i.forAllSubtreeOnSide(n,(e=>e.isLoaded?(e.updateEdgeAfterResolutionChange(s),!0):(E$d(!e.isLeaf),!1)));}this.renderData.geometryState.neighborData.modifiedEdgeResolutions[e]=!1;}}updateNeighborDataAndGeometryIfNeeded(){this.isLoaded&&this.renderData.updateNeighborDataAndGeometryIfNeeded();}updateNeighborsAfterGeometryChange(e=this.level){this.forEachLoadedNeighbor((e=>this._updateNeighbor(e))),Y$2.forEach((t=>{this.findNeighborTile(t,(t=>t.isLoaded&&t.level<e))?.updateNeighborsWithChangedEdgeResolution();}));}updateNeighborsWithChangedEdgeResolution(){this.isLoaded&&this._updateNeighborsWithChangedEdgeResolution();}updateEdgeAfterResolutionChange(e){this.renderData.updateEdgeAfterResolutionChange(e);}forEachLoadedNeighbor(e){const t=this.level,i=e=>e.level===t||e.isLoaded;Y$2.forEach(((t,s)=>{const n=this.findNeighborTile(t,i);null!=n&&n!==this&&n.forAllSubtreeOnSide(q$6(t),(t=>!!t.isLoaded&&(e(t),!0)));const r=this.renderData?.geometryState?.neighborData;r&&(r.modifiedEdgeResolutions[s]=!1);})),Z$3.forEach((t=>{const s=this.findNeighborTile(t,i)?.findCorner(P$8(t),(e=>e.isLoaded));E$d(!s||_e$2(this,s,t)),s?.isLoaded&&e(s);}));}_updateNeighbor(e){e?.isLoaded&&e.updateNeighborDataAndGeometryIfNeeded();}getNeighborLIJ(e,t){const i=X$3(t)?-1:Q$4(t)?1:0,s=J$4(t)?-1:K$6(t)?1:0,n=[e[0],e[1]+i,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return !e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return 0===this.lij[2]}get isNorthEnd(){return 0===this.lij[1]}get isSouthEnd(){return this.extent[1]+t$1k>=this.surface.extent[1]}compareLIJs(e){const t=this.lij,i=t[0],s=e[0];if(i===s)return [t,e];const n=i-s;if(n<0){const i=2**-n;return [[s,t[1]*i,t[2]*i],e]}{const s=2**n;return [t,[i,e[1]*s,e[2]*s]]}}checkGeometryWaterproofness(){m$i&&(E$d(this.isLoaded),this.renderData.checkGeometryWaterproofness());}shouldHaveNeighbor(e){const t=this.extent,i=this.surface.rootTilesExtent,s=.25*(t[2]-t[0]);if(X$3(e)&&t[3]+s>=i[3])return !1;if(Q$4(e)&&t[1]-s<=i[1])return !1;const n=this.surface.isGlobal;return !(!n&&J$4(e)&&t[0]-s<=i[0])&&!(!n&&K$6(e)&&t[2]+s>=i[2])}}function oe$5(e,t,i,s){const n=i===A$8.ELEVATION?de$4.acquire():le$4.acquire();return n.init(e,t,i,s),n}function he$3(e){e.dispose(),e instanceof l$c?de$4.release(e):e instanceof t$g&&le$4.release(e);}const le$4=new e$1f(t$g),de$4=new e$1f(l$c),ue$4=new s$l;var ce$5;function ge$4(e,t){const i=e.level,s=t[0];if(i>s)return !1;const n=s-i,r=Math.floor(t[1]/2**n),a=Math.floor(t[2]/2**n);return r===e.lij[1]&&a===e.lij[2]}function fe$3(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function pe$4(e,t,i){return Math.abs(e-t)<=i}function me$4(e,t,i){if(t$V(e)||t$V(t))return !1;if(0===e.level&&0===t.level){if(e.isEastEnd&&t.isWestEnd&&i===E$q.EAST)return !0;if(e.isWestEnd&&t.isEastEnd&&i===E$q.WEST)return !0}const n=1e-6*(e.extent[2]-e.extent[0]);switch(i){case E$q.NORTH:return pe$4(e.extent[3],t.extent[1],n);case E$q.SOUTH:return pe$4(e.extent[1],t.extent[3],n);case E$q.EAST:return pe$4(e.extent[2],t.extent[0],n)||pe$4(e.extent[2],-t.extent[0],n);case E$q.WEST:return pe$4(e.extent[0],t.extent[2],n)||pe$4(e.extent[0],-t.extent[2],n)}}function _e$2(e,t,i){return !t$V(e)&&!t$V(t)&&t!==e&&(e.level>=t.level?ye$2(e,t,i):ye$2(t,e,P$8(i)))}function ye$2(e,t,i){E$d(e.level>=t.level);const s=z$5(i),n=B$a(i),r=e.extent,a=t.extent,o=[s?r[0]:r[2],n?r[3]:r[1]],h=[s?a[2]:a[0],n?a[1]:a[3]],l=1e-5*(r[2]-r[0]),d=pe$4(o[0],h[0],l)||e.surface.isGlobal&&pe$4(o[0],-h[0],l),u=pe$4(o[1],h[1],l);if(d&&u)return !0;if(e.level===t.level)return !1;if(!d&&!u)return !1;return d?Ae$1(a[1],a[3],r[1],r[3],l):Ae$1(a[0],a[2],r[0],r[2],l)}function Ae$1(e,t,i,s,n=t$1k){return e-n<=i&&i<=s&&s<=t+n}!function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM";}(ce$5||(ce$5={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$h{constructor(){this._scales=[-1,-1,-1,-1],this._offsets=[-1,-1,-1,-1];}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1;}setScale(s,t,e){this._scales[2*s]=t,this._scales[2*s+1]=e;}setOffset(s,t,e){this._offsets[2*s]=t,this._offsets[2*s+1]=e;}get scales(){return this._scales}get offsets(){return this._offsets}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class T$a{constructor(){this.geometryInfo=new h$d,this.intersectionData=null,this.geometryState=null,this._textureRef=new n$k((()=>this.tile.surface.textureFadeDuration)),this.overlay=new s$h,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1;}get tile(){return this._tile}init(e){this._tile=e,this.clear();const t=this.geometryInfo;t.indices=null,t.vertexAttributes=null,B$t(t.boundingBox),t.indexCount=0,t.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new i$j,this.localOrigin=null,this.overlay.clear();}clear(){this._releaseGeometry(),this.releaseTexture(),this._textureRef.clear();}updateGeometryIfChanged(e,t){const r=this.updateGeometryStateAndPrepareForGeometryGeneration(t);this._hasGeometry=!0;return this.updateNeighborDataAndGeometryIfNeeded(r,e)}updateNeighborDataAndGeometryIfNeeded(e=!1,t=this.vao.context){const r=this._updateNeighborData(),i=e||this._geometryStateChangedSinceLastUpdate||r;return i&&(this._updateGeometry(t),this._geometryStateChangedSinceLastUpdate=!1),i}_calculateEdgeResolution(e,t){const s=this.tile,a=this.geometryState.numVerticesPerSide-1;if(!s.surface.isGlobal){const t=s.surface.extent;if(r$W(t)&&(0===e&&s.extent[3]>t[3]||1===e&&s.extent[2]>t[2]||2===e&&s.extent[1]<t[1]||3===e&&s.extent[0]<t[0]))return a}const o=s.level,n=Y$2[e],l=t||s.findNeighborTile(n,(e=>e.isLoaded||e.level===o));if(!l||l.isLeaf&&!l.isLoaded)return E$d(t$V(s.surface?.rootTiles)||s.surface.updatingRootTiles||!s.shouldHaveNeighbor(n)),a;if(l.isLoaded){const t=l,r=t.renderData.geometryState,i=o-t.level;if(0===i){const e=r.numVerticesPerSide-1;return Math.max(e,a)}const s=2**i,n=r.neighborData.edgeResolutions[(e+2)%4]/s;return Math.max(1,n)}E$d(!l.isLeaf);let h=a;return l.forAllSubtreeOnSide(q$6(n),(e=>e===s||(e.isLoaded?(h=Math.max(h,2**(e.level-o)),!0):(E$d(!e.isLeaf),!1)))),h}_updateNeighborData(){const e=this.tile,r=t=>t.isLoaded||t.level===e.level,i=e=>e.isLoaded,s=[null,null,null,null],a=[null,null,null,null];(()=>{for(let t=0;t<4;++t){const i=e.findNeighborTile(Y$2[t],r);s[t]=i,a[t]=i?.isLoaded?i:null;}})();const o=[null,null,null,null];(()=>{for(let t=0;t<4;++t)o[t]=e.findNeighborTile(Z$3[t],i);})();const l=this.geometryState.neighborData;let h=!1;(()=>{for(let t=0;t<4;++t){const r=l.edgeResolutions[t],i=s[t],a=this._calculateEdgeResolution(t,i);l.edgeResolutions[t]=a,r!==a&&(h=!0,this._edgeResolutionChanged=!0,i&&i!==e&&!i.isLoaded&&i.level===e.level&&(l.modifiedEdgeResolutions[t]=!0));}})();(()=>{const r=(r,i)=>{const s=r.reduce(((e,t)=>Math.min(e,t?.level??1/0)),1/0);for(let l=0;l<4;++l){const s=r[(l+3)%4],a=r[l];if(s&&s.level<e.level&&s===a){const r=s,a=1==(1&l),o=(e.getNeighborEdgeStartVertexIndex(l,r)+(0===i||1===i&&!a||3===i&&a?1:0))/2**(e.level-r.level),h=a?0===i||1===i?r.extent[0]:r.extent[2]:s$1c(r.extent[0],r.extent[2],o),d=a?s$1c(r.extent[1],r.extent[3],o):0===i||3===i?r.extent[1]:r.extent[3];return h$e(h,d,r.renderData.geometryState.samplerData)}}let a=0,o=0;for(let e=0;e<4;++e){const t=r[e];if(t&&t.level===s){const r=0===e||1===e,i=0===e||3===e,s=t.extent;o+=h$e(s[r?0:2],s[i?1:3],t.renderData?.geometryState?.samplerData),a++;}}return a?o/a:0},i=l.cornerNeighborData,s=(t,s)=>{const a=i[t],o=a.cornerTiles;for(let r=0;r<4;++r){const t=Z$3[r],i=s[r]?.findCorner(P$8(t),(t=>t?.isLoaded||t===e));o[r]=i;}const n=r(o,t);return a.elevation!==n&&(a.elevation=n,!0)};for(let t=0;t<4;++t){const r=o[t],i=a[t],n=[r,a[(t+1)%4],e,i],l=n.map(((e,r)=>n[(r+4-t)%4]));s(t,l)&&(this._cornerElevationChanged=!0,h=!0);}})();return (()=>{const t=(t,r)=>{if(!t?.isLoaded||t.lij[0]>e.lij[0])return null;const i=t.renderData.geometryState;return {neighborSamplerData:i.samplerData,neighborEdgeOverlapResolution:i.neighborData.edgeResolutions[r+2],version:i.samplerDataVersion,neighborVerticesPerSide:i.numVerticesPerSide,neighborTile:t}},r=l.edgeNeighbours;for(let i=0;i<4;++i){const s=a[i];s&&(E$d(s?.isLoaded),E$d(s?.lij[0]<=e.lij[0]));const o=r[i],n=o?.version,l=t(s,i),d=l?.version??null,u=null!=o!=(null!=l),g=o&&l&&n!==d,c=o&&l&&o?.neighborTile!==l?.neighborTile,p=u||g||c;this._edgeNeighborChanged||(this._edgeNeighborChanged=p),h||(h=p),!p&&n||(r[i]=l);}})(),h}updateEdgeAfterResolutionChange(e){const t=this._calculateEdgeResolution(e),r=this.geometryState.neighborData.edgeResolutions,i=r[e];E$d((this.geometryState.neighborData.edgeNeighbours[e]?.neighborTile.level??0)<=this.tile.level),t!==i&&(r[e]=t,this._edgeResolutionChanged=!0,T$a.deferTileNeighborUpdate?T$a.neighborTilesToUpdate.add(this.tile):this._updateGeometry(this.vao.context));}_updateGeometry(e){this.intersectionData=null;const t=this.tile,r=t.lij,i=T$a.updatedGeometryTiles.get(r)||0;T$a.updatedGeometryTiles.set(r,i+1);const s=this._vao,a=this.geometryInfo.vertexAttributes,o=!s||!a||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._edgeResolutionChanged,n=!o&&this._edgeNeighborChanged,l=!n&&this._cornerElevationChanged;this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,o?(this._releaseGeometry(),this._createGeometry(e)):n?t.updateEdgeElevations():l?t.updateCornerElevations():console.warn("Update for no reason?");}releaseGeometry(){return this._releaseGeometry()}get hasGeometry(){return this._hasGeometry}ensureTexture(e,t){return r$W(this._texture)&&this._texture.descriptor.width!==e&&this.releaseTexture(),t$V(this._texture)&&(this._texture=t(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){r$W(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty());}updateGeometryStateAndPrepareForGeometryGeneration(t){const r=this._getElevationInfo(),i=r.samplerData?this.tile.getElevationBasedVerticesPerSide(r.maxTileLevel):this.tile.getDefaultVerticesPerRowOnLevel(),s=Math.max(i,5);let a=this.tile.clippingArea;this.tile.intersectsClippingArea&&!this.tile.isWithinClippingArea||(a=null);const o=this.geometryState;let n=!1;return o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,n=!0),r.changed&&(this._samplerDataChanged=!0,o.samplerData=r.samplerData,o.samplerDataVersion++,n=!0),i$1n(o.clippingArea,a)||(this._clippingAreaChanged=!0,o.clippingArea=a,n=!0),o.wireframe!==t&&(this._wireframeChanged=!0,o.wireframe=t,n=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=n),this._hasGeometry=!0,n}_createGeometry(e){this.tile.createGeometry();const t=this.geometryInfo.vertexAttributes,r=this.geometryInfo.indices,i=e.gl;this._vao=new f$U(e,E$E,{geometry:o$13(t.layout)},{geometry:c$13.createVertex(e,i.STATIC_DRAW,t.buffer)},c$13.createIndex(e,i.STATIC_DRAW,r)),this._hasGeometry=!0;}_releaseGeometry(){return this._hasGeometry=!1,!!this._vao&&(this._vao.dispose(),this._vao=null,_$8(this.geometryInfo),!0)}get vao(){return this._vao}setTextureReference(e,t=s$j.Immediate){r$W(e)&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,t);}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,t=this.tile.layerInfo[A$8.ELEVATION],i=t.length;let s=new Array(i),a=0,o=0,n=!1;for(let l=0;l<i;l++){const i=t[l];if(r$W(i.upsampleInfo)){const t=i.upsampleInfo.tile,r=t.layerInfo[A$8.ELEVATION][l].data,d=r&&r.samplerData;e&&e[a]===d||(n=!0),s[a++]=d,o=Math.max(o,t.lij[0]);}else if(i.data){const t=this.tile.surface.layerViewByIndex(l,A$8.ELEVATION);if(u$h(this.tile,t.layer,!1)){const t=i.data;e&&e[a]===t.samplerData||(n=!0),s[a++]=t.samplerData,o=this.tile.level;}}}return r$W(e)&&e.length!==a&&(n=!0),a>0?s.length=a:s=null,{changed:n,samplerData:s,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){const e=E$I(this.intersectionData,0,(e=>e.estimatedMemoryUsage));return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength+e}get textureDescriptor(){return r$W(this._texture)?this._texture.descriptor:null}get test(){return {hasTexture:null!=this._texture}}checkGeometryWaterproofness(){}}function G$7(e,t,i){if(r$W(i))for(const r of i)if(r){const i=r.x0,s=r.width,a=i+(s-1)/r.dx,o=r.y1,n=o-(s-1)/r.dy;if(e>=i-$$4&&e<=a+$$4&&n-$$4<=t&&t<=o+$$4)return !0}return !1}T$a.updatedGeometryTiles=new Map,T$a.deferTileNeighborUpdate=!1,T$a.neighborTilesToUpdate=new Set;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const D$6=65536;function O$8(e,t){const n=e.tile,{extent:s,extentInRadians:l,surface:u}=n,d=e.localOrigin,m=e.geometryState,b=u.isWebMercator,M=u.shadingEnabled,v=m.numVerticesPerSide,D=v-1,O=(v-2)**2,V=b&&(t===O$r.HAS_SOUTH_POLE||t===O$r.HAS_BOTH_POLES),A=b&&(t===O$r.HAS_NORTH_POLE||t===O$r.HAS_BOTH_POLES),P=6,B=((V?1:0)+(A?1:0))*P*(D+1),w=m.neighborData,I=w.edgeResolutions.reduce(((e,t)=>e+t+1),0),L=b$7(O+B+I),T=e.geometryInfo;T.numVerticesPerSide=m.numVerticesPerSide,T.vertexAttributes=L,r$17(T.uvOffsetAndScale,0,0,1,1);const U=L.position.typedBuffer,N=L.uv0.typedBuffer,j=L.normal.typedBuffer,Z=T.boundingBox;B$t(Z);const C=d[0],H=d[1],W=d[2];ge$3.update(D,l);let _=0;const X=m.samplerData,q=n.ellipsoid.radius,k=ee$1(e),G=v-2,z=s[0],F=s[2],J=s[1],Q=s[3];if((()=>{for(let e=1;e<=G;e++){const t=e/D,n=J*(1-t)+Q*t,o=k(t),r=Math.cos(o),a=Math.sin(o);for(let e=1;e<=G;e++){const o=e/D,s=z*(1-o)+F*o,i=ge$3.sinLonLUT[e],c=ge$3.cosLonLUT[e],l=q+h$e(s,n,X),u=c*r*l-C,f=i*r*l-H,g=a*l-W;ue$3(u,f,g,Z);const d=H$l*_;U[d+0]=u,U[d+1]=f,U[d+2]=g,N[d+0]=o,N[d+1]=t,++_;}}})(),M){(()=>{const t=e=>(e$15(xe$1,e,Se$1),_$v(pe$3,xe$1,ye$1),_$v(be$1,pe$3,xe$1),be$1),n=L.position,s=L.normal;_=0;const l=e=>{n.getVec(e,he$2),u$W(ve$1,ve$1,t(he$2));},u=(e,n)=>{{const t=e/D,r=z*(1-t)+F*t,a=ge$3.sinLonLUT[e],s=ge$3.cosLonLUT[e],i=n/D,c=J*(1-i)+Q*i,l=k(i),u=Math.cos(l),f=Math.sin(l),g=q+h$e(r,c,X);o$W(he$2,s*u*g-C,a*u*g-H,f*g-W);}u$W(ve$1,ve$1,t(he$2));},f=(e,t,n)=>{e>1&&t>1&&e<G&&t<G?l(_+n):u(e,t);};for(let i=1;i<=G;i++)for(let t=1;t<=G;t++)n.getVec(_,Se$1),u$W(Me$1,Se$1,e.localOrigin),z$s(ye$1,Me$1),o$W(ve$1,0,0,0),f(t-1,i,-1),f(t+1,i,1),f(t,i-1,-G),f(t,i+1,+G),z$s(ve$1,ve$1),s.setVec(_,ve$1),++_;})();}_=O,E$9(e,O),Y$1(e),_=O+I;const $=[];(()=>{const e=(e,t)=>{const n=t*v;ue$3(-C,-H,e*q-W,Z),$.push({connectedRowOffset:n,connectedOuterEdgeOffset:1===e?0:2,rowOffset:_,latitudeResolution:P});const o=K$5(-1===e?J:Q,q),r=e*Math.PI/2-o,a=.99*(1===e?1:-1),s=q+0;for(let i=1;i<=P;++i){const e=o+r*(i/P),t=Math.cos(e),n=Math.sin(e);for(let o=0;o<=D;o++){const e=o/D,r=ge$3.sinLonLUT[o],i=ge$3.cosLonLUT[o]*t*s-C,c=r*t*s-H,l=n*s-W;ue$3(i,c,l,Z);const u=H$l*_;if(U[u+0]=i,U[u+1]=c,U[u+2]=l,N[u+0]=e,N[u+1]=a,M){const e=1/Math.sqrt(i*i+c*c+l*l);j[u+0]=e*i,j[u+1]=e*c,j[u+2]=e*l;}++_;}}};V&&e(-1,0),A&&e(1,D);})(),R$6(T,m.numVerticesPerSide,$,[0,v-1],[0,v-1],m.wireframe),e.intersectionData=null;for(let o=0;o<4;++o)E$d(T.outerEdges[o].count===w.edgeResolutions[o]+1);}function V$5(n,o){const r=n.tile,a=r.extent,s=n.localOrigin,i=n.geometryState,c=r.surface,l=c.isWebMercatorOnPlateeCarree,u=c.shadingEnabled,m=a[0],x=a[1],b=a[2]-m,M=a[3]-x,y=i.clippingArea,v=r$W(y)?Math.max(0,(y[0]-a[0])/b):0,D=r$W(y)?Math.max(0,(y[1]-a[1])/M):0,O=r$W(y)?Math.min(1,(y[2]-a[0])/b):1,V=r$W(y)?Math.min(1,(y[3]-a[1])/M):1,A=O-v,P=V-D,B=A>0?1/A:1,w=P>0?1/P:1,L=-v*B,T=-D*w,U=i.numVerticesPerSide,N=U-1,Z=(U-2)**2+i.neighborData.edgeResolutions.reduce(((e,t)=>e+t+1),0),C=b$7(Z),H=C.position.typedBuffer,W=C.uv0.typedBuffer,_=C.normal.typedBuffer,X=n.geometryInfo,Y=X.boundingBox;B$t(Y);let q=0;const k=r.ellipsoid.radius,G=i.samplerData,z=r$W(y)?y:de$3,F=o$1r(Math.max(a[0],z[0]),Math.max(a[1],z[1]),Math.min(a[2],z[2]),Math.min(a[3],z[3])),J=s[0],K=s[1],Q=s[2],$=j$5(l,k,o);(()=>{for(let t=1;t<=N-1;t++){const n=t/N,r=T+n*w,a=o$X(x+n*M,F[1],F[3]),s=o$X(r,0,1),i=$(a)-K,c=b/N;for(let t=1;t<=N-1;t++){const n=t/N,r=L+n*B,l=o$X(m+n*b,F[0],F[2]),f=o$X(r,0,1),g=h$e(l,a,G),d=l*o-J,x=g-Q;ue$3(d,i,x,Y);const p=H$l*q;if(H[p+0]=d,H[p+1]=i,H[p+2]=x,W[p+0]=f,W[p+1]=s,u){const e=h$e(l+c,a,G),t=h$e(l-c,a,G),n=h$e(l,a+c,G),o=.25*(t-e),r=.25*(h$e(l,a-c,G)-n),s=c,i=Math.sqrt(o*o+r*r+s*s);_[p+0]=o/i,_[p+1]=r/i,_[p+2]=s/i;}++q;}}})(),X.numVerticesPerSide=i.numVerticesPerSide,X.vertexAttributes=C,r$17(n.geometryInfo.uvOffsetAndScale,v,D,O-v,V-D),E$9(n,q),I$9(n,o),q=Z,R$6(X,i.numVerticesPerSide,[],[0,U-1],[0,U-1],i.wireframe),n.intersectionData=null;}function R$6(e,t,n,o,r,a){const s=t-1,i=e.vertexAttributes.count,c=2*(Math.min(t-2,o[1])-Math.max(1,o[0]))*(Math.min(t-2,r[1])-Math.max(1,r[0])),l=Y$2.map(((e,n)=>0===n&&r[1]<t-2||1===n&&o[1]<t-2||2===n&&r[0]>1||3===n&&o[0]>1)),u=3*(c+e.outerEdges.reduce(((e,t,n)=>e+(l[n]?0:s-2+t.count-1)),0)+n.reduce(((e,t)=>e+s*(2*(t.latitudeResolution-1)+1)),0))*(a?2:1),f=new(i>D$6?Uint32Array:Uint16Array)(u);let g=0;const d=a?(e,t,n)=>{f[g++]=e,f[g++]=t,f[g++]=t,f[g++]=n,f[g++]=n,f[g++]=e;}:(e,t,n)=>{f[g++]=e,f[g++]=t,f[g++]=n;},m=t-2,h=s-2;(()=>{for(let e=Math.max(r[0],1)-1;e<Math.min(r[1],t-2)-1;++e)for(let n=Math.max(o[0],1)-1;n<Math.min(o[1],t-2)-1;++n){const t=e*m+n,o=t+1,r=o+m,a=r-1;d(t,o,r),d(r,a,t);}})();(()=>{for(let t=0;t<4;++t){if(l[t])continue;const n=e.outerEdges[t],o=e.innerEdges[t];let r=0,a=0;const i=n.count,c=o.count;n.count;const u=1===t||2===t?(e,t,n)=>d(e,t,n):(e,t,n)=>d(e,n,t);for(;r<i-1||a<c-1;){const e=o.getVertexOffset(a),t=n.getVertexOffset(r),l=r<i-1,f=a<c-1,g=l?0+s*(r+.5)/(i-1):0,d=f?1+h*(a+.5)/(c-1):0;if(l&&(!f||g<=d)){++r;u(e,t,n.getVertexOffset(r));}else {++a;u(e,t,o.getVertexOffset(a));}}}})();const x=n=>{let o=e.outerEdges[n.connectedOuterEdgeOffset].offset0;for(let e=0;e<n.latitudeResolution;++e){const r=0===e?n.rowOffset:o+t;for(let t=0;t<s;t++)d(o,o+1,r+t),e<n.latitudeResolution-1&&d(o+1,r+t+1,r+t),++o;o=r;}};(()=>{n.forEach(x);})(),e.indices=f,e.indexCount=u;}function E$9(e,t){const n=e.localOrigin,o=e.geometryInfo,r=e.geometryState.neighborData.edgeResolutions,a=o.numVerticesPerSide-2,s=o.vertexAttributes.position.typedBuffer;let i=t;for(let c=0;c<4;++c){{const e=0===c||2===c,t=(0===c?a-1:0)*a+(1===c?a-1:0),r=(e?0:1)*a+(e?1:0);o.innerEdges[c]=new n$l(s,n,t,r,a);}{const e=i,t=r[c]+1;o.outerEdges[c]=new n$l(s,n,e,1,t),i+=t;}}}function A$7(e){H$4(e),te$1(e);const t=e.vao,n=e.geometryInfo.vertexAttributes;t?.vertexBuffers?.geometry?.setSubData(n.position.typedBuffer);}function P$5(e){Y$1(e),X$2(e);}function B$8(e,t){W$5(e,t),ne$1(e,t),X$2(e);}function w$9(e,t){I$9(e,t),X$2(e);}function I$9(e,t){W$5(e,t),k$5(e,t),ne$1(e,t);}function L$6(e,t,n,o,r){const a=Math.cos(n),s=Math.sin(n),i=Math.sin(t),c=Math.cos(t),l=r+o;e[0]=c*a*l,e[1]=i*a*l,e[2]=s*l;}function T$9(e,t,n,o,r,a){const s=r[0===n?1:3];L$6(e,r[0===t?0:2],s,o,a);}function U$7(e,t){return (Math.PI/2-2*Math.atan(Math.exp(-e/t)))*t}function N$9(e,t){return e*t}function j$5(e,t,n){return e?e=>U$7(e,t):e=>N$9(e,n)}function Z$2(e,t,n,o,r,a,s){const i=0===t?r[0]:r[2],c=0===n?r[1]:r[3],l=o;e[0]=i*a,e[1]=s(c),e[2]=l;}function C$8(o,r){const a=o.geometryState,s=o.tile,i=s.extent,c=c$$(a.clippingArea,i),l=o.geometryInfo,u=l.boundingBox,f=l.outerEdges,g=a.neighborData.cornerNeighborData,d=l.uvOffsetAndScale[0],m=l.uvOffsetAndScale[1],x=l.uvOffsetAndScale[2],p=l.uvOffsetAndScale[3],b=x>0?1/x:1,M=p>0?1/p:1,S=-d*b,y=-m*M,v=s.surface.isWebMercatorOnPlateeCarree,D=j$5(v,v?s.ellipsoid.radius:0,r),O=a.samplerData,V=a.neighborData.edgeNeighbours,R=o.localOrigin,E=(n,o,a,l,f)=>{const d=i[0]*(1-l)+i[2]*l,m=i[1]*(1-f)+i[3]*f,x=o$X(d,c[0],c[2]),p=o$X(m,c[1],c[3]),v=[p===i[3],x===i[2],p===i[1],x===i[0]],E=!v[3]&&!v[1]||!v[0]&&!v[2],A=E?v[0]&&r$W(V[0])?V[0]:v[1]&&r$W(V[1])?V[1]:v[2]&&r$W(V[2])?V[2]:v[3]&&r$W(V[3])?V[3]:null:null,P=E?A?A.neighborTile.level===s.level?.5*(h$e(x,p,O)+h$e(x,p,A.neighborSamplerData)):h$e(x,p,A.neighborSamplerData):h$e(x,p,O):g[a].elevation,B=x*r-R[0],w=D(p)-R[1],I=P-R[2];ue$3(B,w,I,u);const L=o$X(S+l*b,0,1),T=o$X(y+f*M,0,1);n.setVertexRawXYZUV(o,B,w,I,L,T);};for(let e=0;e<4;++e){const t=f[e];E(t,0,0===e?3:1===e?1:2,1===e?1:0,0===e?1:0);const n=2===e?1:3===e?3:0,o=3===e?0:1,r=2===e?0:1;E(t,t.count-1,n,o,r);}}function H$4(e){_$5(e,((t,n,o,r)=>T$9(t,n,o,r,e.tile.extentInRadians,e.tile.ellipsoid.radius)));}function W$5(e,n){const o=e.tile;r$W(o.renderData.geometryState.clippingArea)?C$8(e,n):_$5(e,((t,r,a,s)=>Z$2(t,r,a,s,e.tile.extent,n,j$5(o.surface.isWebMercatorOnPlateeCarree,o.ellipsoid.radius,n))));}function _$5(e,t){const n=e.geometryInfo,o=n.outerEdges,r=e.geometryState.neighborData.cornerNeighborData,a=n.boundingBox,s=e.localOrigin,i=(e,n,o,i,c)=>{t(me$3,o,i,r[n].elevation);for(let t=0;t<3;++t)me$3[t]-=s[t];ue$3(me$3[0],me$3[1],me$3[2],a),e.setVertexRawXYZUV(c,me$3[0],me$3[1],me$3[2],o,i);};for(let c=0;c<4;++c){const e=o[c];i(e,0===c?3:1===c?1:2,1===c?1:0,0===c?1:0,0);i(e,2===c?1:3===c?3:0,3===c?0:1,2===c?0:1,e.count-1);}}function X$2(e){const t=e.vao,n=e.geometryInfo.vertexAttributes;t?.vertexBuffers?.geometry?.setSubData(n.position.typedBuffer);}function Y$1(e){H$4(e);for(let t=0;t<4;++t)q$5(e,t);te$1(e);}function q$5(e,t){const n=e.geometryState,c=n.neighborData,l=e.tile;l.level;const f=l.extent,g=f[2]-f[0],d=f[3]-f[1],m=l.extentInRadians,x=m[0];m[1];const p=m[2];m[3];const b=l.ellipsoid.radius,M=ee$1(e),y=e=>{if(!e)return 0;const t=D,n=O?0:1,o=e.lij[n+1]*L,r=l.lij[n+1]-o;return (O?L-1-r:r)*t},v=c.edgeNeighbours[t],D=c.edgeResolutions[t],O=1===t||3===t,V=1===t?1:0,R=0===t?1:0,E=f[0]+V*g,A=f[1]+R*d,P=x*(1-V)+p*V,B=M(R),w=v?.neighborTile,I=l.level-(w?.level??l.level),L=2**I,T=D*L,U=y(w),N=w?.extent,j=(t+2)%4,Z=n.samplerData,C=w?.renderData?.geometryState?.samplerData,H=w&&0===I,W=(e,t,n,o)=>.5*(h$e(e,t,C)+h$e(n,o,Z)),_=(e,t)=>h$e(e,t,C),X=H?W:_;let Y=N?1===j?N[2]:N[0]:E,q=N?0===j?N[3]:N[1]:A;const k=(e,t,n)=>{const o=(U+e)/T;return q=N[1]*(1-o)+N[3]*o,X(Y,q,t,n)},G=(e,t,n)=>{const o=(U+e)/T;return Y=N[0]*(1-o)+N[2]*o,X(Y,q,t,n)},z=w?O?k:G:(e,t,n)=>h$e(t,n,Z),F=(e,t,n)=>z(e,t,n);let J=V,K=E,Q=P,$=R,te=A,ne=B,oe=Math.sin(Q),re=Math.cos(Q),ae=Math.cos(ne),se=Math.sin(ne);const ie=O?()=>M($):()=>B,ce=O?e=>{$=e,te=f[1]*(1-e)+f[3]*e,ne=ie(),ae=Math.cos(ne),se=Math.sin(ne);}:e=>{J=e,K=f[0]*(1-e)+f[2]*e,Q=x*(1-J)+p*J,oe=Math.sin(Q),re=Math.cos(Q);},le=e.geometryInfo,fe=le.boundingBox,ge=le.vertexAttributes,de=ge.position.typedBuffer,me=ge.uv0.typedBuffer,Se=ge.normal.typedBuffer,De=le.outerEdges[t];let Oe=De.getVertexOffset(1);const Ve=D+1,Re=e.localOrigin,Ee=Re[0],Ae=Re[1],Pe=Re[2],Be=l.surface.shadingEnabled,we=1===t?-1:3===t?1:0,Ie=0===t?-1:2===t?1:0,Le=g/D,Te=we*Le,Ue=Ie*Le,Ne=we*(1/D),je=Ie*(1/D),Ze=e=>{J$g(xe$1,e,Me$1),_$v(pe$3,xe$1,ye$1),_$v(be$1,pe$3,xe$1),u$W(ve$1,ve$1,be$1);};for(let a=1;a<Ve-1;++a){ce(a/D);const e=F(a,K,te),t=b+e,n=re*ae*t,s=oe*ae*t,i=se*t,c=n-Ee,l=s-Ae,f=i-Pe;ue$3(c,l,f,fe);const g=H$l*Oe;if(de[g+0]=c,de[g+1]=l,de[g+2]=f,me[g+0]=J,me[g+1]=$,Be){o$W(ve$1,0,0,0),o$W(Me$1,n,s,i),z$s(ye$1,Me$1);const e=(e,t)=>{const n=h$e(K+e*Te,te+e*Ue,t),o=b+n,r=J+e*Ne,a=x*(1-r)+p*r,s=Math.sin(a),i=Math.cos(a),c=M($+e*je),l=Math.sin(c),f=Math.cos(c),g=r$X(i*f*o,s*f*o,l*o);Ze(g);};w&&e(-1,C),w&&!H||e(1,Z),Se[g+0]=ve$1[0],Se[g+1]=ve$1[1],Se[g+2]=ve$1[2];}++Oe;}if(Be)for(let o=1;o<Ve-1;++o)De.getVertexRawNormal(ve$1,o),De.getVertex(Me$1,o),z$s(ye$1,Me$1),De.getVertex(he$2,o-1),Ze(he$2),De.getVertex(he$2,o+1),Ze(he$2),z$s(ve$1,ve$1),De.setVertexRawNormal(o,ve$1[0],ve$1[1],ve$1[2]);}function k$5(e,n){const o=e.geometryState.clippingArea,r=e.tile.extent,a=r$W(o)&&(r[0]<o[0]||r[2]>o[2]||r[1]<o[1]||r[3]>o[3])?J$3:F$6;for(let t=0;t<4;++t)a(e,t,n);}function G$6(e,t,n,o,r,a,s){return s===r?!e||t?(e,t)=>h$e(e,t,n):null:s===a?e?(e,t)=>h$e(e,t,o):null:null}function z$3(e,t,n,o){if(t!==e)return ()=>0;const r=t?3:2,a=t?1:0,s=o(r,a),i=o(a,r),c=(null!=s?1:0)+(null!=i?1:0),l=t?n:0,u=t?0:n;return (e,t,n)=>((null!=s?-(s(e+l,t+u)-n):0)+(null!=i?+(i(e-l,t-u)-n):0))/c}function F$6(e,n,o){const r=e.geometryState.neighborData,a=r.edgeNeighbours,s=e.tile,i=s.level,c=s.surface,l=c.shadingEnabled,u=a[n],f=r.edgeResolutions[n],g=f,d=s.extent,m=e.geometryState,x=g+1,p=u,b=e.localOrigin,M=m.samplerData,S=(e,t)=>h$e(e,t,M),y=(e,t)=>.5*(h$e(e,t,p.neighborSamplerData)+h$e(e,t,M)),v=(e,t)=>h$e(e,t,p.neighborSamplerData),D=p?.neighborTile.level===i,O=D?y:v,V=r$W(p)?O:S,R=e.geometryInfo,E=R.outerEdges[n],A=j$5(c.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,o),P=R.boundingBox,B=1===n||3===n,w=1===n?d[2]:d[0],I=0===n?d[3]:d[1],L=1===n?1:0,T=0===n?1:0,U=(d[2]-d[0])/f,N=p?.neighborSamplerData,Z=r$W(p),C=(e,t)=>G$6(Z,D,M,N,e,t,n),H=z$3(B,!0,U,C),W=z$3(B,!1,U,C);for(let t=1;t<x-1;++t){const e=t/g,n=B?w:d[0]*(1-e)+d[2]*e,r=B?d[1]*(1-e)+d[3]*e:I,a=B?L:e,s=B?e:T,i=V(n,r),c=n*o-b[0],u=A(r)-b[1],f=i-b[2];if(ue$3(c,u,f,P),l){const e=H(n,r,i),o=W(n,r,i),l=U;E.setVertexRawXYZUVN(t,c,u,f,a,s,e,o,l);}else E.setVertexRawXYZUV(t,c,u,f,a,s);}if(l){const e=B?0:1,t=B?1:0;for(let n=1;n<x-1;++n){E.getNormal(De$1,n);const o=E.getVertexZ(n-1)-E.getVertexZ(n+1),r=De$1[0]+.5*e*o,a=De$1[1]+.5*t*o,s=2*U,i=1/Math.sqrt(r*r+a*a+s*s);E.setVertexRawNormal(n,i*r,i*a,i*s);}}}function J$3(o,r,a){const s=o.geometryState.neighborData,i=s.edgeNeighbours,c=o.tile,l=c.level,u=c.surface,f=u.shadingEnabled,g=i[r],d=s.edgeResolutions[r],m=d,x=c.extent,p=o.geometryState,b=c$$(p.clippingArea,de$3),M=o.geometryInfo,S=M.uvOffsetAndScale[0],y=M.uvOffsetAndScale[1],v=S+M.uvOffsetAndScale[2],D=y+M.uvOffsetAndScale[3],O=v>S?1/(v-S):1,V=D>y?1/(D-y):1,R=-S*O,E=-y*V,A=m+1,P=[x[3]>b[3],x[2]>b[2],x[1]<b[1],x[0]<b[0]],B=g,w=p.samplerData,I=(e,t)=>h$e(e,t,w),L=B?.neighborTile.level===l,T=(e,t)=>{const n=h$e(e,t,B.neighborSamplerData);return L?.5*(n+h$e(e,t,w)):n},U=I,N=r$W(B)?T:I,Z=P[r]?U:N,C=M.outerEdges[r],H=M.boundingBox,W=1===r||3===r,_=o$X(1===r?x[2]:x[0],b[0],b[2]),X=o$X(0===r?x[3]:x[1],b[1],b[3]),Y=1===r?1:0,q=0===r?1:0,k=o.localOrigin,F=j$5(u.isWebMercatorOnPlateeCarree,c.ellipsoid.radius,a),J=(x[2]-x[0])/d,K=B?.neighborSamplerData,Q=r$W(B),$=B?.neighborTile.level===l,ee=(e,t)=>G$6(Q,$,w,K,e,t,r),te=z$3(W,!0,J,ee),ne=z$3(W,!1,J,ee);for(let t=1;t<A-1;++t){const n=t/m,o=W?_:o$X(x[0]*(1-n)+x[2]*n,b[0],b[2]),r=W?o$X(x[1]*(1-n)+x[3]*n,b[1],b[3]):X,s=W?Y:o$X(R+n*O,0,1),i=W?o$X(E+n*V,0,1):q,c=Z(o,r),l=o*a-k[0],u=F(r)-k[1],g=c-k[2];if(ue$3(l,u,g,H),f){const e=te(o,r,c),n=ne(o,r,c),a=J;C.setVertexRawXYZUVN(t,l,u,g,s,i,e,n,a);}else C.setVertexRawXYZUV(t,l,u,g,s,i);}if(f){const e=W?0:1,t=W?1:0;for(let n=1;n<A-1;++n){C.getNormal(De$1,n);const o=C.getVertexZ(n-1)-C.getVertexZ(n+1),r=De$1[0]+.5*e*o,a=De$1[1]+.5*t*o,s=2*J,i=1/Math.sqrt(r*r+a*a+s*s);C.setVertexRawNormal(n,i*r,i*a,i*s);}}}function K$5(e,t){return Math.PI/2-2*Math.atan(Math.exp(-e/t))}function Q$3(e,t,n,o){return K$5(e+o*(t-e),n)}function $$3(e,t,n){return e*(1-n)+t*n}function ee$1(e){const t=e.tile;if(t.surface.isWebMercator){const e=t.extent,n=t.ellipsoid.radius;return t=>Q$3(e[1],e[3],n,t)}const n=t.extentInRadians;return e=>$$3(n[1],n[3],e)}function te$1(e){e.tile.surface.shadingEnabled&&le$3(e,((e,t,n,o,r,a,s)=>oe$4(t,e,n,o,r,a,s)));}function ne$1(e,t){e.tile.surface.shadingEnabled&&le$3(e,((n,o,r,a,s,i,c)=>re(se$1(e,t),n,r,s,i,c)));}function oe$4(e,t,n,o,r,a,c){ae$3(e,he$2,r,a,c),J$g(xe$1,he$2,n),_$v(pe$3,xe$1,o),_$v(t,pe$3,xe$1);}function re(e,t,n,o,r,a){e(he$2,o,r,a);const s=he$2[0]-n[0],i=he$2[1]-n[1],c=he$2[2]-n[2];t[0]=-s*c,t[1]=-i*c,t[2]=s*s+i*i;}function ae$3(e,t,n,o,r){const a=ee$1(e),s=e.tile,i=s.extent;E$d(k$G(i,n,o,1));const c=(n-i[0])/(i[2]-i[0]),l=(o-i[1])/(i[3]-i[1]),u=s.extentInRadians;L$6(t,u[0]*(1-c)+u[2]*c,a(l),r,s.ellipsoid.radius);}function se$1(e,t){return e.tile.surface.isWebMercatorOnPlateeCarree?(n,o,r,a)=>ce$4(t,e.tile.ellipsoid.radius,n,o,r,a):(e,n,o,r)=>ie$2(t,e,n,o,r)}function ie$2(e,t,n,o,r){t[0]=n*e,t[1]=o*e,t[2]=r;}function ce$4(e,t,n,o,r,a){n[0]=o*e,n[1]=(Math.PI/2-2*Math.atan(Math.exp(-r/t)))*t,n[2]=a;}function le$3(e,t){if(!e.tile.surface.shadingEnabled)return;const n=e.geometryState.neighborData.cornerNeighborData,s=e.tile,i=s.extent,c="local"===e.tile.surface.view?.viewingMode;c&&o$W(ye$1,0,0,1);{const l=(e,n,o,r)=>{t(be$1,e.renderData,Me$1,ye$1,n,o,r),u$W(ve$1,ve$1,be$1);},u=1,f=(e,t,n,o,r,a)=>{const s=1===a?r.extent[0]:3===a?r.extent[2]:e,i=0===a?r.extent[1]:2===a?r.extent[3]:t,c=s+fe$2[n][0]*o,f=i+fe$2[n][1]*o;E$d(k$G(r.extent,c,f,u));const g=h$e(c,f,r.renderData.geometryState.samplerData);l(r,c,f,g);},g=(e,t,n)=>e.extent[0===t||1===t?2:0]+n,d=(e,t,n)=>e.extent[0===t||3===t?3:1]+n,x=(e,t,n,o)=>{const r=g(n,o,fe$2[e][0]*t),a=d(n,o,fe$2[e][1]*t);E$d(k$G(n.extent,r,a,u));const s=h$e(r,a,n.renderData.geometryState.samplerData);l(n,r,a,s);},p=(e,t,n,o,r,a)=>{const s=fe$2[e][0]*t,i=fe$2[e][1]*t,c=g(n,o,s),f=d(n,o,i),x=g(r,a,s),p=d(r,a,i);E$d(k$G(n.extent,c,f,u)),E$d(k$G(r.extent,x,p,u));const b=h$e(c,f,n.renderData.geometryState.samplerData),M=h$e(x,p,r.renderData.geometryState.samplerData);l(n,c,f,.5*(b+M));},b=e=>{const t=0===e||1===e?i[2]:i[0],o=0===e||3===e?i[3]:i[1],r=n[e].cornerTiles,a=r.reduce(((e,t)=>Math.min(e,t?.level??1/0)),1/0);for(let n=0;n<4;++n){const e=r[n];Ve$1[n]=e?.level===a?e:null;}for(let n=0;n<4;++n){const e=Ve$1[(n+3)%4],r=Ve$1[n];if(null!=e&&e!==s&&e===r){const r=e,a=(n+2)%4,i=r.renderData.geometryState.neighborData.edgeResolutions[a],c=Math.max(i,2**(s.level-r.level)),l=(r.extent[2]-r.extent[0])/c,u=(n+0)%4,g=(n+1)%4;return f(t,o,(n+3)%4,l,r,n),f(t,o,u,l,r,n),f(t,o,g,l,r,n),ve$1}}{E$d(Ve$1.some((e=>e?.isLoaded||e===s)));const e=Ve$1.reduce(((e,t)=>t?t.extent[2]-t.extent[0]:e),0)/Ve$1.reduce(((e,t)=>Math.max(e,t?.renderData.geometryState.numVerticesPerSide??1)),1);for(let t=0;t<4;++t){const n=Ve$1[(t+3)%4],o=Ve$1[(t+0)%4];if(!n&&!o)continue;const r=0===t?1:1===t?2:2===t?3:0,a=0===t?2:1===t?3:2===t?0:1;if(n&&o)p(t,e,n,r,o,a);else {x(t,e,n??o,n?r:a);}}}return ve$1};for(let t=0;t<4;++t){const n=e.geometryInfo.outerEdges[t],a=1===t||2===t?0:n.count-1;n.getVertex(Me$1,a),c||z$s(ye$1,Me$1),o$W(ve$1,0,0,0);const s=b(t);z$s(Oe$1[t],s);}}{const t=(e,t,n,o,r)=>{e.setVertexRawNormal(r,t,n,o);},n=e.geometryInfo.outerEdges;for(let e=0;e<4;++e){const o=n[e];{const n=Oe$1[0===e?3:1===e?1:2];t(o,n[0],n[1],n[2],0);}{const n=Oe$1[2===e?1:3===e?3:0];t(o,n[0],n[1],n[2],o.count-1);}}}}function ue$3(e,t,n,o){e<o[0]?o[0]=e:e>o[3]&&(o[3]=e),t<o[1]?o[1]=t:t>o[4]&&(o[4]=t),n<o[2]?o[2]=n:n>o[5]&&(o[5]=n);}const fe$2=[[0,1],[1,0],[0,-1],[-1,0]],ge$3=new o$i,de$3=o$1r(-1/0,-1/0,1/0,1/0),me$3=n$16(),he$2=n$16(),xe$1=n$16(),pe$3=n$16(),be$1=n$16(),Me$1=n$16(),Se$1=n$16(),ye$1=n$16(),ve$1=n$16(),De$1=n$16(),Oe$1=[n$16(),n$16(),n$16(),n$16()],Ve$1=[null,null,null,null];

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class f$a extends ae$4{constructor(e,t,r){super(),this.horizontalScaleFactor=1,this.extentInRenderSR=u$T(),void 0!==e&&this.init(e,t,r);}init(r,a,o){super.init(r,a,o);const n=o.view.renderSpatialReference,c=o.spatialReference,l=r$W(n)&&T$H(n)&&c.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this.horizontalScaleFactor=l;const m=this.surface.isWebMercatorOnPlateeCarree,p=this.extentInRenderSR,d=this.extent;if(m){const e=r$X(d[0],d[1],0);Bn(e,k$z.WebMercator,e,k$z.PlateCarree);const r=r$X(d[2],d[3],0);Bn(r,k$z.WebMercator,r,k$z.PlateCarree),p[0]=e[0],p[1]=e[1],p[2]=r[0],p[3]=r[1];}else for(let e=0;e<4;++e)p[e]=d[e]*l;this.centerAtSeaLevel[0]=.5*(p[0]+p[2]),this.centerAtSeaLevel[1]=.5*(p[1]+p[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(p[2]-p[0],p[3]-p[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter();}updateRadiusAndCenter(){this._updateCenter();const e=this.extentInRenderSR,t=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),i=Math.sqrt(t*t+r*r),s=.5*(this.elevationBounds[0]-this.elevationBounds[1]),a=Math.max(i,s);this._center[ce$5.MIDDLE][3]=a;}_isVisible(e){return j$R(e,this._aabb())}_aabb(){const e=this.extentInRenderSR;return v$Z(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,t,r,i){return g$e[0]=1/t[0],g$e[1]=1/t[1],g$e[2]=1/t[2],V$s(this._aabb(),e,g$e,r,i)}createGeometry(){V$5(this.renderData,this.horizontalScaleFactor),this.setMemoryDirty();}getDefaultVerticesPerRowOnLevel(){return this.level<9?3:2}updateCornerElevations(){B$8(this.renderData,this.horizontalScaleFactor);}updateEdgeElevations(){w$9(this.renderData,this.horizontalScaleFactor);}}const g$e=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var O$7;!function(O){O[O.BACK_TO_FRONT=-1]="BACK_TO_FRONT",O[O.NONE=0]="NONE",O[O.FRONT_TO_BACK=1]="FRONT_TO_BACK";}(O$7||(O$7={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class D$5 extends ae$4{constructor(t,e,i){super(),this.obb=new Array(8);for(let s=0;s<8;s++)this.obb[s]=n$16();void 0!==t&&this.init(t,e,i);}init(i,s,r){super.init(i,s,r);const n=this.ellipsoid.radius,h=this.extentInRadians[0],l=this.extentInRadians[1],d=this.extentInRadians[2],c=this.extentInRadians[3],u=i[0],p=s$1c(l,c,.5),m=s$1c(h,d,.5),_=0===u?0:Math.min(Math.abs(l),Math.abs(c));this._edgeLen=(d-h)*Math.cos(_)*n,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=n-Math.sqrt(n*n-this._edgeLen2/4),Re$1(this.centerAtSeaLevel,m,p,this.ellipsoid.radius);const f=e$1d(this.centerAtSeaLevel);z$s(f,f),this.up=f,this._updateOBB(),this.updateRadiusAndCenter();}updateRadiusAndCenter(){if(0===this.lij[0])o$W(this._center[E$8.MIDDLE],0,0,0),o$W(this._center[E$8.TOP],0,0,0),o$W(this._center[E$8.BOTTOM],0,0,0),this.ellipsoid||(this.ellipsoid=p$T(this.surface.spatialReference)),this._center[E$8.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else {this._updateCenter();const t=Math.max(p$$(this._center[E$8.MIDDLE],this.obb[0]),p$$(this._center[E$8.MIDDLE],this.obb[1]));this._center[E$8.MIDDLE][3]=Math.sqrt(t);}}_isVisible(t){if(!P$z(t,this._center[E$8.MIDDLE]))return !1;if(this.lij[0]<10)return !0;const e=this.obb;for(let i=0;i<g$14.NUM;i++){const s=i===k$C.NEAR,r=t[i];s&&(O$6[0]=r[0],O$6[1]=r[1],O$6[2]=r[2],O$6[3]=r[3]-this.surface.view.state.camera.near);const o=s?O$6:r;let a;for(a=0;a<8;a++){const t=e[a];if(o[0]*t[0]+o[1]*t[1]+o[2]*t[2]+o[3]<0)break}if(8===a)return !1}return !0}computeElevationBounds(){super.computeElevationBounds(),this._updateOBB();}createGeometry(){const t=this._getPatchType(this.lij[1],this.lij[0]);O$8(this.renderData,t),this.setMemoryDirty();}_updateOBB(){const t=this.extentInRadians,e=this.obb;for(let i=0;i<2;i++){const s=this.elevationBounds[i];let r=4*i;Re$1(e[r++],t[0],t[1],this.ellipsoid.radius+s),Re$1(e[r++],t[0],t[3],this.ellipsoid.radius+s),Re$1(e[r++],t[2],t[3],this.ellipsoid.radius+s),Re$1(e[r++],t[2],t[1],this.ellipsoid.radius+s);}if(this.surface.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case O$r.HAS_NORTH_POLE:o$W(e[1],0,0,this.ellipsoid.radius),o$W(e[2],0,0,this.ellipsoid.radius),o$W(e[5],0,0,this.ellipsoid.radius),o$W(e[6],0,0,this.ellipsoid.radius);break;case O$r.HAS_SOUTH_POLE:o$W(e[0],0,0,-this.ellipsoid.radius),o$W(e[3],0,0,-this.ellipsoid.radius),o$W(e[4],0,0,-this.ellipsoid.radius),o$W(e[7],0,0,-this.ellipsoid.radius);}}_getPatchType(t,e){return t===(1<<e)-1?0===t?O$r.HAS_BOTH_POLES:O$r.HAS_SOUTH_POLE:0===t?O$r.HAS_NORTH_POLE:O$r.REGULAR}intersectsRay(t,e,i,s){const r=this._center[E$8.MIDDLE],o=r[3]+i,a=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=r[0]-t[0],h=r[1]-t[1],l=r[2]-t[2],d=(n*e[0]+h*e[1]+l*e[2])/a,c=e[0]*d-n,u=e[1]*d-h,p=e[2]*d-l;return c*c+u*u+p*p<o*o}getDefaultVerticesPerRowOnLevel(){return this.level<L$5.length?L$5[this.level]+1:2}updateCornerElevations(){A$7(this.renderData);}updateEdgeElevations(){P$5(this.renderData);}}const L$5=[128,64,32,16,16,8,8,4],O$6=p$Y();var E$8;!function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM";}(E$8||(E$8={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class r$i{constructor(){this.extent=n$1a(),this.minLevel=0,this.maxLevel=0,this.callback=null;}}class u$e{constructor(){this._queries=new n$1l({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new n$1l({initialSize:30}),this._queryPool=new e$1f(r$i);}queryVisibleLevelRange(e,t,i,r){const u=this._queryPool.acquire();a$15(u.extent,e),u.minLevel=t||-Number.MAX_VALUE,u.maxLevel=null!=i?i:Number.MAX_VALUE,u.callback=r,this._queryQueue.push(u);}hasPendingQueries(){return 0!==this._queryQueue.length}prepareQueries(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e);}this._queriesInvPtr=this._queries.length;}processQueries(){for(let e=0;e<this._queries.length;e++){const t=this._queries.data[e];this._queryPool.release(t),t.callback(e>=this._queriesInvPtr),t.callback=null;}this._queries.clear();}scaleQueriesForTile(e){const t=e.level;let s=0;for(;s<this._queriesInvPtr;){const i=this._queries.data[s],r=i.extent;t>=i.minLevel&&t<=i.maxLevel&&r[0]<=e.extent[2]&&r[2]>=e.extent[0]&&r[1]<=e.extent[3]&&r[3]>=e.extent[1]?(this._queries.swapElements(s,this._queriesInvPtr-1),this._queriesInvPtr--):s++;}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$g extends t$X{constructor(){super(...arguments),this.blendMode=e$h.Normal;}}e$Y([e$12({count:e$h.COUNT})],s$g.prototype,"blendMode",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class f$9 extends i$g{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.blendMode=e$h.Normal,this.backgroundColor=f$_;}}class j$4 extends e$11{initializeProgram(e){const r=j$4.shader.get().build(this.configuration);return new o$Z(e.rctx,r,E$E)}initializePipeline(){return W$h({blending:s$1e(R$u.ONE,R$u.ONE_MINUS_SRC_ALPHA),colorWrite:c$10})}}j$4.shader=new t$W(u$g,(()=>import('./BlendLayers.glsl-89230b40.js')));class w$8 extends s$g{constructor(){super(...arguments),this.output=c$c.Composite,this.baseOpacityMode=g$f.One,this.premultipliedSource=!1;}}e$Y([e$12({count:c$c.COUNT})],w$8.prototype,"output",void 0),e$Y([e$12({count:g$f.COUNT})],w$8.prototype,"baseOpacityMode",void 0),e$Y([e$12()],w$8.prototype,"premultipliedSource",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class e$g{constructor(e,f,o,r,c,i){this.texture=e,this.type=f,e.retain(),this.offsetAndScale=r$Z(o.offset[0],o.offset[1],o.scale,o.scale),this.opacities=r$X(r,i,c);}destroy(){this.texture.release();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const r$h=.125;class s$f{constructor(){this._renderParams={context:null,drawPhase:1,state:new U$B({viewpoint:new u$1b({targetGeometry:new j$P(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1};}dispose(){this._renderParams=null;}render(e,t,i,s,a,l,n,o,p,d){const u=l.adjustLevel(t[0]),c=this._renderParams;c.context=e,c.painter=s,c.glyphMosaic=s.glyphMosaic,c.spriteMosaic=s.spriteMosaic,c.pixelRatio=d,c.displayLevel=u,c.requiredLevel=u;const m=l.getScale(t[0]),[g,y]=l.getShift(t,n*m),h=r$h*n*m/p,f=i.transforms.dvs;f[0]=h,f[4]=-h,f[6]=-1-g-o[0]*n*2,f[7]=1+y+(1-o[1])*n*2-2,c.state.size[0]=p,c.state.size[1]=p,i.stage||i.attachWithContext(e),i.triangleCount=0,s.drawTile(c,i,a);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class b$6 extends e$11{initializeProgram(e){const r=b$6.shader.get().build(this.configuration);return new o$Z(e.rctx,r,E$E)}initializePipeline(){return W$h({blending:s$1e(R$u.ONE,R$u.ONE_MINUS_SRC_ALPHA),colorWrite:c$10})}}b$6.shader=new t$W(k$6,(()=>import('./RasterColorizer.glsl-81e54a17.js')));class y$8 extends s$g{constructor(){super(...arguments),this.colorizerType=t$f.Stretch,this.stretchType=e$i.Noop,this.tileBlendInput=o$f.LayerOnly,this.baseOpacityMode=g$f.One,this.applyColormap=!0;}}e$Y([e$12({count:t$f.COUNT})],y$8.prototype,"colorizerType",void 0),e$Y([e$12({count:e$i.COUNT})],y$8.prototype,"stretchType",void 0),e$Y([e$12({count:o$f.COUNT})],y$8.prototype,"tileBlendInput",void 0),e$Y([e$12({count:g$f.COUNT})],y$8.prototype,"baseOpacityMode",void 0),e$Y([e$12()],y$8.prototype,"applyColormap",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class r$g{constructor(t){this._rctx=t,this._pools=new Map;}acquire(t){return this._getPool(t).acquire()}clear(){this._pools.forEach((t=>t.destroy())),this._pools.clear();}_getPool(s){let r=this._pools.get(s);if(!r){const l=i$e.bind(i$e,this._rctx,{colorTarget:Y$d.TEXTURE,depthStencilTarget:V$q.DEPTH_RENDER_BUFFER,width:s,height:s},(t=>this._getPool(t.width).release(t)));r=new e$1f(l,null,(()=>{})),this._pools.set(s,r);}return r}}class i$e extends D$p{constructor(t,e,o){super(t,e),this.release=()=>o(this);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const q$4=s$17.getLogger("esri.views.3d.terrain");class L$4{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._fboPools=[],this._doubleBufferFbo=[],this._vectorTileHelper=new s$f,this._bindParameters=new h$L(null,null,null),this._blendLayersTechniqueConfig=new w$8,this._poolToWrite=0,this._vaoQuad=u$V(this._rctx,A$B),this._fboPools.push(new r$g(this._rctx)),this._fboPools.push(new r$g(this._rctx));}dispose(){this._fboPools.forEach((e=>{e.clear(),e=null;})),this._fboPools=null,this._doubleBufferFbo.forEach((e=>s$1a(e))),this._vaoQuad=s$1a(this._vaoQuad),this._vectorTileHelper=s$1a(this._vectorTileHelper),this._backgroundTechnique=p$X(this._backgroundTechnique),this._applyOpacityTechnique=p$X(this._applyOpacityTechnique),this._blendLayersTechnique=p$X(this._blendLayersTechnique);}_getBlendLayersTechnique(e,r,t,i=!1){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=t?r===c$c.Composite?g$f.OnBaseLayer:g$f.OnBackground:g$f.One,this._blendLayersTechniqueConfig.premultipliedSource=i,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(j$4,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,r){const t=this._getBlendLayersTechnique(e$h.Normal,r,!1),i=this._rctx.bindTechnique(t,e,this._bindParameters);this._render(i);}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(E$F.TRIANGLE_STRIP,0,n$1d(this._vaoQuad,"geometry"));}drawRasterData(e,r,t=!1){if(t$V(r.texture))return;const o=r.baseOpacity<1;r.blendMode!==e$h.Normal||o||t?(r.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):r.fboTexture=null;const s=this._getBlendLayersTechnique(r.blendMode,e,o,t),n=this._rctx.bindTechnique(s,r,this._bindParameters);this._render(n);}drawImageryTileData(e,r,t){const i=e.sourceLayerInfo.data;if(!i.source)return;e.tile.surface.layerViewByIndex(e.layerIndex,A$8.MAP).ensureSymbolizerParameters(i);const o=t.baseOpacity<1;t.blendMode!==e$h.Normal||o?(t.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):t.fboTexture=null;const s=this._getRasterColorizerTechnique(i,r,t.blendMode,o),n=this._rctx.bindTechnique(s);if(!i.bind(this._rctx))return;i.opacity=t.opacity;const l=i.getUniforms();l.scale=e.scale,l.offset=e.offset,l.backgroundColor=t.backgroundColor,l.fboTexture=t.fboTexture,l.baseOpacity=t.baseOpacity,s.bindPass(l,null),this._render(n);}_getRasterColorizerTechnique(e,r,t,o){const s=e.symbolizerParameters,l=["stretch","lut","hillshade"].indexOf(s.type);return t$V(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new y$8,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.tileBlendInput=r===c$c.ColorComposite?o$f.ColorComposite:r===c$c.GridComposite?o$f.GridComposite:o$f.LayerOnly,this._rasterColorizerConfig.blendMode=t,this._rasterColorizerConfig.baseOpacityMode=o?r===c$c.Composite?g$f.OnBaseLayer:g$f.OnBackground:g$f.One,this._rasterColorizerConfig.colorizerType=l,this._rasterColorizerConfig.applyColormap=!!s.colormap,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?e$i.Noop:e$i.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(b$6,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,r,t,i,n,l,a){const h=this._rctx,u=r.sourceLayerInfo.data,_=r.tile.surface.layerViewByIndex(r.layerIndex,A$8.MAP),d=e.baseOpacity<1||e.opacity<1||e.blendMode!==e$h.Normal||a!==c$c.Composite;let f;this._getBlendLayersTechnique(e.blendMode,a,e.baseOpacity<1,d).bindPipelineState(h),d?(f=this._acquire(n),h.bindFramebuffer(f),h.setClearColor(0,0,0,0),h.clearSafe(_$z.COLOR_BUFFER_BIT|_$z.DEPTH_BUFFER_BIT)):l&&h.clearSafe(_$z.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(h,r.sourceLod,u,_.painter,_.layer.styleRepository,_.schemaHelper,Math.round(1/r.scale),r.offset,i,t);}catch(T){q$4.warnOnce("A render call containing vector tiles did not resolve correctly.",T);}return !r$W(f)||(h.bindFramebuffer(this._currentFBO),e.texture=f.colorTexture,e.offset=f$S,e.scale=1,this.drawRasterData(a,e,d),f.release(),l)}copyFBOToTexture(e){const r=this._rctx,t=r.bindTexture(e.texture,u$X.TEXTURE_UNIT_FOR_UPDATES),i=e.descriptor;r.gl.copyTexImage2D(M$v.TEXTURE_2D,0,i.pixelFormat,0,0,i.width,i.height,0),e.generateMipmap(),r.bindTexture(t,u$X.TEXTURE_UNIT_FOR_UPDATES);}_initFBO(e,r){this._rctx.bindFramebuffer(e),this._rctx.setViewport(0,0,r,r),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(_$z.COLOR_BUFFER_BIT|_$z.DEPTH_BUFFER_BIT);}_acquire(e){return this._fboPools[this._poolToWrite].acquire(e)}bindPool(e,r){this._poolToWrite=e,null==this._doubleBufferFbo[e]&&(this._doubleBufferFbo[e]=this._acquire(r),this._initFBO(this._doubleBufferFbo[e],r));}_switchPool(e){this._releaseCurrentFBO(),this._doubleBufferFbo[this._poolToWrite]=null,this._poolToWrite=0===this._poolToWrite?1:0,this.bindPool(this._poolToWrite,e);}get _currentFBO(){return this._doubleBufferFbo[this._poolToWrite]}_releaseCurrentFBO(){this._doubleBufferFbo[this._poolToWrite].release(),this._doubleBufferFbo[this._poolToWrite]=null;}releasePool(){this._rctx.bindFramebuffer(null),this._releaseCurrentFBO();}cleanupFBOPool(e,r){e===this._lastPixelRatio&&r===this._lastNumLayers||(this._fboPools.forEach((e=>e.clear())),this._lastPixelRatio=e,this._lastNumLayers=r);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class C$7{constructor(e,t,r){this._rctx=e,this.tileSize=t,this._techniqueRepository=r,this._passParameters=new f$9,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._numTexturedLayer=0,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new L$4(this._rctx,this._techniqueRepository),this._blackTex=new t$b(A$Q(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize);}dispose(){this._composition=s$1a(this._composition),this._backgroundTexture=p$X(this._backgroundTexture),this._blackTex=p$X(this._blackTex);}get backgroundIsGrid(){return t$V(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,t){if(!e.renderData)return;const r=e.surface,s=r.baseOpacity;this._numTexturedLayer=0;let o=0,a=this.tileSize,i=!1;const n=r.view.state.pixelRatio;let c=!1;const l=e.layerInfo[A$8.MAP];let p=l.length,T=0;for(;T<l.length;T++){const t=r.layerViewByIndex(T,A$8.MAP),f=t.fullOpacity;if(G$5[T]=f,i$1o(t.layer)&&p>=l.length&&(p=T),0===f){l[T].pendingUpdates&=~(E$a.TEXTURE_NOFADING&E$a.TEXTURE_FADING);continue}++o;const x=F$5(e,T);if(x){if(l[T].pendingUpdates&=~(E$a.TEXTURE_NOFADING&E$a.TEXTURE_FADING),U$9(t)){const e=R$7(t.layer.parent)?"normal":t.layer.blendMode;S$4[T]=e;const r="normal"!==e;r&&(c=r,i=!1);}_$a(t)?a=Math.max(a,this.tileSize*n):1===s&&1===f&&(t.isOpaque||this._dataToTexture(x)&&x.sourceLayerInfo.data.descriptor.isOpaque)&&(i=!0),++this._numTexturedLayer;}}this._composition.cleanupFBOPool(n,l.length),a=B$7(a);const f=a/this.tileSize,x=T-1;this._ensureBackgroundTexture(this.tileSize),0!==this._numTexturedLayer?1===this._numTexturedLayer&&!c&&this._useLayerTexture(e,x,p,G$5[x])||this._composeMapLayers(e,t,x,p,G$5,S$4,a,f,!i||c):this._useBackgroundTexture(e,o);}_ensureBackgroundTexture(e){t$V(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(e),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bindPool(0,e),this._passParameters.offset=f$S,this._passParameters.scale=1,this._passParameters.opacity=1,this._passParameters.blendMode=e$h.Normal,r$W(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,r$W(this.backgroundColor)?c$c.ColorOnly:c$c.GridOnly),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.releasePool(),this._backgroundDirty=!1);}_useBackgroundTexture(e,t){let r=s$j.Immediate;(e.surface.view.layerViewManager.updating||t>0)&&(r=s$j.Delayed),this._backgroundTexture&&t$V(e.renderData.textureReference)&&(r=s$j.Immediate),e.renderData.setTextureReference(r$W(this._backgroundTexture)?new e$g(this._backgroundTexture,A$l.FADING,z$2,e.surface.baseOpacity,1,0):null,r);}_useLayerTexture(e,t,r,s){const o=t<r,a=o?1:e.surface.baseOpacity,i=o?e.surface.baseOpacity:1,n=F$5(e,t);return !!this._dataToTexture(n)&&(e.renderData.setTextureReference(new e$g(n.sourceLayerInfo.data,A$l.FADING,n,a,s,i)),!0)}_composeMapLayers(e,t,r,s,o,a,i,n,u){this._composition.bindPool(0,i);const c=e.surface.baseOpacity;let l=!1,p=L$C.LINEAR_MIPMAP_LINEAR,d=!1,h=0;for(let _=r;_>=0;_--){const t=F$5(e,_);if(!t)continue;if(0===o[_])continue;const r=_<s&&c<1&&!l;this._passParameters.baseOpacity=r?c:1,r&&(l=!0);const m=0===h,x=u&&m?this.backgroundIsGrid?c$c.GridComposite:c$c.ColorComposite:c$c.Composite;h$i(t)?(this._passParameters.opacity=o[_],this._passParameters.blendMode=o$g[a[_]],d=this._composition.drawVectorData(this._passParameters,t,n,this.tileSize,i,d,x)):b$8(t)?(this._passParameters.opacity=o[_],this._passParameters.blendMode=o$g[a[_]],this._composition.drawImageryTileData(t,x,this._passParameters),this._hasNearestInterpolation(t)&&(p=L$C.NEAREST)):this._dataToTexture(t)&&(this._passParameters.texture=t.sourceLayerInfo.data.texture,this._passParameters.offset=t.offset,this._passParameters.scale=t.scale,this._passParameters.opacity=o[_],this._passParameters.blendMode=o$g[a[_]],this._composition.drawRasterData(x,this._passParameters)),h++;}const m=e.renderData.ensureTexture(i,(()=>this._buildTexture(i,p)));this._composition.copyFBOToTexture(m),this._composition.releasePool(),e.renderData.setTextureReference(new e$g(m,t,z$2,l?1:c,1,0));}_hasNearestInterpolation(e){const t=e.sourceLayerInfo.data;return !!t.source&&"nearest"===t.interpolation}_dataToTexture(e){return w$c(e)&&this._rasterDataToTexture(e),A$9(e)}_rasterDataToTexture(e){const t=e.sourceLayerInfo;t.data=this._buildTexture(t.data),e.tile.setMemoryDirty();}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0);}_buildTexture(e,t=L$C.LINEAR_MIPMAP_LINEAR){if(t$V(e))return null;const r={target:M$v.TEXTURE_2D,pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,wrapMode:D$q.CLAMP_TO_EDGE,samplingMode:t,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},o=this._rctx;let a;if("number"==typeof e)r.width=r.height=e,a=new t$b(new u$X(o,r));else if(e instanceof O$d)r.isOpaque=e.isOpaque,a=new t$b(new u$X(o,r,e.image)),e.release();else try{a=new t$b(new u$X(o,r,e));}catch(n){a=new t$b(w$F(o)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.");}const i=o.bindTexture(a.texture,u$X.TEXTURE_UNIT_FOR_UPDATES);return a.generateMipmap(),o.bindTexture(i,u$X.TEXTURE_UNIT_FOR_UPDATES),a}get test(){return {backgroundTexture:this._backgroundTexture}}}function B$7(t){const r=a$1f(t),s=r*r,o=t*t;if(s===o)return t;const a=r/2;return s-o<o-a*a?r:a}function F$5(e,t){q$3.layerIndex=t;const r=e.layerInfo[A$8.MAP][t];if(r$W(r.data))return r$Y(q$3.offset,0,0),q$3.tile=e,q$3.scale=1,q$3.sourceLod=e.lij,q$3.sourceLayerInfo=r,q$3;const s=r.upsampleInfo;if(r$W(s)){const e=s.tile.layerInfo[A$8.MAP][t];return q$3.tile=s.tile,a$16(q$3.offset,s.offset),q$3.scale=s.scale,q$3.sourceLod=s.tile.lij,q$3.sourceLayerInfo=e,q$3}return null}const G$5=new Array,S$4=new Array,q$3={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},z$2={offset:[0,0],scale:1};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const s$e=200,o$e=40,a$j=.8,c$b=10,h$9=1e-6;function f$8(t,e,i){const n=e,r=i;let s=0,o=1/0;for(let a=0;a<3;++a){{const e=t[a];if(n[a]<e){if(r[a]<=h$9)return !1;const t=(e-n[a])/r[a];s=Math.max(s,t);}else if(r[a]<=-h$9){const t=(e-n[a])/r[a];o=Math.min(o,t);}if(s>o)return !1}{const e=t[a+3];if(n[a]>e){if(r[a]>=-h$9)return !1;const t=(e-n[a])/r[a];s=Math.max(s,t);}else if(r[a]>=h$9){const t=(e-n[a])/r[a];o=Math.min(o,t);}if(s>o)return !1}}return !0}class l$9{constructor(t,e,i,n,r){this.aabb=t,this.axis=e,this.d=i,this.midStartIndex=n,this.rightStartIndex=r;}}class d$a{constructor(i,n,r,s){this.globalTriangleVertexIndices=i,this.firstTriangleIndex=n,this.positionAttribute=s,this.rayDirection=n$16(),this.bspNodeTree=new Array,this.vertexPositionBuffer=s.data,this.vertexPositionStride=s.stride;const h=r-n,f=h<=I$8?new Uint16Array(h):new Uint32Array(h);this.indices=f;for(let t=0;t<h;++t)f[t]=t;{const e=b$5(i,n,r,s.data,s.stride),d=o$X(Math.log2(h/o$e),2,c$b),u=(t,i,n)=>{const r=y$7(f,e,t,i),s=i-t;if(s<=o$e){const e=new l$9(r,void 0,0,t,i);return this.bspNodeTree.push(e),e}const{axis:c,midValue:h}=N$8(r),m=x$9(f,e,t,i,c,h),g=(t,e)=>{if(n>d)return;const i=e-t;return i<o$e||i>=a$j*s?void 0:u(t,e,n+1)},b=new l$9(r,c,h,m.next,m.mid);return this.bspNodeTree.push(b),b.leftNode=g(t,m.next),b.rightNode=g(m.mid,i),b};u(0,h,0),this.triangleVertexIndices=p$8(f,i,n,r);}}intersectRayTriangleRange(t,e){{if(t>=e)return;const i=this.triangleVertexIndices,n=this.positionAttribute.data,s=this.positionAttribute.stride,o=this.rayOrigin,a=o[0],c=o[1],h=o[2],f=this.rayDirection,l=f[0],d=f[1],m=f[2];for(let g=t,x=3*t;g<e;++g){const t=i[x]*s,e=n[t],o=n[t+1],f=n[t+2],y=i[x+1]*s,N=n[y],b=n[y+1],p=n[y+2],I=i[x+2]*s,T=n[I],M=n[I+1],R=n[I+2];x+=3;const S=N-e,A=b-o,w=p-f,V=T-e,v=M-o,B=R-f,P=d*B-v*m,U=m*V-B*l,j=l*v-V*d,D=S*P+A*U+w*j;if(Math.abs(D)<=Number.EPSILON)continue;const F=a-e,O=c-o,k=h-f,L=F*P+O*U+k*j;if(D>0){if(L<0||L>D)continue}else if(L>0||L<D)continue;const E=O*w-A*k,q=k*S-w*F,z=F*A-S*O,C=l*E+d*q+m*z;if(D>0){if(C<0||L+C>D)continue}else if(C>0||L+C<D)continue;const G=(V*E+v*q+B*z)/D;if(G>=0){const t=this.indices[g]+this.firstTriangleIndex,e=A$R(S,A,w,V,v,B,u$d);this.callback(G,e,t,!1);}}}d$a.numFacesTested+=e-t;}intersectRay(t,e){d$a.numFacesTested=0;const n=r$X(t.r0[0],t.r0[1],t.r0[2]),r=r$X(t.r1[0],t.r1[1],t.r1[2]),s=r[0]-n[0],o=r[1]-n[1],a=r[2]-n[2];if(s*s+o*o+a*a<h$9)return;this.rayOrigin=n;const c=this.rayDirection;c[0]=s,c[1]=o,c[2]=a;const f=this.triangleVertexIndices.length/3;this.callback=e;const l=this.bspNodeTree[0];this.intersectRayBSP(l,0,f);}intersectRayBSP(t,e,i){const n=this.rayOrigin,r=this.rayDirection;if(!f$8(t.aabb,n,r))return;const s=t.axis,o=t.d;if(n[s]<o||r[s]<0){const i=e,n=t.midStartIndex;if(i<n){const e=t.leftNode;void 0!==e?this.intersectRayBSP(e,i,n):this.intersectRayTriangleRange(i,n);}}if(this.intersectRayTriangleRange(t.midStartIndex,t.rightStartIndex),n[s]>o||r[s]>0){const e=t.rightStartIndex,n=i;if(e<n){const i=t.rightNode;void 0!==i?this.intersectRayBSP(i,e,n):this.intersectRayTriangleRange(e,n);}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}d$a.numFacesTested=0;const u$d=n$16(),m$d=[1/0,1/0,1/0],g$d=[-1/0,-1/0,-1/0];function x$9(t,e,i,n,r,s){let o=i,a=n;for(;o<a;){const i=t[o];e[6*i+r+3]<=s?++o:(--a,t[o]=t[a],t[a]=i);}let c=o;for(a=n;c<a;){const i=t[a-1];e[6*i+r]>=s?--a:(t[a-1]=t[c],t[c]=i,++c);}return {next:o,mid:c}}function y$7(t,e,i,r){if(r<=i)return u$19(NaN,NaN,NaN,NaN,NaN,NaN);{const n=6*t[i];for(let t=0;t<3;++t)m$d[t]=e[n+0+t],g$d[t]=e[n+3+t];}for(let n=i+1;n<r;++n){const i=6*t[n];for(let t=0;t<3;++t)m$d[t]=Math.min(m$d[t],e[i+0+t]),g$d[t]=Math.max(g$d[t],e[i+3+t]);}return u$19(m$d[0],m$d[1],m$d[2],g$d[0],g$d[1],g$d[2])}function N$8(t){const e=t[3]-t[0],i=t[4]-t[1],n=t[5]-t[2],r=e>i?e>n?0:i>n?1:2:i>n?1:n>e?2:0;return {axis:r,midValue:(t[r]+t[r+3])/2}}function b$5(t,e,i,n,r){const s=i-e,o=new Float32Array(6*s);for(let a=0;a<s;++a){const i=3*(a+e),s=t[i+0]*r,c=t[i+1]*r,h=t[i+2]*r;for(let t=0;t<3;++t){const e=n[s+t],i=n[c+t],r=n[h+t];o[6*a+t]=Math.min(e,i,r),o[6*a+3+t]=Math.max(e,i,r);}}return o}function p$8(t,e,i,n){const r=n-i;let s=0;for(let a=i;a<n;++a)for(let t=0;t<3;++t)s=Math.max(e[3*a+t],s);const o=s<=I$8?new Uint16Array(3*r):new Uint32Array(3*r);for(let a=0;a<r;++a){const n=3*(t[a]+i);for(let t=0;t<3;++t){const i=e[n+t];o[3*a+t]=i;}}return o}const I$8=65535;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class r$f extends f$17{constructor(){super(...arguments),this.slicePlaneLocalOrigin=n$16(),this.origin=this.slicePlaneLocalOrigin;}}class e$f extends c$1d{}var a$i,o$d;!function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight";}(a$i||(a$i={})),function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.Depth=2]="Depth",t[t.Normal=3]="Normal";}(o$d||(o$d={}));class l$8 extends r$f{constructor(){super(...arguments),this.identifier=a$i.Material,this.transparent=!1,this.integratedMesh=!1;}}class n$h extends r$f{constructor(){super(...arguments),this.identifier=a$i.ShadowMap;}}class h$8 extends r$f{constructor(){super(...arguments),this.identifier=a$i.Highlight;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class o$c extends i$Z{constructor(r,o){super(r,"vec4",a$$.Draw,((e,s,t)=>e.setUniform4fv(r,o(s,t))));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var p$7;!function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT";}(p$7||(p$7={}));class g$c extends t$Y{constructor(){super(...arguments),this.overlayOpacity=1;}}function h$7(e,o){e.vertex.uniforms.add([new o$P("overlayTexOffset"),new o$P("overlayTexScale")]),e.fragment.uniforms.add([new o$_("overlayOpacity",(e=>e.overlayOpacity)),new c$11("ovColorTex",((e,o)=>0===o.overlays.length?null:o.overlays[T$p.INNER].getColorTexture(e.overlaySource)))]),M$4(e,o);}function C$6(e,o){const{vertex:r,fragment:t}=e;r.uniforms.add([new o$c("overlayTexOffset",((e,o)=>b$4(e,o))),new o$c("overlayTexScale",((e,o)=>T$8(e,o)))]),t.constants.add("overlayOpacity","float",1),t.uniforms.add(new c$11("ovColorTex",((e,o)=>O$5(e,o)))),M$4(e,o);}function M$4(e,o){e.extensions.add("GL_OES_standard_derivatives"),o.pbrMode!==l$Q.Water&&o.pbrMode!==l$Q.WaterOnIntegratedMesh||e.include(n$F,o);const{vertex:r,fragment:t}=e;e.varyings.add("vtcOverlay","vec4"),r.code.add(n$19`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),t.code.add(n$19`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),t.code.add(n$19`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),o.pbrMode!==l$Q.Water&&o.pbrMode!==l$Q.WaterOnIntegratedMesh||(t.uniforms.add([new e$_("lightingMainDirection",((e,o)=>o.lighting.lightingMainDirection)),new e$_("lightingMainIntensity",((e,o)=>o.lighting.mainLight.intensity))]),t.code.add(n$19`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`));}function O$5(e,o){return 0===o.overlays.length?null:e.identifier===a$i.Material&&e.subPass===o$d.Color?o.overlays[T$p.INNER].getColorTextureNoRasterImage():e.identifier===a$i.Highlight?o.overlays[T$p.INNER].getValidTexture(H$e.Highlight):null}function b$4(e,a){for(const n of a.overlays){const{index:a,extent:i}=n;y$J(i)>0&&(w$7[2*a]=e.toMapSpace[0]/s$1k(i)-i[0]/s$1k(i),w$7[2*a+1]=e.toMapSpace[1]/l$Y(i)-i[1]/l$Y(i));}return w$7}function T$8(e,a){for(const n of a.overlays){const{index:a,extent:i}=n;y$J(i)>0&&(w$7[2*a]=e.toMapSpace[2]/s$1k(i),w$7[2*a+1]=e.toMapSpace[3]/l$Y(i));}return w$7}const w$7=n$1a();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function e$e(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),t.spherical?e.vertex.code.add(n$19`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(n$19`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(n$19`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function i$d(i,d){i.varyings.add("vtc","vec2"),i.vertex.uniforms.add(new o$P("texOffsetAndScale")),i.fragment.uniforms.add(new s$10("tex")),i.fragment.uniforms.add(new o$Q("textureOpacities"));const s=d.textureFadingEnabled&&!d.renderOccluded;s&&(i.vertex.uniforms.add(new o$P("nextTexOffsetAndScale")),i.varyings.add("nvtc","vec2"),i.fragment.uniforms.add(new s$10("texNext")),i.fragment.uniforms.add(new o$Q("nextTexOpacities")),i.fragment.uniforms.add(new r$R("fadeFactor")));const l=d.tileBlendInput===o$f.ColorComposite,f=d.tileBlendInput===o$f.GridComposite;f&&i.fragment.include(t$c),l&&i.fragment.uniforms.add(new o$Q("backgroundColor")),i.vertex.code.add(n$19`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${s?n$19`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:n$19``}
  }`),i.fragment.code.add(n$19`
    vec4 applyBaseOpacity(vec4 _color, vec3 _opacities) {
      return _opacities.z <= 0.0 ? _color : _color * _opacities.x;
    }

    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${f||l?n$19`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = ${l?n$19`vec4(backgroundColor, 1.0)`:n$19`gridColor(uv)`} * opacities.y;
              float alpha = opacities.z * color.a;
              return mix(bg, color, alpha) * opacities.x;`:n$19`return color;`}
    }`),s?i.fragment.code.add(n$19`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.fragment.code.add(n$19`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class N$7 extends g$c{}function $$2(r){const n=new i$_;n.include(r$1i,{name:"Terrain Shader",output:r.output}),n.attributes.add(O$J.POSITION,"vec3"),n.attributes.add(O$J.UV0,"vec2"),n.attributes.add(O$J.NORMAL,"vec3");const{vertex:f,fragment:N}=n;if(f.uniforms.add([new e$Z("proj",((e,r)=>r.camera.projectionMatrix)),new o$1u("view",((r,o)=>c$17(U$6,o.camera.viewMatrix,r.origin))),new o$1v("origin",(e=>e.origin))]),N.uniforms.add(new o$1v("origin",(e=>e.origin))),r.output===o$19.Color){n.include(r$10),n.include(r$A,r),n.include(i$d,r),n.include(m$X,r);const t=r.overlayMode!==p$7.Disabled,c=r.overlayMode===p$7.EnabledWithWater;t&&n.include(h$7,{...r,pbrMode:l$Q.Water}),c&&n.include(e$e,r),n.varyings.add("vnormal","vec3"),n.varyings.add("vpos","vec3"),(r.atmosphere||r.screenSizePerspective)&&f.uniforms.add(new e$Z("viewNormal",((e,r)=>r.camera.viewInverseTransposeMatrix)));const g=r.receiveShadows&&!r.renderOccluded;g&&n.varyings.add("linearDepth","float"),r.tileBorders&&n.varyings.add("vuv","vec2"),r.atmosphere&&(f.uniforms.add(new e$_("lightingMainDirection",((e,r)=>r.lighting.lightingMainDirection))),n.varyings.add("wnormal","vec3"),n.varyings.add("wlight","vec3")),r.screenSizePerspective&&(n.varyings.add("screenSizeDistanceToCamera","float"),n.varyings.add("screenSizeCosAngle","float")),f.code.add(n$19`
      void main(void) {
        vpos = position;
        vnormal = ${r.shading?n$19`normal`:n$19`getLocalUp(vpos, origin)`};
        vec2 uv = uv0;
        ${r.atmosphere?n$19`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${r.tileBorders?n$19`vuv = uv;`:""}
        ${r.screenSizePerspective?n$19`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${g?n$19`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${t?n$19`setOverlayVTC(uv);`:""}
        ${c?n$19`forwardVertexTangent(vnormal);`:n$19``}
      }
    `),n.extensions.add("GL_OES_standard_derivatives"),n.extensions.add("GL_EXT_shader_texture_lod"),n.include(u$$,r),n.include(m$X,r),n.include(a$1h,r),n.include(c$1e,r),N.uniforms.add([new o$1v("cameraPosition",((e,r)=>e$15(W$4,r.camera.eye,e.origin))),new e$_("viewDirection",((e,r)=>z$s(W$4,o$W(W$4,r.camera.viewMatrix[12],r.camera.viewMatrix[13],r.camera.viewMatrix[14])))),new o$_("lightingGlobalFactor",((e,r)=>r.lighting.globalFactor)),new e$_("lightingMainDirection",((e,r)=>r.lighting.lightingMainDirection)),new e$_("lightingMainIntensity",((e,r)=>r.lighting.mainLight.intensity))]),N.constants.add("ambientBoostFactor","float",c$1l),c&&N.uniforms.add([new c$11("ovWaterTex",((e,r)=>0===r.overlays.length?null:r.overlays[T$p.INNER].getNormalTexture(e.overlaySource))),new o$1u("view",((r,o)=>c$17(U$6,o.camera.viewMatrix,r.origin)))]),N.code.add(n$19`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),N.code.add(n$19`
      void main() {
        ${g?n$19`float shadow = readShadowMap(vpos, linearDepth);`:n$19`float shadow = 0.0;`}
        vec3 normal = normalize(vnormal);
        float vndl = dot(normal, lightingMainDirection);
        float ssao = evaluateAmbientOcclusionInverse();
        vec4 tileColor = getTileColor();
        ${t?n$19`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${r.atmosphere?n$19`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${r.atmosphere?n$19`atm + tileColor.rgb;`:n$19`tileColor.rgb;`}

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl${r.shading?"":n$19`*2.5`}, 0.0, 1.0));

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor ${r.shading?"":n$19`* lightingGlobalFactor`};

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${c?n$19`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + origin);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${r.screenSizePerspective?n$19`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${r.tileBorders?n$19`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `);}return r.output!==o$19.Depth&&r.output!==o$19.Shadow||(n.include(r$10,{hasModelTransformation:!1,linearDepth:!0}),n.include(e$1h,{output:r.output}),n.include(r$A,r),n.varyings.add("linearDepth","float"),f.uniforms.add(new e$$("nearFar",((e,r)=>r.camera.nearFar))),f.code.add(n$19`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),N.code.add(n$19`void main() {
outputDepth(linearDepth);
}`)),r.output===o$19.Normal&&(n.include(r$10),n.include(r$A,r),n.varyings.add("vnormal","vec3"),n.varyings.add("vpos","vec3"),f.uniforms.add(new e$Z("viewNormal",((e,r)=>r.camera.viewInverseTransposeMatrix))),f.code.add(n$19`
        void main(void) {
          vec3 normal = ${r.shading?n$19`normal`:n$19`getLocalUp(position, origin)`};
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
          vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
        }
    `),N.code.add(n$19`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`)),r.output===o$19.Highlight&&(n.include(r$10),n.include(r$A,r),n.include(h$7,r),f.code.add(n$19`void main() {
setOverlayVTC(uv0);
gl_Position = transformPosition(proj, view, position);
}`),n.include(a$19),N.code.add(n$19`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`)),n}const U$6=e$10(),W$4=n$16(),A$6=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:N$7,build:$$2},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class g$b extends e$11{constructor(){super(...arguments),this.useStencil=!1;}initializeConfiguration(i,r){r.spherical=i.viewingMode===l$O.Global;}initializeProgram(e){const i=g$b.shader.get().build(this.configuration);return new o$Z(e.rctx,i,E$E)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return W$h({blending:i.renderOccluded?s$1e(R$u.ONE,R$u.ONE_MINUS_SRC_ALPHA):null,culling:r&&r$11,depthTest:!i.renderOccluded&&{func:I$y.LESS},depthWrite:!i.renderOccluded&&a$1a,colorWrite:c$10,stencilTest:e?t$1o(a$1l.IntegratedMeshMaskExcluded):null})}getPipelineState(e,i){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,i)}}g$b.shader=new t$W(A$6,(()=>import('./Terrain.glsl-4144810f.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class n$g extends i$17{constructor(){super(...arguments),this.output=o$19.Color,this.overlayMode=p$7.Disabled,this.tileBlendInput=o$f.LayerOnly,this.spherical=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.tileBorders=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.shading=a$12("enable-feature:terrain-shading");}}e$Y([e$12({count:o$19.COUNT})],n$g.prototype,"output",void 0),e$Y([e$12({count:p$7.COUNT})],n$g.prototype,"overlayMode",void 0),e$Y([e$12({count:o$f.COUNT})],n$g.prototype,"tileBlendInput",void 0),e$Y([e$12()],n$g.prototype,"spherical",void 0),e$Y([e$12()],n$g.prototype,"atmosphere",void 0),e$Y([e$12()],n$g.prototype,"receiveShadows",void 0),e$Y([e$12()],n$g.prototype,"hasSlicePlane",void 0),e$Y([e$12()],n$g.prototype,"backfaceCullingEnabled",void 0),e$Y([e$12()],n$g.prototype,"stencilEnabled",void 0),e$Y([e$12()],n$g.prototype,"textureFadingEnabled",void 0),e$Y([e$12()],n$g.prototype,"renderOccluded",void 0),e$Y([e$12()],n$g.prototype,"hasScreenSpaceReflections",void 0),e$Y([e$12()],n$g.prototype,"hasCloudsReflections",void 0),e$Y([e$12()],n$g.prototype,"tileBorders",void 0),e$Y([e$12()],n$g.prototype,"screenSizePerspective",void 0),e$Y([e$12()],n$g.prototype,"receiveAmbientOcclusion",void 0),e$Y([e$12()],n$g.prototype,"shading",void 0),e$Y([e$12({constValue:!0})],n$g.prototype,"isGround",void 0),e$Y([e$12({constValue:l$Q.Disabled})],n$g.prototype,"pbrMode",void 0),e$Y([e$12({constValue:!1})],n$g.prototype,"highStepCount",void 0),e$Y([e$12({constValue:!1})],n$g.prototype,"useCustomDTRExponentForWater",void 0),e$Y([e$12({constValue:!1})],n$g.prototype,"useFillLights",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const ae$2=7,oe$3=10,le$2=a$1d(),de$2=n$1a();let he$1=class extends y$F{constructor(e){super(e),this.type=i$1e.TERRAIN,this.isGround=!0,this.tileSize=256,this._techniqueConfiguration=new n$g,this._passParameters=new N$7,this.rctx=null,this._isTransparent=!1,this._scaleRangeQueries=new u$e,this.renderDataPool=new e$1f(T$a),this._patchGroups=new Map,this.patchGroupsDirty=!0,this.tileIterator=new r$k,this.highestVisibleLODTile=null,this.visible=!0,this._opaque=!0,this._velvetOverground=!0,this._castShadows=!0,this.emptyTex=null,this.tileRenderer=null,this.stencilEnabledLayerExtents=[],this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=h$Z.Occlude;}get isGlobal(){return this.stage.viewingMode===l$O.Global}get shadingEnabled(){return this._techniqueConfiguration?.shading}initialize(){const e=[E$G.OPAQUE_TERRAIN,E$G.TRANSPARENT_TERRAIN,E$G.OCCLUDED_TERRAIN];this.stage.addRenderPlugin(e,this);}destroy(){this.stage.removeRenderPlugin(this),c$e();}get canRender(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setNeedsRender();}set opaque(e){this._opaque!==e&&(this._opaque=e,this.setNeedsRender());}get opaque(){return this._opaque&&!this._techniqueConfiguration.hasSlicePlane}get needsLinearDepth(){return this.overlayRenderer.hasWater}set isTransparent(e){this._isTransparent!==e&&(this._isTransparent=e,this.setNeedsRender());}get isTransparent(){return this._isTransparent}get renderPatchBorders(){return !!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"));}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender());}set renderOrder(e){this._set("renderOrder",e),this.setNeedsRender();}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender());}get layerUid(){return j$H}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender());}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender());}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender());}toggleShading(){this._techniqueConfiguration.shading=!this._techniqueConfiguration.shading,this.setNeedsRender();}setRootTiles(e){this._rootTiles=e,this.setNeedsRender();}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender();}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?ge$7:h$Z.Occlude,this.setNeedsRender();}setStencilEnabledLayerExtents(e){this.stencilEnabledLayerExtents=e,this.setNeedsRender();}setTileSize(e){this.tileSize=e,r$W(this.tileRenderer)&&(this.tileRenderer.tileSize=e),this.setNeedsRender();}_prepareTileForLoading(e){e.renderData||(e.renderData=this.renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e));}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometry(e),this.updateTileTexture(e,E$a.TEXTURE_FADING);}queryVisibleLevelRange(e,t,i,r){this._scaleRangeQueries.queryVisibleLevelRange(e,t,i,r),this.setNeedsRender();}updateTileTexture(e,t){r$W(this.tileRenderer)&&(this.tileRenderer.updateTileTexture(e,t===E$a.TEXTURE_FADING?A$l.FADING:A$l.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t));}updateTileGeometryState(e){this._prepareTileForLoading(e),e.renderData.updateGeometryStateAndPrepareForGeometryGeneration(this.wireframe);}updateTileGeometry(e){for(const t of e.layerInfo[A$8.ELEVATION])t.pendingUpdates&=~E$a.GEOMETRY;e.resetPendingUpdate(E$a.GEOMETRY);e.renderData.updateGeometryIfChanged(this.rctx,this.wireframe)&&this.setNeedsRender();}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this.renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setNeedsRender());}_getLocalOriginOfTile(e){const t=oe$3-ae$2,i=Math.max(0,Math.floor((e.level-t)/ae$2)*ae$2);if(this.isGlobal&&0===i)return f$_;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this.visible=e,this.setNeedsRender();}getStats(){return {numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numOriginsRendered:this.numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.allTiles.forAll((e=>{e.isLoaded&&(this.updateTileGeometry(e),e.updateNeighborsAfterGeometryChange());})),this.setNeedsRender());}setNeedsRender(e=t$1n.UPDATE){this.patchGroupsDirty=!0,this._context.requestRender(e);}initializeRenderContext(e){this._context=e,this.rctx=e.renderContext.rctx,this._techniqueRepository=e.shaderTechniqueRepository,this.tileRenderer=new C$7(this.rctx,this.tileSize,this._techniqueRepository),this.updateTileBackground(),this.emptyTex=w$F(this.rctx);}uninitializeRenderContext(){this.emptyTex=s$1a(this.emptyTex),this.tileRenderer=s$1a(this.tileRenderer);}intersect(e,t,i,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&!this._opaque)return;const a=pe$2,o=fe$1;e$15(a,s,i),o$W(o,1/a[0],1/a[1],1/a[2]);const l=e.results.min,p=e.results.max,f=e.results.ground,g=e.options.store===t$1g.MIN,m=!!e.results.ground.target,_=L$K(e.verticalOffset),T=e.tolerance;let y,A=g&&r$W(l.dist)?l.dist:1/0;const O=c=>{const m=c.renderData;if(!m?.vao)return;const O=m.geometryInfo;A$H(le$2,O.boundingBox);const v=m.localOrigin;r$W(_)&&(_.localOrigin=v,_.applyToAabb(le$2));const x=le$2;if(ge$2[0]=i[0]-v[0],ge$2[1]=i[1]-v[1],ge$2[2]=i[2]-v[2],!V$s(x,ge$2,o,T,A))return;const P=(e,t,i)=>{e.set(this.type,c,t,i,o$1g),A=g&&r$W(l.dist)?l.dist:1/0;},C=(o,d)=>{if(r$W(d)&&o>=0&&(e.options.backfacesTerrain||P$u(d,a)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||null==t||t(i,s,o))){if((null==f.dist||o<f.dist)&&P(f,o,d),e.options.isFiltered)return;e.options.store===t$1g.ALL&&(t$V(y)?(y=U$v(e.ray),P(y,o,d),e.results.all.push(y)):o<y.dist&&P(y,o,d)),(null==l.dist||o<l.dist)&&P(l,o,d),e.options.store!==t$1g.MIN&&(null==p.dist||o>p.dist)&&P(p,o,d);}},E=me$2;e$15(E,s,v);const D=O.indices,q=O.vertexAttributes,S={data:q.getField(O$J.POSITION,i$1h).typedBuffer,size:3,stride:q.stride/4},N=O.indexCount/3;if(t$V(_)&&N>s$e){const e=c.renderData;t$V(e.intersectionData)&&(e.intersectionData=new d$a(D,0,N,S)),e.intersectionData.intersectRay({r0:ge$2,r1:E},C);}else v$W(ge$2,E,0,N,D,S,null,_,C);},v=this._rootTiles;if(r$W(v)){(()=>{const t=this.tileIterator;t.reset(v);const s=e.options.invisibleTerrain;for(;!t.done;){const e=t.next();!(e.visible||s&&e.intersectsClippingArea)||!r$W(_)&&!e.intersectsRay(i,a,T,A)||m&&this._useStencilForTile(e)?t.skipSubtree():O(e);}})();}}prepareTechnique(e){if(e.bindParameters.slot===E$G.OCCLUDED_TERRAIN){if(0==(e.renderOccludedMask&ge$7))return null}else {const t=this.opaque?E$G.OPAQUE_TERRAIN:E$G.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==t)return null}switch(e.pass){case A$D.MATERIAL:{this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=r$W(e.bindParameters.clouds.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.ready,this._techniqueConfiguration.overlayMode=this.overlayRenderer.isEmpty()?p$7.Disabled:this.overlayRenderer.hasWater?p$7.EnabledWithWater:p$7.Enabled;const t=e.bindParameters.slot===E$G.OCCLUDED_TERRAIN?h$t.Occluded:h$t.ColorAndWater;return this._updateTechnique(o$19.Color,t===h$t.Occluded)}case A$D.MATERIAL_DEPTH_SHADOWMAP_ALL:case A$D.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._castShadows&&1===e.bindParameters.lighting.globalFactor?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(o$19.Shadow,!1)):null;case A$D.MATERIAL_DEPTH:return this.isTransparent&&this.overlayRenderer.isEmpty()?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(o$19.Depth,!1));case A$D.MATERIAL_NORMAL:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(o$19.Normal,!1);case A$D.MATERIAL_HIGHLIGHT:return this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(o$19.Highlight,!1)):null}return null}render(e,t){const i=e.pass,r=1===e.bindParameters.lighting.globalFactor;switch(this._updatePatchGroups(),t.useStencil=!1,i){case A$D.MATERIAL:{const i=e.bindParameters.slot===E$G.OCCLUDED_TERRAIN?h$t.Occluded:h$t.ColorAndWater;this._renderMaterialPass(e,t,i);break}case A$D.MATERIAL_DEPTH_SHADOWMAP_ALL:case A$D.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:this._castShadows&&r&&this._renderAuxiliaryPass(e,t,h$t.None);break;case A$D.MATERIAL_DEPTH:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(e,t,h$t.None);break;case A$D.MATERIAL_NORMAL:this._renderAuxiliaryPass(e,t,h$t.None);break;case A$D.MATERIAL_HIGHLIGHT:this.needsHighlight&&(this._renderAuxiliaryPass(e,t,h$t.Highlight),e.rctx.clearSafe(_$z.DEPTH_BUFFER_BIT));}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender();}_renderMaterialPass(e,t,i){const{rctx:r}=e;this._passParameters.overlaySource=i,r.bindTechnique(t,this._passParameters,e.bindParameters),this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this._scaleRangeQueries.prepareQueries(),this.opaque?this._renderPatchGroups(e,t,i):e.offscreenRenderingHelper.renderToTargets((()=>this._renderPatchGroups(e,t,i)),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._scaleRangeQueries.processQueries();}_renderAuxiliaryPass(e,t,i){const r=e.rctx;this._passParameters.overlaySource=i,r.bindTechnique(t,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,t,i);}updateTileBackground(e=null){if(t$V(this.tileRenderer))return;const i=this.tileRenderer;let s=null;if(r$W(e)){const i=l$T.toUnitRGBA(e);s=r$X(i[0]||0,i[1]||0,i[2]||0);}i.setBackground(s),this.allTiles.forAll((e=>i.updateTileTexture(e,A$l.FADING))),this._techniqueConfiguration.tileBlendInput=i.backgroundIsGrid?o$f.GridComposite:r$W(i.backgroundColor)?o$f.ColorComposite:o$f.LayerOnly,this.setNeedsRender();}_updatePatchGroups(){if(this.patchGroupsDirty){if(this.highestVisibleLODTile=null,this._rebuildPatchGroups(),this.renderOrder!==O$7.NONE){const e=Array.from(this._patchGroups.values());e.forEach((e=>a$k(this.renderOrder,e))),e.sort(((e,t)=>h$c(e[0],t[0],this.renderOrder))),this._patchGroups=new Map(e.map((e=>[e[0].renderData.localOrigin,e])));}this.patchGroupsDirty=!1;}}_rebuildPatchGroups(){const e=this._rootTiles;if(!t$V(e)){e[0]?.surface.checkAllTileWaterproofness(),this._patchGroups.clear();for(const t of e)this._rebuildPatchGroupsForRootTile(t);}}_rebuildPatchGroupsForRootTile(e){const t=this.tileIterator;for(t.resetOne(e);!t.done;){const e=t.next(),i=e.renderData;if(!i||e.visible)if(e.rendered){if(i){const r=this._patchGroups.get(i.localOrigin)||new Array;this._patchGroups.set(i.localOrigin,r),r.push(e),(!this.highestVisibleLODTile||e.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=e),t.skipSubtree();}}else this.numTilesCulled++;else this.numTilesCulled++,t.skipSubtree();}}_useStencilForTile(e){for(const t of this.stencilEnabledLayerExtents)if(e.intersectsExtent(t))return !0;return !1}_renderPatchGroupsAuxiliary(e,t,i){const r=this.stencilEnabledLayerExtents.length>0;this._patchGroups.forEach((s=>{const n=s[0].renderData.localOrigin;t.program.bindDraw(new i$y(n),e.bindParameters);for(let a=0;a<s.length;a++)this._renderPatch(e,t,s[a],E$F.TRIANGLES,r,i);})),e.rctx.bindVAO(null);}_renderPatchGroups(e,t,i){const s=e.rctx,a=e.bindParameters.camera,o=t.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const e=r$1h(this.stage.viewingMode,this.ellipsoidRadius),t=this.pointsOfInterest.centerOnSurfaceFrequent.distance;e.update({distance:t,fovY:a.fovY});}const l=this.stencilEnabledLayerExtents.length>0,d=i===h$t.Occluded;d&&(o.bindTexture("tex",this.emptyTex),o.setUniform1f("blend",1),o.setUniform4fv("texOffsetAndScale",l$W));const h=r$W(this.tileRenderer)&&r$W(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:f$_;this._techniqueConfiguration.tileBlendInput===o$f.ColorComposite&&o.setUniform3fv("backgroundColor",h);const c=this.wireframe?E$F.LINES:E$F.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&o.bindTexture("texNext",this.emptyTex),this._patchGroups.forEach((s=>{const a=s[0].renderData.localOrigin;t.program.bindDraw(new i$y(a),e.bindParameters),this.numOriginsRendered++;for(let h=0;h<s.length;h++){const a=s[h],u=a.renderData.textureReference;if(!t$V(u)){if(!d){this._scaleRangeQueries.scaleQueriesForTile(a),ue$2(a.renderData.geometryInfo.uvOffsetAndScale,u.offsetAndScale,de$2),o.setUniform4fv("texOffsetAndScale",de$2),o.bindTexture("tex",u.texture.texture);const e=a.renderData.textureFadeFactor,t=e<1?a.renderData.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&r$W(t)&&e<1?(ue$2(a.renderData.geometryInfo.uvOffsetAndScale,t.offsetAndScale,de$2),o.setUniform1f("fadeFactor",e),o.setUniform4fv("nextTexOffsetAndScale",de$2),o.setUniform3fv("nextTexOpacities",t.opacities),o.bindTexture("texNext",t.texture.texture)):o.setUniform1f("fadeFactor",1),a.renderData.textureIsFading&&this.setNeedsRender(),o.setUniform3fv("textureOpacities",u.opacities);}this._renderPatch(e,t,a,c,l,i),a.renderOrder=this.numTilesRendered,this.numTilesRendered++;}}})),s.bindVAO(null);}_renderPatch(e,t,i,r,s,a){const o=i.renderData,l=o.vao,d=l.indexBuffer;if(t$V(d))return;const h=t.program;a!==h$t.None&&this._bindOverlayPatchData(h,o.overlay),s&&(t.useStencil=this._useStencilForTile(i),t.bindPipelineState(e.rctx,e.bindParameters.slot));const c=o.geometryInfo.indexCount;e.rctx.bindVAO(l),h.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(r,c,d.indexType,0);}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales);}_updateTechnique(e,t){return this._techniqueConfiguration.output=e,e===o$19.Color&&(this._techniqueConfiguration.atmosphere=this.isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=t,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(g$b,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return {tileRenderer:this.tileRenderer}}};e$Y([d$R({constructOnly:!0})],he$1.prototype,"overlayRenderer",void 0),e$Y([d$R({constructOnly:!0})],he$1.prototype,"stage",void 0),e$Y([d$R({readOnly:!0})],he$1.prototype,"isGlobal",null),e$Y([d$R({constructOnly:!0})],he$1.prototype,"allTiles",void 0),e$Y([d$R({constructOnly:!0})],he$1.prototype,"ellipsoidRadius",void 0),e$Y([d$R({value:!1})],he$1.prototype,"renderingDisabled",null),e$Y([d$R()],he$1.prototype,"renderPatchBorders",null),e$Y([d$R()],he$1.prototype,"cullBackFaces",null),e$Y([d$R({value:O$7.FRONT_TO_BACK})],he$1.prototype,"renderOrder",null),e$Y([d$R()],he$1.prototype,"wireframe",null),he$1=e$Y([n$18("esri.views.3d.terrain.TerrainRenderer")],he$1);const ce$3=he$1;function ue$2(e,t,i){i[0]=e[0]*t[2]+t[0],i[1]=e[1]*t[3]+t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3];}const pe$2=n$16(),fe$1=n$16(),ge$2=n$16(),me$2=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class e$d{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let g$a=class extends y$F{constructor(e){super(e),this._handles=new u$U;}initialize(){this._handles.add(this.layers.on("change",(()=>this._update()))),this._handles.add(l$M((()=>this.extentHelper.layerViewsExtent),(()=>this._setAdHocTilingScheme()))),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme();}destroy(){this._handles=l$N(this._handles),this._waitTask=null;}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some((t=>!(!t$1m(t)||t.isRejected())&&(!(t.isFulfilled()&&!f$7(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!("vector-tile"===t?.type||H$5(t)))))),e)if(e.isResolved()){const t=C$a(e,this.viewSpatialReference,this.viewingMode);if(r$W(t)){const e=new M$s(t.tileInfo);this._lockTilingScheme(e);}}else this._updateWhen(e);}_updateWhen(e){const t=e.when().catch((()=>{})).then((()=>{t!==this._waitTask||this.destroyed||this._update();}));this._waitTask=t;}_lockTilingScheme(e){if(this.viewingMode===l$O.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=M$s.makeWebMercatorAuxiliarySphere(t):Ce$1(e.spatialReference)&&(e=M$s.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t));}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(l$M((()=>this.extentHelper.tiledLayersExtent),(()=>this._updateTiledLayerExtent())));}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent);}_setAdHocTilingScheme(){if(this.viewingMode===l$O.Global){const e=this.extentHelper.viewSpatialReference,t=Ce$1(e)||P$v(e)||s$15(e);e.isWebMercator?this.tilingScheme=M$s.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=M$s.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent);}else {const e=this.extentHelper.layerViewsExtent;r$W(e)&&!I$B(e,this.extent)&&(this.tilingScheme=M$s.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e));}}get test(){return {lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function f$7(e,t,i){return r$W(C$a(e,t,i))}e$Y([d$R()],g$a.prototype,"tilingScheme",void 0),e$Y([d$R({readOnly:!0})],g$a.prototype,"extent",void 0),e$Y([d$R({value:!1})],g$a.prototype,"tilingSchemeLocked",void 0),e$Y([d$R({constructOnly:!0})],g$a.prototype,"viewSpatialReference",void 0),e$Y([d$R({constructOnly:!0})],g$a.prototype,"layers",void 0),e$Y([d$R({constructOnly:!0})],g$a.prototype,"extentHelper",void 0),e$Y([d$R({constructOnly:!0})],g$a.prototype,"viewingMode",void 0),g$a=e$Y([n$18("esri.views.3d.terrain.TilingSchemeLogic")],g$a);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class t$a{constructor(){this.offset=n$1b(),this.scale=0,this.tile=null;}init(s,t,i,e){this.tile=s,this.offset[0]=t,this.offset[1]=i,this.scale=e;}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const Xe$1=s$17.getLogger("esri.views.3d.terrain.TerrainSurface"),ze$1=.25;let Ye$1=class extends(n$17.EventedMixin(y$F)){constructor(e){super(e),this._elevationBounds=new s$l,this._iteratorPool=new e$1f(r$k,(e=>e.remove=()=>this._iteratorPool.release(e))),this._postorderIterator=new i$i,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visible=!1,this._usedMemory=null,this._performanceInfo=new e$d,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=n$16(),this._eyePosSurfaceSR=n$16(),this._splitLimits=new re$1,this._snapLevel=1/0,this._frustum=H$o(),this._viewProjectionMatrix=e$10(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new u$U,this._watchUpdatingTracking=new c$14,this._frameTask=Q$k,this._allTiles=new n$1l,this._upsampleInfoPool=new e$1f(t$a),this._rootTilesExtent=u$T(),this._maxNumUpdating=1,this.maxTextureScale=1.2,this.backgroundColor=null,this._updatingRootTiles=!1,this.deferTileNeighborUpdate=!1,this.neighborTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._layerViewsDirty=!1,this._isGlobal=!e.view?.state?.isLocal;}initialize(){this._lercDecoder=n$1B(this.view.resourceController),this._tilePool=this.view.state.isLocal?new e$1f(f$a):new e$1f(D$5);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",(e=>e.unloadMapData())),this._elevationQueryCache=new t$j(e.newCache("elevation-query")),this._set("overlayManager",new le$5({surface:this})),this._handles.add([l$M((()=>this.overlayManager.hasHighlights),(e=>this._renderer.setNeedsHighlight(e))),l$M((()=>this.overlayManager.rendersOccluded),(e=>this._renderer.setRenderOccludedOverlay(e)))],"overlayManager"),this._renderer=new ce$3({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:p$T(this.view.spatialReference).radius,stage:this.view._stage,allTiles:this._allTiles}),this._handles.add([l$M((()=>this.baseOpacity),(e=>{this._handleLayerViewChanges(),this._updateBaseOpacity(e);}),w$x),l$M((()=>this.hasCompositeBlendMode),(()=>{this._updateBaseOpacity(this.baseOpacity);}),w$x),l$M((()=>this.renderingDisabled),(()=>this._updateTransparentTerrain()),U$s),l$M((()=>this.backgroundColor),(e=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(e);}),w$x),l$M((()=>this.view.pointsOfInterest),(e=>{this._renderer.pointsOfInterest=e,this._watchUpdatingTracking.removeAll(),e&&this._watchUpdatingTracking.add((()=>e.focus.renderLocation),(()=>()=>this._allTilesSorted=!1));})),l$M((()=>t$E.TERRAIN_TILE_TREE_SHOW_TILES),(e=>{e&&!this._treeDebugger?import('./TerrainTileTree3DDebugger-54e6102d.js').then((({TerrainTileTree3DDebugger:e})=>{!this._treeDebugger&&t$E.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new e({view:this.view}));})):e||(this._treeDebugger=l$N(this._treeDebugger));}),h$V)]),this._extentHelper=g$g(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});const t=this.view.defaultsFromMap?new p$19({getCollections:()=>this.view?.defaultsFromMap?.mapCollections?.map((({layers:e})=>e)),getChildrenFunction:e=>e&&"layers"in e?e.layers:null}):this.view.map.allLayers,i=new g$a({layers:t,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",i),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(A$b.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(A$b.BASEMAP);const r=this.view.resourceController.scheduler;this._frameTask=r.registerTask(L$D.TERRAIN_SURFACE,this),this._handles.add([l$M((()=>this._extentHelper.stencilEnabledExtents),(e=>this._renderer.setStencilEnabledLayerExtents(e)),h$V),l$M((()=>this.tilingSchemeLogic.tilingScheme),(()=>this._updateTilingScheme()),U$s),l$M((()=>this.extent),(()=>this._updateRootTiles()),h$V),this.view.on("resize",(()=>this._viewChangeUpdate())),l$M((()=>{const e=this.view,t=e.state;return [this.lodBias,this.lodSnapping,e.resourceController?.memoryController?.memoryFactor,t.camera,t.contentCamera,t.fixedContentCamera]}),(()=>this._viewChangeUpdate()),w$x),l$M((()=>this.view.qualitySettings?.tiledSurface?.textureFadeDuration),(e=>this._renderer.textureFadingEnabled=e>0),h$V),l$M((()=>this._userClippingExtent),(()=>this._updateClippingExtent()),U$s)]),this._handles.add(this.view.allLayerViews.on("after-changes",(()=>this._layerViewsDirty=!0))),this._layerViewsDirty=!0,this._handleLayerViewChanges();}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=p$X(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=l$N(this._upsampleMapCache),this._elevationQueryCache=l$N(this._elevationQueryCache),this._set("tilingSchemeLogic",l$N(this.tilingSchemeLogic)),this._extentHelper=l$N(this._extentHelper),this._basemapLayerViewHandles.forEach(((e,t)=>this._unregisterTiledLayerView(t))),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",l$N(this.overlayManager)),this._tilePool=l$N(this._tilePool),ae$4.prune(),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),this._renderer=l$N(this._renderer),this._iteratorPool=l$N(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=l$N(this._upsampleInfoPool),p$1a(),u$f();}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){const e=this.view.pointsOfInterest?.contentCameraOnSurface?.scale;if(e){const t=this.view.state.contentCamera;let i=re$7(this.view,t.eye,t.viewForward,t.up).tilt;i>90&&(i=180-i);const r=2*(i/90)**2,s=xe$3(this.view,e)-r;Math.abs(this._snapLevel-s)>ze$1&&(Math.round(s)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=s);}return Math.round(this._snapLevel)}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?S$o.ON:S$o.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if(t$V(t)||t$V(e))return null;const i=u$T(),r=e$q(t,i,e)?i:null,s=this._get("extent");return I$B(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=U$A(this.groundExtent,this._userClippingExtent,u$T()),t=this._get("extent");return I$B(e,t)?t:e}get groundExtent(){return r$W(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||this._asyncWorkItems>0||!this._allTilesSorted||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get viewingMode(){return this.view.state.viewingMode}get ready(){return r$W(this.rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e);}get spatialReference(){return this.tilingScheme?.spatialReference??null}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._updateTransparentTerrain();}_updateTransparentTerrain(){const e=!this.renderingDisabled&&!this.opaque;this.view?._stage?.renderView.setRenderParameters({transparentTerrain:e});}set velvetOverground(e){e!==this.velvetOverground&&(this._renderer.velvetOverground=e),this._set("velvetOverground",e);}set visible(e){e!==this._visible&&(this._visible=e,this._renderer.setVisibility(e),this.suspended=!e);}get opaque(){return this._renderer.opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate();}intersect(e,t,i,r){this._renderer.intersect(e,t,i,r);}getElevation(e,t,i,r){const s=this.getTileWithElevation(e,t,i,r,et$1);return t$V(s)?null:l$g(et$1[0],et$1[1],s.renderData.geometryState.samplerData)}getTileWithElevation(e,t,i,r,s=et$1){const a=this.rootTiles;if(t$V(a)||!a.length)return null;if(0===a[0].layerInfo[A$8.ELEVATION].length)return null;if(s[0]=e,s[1]=t,s[2]=i,!Bn(s,r,s,this.tilingScheme?.spatialReference))return Xe$1.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let n of a){if(!n.containsPoint(s))continue;for(;n&&!n.rendered&&!n.isLeaf;){let e=0;s[0]>.5*(n.extent[0]+n.extent[2])&&(e+=1),s[1]<.5*(n.extent[1]+n.extent[3])&&(e+=2),n=n.children[e];}const e=n.renderData;return (e?e.geometryState.samplerData:null)?n:null}return null}get elevationBounds(){return this._elevationBounds}getScale(e){if(this.tilingScheme){if(!Hn(e,et$1,this.spatialReference))return Xe$1.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this.rootTiles;if(r$W(t))for(let e of t)if(e?.containsPoint(et$1)){for(;!e.isLeaf&&!e.rendered;){let t=0;et$1[0]>e.children[0].extent[2]&&(t+=1),et$1[1]<e.children[0].extent[1]&&(t+=2),e=e.children[t];}return this._getLodBiasCorrectedScale(e.level)}}return 1e100}getSphereElevationBounds(e,t,i,r,s){if(et$1[0]=e,et$1[1]=t,et$1[2]=i,et$1[3]=r,!Bn(et$1,s,et$1,this.tilingScheme?.spatialReference))return Xe$1.error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let a=1/0,n=-1/0;const o=e=>{if(e&&g$15(e.extent,et$1))if(e.isLeaf||e.rendered)a=Math.min(a,e.elevationBounds[0]),n=Math.max(n,e.elevationBounds[1]);else for(const t of e.children)o(t);},l=this.rootTiles;if(r$W(l))for(const h of l)o(h);return {min:a,max:n}}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!Hn(e,et$1,this.spatialReference))return Xe$1.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;et$1[3]=t;let i=null;const r=e=>{if(e&&g$15(e.extent,et$1))if(e.isLeaf||e.rendered){const t=this._getLodBiasCorrectedScale(e.level);i=null==i?t:Math.min(i,t);}else for(const t of e.children)r(t);},s=this.rootTiles;if(r$W(s))for(const a of s)r(a);return i}queryVisibleScaleRange(e,t,i,r){const s=t?this.tilingScheme.levelAtScale(t):0,a=i?this.tilingScheme.levelAtScale(i):1/0,n=this.lodBias;this._renderer.queryVisibleLevelRange(e,s+n,a+n,r);}_updateBaseOpacity(e){const t=this._renderer.opaque;this._renderer.opaque=e>=1&&!this.hasCompositeBlendMode,this._renderer.isTransparent=this._allSurfaceLayersTransparent();const i=t!==this._renderer.opaque;i&&this._updateTransparentTerrain(),this._updateTileTextures(i?A$l.UNFADED:A$l.IMMEDIATE);}_updateTilingScheme(){const e=this.tilingSchemeLogic.tilingScheme;e!==this.tilingScheme&&(T$b(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles()));}_acquireTile(e,t,i,r){const s=this._tilePool.acquire();return it$1[0]=e,it$1[1]=t,it$1[2]=i,s.init(it$1,r,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const i=tt$2;let s=t.rootTilesInExtent(e,i,5*t$U);if(r$W(this.rootTiles)){if(s.length>t$U)return void Xe$1.warn(a$V);const e=this.rootTiles.map((e=>e.lij)),t=s$1v(e,s,Ke$1);if(this._updatingRootTiles=!0,t.removed.length>0||t.added.length>0){const e=this.rootTiles.filter((e=>!(t.removed.findIndex((t=>Ke$1(t,e.lij)))>-1)||(this._purgeTile(e,!0),!1)));t.added.forEach((t=>e.push(this._newRootTile(t)))),this._setRootTiles(e);}}else this._updatingRootTiles=!0,s.length>t$U&&(Xe$1.warn(u$S),s=t.rootTilesInExtent(e,i,t$U)),this._setRootTiles(s.map((e=>this._newRootTile(e))));I$B(i,this._rootTilesExtent)||(this._rootTilesExtent=u$T(i)),this.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._allTiles.forEach((e=>{e.isLoaded&&this._prepareToLoadTile(e);})),this._allTiles.forAll((e=>{e.isLoaded&&(this._updateTileGeometry(e),this._updateTileNeighborsAfterGeometryChange(e));})),this._updatingRootTiles=!1,this.checkAllTileWaterproofness();}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===E$a.SPLIT&&t.setPendingUpdate(E$a.SPLIT),this._loadTile(t),this.deferTileNeighborUpdate||t.checkGeometryWaterproofness(),t}_setRootTiles(e){if(this._set("rootTiles",e),this._allTiles.clear(),r$W(e)){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove();}this._renderer.setRootTiles(this.rootTiles),this._updateTilesVisibility(e);}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate());}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this.rootTiles)));}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(E$a.GEOMETRY)&&this._updateTileGeometry(e);}_updateTilesVisibility(e){if(t$V(e))return;const t=m$f(e);let i=t?this._elevationBounds.min:1/0,r=t?this._elevationBounds.max:-1/0;const s=this.view.state.fixedContentCamera,a=this.extent,n=this._viewProjectionMatrix;this.setTileTreeDirty();const o=this._iteratorPool.acquire();for(o.reset(e);!o.done;){const e=o.next();e.updateClippingStatus(a)&&e.resetPendingUpdate(E$a.GEOMETRY)&&this._updateTileGeometry(e),e.setPendingUpdate(E$a.RENDERDATA);const t=e.computeVisibility();s||t?(e.updateScreenDepth(n),e.renderData&&(i=Math.min(e.elevationBounds[0],i),r=Math.max(e.elevationBounds[1],r))):o.skipSubtree();}o.remove(),this._viewChanged=!0,this._allTilesDirty=!0,isFinite(i)&&isFinite(r)&&(this._elevationBounds.min===i&&this._elevationBounds.max===r||(this._elevationBounds.min=i,this._elevationBounds.max=r,this.emit("elevation-bounds-change",null)));}_updateViewDependentParameters(){const e=this.view.state.camera,t=this.view.state.contentCamera,i=Math.tan(.5*t.fovX),r=Math.tan(.5*t.fovY),s=this.tilingScheme.pixelSize,a=2**-this.lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*a,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*a,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(t$V(this._splitLimits.frustum)&&(this._splitLimits.frustum=H$o()),i$11(this._splitLimits.frustum,t.frustum)):this._splitLimits.frustum=null,i$11(this._frustum,e.frustum),u$Z(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),r$V(this._eyePosRenderSR,t.eye),Bn(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference);}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(Je$1(e)?(this._loadChildren(e),this.deferTileNeighborUpdate||(this._checkTileNeighborsWaterproofness(e),e.children.forEach((e=>e.checkGeometryWaterproofness())))):Ze$1(e)&&this._loadParent(e));}_updateTileGeometry(e){e.updateVisibility(),this._renderer.updateTileGeometry(e),this._updateTileNeighborsAfterGeometryChange(e),this._elevationUpdate(e),this._usedMemory=null,this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e);}_updateTileNeighborsAfterGeometryChange(e,t){if(this.deferTileNeighborUpdate){const t=this.neighborTilesToUpdate;e.forEachLoadedNeighbor((e=>{t.add(e);}));}else e.updateNeighborsAfterGeometryChange(t);}_updateTileTexture(e,t){const i=e.resetPendingUpdate(E$a.TEXTURE_FADING)?E$a.TEXTURE_FADING:!!e.resetPendingUpdate(E$a.TEXTURE_NOFADING)&&E$a.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,t.madeProgress());}_elevationUpdate(e){st$1.spatialReference=this.spatialReference,st$1.tile=e,st$1.extent=e.extent,this.emit("elevation-change",st$1);}get running(){return this.updating&&this.ready&&!this.suspended}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateTileStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),e.run((()=>this._updateElevation(e))),e.run((()=>this._updateTextures(e))),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),e.done?this.requestUpdate():this._usedMemory=this._recalculateUsedMemory(),this.notifyChange("updatingProgressValue");}_updateTileStatus(e){if(!this._viewChanged||!this.rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();for(t.reset(this.rootTiles);!t.done;){const e=t.next();if(e.loadable){const i=e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(i===E$a.SPLIT){e.resetPendingUpdate(E$a.MERGE),e.isLeaf&&(e.setPendingUpdate(E$a.SPLIT),t.skipSubtree());continue}e.resetPendingUpdate(E$a.SPLIT)&&e.updateAgentSuspension(),i===E$a.VSPLITMERGE&&e.updateAgents(A$8.ELEVATION);}if(t.skipSubtree(),!e.isLeaf){e.setPendingUpdate(E$a.MERGE),e.resetPendingUpdate(E$a.SPLIT);const t=this._iteratorPool.acquire();t.resetOne(e);for(let e=t.next();!t.done;e=t.next())this._updateClippingStatus(e),e.updateVisibility(),e.loadable&&e.updateScreenDepth(this._viewProjectionMatrix);t.remove();}}t.remove(),this.requestUpdate(),e.madeProgress();}_sortTiles(e){e.done||this._allTilesSorted||(c$d(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress());}_prepareBatchTileGeometryUpdate(){E$d(0===this.neighborTilesToUpdate.size),this.deferTileNeighborUpdate=!0;}_batchUpdateUpdatedTileNeighbors(){this.deferTileNeighborUpdate=!1;const e=this.neighborTilesToUpdate;(()=>{const t=()=>{for(const t of e)t.updateNeighborsWithChangedEdgeResolution();};(()=>{for(const t of e)t.updateNeighborDataAndGeometryIfNeeded();})(),t(),e.clear();})();}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate(),this._prepareBatchTileGeometryUpdate();let i=!1;for(;!e.done;){i=!0;let r=!1;const s=!this._allTiles.some((i=>{if(i.resetPendingUpdate(E$a.MERGE)){if(!t)return i.setPendingUpdate(E$a.MERGE),e.done;this._mergeTile(i),r=!0,e.madeProgress();}else i.resetPendingUpdate(E$a.SPLIT)&&(this._splitTile(i),r=!0,e.madeProgress());return !e.done&&i.resetPendingUpdate(E$a.RENDERDATA)&&(this._updateRenderData(i),e.madeProgress()),e.done}));if(r&&(this._allTilesSorted=!1,this._allTilesDirty=!0),s){if(!r)break;this._updateTilesVisibility(this.rootTiles);}else this._allTilesDirty=!0;}i||(this._allTilesDirty=!0),this._batchUpdateUpdatedTileNeighbors(),this._sortTiles(e);}_updateElevation(e){return this._prepareBatchTileGeometryUpdate(),this._allTiles.some((t=>(t.resetPendingUpdate(E$a.GEOMETRY)&&(this._updateTileGeometry(t),this._updateTileTexture(t,e),e.madeProgress()),e.done))),this._batchUpdateUpdatedTileNeighbors(),e.hasProgressed}_updateTextures(e){return this._allTiles.some((t=>(this._updateTileTexture(t,e),e.done))),e.hasProgressed}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(t$1n.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles());}get lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*e$W}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,i=o$X(e-this.lodBias,0,t.length-1),r=i-Math.floor(i);return t[Math.floor(i)].scale*(1-r)+t[Math.ceil(i)].scale*r}_removeAllTiles(){r$W(this.rootTiles)&&(this.rootTiles.forEach((e=>this._purgeTile(e,!1))),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.visible=!1;}_purgeDescendantTiles(e){if(e.isLeaf)return !1;let t=!1;for(let i=0;i<4;++i)t=this._purgeTile(e.children[i],!1)||t;return e.unsetChildren(),t}_purgeTile(e,t){const i=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),t&&this._updateTileNeighborsAfterGeometryChange(e),this._tilePool.release(e),i}_unloadTile(e){this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e),e.unload(this._renderer);}_splitTile(e){T$b(e.isLeaf,"tile that is already split should not be split again!");const t=e.level+1,i=2*e.lij[1],r=2*e.lij[2];e.setChildren(this._createTile(t,i,r,e),this._createTile(t,i,r+1,e),this._createTile(t,i+1,r,e),this._createTile(t,i+1,r+1,e)),e.setPendingUpdate(E$a.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,this._emitTileScaleChange(e,t),++this._performanceInfo.numSplit;}_emitTileScaleChange(e,t=e.level){at$1.spatialReference=this.spatialReference,at$1.extent=e.extent,at$1.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",at$1);}_createTile(e,t,i,r){T$b(!!r,"_createTile sanity check");const s=this._acquireTile(e,t,i,r);return s.updateClippingStatus(this.extent),s.loadable&&(s.updateScreenDepth(this._viewProjectionMatrix),s.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===E$a.SPLIT&&s.setPendingUpdate(E$a.SPLIT)),s}_mergeTile(e){T$b(!e.hasPendingUpdate(E$a.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(T$b(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._updateTileNeighborsAfterGeometryChange(e),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e)),this._allTilesDirty=!0,++this._performanceInfo.numMerged,this._emitTileScaleChange(e);}_checkTileAndNeighborsWaterproofness(e){e.checkGeometryWaterproofness(),this._checkTileNeighborsWaterproofness(e);}_checkTileNeighborsWaterproofness(e){m$i&&e.forallNeighbors((e=>!!e.isLoaded&&(e.checkGeometryWaterproofness(),!0)));}_loadChildren(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e),T$b(e.rendered,"parent should be rendered"),this._unloadTile(e);const t=e.children;t.forEach((e=>this._prepareToLoadTile(e))),t.forEach((e=>this._loadTilePrepared(e))),this._updateTileNeighborsAfterGeometryChange(e,e.level+1),this.deferTileNeighborUpdate||(t.forEach((e=>e.updateNeighborsWithChangedEdgeResolution())),t.forEach((e=>e.checkGeometryWaterproofness())),this._checkTileNeighborsWaterproofness(e));}_loadParent(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e);const t=e.parent;this._unloadChildren(t),this._loadTile(t),this._updateTileNeighborsAfterGeometryChange(t),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(t);}_unloadChildren(e){if(!e.isLeaf)for(let t=0;t<4;++t){const i=e.children[t];this._unloadChildren(i),this._unloadTile(i);}}_postLoadTile(e){e.setPendingUpdate(E$a.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e),this._elevationUpdate(e);}_loadTile(e){e.load(this._renderer),this._postLoadTile(e);}_loadTilePrepared(e){e.loadPrepared(this._renderer),this._postLoadTile(e);}_prepareToLoadTile(e){e.prepareToLoad(this._renderer);}_elevationDataArrived(e,t,i){const r=new e$l(e.lij,e.extent,i);e.dataArrived(t,A$8.ELEVATION,r);const s=[e],a=e.level,n=this._iteratorPool.acquire();for(n.reset(s);!n.done;){const e=n.next();e.findElevationBoundsForLayer(t,a),e.computeElevationBounds();}n.remove(),this._updateTilesVisibility(s);}_handleLayerViewChanges(e=w$C){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const i=new Set;let r=-1;for(const s of this.view.allLayerViews.items)if(i.add(s.uid),x$a(s))if(this._basemapLayerViewHandles.has(s.uid)){const e=this._layerClassFromLayerView(s),i=this._getLayerIdxByUID(e,s.uid);r$W(i)&&((i<r||t$V(r))&&(t=!0),r=i);}else this._registerTiledLayerView(s),s.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach(((e,r)=>{i.has(r)||(this._unregisterTiledLayerView(r),t=!0);})),t&&this._updateTiledLayers(),this._renderer.isTransparent=this._allSurfaceLayersTransparent(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),e.madeProgress();}_allSurfaceLayersTransparent(){let e=0===this.view.map?.ground?.opacity;for(const t of this.view.allLayerViews.items)if(W$6(t)&&!i$1o(t.layer)&&0!==t.fullOpacity)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if(U$9(e)){const t=R$7(e.layer.parent)?"normal":e.layer.blendMode;if(i$h(o$g[t]))return !0}return !1}_layerClassFromLayerView(e){return I$a(e)?A$8.ELEVATION:A$8.MAP}_registerTiledLayerView(e){const t=[],i=this._layerClassFromLayerView(e);t.push(l$M((()=>e.suspended),(()=>this._updateTiledLayers()))),t.push(l$M((()=>e.fullOpacity),(()=>this._updateTileTextures(A$l.UNFADED)))),t.push(l$M((()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null),(()=>this._restartAllAgents(i)))),U$9(e)&&t.push(l$M((()=>e.layer.blendMode),(()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(A$l.UNFADED);}))),e.on("data-changed",(()=>{const t=this._getLayerIdxByUID(i,e.uid);r$W(t)&&this._invalidateLayerData(t,i);})),this._basemapLayerViewHandles.set(e.uid,t);}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(let e=0;e<t.length;e++)t[e].remove();this._basemapLayerViewHandles.delete(e);}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let i=null;e.forEach((e=>{if(!e.layer||e.suspended||!x$a(e)||!e.fullExtent)return;const r=this._layerClassFromLayerView(e);if(r===A$8.MAP){const t=e.displayLevelRange.maxLevel;t!==1/0&&(null===i||t>i)&&(i=t);}t[r].push(e);}));for(const r of E$b){const e=this._layerViews[r],i=t[r];i.reverse();const s=i.length;let a=e.length!==s;const n=new Array(s),o=new Array(e.length);this._layerIndexByUid[r].clear();for(let t=0;t<s;t++){const s=i[t].uid;this._layerIndexByUid[r].set(s,t);const l=e.indexOf(i[t]);n[t]=l,t!==l&&(a=!0),l>-1&&(o[l]=t);}if(a){const e=this._postorderIterator;for(e.reset(this.rootTiles);!e.done;)e.next().modifyLayers(o,n,r);this._layerViews[r]=i,this._restartAllAgents(r),this._updateTilesVisibility(this.rootTiles);}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate();}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this.rootTiles);!t.done;){const i=t.next();i.restartAgents(e),e===A$8.ELEVATION&&i.computeElevationBounds();}}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll((t=>{t.updateAgents(A$8.MAP),e===A$l.IMMEDIATE?this.renderer.updateTileTexture(t,E$a.TEXTURE_NOFADING):t.updateRenderData(A$8.MAP,e);})),this._renderer.isTransparent=this._allSurfaceLayersTransparent();}_invalidateLayerData(e,t){this._allTiles.forAll((i=>i.removeLayerAgent(e,t))),this._allTiles.forAll((i=>i.invalidateLayerData(e,t)));}setTileTreeDirty(){this._allTilesDirty=!0;}requestRender(e=t$1n.UPDATE){this.renderer.setNeedsRender(e);}requestUpdate(){1==++this._pendingUpdates&&(this._hasPendingUpdates=!0);}requestTileData(e,t,i,r){const s=this.layerViewByIndex(t,i),a=s.layer;return !a.tilemapCache||_$a(s)?this._requestTileData(e,i,s,r):(++this._asyncWorkItems,a.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...r,timeout:6e3}).then((()=>--this._asyncWorkItems)).catch((t=>{throw --this._asyncWorkItems,g$T(t)||this._dataMissing(e,i,s,{notInTilemap:!0}),t})).then((()=>this._frameTask.schedule((()=>this._requestTileData(e,i,s,r)),r.signal))))}_requestTileData(e,t,i,r){return t===A$8.ELEVATION?I$a(i)?this._requestElevationTileData(e,i,r):Promise.reject():W$6(i)?this._requestMapTileData(e,i,r):Promise.reject()}_requestElevationTileData(e,t,i){++this._asyncWorkItems;const r=r=>{if(p$V(i))return;const s=this._layerIndexByUid[A$8.ELEVATION].get(t.uid);null!=s?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,s,r)):Xe$1.warn("TerrainSurface: received data from unknown layer %d %s",A$8.ELEVATION,e.lij.toString());},s=i=>{g$T(i)||(this._dataMissing(e,A$8.ELEVATION,t,i),this.requestUpdate());};if(v$9(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:C$x,signal:i.signal}).then((e=>{if(!p$V(i))return this._frameTask.schedule((()=>r(e)),i.signal,s);Xe$1.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.");}),s).finally((()=>{--this._asyncWorkItems;}));const a=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(a,"binary",i).then((e=>this._lercDecoder.decode(e,{noDataValue:C$x},i.signal))).then((e=>{e?r({values:e.pixelData,width:e.width,height:e.height,noDataValue:e.noDataValue,minValue:e.minValue,maxValue:e.maxValue}):s(new Error("LERC decoding failed"));}),s).finally((()=>{--this._asyncWorkItems;}))}_requestMapTileData(e,t,i){++this._asyncWorkItems;const r=(r,s)=>{--this._asyncWorkItems,j$9(s),p$V(i)||(this._dataMissing(e,A$8.MAP,t,r),this.requestUpdate());},s=e=>t=>r(t,e),a=r=>this._frameTask.schedule((()=>{--this._asyncWorkItems,this.requestUpdate(),p$V(i)?j$9(r):this._mapTileDataArrived(e,t,r);}),i.signal,s(r)).catch(s(r)),n=(e,t=null)=>this._frameTask.schedule((()=>r(e,t)));if(_$a(t)){const r=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(r[0],r[1],r[2],i).then(a,n)}if(O$c(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(a,n);if(g$h(t)&&v$9(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then((e=>{if(p$V(i))return Xe$1.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void n(m$L());a(e);}),n);let o=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);p$1b(t.layer)&&t.layer.refreshTimestamp&&(o+=`${o.includes("?")?"&":"?"}_ts=${t.layer.refreshTimestamp}`);const l=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(o,l,i).then(a,n)}_mapTileDataArrived(e,t,i){const r=this._getLayerIdxByUID(A$8.MAP,t.uid);r$W(r)?e.dataArrived(r,A$8.MAP,i):(j$9(i),Xe$1.warn("TerrainSurface: received data from unknown layer"));}_getLayerIdxByUID(e,t){return this._layerIndexByUid[e].get(t)}_dataMissing(e,t,i,r){const s=this._getLayerIdxByUID(t,i.uid);r$W(s)?e.dataMissing(s,t,r):Xe$1.warn("TerrainSurface: received data from unknown layer");}updateTileOverlayParams(e){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll((e=>{e.renderData&&this.overlayManager.setTileParameters(e);})),this._renderer.setNeedsRender(e));}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll((t=>{t.isLeaf&&e.numLeaves++;const i=t.level;t.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++));})),e}getUsedMemory(){return this.tilingScheme?(t$V(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),r$W(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce(((e,t)=>e+t.usedMemory),0):null}getUsedMemoryForLayerView(e){let t=0;const i=this._layerClassFromLayerView(e),r=this._getLayerIdxByUID(i,e.uid);return r$W(r)&&this._allTiles.forAll((e=>t+=e.getUsedMemoryForLayer(i,r))),t}getTile(e){if(t$V(e)||t$V(this.rootTiles))return null;const t=e.split("/").map((e=>+e));if(0===t[0])return this.rootTiles.find((e=>e.lij[1]===t[1]&&e.lij[2]===t[2]));const i=2**t[0],r=Math.floor(t[1]/i),s=Math.floor(t[2]/i);let a;if(this.rootTiles.some((e=>e.lij[1]===r&&e.lij[2]===s&&(a=e,!0))),a){let e=1<<t[0]-1;for(;a.lij[0]<t[0];){let i=t[1]&e?2:0;if((t[2]&e)>0&&i++,!a.children[i])return null;a=a.children[i],e>>=1;}return T$b(a.lij[0]===t[0]&&a.lij[1]===t[1]&&a.lij[2]===t[2],"not the right tile?"),a}return null}get test(){const e=this;return {renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{r$W(e.rootTiles)&&(e._mergeTile(e.rootTiles[0]),e._viewChangeUpdate());},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){rt$1.clear(),e._allTiles.forAll((e=>{e.visible&&e.rendered&&rt$1.push(e);}));const t=rt$1.toArray();return a$k(e.renderOrder,t),t},lockTilingScheme(t,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(t);}}}checkAllTileWaterproofness(){if(!m$i)return;const e=this.rootTiles;if(t$V(e))return;const t=e=>e?.renderData?.geometryInfo?.indices?.length>0??!1,i=(e,i)=>{t(e)&&console.error("Tile[",e.lij,"] has geometry although parent[",i.lij,"] has geom");},r=e=>{if(e.renderData&&!e.renderData.geometryState&&console.error("Tile[",e.lij,"] has renderData but not geometryState"),e.renderData&&!e.renderData.geometryInfo&&console.error("Tile[",e.lij,"] has renderData but not geometryInfo"),!e.renderData?.geometryInfo||(e.renderData.geometryInfo.indices?.length??0)>0||console.error("Tile[",e.lij,"] has renderData but no indices - geometryInfo: ",e.renderData.geometryInfo),t(e)){e.checkGeometryWaterproofness();for(const t of e.children)i(t,e);}else if(e.isLeaf)console.error("Tile[",e.lij,"] has no geometry and no children, from root to leaf");else for(const t of e.children)r(t);},s=e=>{const t=e.parent?.visible??!0,i=e.visible;e.computeVisibility();const r=e.visible;if(i!==r&&t&&console.error(" Tile[",e.lij,"] has out of date visibility: ",i," instead of ",r),!e.isLeaf)for(const a of e.children)s(a);};for(const a of e)r(a),s(a);}get isGlobal(){return this._isGlobal}get shadingEnabled(){return this._renderer.shadingEnabled}get isWebMercator(){return !!this.tilingScheme?.spatialReference.isWebMercator}get isWebMercatorOnPlateeCarree(){return this.isWebMercator&&T$H(this.view?.renderSpatialReference)}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&0===e[2]}lijEastEnd(e){return 2**(e+(this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const t=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<t)return e;if(!this.isGlobal)return null;const r=(i+(i<0?t:0))%t;return [e[0],e[1],r]}};e$Y([d$R()],Ye$1.prototype,"_renderer",void 0),e$Y([d$R()],Ye$1.prototype,"_hasPendingUpdates",void 0),e$Y([d$R()],Ye$1.prototype,"_asyncWorkItems",void 0),e$Y([d$R()],Ye$1.prototype,"_allTilesDirty",void 0),e$Y([d$R()],Ye$1.prototype,"_allTilesSorted",void 0),e$Y([d$R()],Ye$1.prototype,"_viewChanged",void 0),e$Y([d$R({readOnly:!0})],Ye$1.prototype,"_watchUpdatingTracking",void 0),e$Y([d$R()],Ye$1.prototype,"_frameTask",void 0),e$Y([d$R({readOnly:!0})],Ye$1.prototype,"snapLevel",null),e$Y([d$R({readOnly:!0})],Ye$1.prototype,"lodSnapping",null),e$Y([d$R({constructOnly:!0})],Ye$1.prototype,"view",void 0),e$Y([d$R()],Ye$1.prototype,"_userClippingExtent",null),e$Y([d$R()],Ye$1.prototype,"_rootTilesExtent",void 0),e$Y([d$R({readOnly:!0})],Ye$1.prototype,"extent",null),e$Y([d$R({readOnly:!0})],Ye$1.prototype,"groundExtent",null),e$Y([d$R({readOnly:!0})],Ye$1.prototype,"_tilingSchemeExtent",null),e$Y([d$R({readOnly:!0})],Ye$1.prototype,"updating",null),e$Y([d$R(t$i)],Ye$1.prototype,"updatingProgress",void 0),e$Y([d$R({readOnly:!0})],Ye$1.prototype,"updatingProgressValue",null),e$Y([d$R()],Ye$1.prototype,"_maxNumUpdating",void 0),e$Y([d$R({aliasOf:"view.map.ground.opacity"})],Ye$1.prototype,"baseOpacity",void 0),e$Y([d$R()],Ye$1.prototype,"hasCompositeBlendMode",void 0),e$Y([d$R({readOnly:!0})],Ye$1.prototype,"overlayManager",void 0),e$Y([d$R({readOnly:!0})],Ye$1.prototype,"viewingMode",null),e$Y([d$R()],Ye$1.prototype,"maxTextureScale",void 0),e$Y([d$R({readOnly:!0})],Ye$1.prototype,"ready",null),e$Y([d$R({value:O$7.FRONT_TO_BACK})],Ye$1.prototype,"renderOrder",null),e$Y([d$R({readOnly:!0})],Ye$1.prototype,"rootTiles",void 0),e$Y([d$R({readOnly:!0})],Ye$1.prototype,"spatialReference",null),e$Y([d$R({type:l$T,aliasOf:"view.map.ground.surfaceColor"})],Ye$1.prototype,"backgroundColor",void 0),e$Y([d$R({value:!1})],Ye$1.prototype,"slicePlaneEnabled",null),e$Y([d$R({readOnly:!0})],Ye$1.prototype,"tilingScheme",void 0),e$Y([d$R({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],Ye$1.prototype,"tilingSchemeLocked",void 0),e$Y([d$R({readOnly:!0})],Ye$1.prototype,"tilingSchemeLogic",void 0),e$Y([d$R({value:!0})],Ye$1.prototype,"velvetOverground",null),e$Y([o$1w("_renderer.wireframe")],Ye$1.prototype,"wireframe",void 0),e$Y([d$R({value:!1})],Ye$1.prototype,"suspended",null),e$Y([d$R({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],Ye$1.prototype,"textureFadeDuration",void 0),e$Y([d$R()],Ye$1.prototype,"_layerViewsDirty",void 0),e$Y([o$1w("_renderer.renderPatchBorders")],Ye$1.prototype,"renderPatchBorders",void 0),e$Y([o$1w("_renderer.renderingDisabled")],Ye$1.prototype,"renderingDisabled",void 0),Ye$1=e$Y([n$18("esri.views.3d.terrain.TerrainSurface")],Ye$1);const $e$1=Ye$1;function Ke$1(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Je$1(e){return !e.isLeaf&&(e.children.some((e=>e.shouldLoad))||e.children.some((e=>Je$1(e))))}function Ze$1(e){return e.isLeaf&&e.parent&&e.parent.shouldLoad}const et$1=n$1a(),tt$2=u$T(),it$1=[0,0,0],rt$1=new n$1l,st$1={spatialReference:null,tile:null,extent:null,context:"ground"},at$1={spatialReference:null,extent:null,scale:0};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let y$6=class extends y$F{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1;}commit(e){this.dirty=!1,this._dirtyGeomRecords.forEach(((t,r)=>this.commitLayer(r,e)));}commitLayer(e,t){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach(((r,s)=>{const d=this._ensureGeomRecord(e,s);r.forEach(((e,r)=>{const i=e[0],c=e[1],y=e[2];let h=!1;if(c&E$p.Geometry.UPDATE){const e=d.get(r);if(e){const r=e[1];if(y&E$p.State.TRANSFORMATION){const e=this.model.getObject(s);this.model.updateRenderGeometryTransformation(e,i,r)&&(h=!0);}h||t.updates.push({renderGeometry:r,updateType:y});}else e$18(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update");}if(c&E$p.Geometry.REMOVE||h){const e=d.get(r);e?(t.removes.push(e[1]),d.delete(r),e[0].disposed&&o$y.pool.release(e[0])):c===E$p.Geometry.REMOVE&&e$18(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");}if(c&E$p.Geometry.ADD||h){const e=this.model.getObject(s);if(r$W(e)){const o=this.model.getRenderGeometry(e,i),s=[i,o];t.adds.push(o),d.set(r,s);}}})),0===d.size&&this._residentGeomRecords.get(e).delete(s);})),0===this._residentGeomRecords.get(e).size&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e));}getResidentRenderGeometries(e,t){const r=this._residentGeomRecords.get(e);r&&r.forEach((e=>e.forEach((e=>t.push(e[1])))));}_objectStateChanged(e,t){for(const r of t.geometryRecords)this._updateOrCreateDirtyRecord(t,r,null,E$p.Geometry.UPDATE,0,0,E$p.Geometry.UPDATE,E$p.Geometry.ADD|E$p.Geometry.REMOVE,e);}visibilityChanged(e){this._objectStateChanged(E$p.State.VISIBILITIES,e);}highlightChanged(e){this._objectStateChanged(E$p.State.HIGHLIGHTS,e);}occlusionChanged(e){this._objectStateChanged(E$p.State.OCCLUDEES,e);}vertexAttrsUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.record,null,E$p.Geometry.UPDATE,0,0,E$p.Geometry.UPDATE,E$p.Geometry.ADD|E$p.Geometry.REMOVE,E$p.State.VERTEXATTRS);}layerAdded(e){e.objects.forAll((t=>this._layerObjectAdded(e,t)));}layerRemoved(e){e.objects.forAll((t=>this._layerObjectRemoved(e,t)));}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object);}_layerObjectAdded(e,t){const r=e.id;for(const o of t.geometryRecords)this._objectGeometryAdded(t,o,r);}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object);}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t);}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t);}_layerObjectRemoved(e,t){const r=e.id;for(const o of t.geometryRecords)this._objectGeometryRemoved(t,o,r);}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach(((e,t)=>{const r=this.model.getObject(t);r&&r.hasVolativeTransformation()&&e.forEach((e=>{e[1].shaderTransformationChanged();}));}));}objectTransformation(e){const t=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(t,r).forEach((r=>{this._updateOrCreateDirtyRecord(e,r[0],t,E$p.Geometry.UPDATE,0,0,E$p.Geometry.UPDATE,E$p.Geometry.ADD|E$p.Geometry.REMOVE,E$p.State.TRANSFORMATION);}));}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.record);}_objectGeometryAdded(e,t,r=null){this._updateOrCreateDirtyRecord(e,t,r,E$p.Geometry.ADD,E$p.Geometry.REMOVE,0,0,0);}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.record);}_objectGeometryRemoved(e,t,r=null){this._updateOrCreateDirtyRecord(e,t,r,E$p.Geometry.REMOVE,E$p.Geometry.ADD,E$p.Geometry.UPDATE,0,0);}_updateOrCreateDirtyRecord(e,t,r,o,d,i,c,m,y){r=c$$(r,this._getParentLayerId(e));const h=e.id,l=t.id,R=this._ensureDirtyRecord(r,h),G=R.get(l);if(G){const e=G[1];e&d?(R.delete(l),G[0].disposed&&o$y.pool.release(G[0])):e&i?(G[1]=o,G[2]=y):e&c?G[2]|=y:e&m||e$18(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state");}else R.set(l,[t,o,y]);this.dirty=this._hasDirtyGeometryRecords;}_ensureGeomRecord(e,t){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let o=r.get(t);return o||(o=new Map,r.set(t,o)),o}get _hasDirtyGeometryRecords(){return n$1m(this._dirtyGeomRecords,(e=>n$1m(e,(e=>e&&e.size>0))))}_ensureDirtyRecord(e,t){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let o=r.get(t);return o||(o=new Map,r.set(t,o)),o}_getParentLayerId(e){return r$W(e.parentLayer)?e.parentLayer.id:n$1C}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach(((r,o)=>{r.forEach(((r,s)=>{t.length>0&&(t+="\n"),t+=o+"."+s;const d=[];r.forEach((e=>{const t=e[1];d[t]||(d[t]=[]),d[t].push(e[0].geometry.id);}));for(let o=0;o<d.length;o++)if(d[o]){t+=" "+e[o-1]+": ";for(let e=0;e<d[o].length;e++)t+=d[o][e]+", ";}}));})),t}get test(){const e=this;return {get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce(((e,t)=>e+t.size),0)}}}};e$Y([d$R({constructOnly:!0})],y$6.prototype,"model",void 0),e$Y([d$R()],y$6.prototype,"dirty",void 0),y$6=e$Y([n$18("esri.views.3d.webgl-engine.lib.ModelDirtySet")],y$6);const h$6=y$6;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let h$5=class extends y$F{constructor(){super(...arguments),this.dirtySet=new h$6({model:this}),this._content=new Map,this._originFactory=new j$r(null,75e4);}getObject(t){return this._content.get(t)}add(t){const e=t.id;e$18(!this._content.has(e),"Model/Stage already contains object to be added"),this._content.set(e,t),y$q(t)&&this.dirtySet.layerAdded(t);}remove(t){e$18(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload(),y$q(t)&&this.dirtySet.layerRemoved(t);}addMany(t){for(const e of t)r$W(e)&&(e$18(!this._content.has(e.id),"Model/Stage already contains object to be added"),this._content.set(e.id,e));}removeMany(t){for(const e of t)e$18(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload();}has(t){return this._content.has(t.id)}forEachOfType(t,e){this._content.forEach((o=>{o.type===t&&e(o);}));}getRenderGeometry(t,e){const{geometry:o,material:r,id:n,shaderTransformation:i,origin:s,instanceParameters:a}=e,c=new T$l(o,r,{id:n,boundingInfo:o.boundingInfo,calculateShaderTransformation:i,castShadow:t.castShadow});return c.updateTransformation((o=>t.getCombinedStaticTransformation(e,o))),c.origin=s||this._originFactory.getOrigin(c.boundingSphere),c.instanceParameters=a,c}updateRenderGeometryTransformation(t,e,o){if(t$V(t))return !1;o.updateTransformation((o=>t.getCombinedStaticTransformation(e,o)));const n=this._originFactory.getOrigin(o.boundingSphere);return o.origin!==n}getStats(){const t={},e=Array.from(this._content.values());for(let o=0;o<e$1g.COUNT;++o)t[o]=e.filter((t=>t.type===o)).length;return {contentTypes:t,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return {content:Array.from(this._content.values())}}};e$Y([d$R({constructOnly:!0})],h$5.prototype,"dirtySet",void 0),h$5=e$Y([n$18("esri.views.3d.webgl-engine.parts.Model")],h$5);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function a$h(o,n,a,s){const c=h$4(o,n,a),i=e$10();return qn(a,c,i,s),i}const s$d=1,c$a=5-s$d;function h$4(t,r,a){const h=n$16(),i=t[3],e=2**(Math.ceil(Math.log(i)*Math.LOG2E/c$a)*c$a+s$d);if(a.isGeographic){const o=e/p$T(a).radius*180/Math.PI,r=Math.round(t[1]/o),s=Math.max(-90,Math.min(90,r*o)),c=o/Math.cos((Math.abs(s)-o/2)/180*Math.PI),i=Math.round(t[0]/c)*c;h[0]=i,h[1]=s;}else {const o=Math.round(t[0]/e),r=Math.round(t[1]/e);h[0]=o*e,h[1]=r*e;}const M=t[2]+r,m=Math.round(M/e);return h[2]=m*e,h}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const t$9=1e-6,n$f=[0,0,0],r$e=[0,0,0];function i$c(t,i){const{data:s,size:e}=t,a=s.length/e;if(a<=0)return;const c=new H$3(t);L$3(n$f,c.minProj,c.maxProj),R$5(n$f,n$f,.5),Q$2(r$e,c.maxProj,c.minProj);const h=K$4(r$e),u=new J$2;u.quality=h,a<14&&(t={data:new Float64Array(c.buffer,112,42),size:3});const f=[0,0,0],m=[0,0,0],P=[0,0,0],j=[0,0,0],b=[0,0,0],x=[0,0,0],I=[0,0,0];switch(o$b(c,t,I,f,m,P,j,b,x,u)){case 1:return void z$1(n$f,r$e,i);case 2:return void G$4(t,j,i)}l$7(t,I,f,m,P,j,b,x,u),O$4(t,u.b0,u.b1,u.b2,Y,_$4);const N=[0,0,0];Q$2(N,_$4,Y),u.quality=K$4(N),u.quality<h?C$5(u.b0,u.b1,u.b2,Y,_$4,N,i):z$1(n$f,r$e,i);}function o$b(n,r,i,o,s,e,a,c,h,u){if(P$4(n,o,s),$$1(o,s)<t$9)return 1;Q$2(a,o,s),X$1(a,a);return b$3(r,o,a,e)<t$9?2:(Q$2(c,s,e),X$1(c,c),Q$2(h,e,o),X$1(h,h),W$3(i,c,a),X$1(i,i),d$9(r,i,a,c,h,u),0)}const s$c=[0,0,0],e$c=[0,0,0],a$g=[0,0,0],c$9=[0,0,0],h$3=[0,0,0],u$c=[0,0,0],f$6=[0,0,0],m$c=[0,0,0];function l$7(t,n,r,i,o,l,P,j,b){I$7(t,n,r,s$c,e$c),void 0!==s$c[0]&&(Q$2(a$g,s$c,r),X$1(a$g,a$g),Q$2(c$9,s$c,i),X$1(c$9,c$9),Q$2(h$3,s$c,o),X$1(h$3,h$3),W$3(u$c,c$9,l),X$1(u$c,u$c),W$3(f$6,h$3,P),X$1(f$6,f$6),W$3(m$c,a$g,j),X$1(m$c,m$c),d$9(t,u$c,l,c$9,a$g,b),d$9(t,f$6,P,h$3,c$9,b),d$9(t,m$c,j,a$g,h$3,b)),void 0!==e$c[0]&&(Q$2(a$g,e$c,r),X$1(a$g,a$g),Q$2(c$9,e$c,i),X$1(c$9,c$9),Q$2(h$3,e$c,o),X$1(h$3,h$3),W$3(u$c,c$9,l),X$1(u$c,u$c),W$3(f$6,h$3,P),X$1(f$6,f$6),W$3(m$c,a$g,j),X$1(m$c,m$c),d$9(t,u$c,l,c$9,a$g,b),d$9(t,f$6,P,h$3,c$9,b),d$9(t,m$c,j,a$g,h$3,b));}function P$4(t,n,r){let i=$$1(t.maxVert[0],t.minVert[0]),o=0;for(let s=1;s<7;++s){const n=$$1(t.maxVert[s],t.minVert[s]);n>i&&(i=n,o=s);}U$5(n,t.minVert[o]),U$5(r,t.maxVert[o]);}const j$3=[0,0,0];function b$3(t,n,r,i){const{data:o,size:s}=t;let e=Number.NEGATIVE_INFINITY,a=0;for(let c=0;c<o.length;c+=s){j$3[0]=o[c]-n[0],j$3[1]=o[c+1]-n[1],j$3[2]=o[c+2]-n[2];const t=r[0]*j$3[0]+r[1]*j$3[1]+r[2]*j$3[2],i=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],s=j$3[0]*j$3[0]+j$3[1]*j$3[1]+j$3[2]*j$3[2]-t*t/i;s>e&&(e=s,a=c);}return U$5(i,o,a),e}const x$8=[0,0];function I$7(n,r,i,o,s){T$7(n,r,x$8,s,o);const e=tt$1(i,r);x$8[1]-t$9<=e&&(o[0]=void 0),x$8[0]+t$9>=e&&(s[0]=void 0);}const N$6=[0,0,0],V$4=[0,0,0],y$5=[0,0,0],q$2=[0,0,0],w$6=[0,0,0],A$5=[0,0,0];function d$9(n,r,i,o,s,e){if(Z$1(r)<t$9)return;W$3(N$6,i,r),W$3(V$4,o,r),W$3(y$5,s,r),F$4(n,r,x$8),w$6[1]=x$8[0],q$2[1]=x$8[1],A$5[1]=q$2[1]-w$6[1];const a=[i,o,s],c=[N$6,V$4,y$5];for(let t=0;t<3;++t){F$4(n,a[t],x$8),w$6[0]=x$8[0],q$2[0]=x$8[1],F$4(n,c[t],x$8),w$6[2]=x$8[0],q$2[2]=x$8[1],A$5[0]=q$2[0]-w$6[0],A$5[2]=q$2[2]-w$6[2];const i=K$4(A$5);i<e.quality&&(U$5(e.b0,a[t]),U$5(e.b1,r),U$5(e.b2,c[t]),e.quality=i);}}const M$3=[0,0,0];function F$4(t,n,r){const{data:i,size:o}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let s=0;s<i.length;s+=o){const t=i[s]*n[0]+i[s+1]*n[1]+i[s+2]*n[2];r[0]=Math.min(r[0],t),r[1]=Math.max(r[1],t);}}function T$7(t,n,r,i,o){const{data:s,size:e}=t;U$5(i,s),U$5(o,i),r[0]=tt$1(M$3,n),r[1]=r[0];for(let a=e;a<s.length;a+=e){const t=s[a]*n[0]+s[a+1]*n[1]+s[a+2]*n[2];t<r[0]&&(r[0]=t,U$5(i,s,a)),t>r[1]&&(r[1]=t,U$5(o,s,a));}}function z$1(t,n,r){U$5(r.center,t),R$5(r.halfSize,n,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1;}const E$7=[0,0,0],v$7=[0,0,0],g$9=[0,0,0],Y=[0,0,0],_$4=[0,0,0],S$3=[0,0,0];function G$4(n,r,i){U$5(E$7,r),Math.abs(r[0])>Math.abs(r[1])&&Math.abs(r[0])>Math.abs(r[2])?E$7[0]=0:Math.abs(r[1])>Math.abs(r[2])?E$7[1]=0:E$7[2]=0,Z$1(E$7)<t$9&&(E$7[0]=E$7[1]=E$7[2]=1),W$3(v$7,r,E$7),X$1(v$7,v$7),W$3(g$9,r,v$7),X$1(g$9,g$9),O$4(n,r,v$7,g$9,Y,_$4),Q$2(S$3,_$4,Y),C$5(r,v$7,g$9,Y,_$4,S$3,i);}function O$4(t,n,r,i,o,s){F$4(t,n,x$8),o[0]=x$8[0],s[0]=x$8[1],F$4(t,r,x$8),o[1]=x$8[0],s[1]=x$8[1],F$4(t,i,x$8),o[2]=x$8[0],s[2]=x$8[1];}const p$6=[0,0,0],B$6=[1,0,0,0,1,0,0,0,1],k$4=[0,0,0];function C$5(t,n,r,i,o,s,e){B$6[0]=t[0],B$6[1]=t[1],B$6[2]=t[2],B$6[3]=n[0],B$6[4]=n[1],B$6[5]=n[2],B$6[6]=r[0],B$6[7]=r[1],B$6[8]=r[2],nt$1(e.quaternion,B$6),L$3(k$4,i,o),R$5(k$4,k$4,.5),R$5(e.center,t,k$4[0]),R$5(p$6,n,k$4[1]),L$3(e.center,e.center,p$6),R$5(p$6,r,k$4[2]),L$3(e.center,e.center,p$6),R$5(e.halfSize,s,.5);}const D$4=7;class H$3{constructor(t){this.minVert=new Array(D$4),this.maxVert=new Array(D$4);const n=64*D$4;this.buffer=new ArrayBuffer(n);let r=0;this.minProj=new Float64Array(this.buffer,r,D$4),r+=8*D$4,this.maxProj=new Float64Array(this.buffer,r,D$4),r+=8*D$4;for(let a=0;a<D$4;++a)this.minVert[a]=new Float64Array(this.buffer,r,3),r+=24;for(let a=0;a<D$4;++a)this.maxVert[a]=new Float64Array(this.buffer,r,3),r+=24;for(let a=0;a<D$4;++a)this.minProj[a]=Number.POSITIVE_INFINITY,this.maxProj[a]=Number.NEGATIVE_INFINITY;const i=new Array(D$4),o=new Array(D$4),{data:s,size:e}=t;for(let a=0;a<s.length;a+=e){let t=s[a];t<this.minProj[0]&&(this.minProj[0]=t,i[0]=a),t>this.maxProj[0]&&(this.maxProj[0]=t,o[0]=a),t=s[a+1],t<this.minProj[1]&&(this.minProj[1]=t,i[1]=a),t>this.maxProj[1]&&(this.maxProj[1]=t,o[1]=a),t=s[a+2],t<this.minProj[2]&&(this.minProj[2]=t,i[2]=a),t>this.maxProj[2]&&(this.maxProj[2]=t,o[2]=a),t=s[a]+s[a+1]+s[a+2],t<this.minProj[3]&&(this.minProj[3]=t,i[3]=a),t>this.maxProj[3]&&(this.maxProj[3]=t,o[3]=a),t=s[a]+s[a+1]-s[a+2],t<this.minProj[4]&&(this.minProj[4]=t,i[4]=a),t>this.maxProj[4]&&(this.maxProj[4]=t,o[4]=a),t=s[a]-s[a+1]+s[a+2],t<this.minProj[5]&&(this.minProj[5]=t,i[5]=a),t>this.maxProj[5]&&(this.maxProj[5]=t,o[5]=a),t=s[a]-s[a+1]-s[a+2],t<this.minProj[6]&&(this.minProj[6]=t,i[6]=a),t>this.maxProj[6]&&(this.maxProj[6]=t,o[6]=a);}for(let a=0;a<D$4;++a){let t=i[a];U$5(this.minVert[a],s,t),t=o[a],U$5(this.maxVert[a],s,t);}}}class J$2{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0;}}function K$4(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function L$3(t,n,r){t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2];}function Q$2(t,n,r){t[0]=n[0]-r[0],t[1]=n[1]-r[1],t[2]=n[2]-r[2];}function R$5(t,n,r){t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r;}function U$5(t,n,r=0){t[0]=n[r+0],t[1]=n[r+1],t[2]=n[r+2];}function W$3(t,n,r){const i=n[0],o=n[1],s=n[2],e=r[0],a=r[1],c=r[2];t[0]=o*c-s*a,t[1]=s*e-i*c,t[2]=i*a-o*e;}function X$1(t,n){const r=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(r>0){const i=1/Math.sqrt(r);t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i;}}function Z$1(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function $$1(t,n){const r=n[0]-t[0],i=n[1]-t[1],o=n[2]-t[2];return r*r+i*i+o*o}function tt$1(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function nt$1(t,n){const r=n[0]+n[4]+n[8];if(r>0){let i=Math.sqrt(r+1);t[3]=.5*i,i=.5/i,t[0]=(n[5]-n[7])*i,t[1]=(n[6]-n[2])*i,t[2]=(n[1]-n[3])*i;}else {let r=0;n[4]>n[0]&&(r=1),n[8]>n[3*r+r]&&(r=2);const i=(r+1)%3,o=(r+2)%3;let s=Math.sqrt(n[3*r+r]-n[3*i+i]-n[3*o+o]+1);t[r]=.5*s,s=.5/s,t[3]=(n[3*i+o]-n[3*o+i])*s,t[i]=(n[3*i+r]+n[3*r+i])*s,t[o]=(n[3*o+r]+n[3*r+o])*s;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const w$5=e$13(),A$4=n$16(),B$5=n$16(),I$6=n$1a(),C$4=e$16();class D$3{constructor(t){const e=56,a=0,n=24,r=36,s=t*e;this.buffer=new ArrayBuffer(s),this.obbs=new Array(t);for(let o=0;o<t;o++)this.obbs[o]={center:u$1d(this.buffer,e*o+a),halfSize:e$1o(this.buffer,e*o+n),quaternion:n$1D(this.buffer,e*o+r)};}}function E$6(t=[0,0,0],e=[-1,-1,-1],a=[0,0,0,1]){return {center:t$12(t),halfSize:t$$(e),quaternion:r$1j(a)}}function F$3(t){return E$6(t.center,t.halfSize,t.quaternion)}function G$3(t,e){r$V(e.center,t.center),r$V(e.halfSize,t.halfSize),B$w(e.quaternion,t.quaternion);}function H$2(t,e){return e=e||E$6(),i$c(t,e),e}function J$1(t,e){const a=W$i(e,t.center),n=U$4(t,Z$g(e));return a>n?1:a<-n?-1:0}function K$3(e,a){a||(a=a$1d());const n=p$1c(C$4,e.quaternion),r=e.halfSize[0]*Math.abs(n[0])+e.halfSize[1]*Math.abs(n[3])+e.halfSize[2]*Math.abs(n[6]),s=e.halfSize[0]*Math.abs(n[1])+e.halfSize[1]*Math.abs(n[4])+e.halfSize[2]*Math.abs(n[7]),f=e.halfSize[0]*Math.abs(n[2])+e.halfSize[1]*Math.abs(n[5])+e.halfSize[2]*Math.abs(n[8]);return a[0]=e.center[0]-r,a[1]=e.center[1]-s,a[2]=e.center[2]-f,a[3]=e.center[0]+r,a[4]=e.center[1]+s,a[5]=e.center[2]+f,a}function L$2(t,e){return W$i(e,t.center)-U$4(t,Z$g(e))}function N$5(t,e){return W$i(e,t.center)+U$4(t,Z$g(e))}function O$3(t,e){return J$1(t,e[0])<=0&&J$1(t,e[1])<=0&&J$1(t,e[2])<=0&&J$1(t,e[3])<=0&&J$1(t,e[4])<=0&&J$1(t,e[5])<=0}function P$3(t,e,a,n=0){S$L(w$5,t.quaternion),e$15(A$4,e,t.center);const s=S$M(A$4,A$4,w$5),f=S$M(B$5,a,w$5);let o=-1/0,i=1/0;for(let r=0;r<3;r++)if(Math.abs(f[r])>1e-6){const e=(n+t.halfSize[r]-s[r])/f[r],a=(-n-t.halfSize[r]-s[r])/f[r];o=Math.max(o,Math.min(e,a)),i=Math.min(i,Math.max(e,a));}else if(s[r]>t.halfSize[r]+n||s[r]<-t.halfSize[r]-n)return !1;return o<=i}function Q$1(a,n,s,f,o){S$L(w$5,a.quaternion),J$g(A$4,n,a.center),S$M(A$4,A$4,w$5);const i=A$4[0]<-a.halfSize[0]?-1:A$4[0]>a.halfSize[0]?1:0,c=A$4[1]<-a.halfSize[1]?-1:A$4[1]>a.halfSize[1]?1:0,S=A$4[2]<-a.halfSize[2]?-1:A$4[2]>a.halfSize[2]?1:0,b=Math.abs(i)+Math.abs(c)+Math.abs(S);if(0===b)return 1/0;const M=1===b?4:6,p=6*(i+3*c+9*S+13);p$1c(C$4,a.quaternion),f$18(C$4,C$4,a.halfSize);for(let t=0;t<M;t++){const e=T$6[p+t];o$W(A$4,((1&e)<<1)-1,(2&e)-1,((4&e)>>1)-1),O$K(A$4,A$4,C$4),u$W(I$6,a.center,A$4),I$6[3]=1,w$z(I$6,I$6,s);const n=1/Math.max(1e-6,I$6[3]);R$4[2*t]=I$6[0]*n,R$4[2*t+1]=I$6[1]*n;}const q=2*M-2;let j=R$4[0]*(R$4[3]-R$4[q+1])+R$4[q]*(R$4[1]-R$4[q-1]);for(let t=2;t<q;t+=2)j+=R$4[t]*(R$4[t+3]-R$4[t-1]);return Math.abs(j)*f*o*.125}const R$4=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],T$6=(()=>{const t=new Int8Array(162);let e=0;const a=a=>{for(let n=0;n<a.length;n++)t[e+n]=a[n];e+=6;};return a([6,2,3,1,5,4]),a([0,2,3,1,5,4]),a([0,2,3,7,5,4]),a([0,1,3,2,6,4]),a([0,1,3,2,0,0]),a([0,1,5,7,3,2]),a([0,1,3,7,6,4]),a([0,1,3,7,6,2]),a([0,1,5,7,6,2]),a([0,1,5,4,6,2]),a([0,1,5,4,0,0]),a([0,1,3,7,5,4]),a([0,2,6,4,0,0]),a([0,0,0,0,0,0]),a([1,3,7,5,0,0]),a([2,3,7,6,4,0]),a([2,3,7,6,0,0]),a([2,3,1,5,7,6]),a([0,1,5,7,6,2]),a([0,1,5,7,6,4]),a([0,1,3,7,6,4]),a([4,5,7,6,2,0]),a([4,5,7,6,0,0]),a([4,5,1,3,7,6]),a([0,2,3,7,5,4]),a([6,2,3,7,5,4]),a([6,2,3,1,5,4]),t})();function U$4(t,e){S$L(w$5,t.quaternion),S$M(A$4,e,w$5);const a=t.halfSize;return Math.abs(A$4[0]*a[0])+Math.abs(A$4[1]*a[1])+Math.abs(A$4[2]*a[2])}function V$3(t,e){for(let a=0;a<8;++a){const n=e[a];n[0]=1&a?-t.halfSize[0]:t.halfSize[0],n[1]=2&a?-t.halfSize[1]:t.halfSize[1],n[2]=4&a?-t.halfSize[2]:t.halfSize[2],S$M(n,n,t.quaternion),u$W(n,n,t.center);}}function W$2(t){return Y$f(t.halfSize)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function ae$1(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function ie$1(e){if(a$12("disable-feature:i3s-draco")||!e)return !1;for(const t of e)for(const e of t.geometryBuffers)if("draco"===e.compressedAttributes?.encoding)return !0;return !1}function se(e,t,r,n,o,a){const i=t!==n;o.traverse(r,(r=>{let o=r.mbs;i&&(o=pe$1,bn(r.mbs,n,o,t));return me$1(e,o)!==he.OUTSIDE&&(a(r),!0)}));}function ce$2(e,t,r){let n=0,o=0;for(let a=0;a<t.length&&n<e.length;a++)e[n]===t[a]&&(r(a)&&(e[o]=e[n],o++),n++);e.length=o;}function le$1(e,r,n){let o=0,a=0;for(;o<n.length;){M$z(e,n[o])>=0===r&&(n[a]=n[o],a++),o++;}n.length=a;}const fe=u$T();function ue$1(e,t){if(0===t.rotationScale[1]&&0===t.rotationScale[2]&&0===t.rotationScale[3]&&0===t.rotationScale[5]&&0===t.rotationScale[6]&&0===t.rotationScale[7])return fe[0]=(e[0]-t.position[0])/t.rotationScale[0],fe[1]=(e[1]-t.position[1])/t.rotationScale[4],fe[2]=(e[2]-t.position[0])/t.rotationScale[0],fe[3]=(e[3]-t.position[1])/t.rotationScale[4],fe}const pe$1=n$1a();var he;function me$1(e,t){const r=t[0],n=t[1],o=t[3],a=e[0]-r,i=r-e[2],s=e[1]-n,c=n-e[3],l=Math.max(a,i,0),f=Math.max(s,c,0),u=l*l+f*f;if(u>o*o)return he.OUTSIDE;if(u>0)return he.INTERSECTS_CENTER_OUTSIDE;return -Math.max(a,i,s,c)>o?he.INSIDE:he.INTERSECTS_CENTER_INSIDE}function de$1(e,t){const r=t[0],n=t[1],o=t[2],a=t[3],i=e[0]-r,s=r-e[3],c=e[1]-n,l=n-e[4],f=e[2]-o,u=o-e[5],p=Math.max(i,s,0),h=Math.max(c,l,0),m=Math.max(f,u,0),d=p*p+h*h+m*m;if(d>a*a)return he.OUTSIDE;if(d>0)return he.INTERSECTS_CENTER_OUTSIDE;return -Math.max(i,s,c,l,f,u)>a?he.INSIDE:he.INTERSECTS_CENTER_INSIDE}function ye(e,t,r){const n=[],o=r&&r.missingFields,a=r&&r.originalFields;for(const i of e){const e=i.toLowerCase();let r=!1;for(const o of t)if(e===o.name.toLowerCase()){n.push(o.name),r=!0,a&&a.push(i);break}!r&&o&&o.push(i);}return n}async function Se(e,t,n,a,c){if(0===t.length)return [];const l=e.attributeStorageInfo;if(r$W(e.associatedLayer))try{return await be(e.associatedLayer,t,n,a)}catch(f){if(e.associatedLayer.loaded)throw f}if(l){const i=ge$1(t,n,c);if(t$V(i))throw new s$16("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const f=e.parsedUrl.path,u=await Promise.all(i.map((e=>Ee(f,l,e.node,e.indices,a).then((t=>{for(let r=0;r<e.graphics.length;r++){const n=e.graphics[r],o=t[r];if(n.attributes)for(const e in n.attributes)e in o||(o[e]=n.attributes[e]);n.attributes=o;}return e.graphics})))));return x$Q(u)}throw new s$16("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function ge$1(e,t,r){const n=new Map,o=[],a=r();for(const i of e){const e=i.attributes[t];for(let t=0;t<a.length;t++){const r=a[t],s=r.featureIds.indexOf(e);if(s>=0){let e=n.get(r.node);e||(e={node:r.node,indices:[],graphics:[]},o.push(e),n.set(r.node,e)),e.indices.push(s),e.graphics.push(i);for(let r=t;r>0;r--)a[r]=a[r-1];a[0]=r;break}}}return o}async function be(e,t,r,n){t.sort(((e,t)=>e.attributes[r]-t.attributes[r]));const o=t.map((e=>e.attributes[r])),a=[],i=ye(n,e.fields,{originalFields:a}),s=await we(e,o,i);for(let c=0;c<t.length;c++){const e=t[c],r=s[c],n={};if(e.attributes)for(const t in e.attributes)n[t]=e.attributes[t];for(let t=0;t<a.length;t++)n[a[t]]=r[i[t]];e.attributes=n;}return t}function we(e,t,a){const i=e.capabilities.query.maxRecordCount;if(null!=i&&t.length>i){const o=d$16(t,i);return Promise.all(o.map((t=>we(e,t,a)))).then(x$Q)}const s=new b$K({objectIds:t,outFields:a,orderByFields:[e.objectIdField]});return e.queryFeatures(s).then((e=>{if(e&&e.features&&e.features.length===t.length)return e.features.map((e=>e.attributes));throw new s$16("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")}))}function Ee(t,r,n,o,a){const i=[];for(const e of r)if(e&&a.includes(e.name)){const r=`${t}/nodes/${n.resources.attributes}/attributes/${e.key}/0`;i.push({url:r,storageInfo:e});}return E$Q(i.map((t=>U$z(t.url,{responseType:"array-buffer"}).then((e=>I$C(t.storageInfo,e.data)))))).then((e=>{const t=[];for(const r of o){const n={};for(let t=0;t<e.length;t++)null!=e[t].value&&(n[i[t].storageInfo.name]=Me(e[t].value,r));t.push(n);}return t}))}!function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",e[e.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",e[e.INSIDE=3]="INSIDE";}(he||(he={}));const Te=-32768,Ie=-(2**31);function Me(e,t){if(!e)return null;const r=e[t];if(u$1e(e))return r===Te?null:r;if(f$19(e))return r===Ie?null:r;return r!=r?null:r}function ve(e){const t=e.store.indexCRS||e.store.geographicCRS,r=void 0===t?e.store.indexWKT:void 0;if(r){if(!e.spatialReference)throw new s$16("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(r!==e.spatialReference.wkt)throw new s$16("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const n=t?new k$z(ae$1(t)):e.spatialReference;return n.equals(e.spatialReference)?e.spatialReference:n}function Re(e){const t=e.store.vertexCRS||e.store.projectedCRS,r=void 0===t?e.store.vertexWKT:void 0;if(r){if(!e.spatialReference)throw new s$16("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(r!==e.spatialReference.wkt)throw new s$16("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const n=t?new k$z(ae$1(t)):e.spatialReference;return n.equals(e.spatialReference)?e.spatialReference:n}function xe(e,t){return t$V(t)?"@null":t===O$H(t)?"@ECEF":e.equals(t)?"":null!=t.wkid?"@"+t.wkid:null}function je(e,t,r){if(!An(e,t))throw new s$16("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===r&&!qe(e,t))throw new s$16("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function qe(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}function ze(e,t,r){const n=ve(e),o=Re(e);je(n,t,r),je(o,t,r);}function Ce(e){return (null==e.geometryType||"triangles"===e.geometryType)&&((null==e.topology||"PerAttributeArray"===e.topology)&&(null!=e.vertexAttributes&&null!=e.vertexAttributes.position))}function Ne(e){if(null==e.store||null==e.store.defaultGeometrySchema||!Ce(e.store.defaultGeometrySchema))throw new s$16("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function ke(e,t){ze(e,t.spatialReference,t.viewingMode);}function De(e){return null!=e.geometryType&&"points"===e.geometryType&&((null==e.topology||"PerAttributeArray"===e.topology)&&((null==e.encoding||""===e.encoding||"lepcc-xyz"===e.encoding)&&(null!=e.vertexAttributes&&null!=e.vertexAttributes.position)))}function Ue(e){if(null==e.store||null==e.store.defaultGeometrySchema||!De(e.store.defaultGeometrySchema))throw new s$16("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function _e$1(e,t){je(e.spatialReference,t.spatialReference,t.viewingMode);}function We(e){return "simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type}function Ae(e){return "mesh-3d"===e.type}function Fe(e){if(null==e||!We(e))return !0;if(("unique-value"===e.type||"class-breaks"===e.type)&&null==e.defaultSymbol)return !0;const t=e.getSymbols();if(0===t.length)return !0;for(const r of t){if(!Ae(r)||0===r.symbolLayers.length)return !0;for(const e of r.symbolLayers.items)if("fill"!==e.type||t$V(e.material)||t$V(e.material.color)||"replace"!==e.material.colorMixMode)return !0}return !1}const Oe=m$w({color:[0,0,0,0],opacity:0});class Ge{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0;}}function Ke(e){const t=new Ge;let r=!1,n=!1;for(const o of e.symbolLayers.items)if("fill"===o.type&&o.enabled){const e=o.material,a=o.edges;if(r$W(e)&&!r){const n=e.color,a=n$1u(e.colorMixMode);r$W(n)?t.material={color:[n.r/255,n.g/255,n.b/255],alpha:n.a,colorMixMode:a}:t.material={color:[1,1,1],alpha:1,colorMixMode:r$1k.Multiply},t.castShadows=o.castShadows,r=!0;}r$W(a)&&!n&&(t.edgeMaterial=p$r(a,{}),n=!0);}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:r$1k.Multiply}),t}function Le(e,t){return (0|e)+(0|t)|0}function Be(e,t,r,n,o=0){n===O$H(n)?t.isGeographic?at(e,r,t,o):ot$1(e,r,t,o):t.isWGS84&&(n.isWebMercator||T$H(n))?He(t,e,n,r,o):t.isWebMercator&&T$H(n)?rt(t,e,n,r,o):e===r?(r.center[2]+=o,Un(r.center,t,0,r.center,n,0,1)):(o$W(r.center,e.center[0],e.center[1],e.center[2]+o),Un(r.center,t,0,r.center,n,0,1),B$w(r.quaternion,e.quaternion),r$V(r.halfSize,e.halfSize));}function Pe(e,t,r,n,o){if(B$w(o.quaternion,e.quaternion),n===l$O.Global){S$L(Ze,e.quaternion),S$M($e,e.center,Ze),f$1a(Qe,$e),m$$(Ve,Qe,e.halfSize),J$g(Ve,Qe,Ve);const n=s$1b(Ve);u$W(Ve,Qe,e.halfSize);const a=s$1b(Ve);if(n<r)r$V(o.center,e.center),o$W($e,r,r,r),u$W(o.halfSize,e.halfSize,$e);else {const i=a>0?1+t/a:1,s=n>0?1+r/n:1,c=(s+i)/2,l=(s-i)/2;q$p(o.halfSize,Qe,l),g$$(o.halfSize,o.halfSize,e.halfSize,c),q$p(o.center,Qe,c),g$$(o.center,o.center,e.halfSize,l),l$1a($e,$e),c$1k(o.center,o.center,$e),S$M(o.center,o.center,o.quaternion);}}else {const n=o$W($e,0,0,1);g$$(o.center,e.center,n,(r+t)/2),S$L(Ze,e.quaternion),S$M(n,n,Ze),f$1a(n,n),g$$(o.halfSize,e.halfSize,n,(r-t)/2);}return o}const $e=n$16(),Qe=n$16(),Ve=n$16(),Ze=e$13();function He(e,t,r,n,o){r$V(et,t.center),et[2]+=o;const a=O$H(r);Un(et,e,0,et,a,0,1),nt(a,t,et,r,n);}const Je=new Float64Array(24),Xe={data:Je,size:3},Ye=n$16(),et=n$16(),tt=e$16();function rt(e,t,r,n,o){r$V(et,t.center),et[2]+=o,nt(e,t,et,r,n);}function nt(e,t,r,n,o){const a=p$1c(tt,t.quaternion);for(let i=0;i<8;++i){for(let e=0;e<3;++e)Ye[e]=t.halfSize[e]*(0!=(i&1<<e)?-1:1);for(let e=0;e<3;++e){let t=r[e];for(let r=0;r<3;++r)t+=Ye[r]*a[3*r+e];Je[3*i+e]=t;}}Un(Je,e,0,Je,n,0,8),H$2(Xe,o);}function ot$1(e,t,r,n){V$3(e,ht$1),o$W(t.center,e.center[0],e.center[1],e.center[2]+n),qn(r,t.center,ut$1,O$H(r)),o$W(t.center,ut$1[12],ut$1[13],ut$1[14]);const o=2*Math.sqrt(1+ut$1[0]+ut$1[5]+ut$1[10]);pt$1[0]=(ut$1[6]-ut$1[9])/o,pt$1[1]=(ut$1[8]-ut$1[2])/o,pt$1[2]=(ut$1[1]-ut$1[4])/o,pt$1[3]=.25*o,y$H(t.quaternion,pt$1,e.quaternion),S$L(pt$1,t.quaternion);let a=0,i=0,s=0;for(const c of ht$1)c[2]+=n,Un(c,r,0,c,O$H(r),0,1),J$g(St,c,t.center),S$M(St,St,pt$1),a=Math.max(a,Math.abs(St[0])),i=Math.max(i,Math.abs(St[1])),s=Math.max(s,Math.abs(St[2]));o$W(t.halfSize,a,i,s);}function at(e,t,r,n){const o=p$T(r),a=1+Math.max(0,n)/(o.radius+e.center[2]);o$W(t.center,e.center[0],e.center[1],e.center[2]+n),Un(t.center,r,0,t.center,O$H(r),0,1),B$w(t.quaternion,e.quaternion),S$L(pt$1,e.quaternion),o$W(St,0,0,1),S$M(St,St,pt$1),o$W(St,e.halfSize[0]*Math.abs(St[0]),e.halfSize[1]*Math.abs(St[1]),e.halfSize[2]*Math.abs(St[2])),q$p(St,St,o.inverseFlattening),u$W(t.halfSize,e.halfSize,St),q$p(t.halfSize,t.halfSize,a);}function it(e,t,r,n,o,a){if(!a||0===a.length||t$V(t))return null;const c=a$h(e.mbs,o,r,t);let l;h$U(bt,c);const f=()=>{if(!l)if(l=ht$1,D$s(dt$1),r$W(e.serviceObb)){Be(e.serviceObb,r,yt,t,o),V$3(yt,l);for(const e of l)L$E(e,e,bt),m$Y(dt$1,e);}else {const n=e.mbs,a=n[3];Bn(n,r,St,t),L$E(St,St,bt),St[2]+=o;for(let e=0;e<8;++e){const t=1&e?a:-a,r=2&e?a:-a,n=4&e?a:-a,o=l[e];r$V(o,[St[0]+t,St[1]+r,St[2]+n]),m$Y(dt$1,o);}}};let u=1/0,p=-1/0;const m=e=>{if("replace"!==e.type)return;const r=e.geometry;if(!r.hasZ)return;D$s(mt$1);const o=r.spatialReference||n,a=r.rings.reduce(((e,r)=>r.reduce(((e,r)=>(Bn(r,o,St,t),L$E(St,St,bt),m$Y(mt$1,St),Math.min(St[2],e))),e)),1/0);f(),E$L(dt$1,mt$1)&&(u=Math.min(u,a),p=Math.max(p,a));};if(a.forEach((e=>m(e))),u===1/0)return null;const d=(e,t,r)=>{L$E(St,r,c),e[t+0]=St[0],e[t+1]=St[1],e[t+2]=St[2],t+=24,r[2]=u,L$E(St,r,c),e[t+0]=St[0],e[t+1]=St[1],e[t+2]=St[2],t+=24,r[2]=p,L$E(St,r,c),e[t+0]=St[0],e[t+1]=St[1],e[t+2]=St[2];};for(let i=0;i<8;++i)d(gt$1.data,3*i,l[i]);return H$2(gt$1)}function st(e){return r$W(e)&&e.halfSize[0]>=0}function ct$1(e){return e[3]>=0}function lt$1(e){r$W(e)&&(e.halfSize[0]=-1);}function ft$1(e){r$W(e)&&(e[3]=-1);}const ut$1=e$10(),pt$1=e$1p(),ht$1=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],mt$1=u$T(),dt$1=u$T(),yt=E$6(),St=[0,0,0],gt$1={data:new Array(72),size:3},bt=e$10();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class t$8{constructor(t){this._totalCount=t,this._indexRanges=[0,t];}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return 0===this._indexRanges.length}componentCount(){const t=this._indexRanges;let n=0;for(let e=0;e<t.length;e+=2)n+=t[e+1];return n}reset(t){"all"===t||t.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=n$e(t);}forEachComponent(t){const n=this._indexRanges;for(let e=0;e<n.length;e+=2){const s=n[e],o=s+n[e+1];for(let n=s;n<o;n++)if(!t(n))return !1}return !0}forEachComponentRange(t){const n=this._indexRanges;for(let e=0;e<n.length;e+=2){const s=n[e];if(!t(s,s+n[e+1]))return !1}return !0}computeOffsetRanges(t){const n=new Array(this._indexRanges.length),e=this._indexRanges;for(let s=0;s<e.length;s+=2){const o=e[s],r=o+e[s+1],i=t[o],l=t[r];n[s]=i,n[s+1]=l-i;}return n}}function n$e(t){const n=new Array;if(0===t.length)return n;let e=t[0],s=1;for(let o=1;o<t.length;o++){const r=t[o];e+s===r?s+=1:(n.push(e),n.push(s),e=r,s=1);}return n.push(e),n.push(s),n}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class a$f extends e$C{constructor(t,e){super(),this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=t$1i(e);const s=this.count;this.visibility=new t$8(s),this.materialDataBuffer=t.getBuffer(s),this.materialDataIndices=new Uint16Array(s);for(let h=0;h<s;h++)this.materialDataIndices[h]=this.materialDataBuffer.acquireIndex();}dispose(){super.dispose();for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t]);}get count(){return this.offsets.length-1}get geometryRanges(){return t$V(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return t$V(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return t$V(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty();}_updateCachedHighlightRanges(){if((t$V(this.cachedHighlightRanges)||t$V(this.cachedDefaultRanges))&&r$W(this.highlightCounts)){const{highlightRanges:t,defaultRanges:e}=n$d(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=t,this.cachedDefaultRanges=e;}}}function n$d(t,e,h){const i=[],s=[];let a=h.length,n=h.length;return e.forEachComponent((e=>(t[e]>0?(a!==e-1&&(i.length&&i.push(h[a+1]-i[i.length-1]),i.push(h[e])),a=e):(n!==e-1&&(s.length&&s.push(h[n+1]-s[s.length-1]),s.push(h[e])),n=e),!0))),i.length&&i.push(h[a+1]-i[i.length-1]),s.length&&s.push(h[n+1]-s[s.length-1]),{highlightRanges:i,defaultRanges:s}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$b extends e$C{constructor(){super(...arguments),this.visible=t$7.Hidden;}}var t$7;e$Y([i$B()],s$b.prototype,"renderable",void 0),e$Y([i$B()],s$b.prototype,"components",void 0),function(e){e[e.Hidden=0]="Hidden",e[e.Visible=1]="Visible";}(t$7||(t$7={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function t$6(t,n,e,l){if(e>=n)return t;null==t&&(t=i$b());const s=t.isVisibleBit;let a=t.data;const c=r$d(a),o=e/c|0,f=e-c*o,h=(n-1)/c|0,B=a,E=l===s;if(!(e<B.length*c)&&E){const t=1.5,n=o+1,i=Math.ceil(B.length*t),e=h+1;let r=Math.max(n,i);r=Math.min(r,e),a=new Uint32Array(r),a.set(B);}return o<a.length&&(a[o]=u$b(a[o],f,E)),t.data=a,t}function n$c(t,n){if(null==t)return !0;const{isVisibleBit:i,data:u}=t,l=r$d(u);return n<u.length*l?e$b(i,u,n,l):!t.isVisibleBit}function i$b(t=!0){return {isVisibleBit:!t,data:new Uint32Array(0)}}function e$b(t,n,i,e){const r=i/e|0,u=i-r*e;return l$6(n[r],u)===t}function r$d(t){const n=8;return t.BYTES_PER_ELEMENT*n}function u$b(t,n,i){return t&~(1<<n)|(i?1:0)<<n}function l$6(t,n){return 0!=(t&1<<n)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class _$3{constructor(o,s){this._indices=r$W(o.indices)?o.indices:l$R(o.positions.length/3),this._positions=new i$1h(o.positions),this._components=s,this._componentIntersectionData=new Array(s.count);}getComponentAabb(o,s){if(r$W(this._perComponentAabbs)){for(let t=0;t<6;t++)s[t]=this._perComponentAabbs[6*o+t];return s}return this._computePerComponentAabbs(),this.getComponentAabb(o,s)}getComponentPositions(t,o){o.indices=this._indices,o.data=this._positions.typedBuffer,o.stride=this._positions.typedBufferStride,o.startIndex=this._components.offsets[t],o.endIndex=this._components.offsets[t+1];}intersect(e,n,i,a,_,u,l){const C={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},A=this._indices,y=this._components.offsets,g=N$u(e,n,b$2),j=e[2],B=n[2];this._components.visibility.forEachComponent((c=>{if(!n$c(this._components.pickability,c))return !0;const b=this.getComponentAabb(c,d$8);if(r$W(u)){const o=u[c];r$W(_)?_.componentOffset=o:(e[2]=j-o,n[2]=B-o);}if(r$W(_)&&_.applyToAabb(b),!O$N(b,e,g,i))return !0;const x=y[c]/3,I=y[c+1]/3,M=(t,o,e)=>{l(c,t,O$K(o,o,a),e);},D=I-x;return t$V(_)&&D>s$e?(null==this._componentIntersectionData[c]&&(this._componentIntersectionData[c]=new d$a(this._indices,x,I,C)),this._componentIntersectionData[c].intersectRay({r0:e,r1:n},M)):v$W(e,n,x,I,A,C,void 0,_,M),!0}));}_computePerComponentAabbs(){const t=this._components.count;this._perComponentAabbs=new Float32Array(6*t);const o=this._indices,s=this._positions.typedBuffer,e=this._positions.typedBufferStride,n=this._components.offsets;let i=0;for(let r=0;r<t;r++){const t=n[r],p=n[r+1];let m=1/0,a=1/0,c=1/0,h=-1/0,f=-1/0,_=-1/0;for(let n=t;n<p;n++){const t=o[n]*e,i=s[t],r=s[t+1],p=s[t+2];m=Math.min(m,i),a=Math.min(a,r),c=Math.min(c,p),h=Math.max(h,i),f=Math.max(f,r),_=Math.max(_,p);}this._perComponentAabbs[i++]=m,this._perComponentAabbs[i++]=a,this._perComponentAabbs[i++]=c,this._perComponentAabbs[i++]=h,this._perComponentAabbs[i++]=f,this._perComponentAabbs[i++]=_;}}get positions(){return this._positions}get indices(){return this._indices}}const b$2=n$16(),d$8=a$1d();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$a{constructor(s,t,e){this.material=s,this.geometry=t,this.meta=e;}dispose(){this.material.dispose(),this.geometry.dispose();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class o$a extends e$C{constructor(s,t,i,o){super(),this.primitiveType=t,this.parameters=i,this.indexed=o,this.vao=s;}}e$Y([i$B()],o$a.prototype,"vao",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function r$c(r,n){return {near:r,far:n}}function n$b(n){return n?a$e(n,1/0,-1/0):r$c(1/0,-1/0)}function a$e(r,n,a){return r.near=n,r.far=a,r}function t$5(r,n,a=r){return a.near=Math.min(r.near,n.near),a.far=Math.max(r.far,n.far),a}function e$a(r,n){return r.near<=n&&n<=r.far}const f$5={near:0,far:0};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function S$2(n,o){const e=n$b(),{eye:r,frustum:a,viewForward:s}=n;o.forAll((n=>{const o=r$W(n.offsetObb)?n.offsetObb:n.obb,l=P$u(J$g(E$5,o.center,r),s),u=U$4(o,s);if(e$a(e,l-u)&&e$a(e,l+u))return;const i=R$3(o,a);if(-1===i)return;if(0===i)return v$6.far=l+u,v$6.near=l-u,void t$5(e,v$6);const h=q$1.pushNew();h.near=l-u,h.far=l+u,h.mask=i,h.object=n;}));for(let l=0;l<q$1.length;l++){const n=q$1.data[l];if(e$a(e,n.near)&&e$a(e,n.far))continue;v$6.far=n.far,v$6.near=1/0;const o=M$2(r$W(n.object.offsetObb)?n.object.offsetObb:n.object.obb,r,A$3,(t=>{let o=x$7;for(let e=0;e<P$2&&t.length>0;e++){if(0==(n.mask&1<<e))continue;B$4(a[e],t,o);const r=t;t=o,o=r;}for(let n=0;n<t.length;n+=3){o$W(y$4,t.data[n+0],t.data[n+1],t.data[n+2]);const o=P$u(J$g(y$4,y$4,r),s);v$6.near=Math.min(v$6.near,o);}}));0===o&&(v$6.near=0),t$5(e,v$6);}return q$1.length=0,e}const q$1=new n$1l({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),v$6=n$b(),y$4=n$16(),O$2=n$16(),A$3=new n$1l({deallocator:null}),x$7=new n$1l({deallocator:null});function B$4(t,n,o){o.length=0;const e=n.length-3;F$2(y$4,n,e);const r=W$i(t,y$4);r<=0&&(o.push(y$4[0]),o.push(y$4[1]),o.push(y$4[2]));let a=0,s=r;for(;a<e;a+=3){F$2(O$2,n,a);const e=W$i(t,O$2);if(s*e<0){A$C(y$4,O$2,y$4,e/(e-s)),I$5(o,y$4);}e<=0&&I$5(o,O$2),s=e,r$V(y$4,O$2);}if(s*r<0){F$2(O$2,n,e);A$C(y$4,O$2,y$4,r/(r-s)),I$5(o,y$4);}}function F$2(t,n,o){return o$W(t,n.data[o+0],n.data[o+1],n.data[o+2])}function I$5(t,n){t.push(n[0]),t.push(n[1]),t.push(n[2]);}function M$2(t,n,r,s){S$L(D$2,t.quaternion),J$g(E$5,n,t.center),S$M(E$5,E$5,D$2);const f=8*((E$5[0]<-t.halfSize[0]?-1:E$5[0]>t.halfSize[0]?1:0)+3*(E$5[1]<-t.halfSize[1]?-1:E$5[1]>t.halfSize[1]?1:0)+9*(E$5[2]<-t.halfSize[2]?-1:E$5[2]>t.halfSize[2]?1:0)+13),h=N$4[f];if(0===h)return h;p$1c(C$3,t.quaternion),f$18(C$3,C$3,t.halfSize);const m=(n,o)=>{const e=N$4[f+o+1];return o$W(n,((1&e)<<1)-1,(2&e)-1,((4&e)>>1)-1),O$K(n,n,C$3),u$W(n,t.center,n)};return r.length=0,I$5(r,m(G$2,0)),I$5(r,m(H$1,1)),I$5(r,m(E$5,2)),I$5(r,m(J,3)),s(r),1===h?h:(r.length=0,I$5(r,G$2),I$5(r,J),I$5(r,m(E$5,4)),I$5(r,m(K$2,5)),s(r),2===h||(r.length=0,I$5(r,G$2),I$5(r,K$2),I$5(r,m(E$5,6)),I$5(r,H$1),s(r)),h)}const N$4=(()=>{const t=new Int8Array(216);let n=0;const o=o=>{for(let e=0;e<o.length;e++)t[n+e]=o[e];n+=8;};return o([3,0,6,2,3,1,5,4]),o([2,0,2,3,1,5,4,0]),o([3,1,0,2,3,7,5,4]),o([2,0,1,3,2,6,4,0]),o([1,0,1,3,2,0,0,0]),o([2,1,5,7,3,2,0,0]),o([3,2,0,1,3,7,6,4]),o([2,2,0,1,3,7,6,0]),o([3,3,0,1,5,7,6,2]),o([2,0,1,5,4,6,2,0]),o([1,0,1,5,4,0,0,0]),o([2,1,3,7,5,4,0,0]),o([1,0,2,6,4,0,0,0]),o([0,0,0,0,0,0,0,0]),o([1,1,3,7,5,0,0,0]),o([2,2,3,7,6,4,0,0]),o([1,2,3,7,6,0,0,0]),o([2,3,1,5,7,6,2,0]),o([3,4,0,1,5,7,6,2]),o([2,5,7,6,4,0,1,0]),o([3,5,0,1,3,7,6,4]),o([2,4,5,7,6,2,0,0]),o([1,4,5,7,6,0,0,0]),o([2,5,1,3,7,6,4,0]),o([3,6,0,2,3,7,5,4]),o([2,6,2,3,7,5,4,0]),o([3,7,6,2,3,1,5,4]),t})(),P$2=4;function R$3(t,n){let o=0;for(let e=0;e<P$2;e++){const r=J$1(t,n[e]);if(r>0)return -1;0===r&&(o|=1<<e);}return o}const C$3=e$16(),D$2=e$13(),E$5=n$16(),G$2=n$16(),H$1=n$16(),J=n$16(),K$2=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class e$9{constructor(t){this._objects=t;}submit(t,e){this._objects.preSubmit(e),this._objects.visibleObjects.forAll((s=>s.renderable.material.submit(t,e,s)));}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?S$2(e,this._objects.visibleObjects):null}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function o$9(o){const i=T$C().vec3f(O$J.POSITION);return o.normals&&i.vec2i16(O$J.NORMALCOMPRESSED,{glNormalized:!0}),o.textureCoordinates===o$Y.Default?i.vec2f(O$J.UV0):o.textureCoordinates===o$Y.Atlas&&(i.vec2f(O$J.UV0),i.vec4u16(O$J.UVREGION,{glNormalized:!0})),o.colors&&i.vec4u8(O$J.COLOR,{glNormalized:!0}),i.alignTo(4)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class o$8 extends i$Z{constructor(r,o){super(r,"int",a$$.Draw,((e,s,i)=>e.setUniform1i(r,o(s,i))));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var m$b;!function(o){o[o.Uniform=0]="Uniform",o[o.Varying=1]="Varying",o[o.COUNT=2]="COUNT";}(m$b||(m$b={}));const x$6=429496.7296;function s$9(o,r){o$18(o/x$6*.5+.5,r);}function C$2(e,r){switch(r.componentData){case m$b.Varying:return f$4(e);case m$b.Uniform:return v$5(e);case m$b.COUNT:return;default:n$1i(r.componentData);}}function f$4(o){const{vertex:e,fragment:l}=o;e.include(a$10),e.uniforms.add([new s$10("componentColorTex"),new o$R("componentColorTexInvDim")]),o.attributes.add(O$J.COMPONENTINDEX,"float"),o.varyings.add("vExternalColorMixMode","mediump float"),o.varyings.add("vExternalColor","vec4"),o.include(e$1q),e.constants.add("elevationScale","float",2*x$6),e.code.add(n$19`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex * 2.0 + 0.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return texture2D(componentColorTex, indexCoord);
}
float readElevationOffset() {
float normalizedIndex = (componentIndex * 2.0 + 1.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return (rgba2float(texture2D(componentColorTex, indexCoord)) - 0.5) * elevationScale;
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),l.code.add(n$19`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`);}function v$5(o){const{vertex:e,fragment:r}=o;e.uniforms.add(new o$c("externalColor",(o=>o.componentParameters.externalColor))),r.uniforms.add(new o$8("externalColorMixMode",(o=>o.componentParameters.externalColorMixMode))),o.varyings.add("vExternalColor","vec4"),e.code.add(n$19`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),r.code.add(n$19`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var a$d;function r$b(r,c){const i=r.vertex;switch(i.code.add(n$19`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),c.vertexDiscardMode){case a$d.None:i.code.add(n$19`#define vertexDiscardByOpacity(_opacity_) {}`);break;case a$d.Opaque:i.code.add(n$19`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case a$d.Transparent:i.code.add(n$19`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);}}!function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT";}(a$d||(a$d={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var t$4;function a$c(a){return a&&P$v(a)?t$4.Mars:a&&s$15(a)?t$4.Moon:t$4.Earth}!function(r){r[r.Earth=1]="Earth",r[r.Mars=2]="Mars",r[r.Moon=3]="Moon",r[r.COUNT=4]="COUNT";}(t$4||(t$4={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var v$4,T$5;!function(o){o[o.None=0]="None",o[o.Transparent=1]="Transparent",o[o.Opaque=2]="Opaque",o[o.COUNT=3]="COUNT";}(v$4||(v$4={})),function(o){o[o.None=0]="None",o[o.NoOverlay=1]="NoOverlay",o[o.ColorOverlay=2]="ColorOverlay",o[o.ColorOverlayWithWater=3]="ColorOverlayWithWater",o[o.COUNT=4]="COUNT";}(T$5||(T$5={}));class m$a extends t$X{constructor(){super(...arguments),this.output=o$19.Color,this.textureCoordinateType=o$Y.None,this.componentData=m$b.Uniform,this.cullFace=n$1t.Back,this.vertexDiscardMode=a$d.None,this.doubleSidedMode=i$1i.WindingOrder,this.alphaDiscardMode=C$z.Opaque,this.integratedMeshMode=T$5.None,this.transparencyPassType=O$L.NONE,this.ellipsoidMode=t$4.Earth,this.pbrMode=l$Q.Disabled,this.normalType=i$1p.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.isGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1;}}e$Y([e$12({count:o$19.COUNT})],m$a.prototype,"output",void 0),e$Y([e$12({count:o$Y.COUNT})],m$a.prototype,"textureCoordinateType",void 0),e$Y([e$12({count:m$b.COUNT})],m$a.prototype,"componentData",void 0),e$Y([e$12({count:n$1t.COUNT})],m$a.prototype,"cullFace",void 0),e$Y([e$12({count:a$d.COUNT})],m$a.prototype,"vertexDiscardMode",void 0),e$Y([e$12({count:i$1i.COUNT})],m$a.prototype,"doubleSidedMode",void 0),e$Y([e$12({count:C$z.COUNT})],m$a.prototype,"alphaDiscardMode",void 0),e$Y([e$12({count:T$5.COUNT})],m$a.prototype,"integratedMeshMode",void 0),e$Y([e$12({count:O$L.COUNT})],m$a.prototype,"transparencyPassType",void 0),e$Y([e$12({count:t$4.COUNT})],m$a.prototype,"ellipsoidMode",void 0),e$Y([e$12({count:l$Q.COUNT})],m$a.prototype,"pbrMode",void 0),e$Y([e$12({count:i$1p.COUNT})],m$a.prototype,"normalType",void 0),e$Y([e$12()],m$a.prototype,"spherical",void 0),e$Y([e$12()],m$a.prototype,"doublePrecisionRequiresObfuscation",void 0),e$Y([e$12()],m$a.prototype,"hasVertexColors",void 0),e$Y([e$12()],m$a.prototype,"hasNormals",void 0),e$Y([e$12()],m$a.prototype,"hasSlicePlane",void 0),e$Y([e$12()],m$a.prototype,"hasBaseColorTexture",void 0),e$Y([e$12()],m$a.prototype,"receiveAmbientOcclusion",void 0),e$Y([e$12()],m$a.prototype,"receiveShadows",void 0),e$Y([e$12()],m$a.prototype,"blendingEnabled",void 0),e$Y([e$12()],m$a.prototype,"hasScreenSpaceReflections",void 0),e$Y([e$12()],m$a.prototype,"hasPolygonOffset",void 0),e$Y([e$12()],m$a.prototype,"hasMetalnessAndRoughnessTexture",void 0),e$Y([e$12()],m$a.prototype,"hasEmissionTexture",void 0),e$Y([e$12()],m$a.prototype,"hasOcclusionTexture",void 0),e$Y([e$12()],m$a.prototype,"hasNormalTexture",void 0),e$Y([e$12()],m$a.prototype,"hasOccludees",void 0),e$Y([e$12()],m$a.prototype,"hasMultipassTerrain",void 0),e$Y([e$12()],m$a.prototype,"cullAboveGround",void 0),e$Y([e$12()],m$a.prototype,"isGround",void 0),e$Y([e$12()],m$a.prototype,"hasCloudsReflections",void 0),e$Y([e$12()],m$a.prototype,"snowCover",void 0),e$Y([e$12({constValue:a$$.Draw})],m$a.prototype,"pbrTextureBindType",void 0),e$Y([e$12({constValue:!0})],m$a.prototype,"hasSliceHighlight",void 0),e$Y([e$12({constValue:!1})],m$a.prototype,"hasSliceInVertexProgram",void 0),e$Y([e$12({constValue:!1})],m$a.prototype,"useCustomDTRExponentForWater",void 0),e$Y([e$12({constValue:!1})],m$a.prototype,"hasVertexTangents",void 0),e$Y([e$12({constValue:!0})],m$a.prototype,"supportsTextureAtlas",void 0),e$Y([e$12({constValue:!1})],m$a.prototype,"highStepCount",void 0),e$Y([e$12({constValue:!1})],m$a.prototype,"instancedDoublePrecision",void 0),e$Y([e$12({constValue:!0})],m$a.prototype,"useFillLights",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function l$5(l,s){l.include(e$1k,s),l.fragment.include(i$1q);const i=l.fragment;i.uniforms.add(new o$c("baseColor",(o=>o.baseColor))),i.uniforms.add(new e$1r("objectOpacity",(o=>o.objectOpacity))),s.hasVertexColors?i.code.add(n$19`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(n$19`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(n$19`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function t$3(t,s){const l=t.fragment;switch(s.doubleSidedMode){case i$1i.None:l.code.add(n$19`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case i$1i.View:t.include(F$w,s),l.code.add(n$19`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case i$1i.WindingOrder:l.code.add(n$19`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:n$1i(s.doubleSidedMode);case i$1i.COUNT:}switch(s.normalType){case i$1p.Attribute:case i$1p.CompressedAttribute:t.include(n$1E,s),l.code.add(n$19`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case i$1p.ScreenDerivative:t.extensions.add("GL_OES_standard_derivatives"),t.include(F$w,s),l.code.add(n$19`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case i$1p.Ground:s.spherical?(t.include(F$w,s),l.code.add(n$19`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):l.code.add(n$19`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),t.extensions.add("GL_OES_standard_derivatives"),l.code.add(n$19`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:n$1i(s.normalType);case i$1p.COUNT:}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function s$8(s,a){const d=s.fragment;if(a.hasBaseColorTexture){s.include(a$1m,a);const l=a.textureCoordinateType===o$Y.Atlas;d.uniforms.add(m$10("baseColorTexture",(e=>e.texture),l)),l?(s.include(t$1p),d.code.add(n$19`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, baseColorTextureSize, vuv0, vuvRegion);
}`)):d.code.add(n$19`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`);}else d.code.add(n$19`vec4 readBaseColorTexture() { return vec4(1.0); }`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const I$4=new Map([[O$J.POSITION,0],[O$J.NORMAL,1],[O$J.NORMALCOMPRESSED,1],[O$J.COLOR,2],[O$J.UV0,3],[O$J.UVREGION,4],[O$J.COMPONENTINDEX,5]]);function G$1(a){const i=new i$_;i.include(F$w,a),i.include(n$1E,a),i.include(e$1k,a),i.include(d$T,a),i.include(t$1f,a),i.include(C$2,a),i.include(t$1q,a),i.include(p$1d,a),i.include(s$8,a),i.include(r$b,a);const{vertex:V,fragment:I}=i;I.uniforms.add(new o$12("view")),a.pbrMode!==l$Q.Normal&&a.pbrMode!==l$Q.Schematic||(i.include(d$17,a),a.hasNormalTexture&&i.include(m$11,a)),a.output===o$19.Shadow&&a.componentData===m$b.Varying?V.code.add(n$19`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):V.code.add(n$19`#define discardShadows(castShadows) {}`);const G=a.integratedMeshMode===T$5.ColorOverlay||a.integratedMeshMode===T$5.ColorOverlayWithWater,k=G&&a.output===o$19.Color&&a.pbrMode===l$Q.WaterOnIntegratedMesh;return G&&(i.include(m$X,a),i.include(C$6,a),a.spherical?V.code.add(n$19`
      const float invEllipsoidRadius = ${n$19.float(1/(a.ellipsoidMode===t$4.Earth?s$18.radius:a.ellipsoidMode===t$4.Mars?t$1r.radius:e$1s.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):V.code.add(n$19`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),k&&(i.varyings.add("tbnTangent","vec3"),i.varyings.add("tbnBiTangent","vec3"),i.varyings.add("groundNormal","vec3")),V.code.add(n$19`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${n$19.float(t$19)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${k?a.spherical?n$19`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:n$19`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${G?n$19`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),a.output===o$19.Alpha&&(I.include(a$Y),i.include(n$1q,a),i.include(l$5,a),G&&I.uniforms.add(new c$11("ovColorTex",((e,o)=>O$5(e,o)))),I.code.add(n$19`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${a.hasMultipassTerrain?n$19`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${G?n$19`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),a.output===o$19.Color&&(I.include(a$Y),i.include(n$1q,a),i.include(l$5,a),i.include(t$3,a),i.include(m$X,a),a.receiveShadows?(i.include(h$18,a),I.code.add(n$19`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):I.code.add(n$19`float evaluateShadow() { return 0.0; }`),G&&I.uniforms.add(new c$11("ovColorTex",((e,o)=>O$5(e,o)))),I.code.add(n$19`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${a.hasMultipassTerrain?n$19`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${G?n$19`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),a.pbrMode===l$Q.Normal||a.pbrMode===l$Q.Schematic?(I.uniforms.add(new e$_("lightingMainIntensity",((e,o)=>o.lighting.mainLight.intensity))),I.code.add(n$19`
        ${a.pbrMode===l$Q.Normal?n$19`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),a.hasNormalTexture?I.code.add(n$19`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):I.code.add(n$19`vec3 shadingNormal = normalVertex;`),I.code.add(n$19`${a.spherical?n$19`vec3 normalGround = normalize(positionWorld());`:n$19`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),I.code.add(n$19`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${a.snowCover?n$19`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${G?n$19` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(a.receiveShadows?I.code.add(n$19`float shadow = evaluateShadow();`):a.spherical?(I.uniforms.add(new o$_("lightingGlobalFactor",((e,o)=>o.lighting.globalFactor))),I.code.add(n$19`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):I.code.add(n$19`float shadow = 0.0;`),k&&I.uniforms.add(new c$11("ovNormalTex",((e,o)=>U$3(o)))),a.snowCover&&(i.extensions.add("GL_OES_standard_derivatives"),I.code.add(n$19`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),I.code.add(n$19`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${G?n$19` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${k?n$19`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),I.code.add(n$19`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${a.transparencyPassType===O$L.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),a.output!==o$19.Depth&&a.output!==o$19.Shadow||(i.include(e$1h,a),I.code.add(n$19`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),a.output===o$19.Normal&&(i.include(t$3,a),I.code.add(n$19`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${a.normalType===i$1p.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),a.output===o$19.Highlight&&(i.include(a$19),I.code.add(n$19`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${G?n$19`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),i}function U$3(e){return 0===e.overlays.length?null:e.overlays[T$p.INNER].getValidTexture(H$e.Water)}const k$3=Object.freeze(Object.defineProperty({__proto__:null,attributeLocations:I$4,build:G$1,getOverlayNormalTexture:U$3},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class x$5 extends e$11{bindDraw(e,r){const o=this.program;o.bindDraw(e,r),o.rebindTextures(),e.componentParameters.type===m$b.Varying&&e.componentParameters.texture.bind(o,"componentColorTex","componentColorTexInvDim");}initializeConfiguration(r,t){t.spherical=r.viewingMode===l$O.Global,t.doublePrecisionRequiresObfuscation=r$1c(r.rctx);}initializeProgram(e){const r=x$5.shader.get(),t=r.build(this.configuration);return new o$Z(e.rctx,t,r.attributeLocations)}_setPipelineState(e){const t=this.configuration,o=t.integratedMeshMode!==T$5.None,n=e===O$L.NONE,s=e===O$L.FrontFace;return W$h({blending:t.output!==o$19.Color&&t.output!==o$19.Alpha||!t.blendingEnabled?null:n?c$1c:E$J(e),culling:h$14(t.cullFace),depthTest:{func:l$13(e)},depthWrite:n||s?a$1a:null,colorWrite:c$10,stencilWrite:o||t.hasOccludees?e$1i:null,stencilTest:o?u$1f(a$1l.IntegratedMeshMaskExcluded):t.hasOccludees?f$11:null,polygonOffset:n||s?t.hasPolygonOffset?{factor:2,units:2}:null:f$12})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}x$5.shader=new t$W(k$3,(()=>import('./ComponentShader.glsl-d00c7970.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class e$8 extends t$Y{constructor(){super(...arguments),this._dirty=!0;}_setDirty(){this._dirty=!0;}_setClean(){if(this._dirty=!1,null!=this._parameterBlocks)for(const t of this._parameterBlocks)this[t]._setClean();}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(null==this._parameterBlocks)return !1;for(const t of this._parameterBlocks)if(this[t].dirty)return !0;return !1}}class r$a{constructor(){this._dirty=!0;}_setDirty(){this._dirty=!0;}_setClean(){this._dirty=!1;}get dirty(){return this._dirty}}function s$7(t={}){return (e,r)=>{const s=e._parameterCount??0;if(e._parameterCount=s+1,t.vectorOps){const i=t.vectorOps;Object.defineProperty(e,r,{get(){return this[s]},set(t){const e=this[s];if(null==e)this[s]=t;else {if(i.equals(e,t))return;i.copy(e,t);}this._setDirty();}});}else Object.defineProperty(e,r,{get(){return this[s]},set(e){this[s]!==e&&(t.dispose&&this[s]&&this[s].dispose(),this[s]=e,this._setDirty());}});}}function i$a(){return (t,e)=>{const r=t._parameterCount??0;t._parameterCount=r+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(r),Object.defineProperty(t,e,{get(){return this[r]},set(t){this[r]!==t&&(this[r]=t,this._setDirty());}});}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class c$8{constructor(s){this._low=n$1c(),this._high=n$1c(),s&&this.set(s);}get low(){return this._low}get high(){return this._high}set(h){const e=this._low,i=this._high;r$V(e,h),J$g(i,h,e);}setElements(s,t,e){o$W(n$a,s,t,e),this.set(n$a);}get(s){return u$W(s,this._low,this._high)}getLowScaled(s){return q$p(s,this._low,1)}}const n$a=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class _$2 extends e$8{constructor(e,t){super(),this.toMapSpace=t,this.baseColor=r$1e(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=r$$(1,1,.5),this.emissiveFactor=r$$(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new B$3,this.componentParameters=new L$1,this.textureAlphaCutoff=o$1c,this.alphaDiscardMode=C$z.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=t$4.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new m$a;const r=new c$8(e.position),s=r$1l(e.rotationScale);u$18(s,s),this.transformNormalGlobalFromModel=o$14(s,s),this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale;}dispose(){this._technique=p$X(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null;}get texture(){return r$W(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return r$W(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return r$W(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return r$W(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return r$W(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(e,t,o,a){const i=this._techniqueConfiguration;i.hasVertexColors=a.colors,i.hasNormals=a.normals,i.textureCoordinateType=a.textureCoordinates,i.hasMetalnessAndRoughnessTexture=r$W(this.metallicRoughnessTexture),i.hasEmissionTexture=r$W(this.emissionTexture),i.hasOcclusionTexture=r$W(this.occlusionTexture),i.hasNormalTexture=r$W(this.normalTexture),i.transparencyPassType=t.identifier===a$i.Material&&null!=o.transparencyPassType?o.transparencyPassType:O$L.NONE,i.hasMultipassTerrain=t.identifier===a$i.Material&&null!=o.multipassTerrain&&o.multipassTerrain.enabled,i.cullAboveGround=t.identifier===a$i.Material&&null!=o.multipassTerrain&&o.multipassTerrain.cullAboveGround,i.ellipsoidMode=this.ellipsoidMode,i.componentData=this.componentParameters.type,i.cullFace=this.commonMaterialParameters.cullFace,i.doubleSidedMode=this.commonMaterialParameters.doubleSided?i$1i.View:i$1i.None,i.hasBaseColorTexture=r$W(this.baseColorTexture);const n=this._computeWhichMaterialPass();i.blendingEnabled=n===V$2.Transparent||n===V$2.OpaqueAndTransparent,i.alphaDiscardMode=this.alphaDiscardMode,i.integratedMeshMode=this.isIntegratedMesh?X(o)?U$3(o)?T$5.ColorOverlayWithWater:T$5.ColorOverlay:T$5.NoOverlay:T$5.None,i.isGround=this.isIntegratedMesh,i.hasPolygonOffset=this.polygonOffsetEnabled;const l=this.hasParametersFromSource&&t$V(this.baseColorTexture);return i.pbrMode=i.integratedMeshMode===T$5.ColorOverlayWithWater?l$Q.WaterOnIntegratedMesh:this.usePBR?l?l$Q.Schematic:l$Q.Normal:l$Q.Disabled,i.normalType=i.integratedMeshMode===T$5.None?i.hasNormals?i$1p.CompressedAttribute:i$1p.ScreenDerivative:i$1p.Ground,i.hasSlicePlane=r$W(o.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,t.identifier===a$i.ShadowMap?(i.output=o$19.Shadow,i.vertexDiscardMode=a$d.None):t.identifier===a$i.Highlight?(i.output=o$19.Highlight,i.vertexDiscardMode=a$d.None):(this._computeWhichMaterialPass()===V$2.OpaqueAndTransparent?i.vertexDiscardMode=t.transparent?a$d.Opaque:a$d.Transparent:i.vertexDiscardMode=a$d.None,i.output=H(t.subPass),t.subPass===o$d.Alpha&&(i.hasOccludees=o.hasOccludees),t.subPass===o$d.Color?(i.receiveAmbientOcclusion=o.ssaoHelper.ready,i.hasOccludees=o.hasOccludees,i.receiveShadows=o.shadowMap.ready,i.hasScreenSpaceReflections=o.ssr.enabled,i.hasCloudsReflections=r$W(o.clouds.data)):(i.receiveAmbientOcclusion=!1,i.receiveShadows=!1),i.snowCover=this.hasSnowCover(o)),this._technique=e.releaseAndAcquire(x$5,i,this._technique),this._setClean(),this._technique}hasSnowCover(e){return r$W(e.weather)&&e.weatherVisible&&"snowy"===e.weather.type&&"enabled"===e.weather.snowCover}submit(e,t,s){if(0===this.objectOpacity)return;const o=s.renderable.geometry,a=s.components,i=s.renderable.meta.cameraDepthSquared,n=a.geometryRanges,l=a.highlightRanges,h=a.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case V$2.Opaque:e.materialOpaque.submitDraw(this,o,n,i);break;case V$2.Transparent:e.materialTransparent.submitDraw(this,o,n,i);break;case V$2.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,o,n,i),e.materialTransparent.submitDraw(this,o,n,i);break;case V$2.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,o,n,i),U$2(t)&&e.highlightIntegratedMesh.submitDraw(this,o,n,i);}const u=this.componentParameters.castShadows!==W$1.None;u&&e.shadowMap.submitDraw(this,o,n,i),r$W(l)&&(e.highlight.submitDraw(this,o,l,i),u&&e.highlightShadowMap.submitDraw(this,o,l,i)),u&&r$W(h)&&e.defaultShadowMap.submitDraw(this,o,h,i);}get attributeLocations(){return I$4}_computeWhichMaterialPass(){return this.isIntegratedMesh?V$2.IntegratedMesh:this.objectOpacity<1?V$2.Transparent:this.componentParameters.opaqueOverride===W$1.All?V$2.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===C$z.Blend||this.alphaDiscardMode===C$z.MaskBlend?V$2.Transparent:this.componentParameters.transparent===W$1.None?V$2.Opaque:this.componentParameters.transparent===W$1.All?V$2.Transparent:V$2.OpaqueAndTransparent}}var k$2,V$2,W$1;e$Y([s$7({vectorOps:G$r})],_$2.prototype,"baseColor",void 0),e$Y([s$7()],_$2.prototype,"usePBR",void 0),e$Y([s$7()],_$2.prototype,"hasParametersFromSource",void 0),e$Y([s$7({vectorOps:V$t})],_$2.prototype,"mrrFactors",void 0),e$Y([s$7({vectorOps:V$t})],_$2.prototype,"emissiveFactor",void 0),e$Y([s$7({dispose:!0})],_$2.prototype,"baseColorTexture",void 0),e$Y([s$7({dispose:!0})],_$2.prototype,"metallicRoughnessTexture",void 0),e$Y([s$7({dispose:!0})],_$2.prototype,"emissionTexture",void 0),e$Y([s$7({dispose:!0})],_$2.prototype,"occlusionTexture",void 0),e$Y([s$7({dispose:!0})],_$2.prototype,"normalTexture",void 0),e$Y([s$7()],_$2.prototype,"objectOpacity",void 0),e$Y([i$a()],_$2.prototype,"commonMaterialParameters",void 0),e$Y([i$a()],_$2.prototype,"componentParameters",void 0),e$Y([s$7()],_$2.prototype,"textureAlphaCutoff",void 0),e$Y([s$7()],_$2.prototype,"alphaDiscardMode",void 0),e$Y([s$7()],_$2.prototype,"isIntegratedMesh",void 0),e$Y([s$7()],_$2.prototype,"polygonOffsetEnabled",void 0),e$Y([s$7()],_$2.prototype,"ellipsoidMode",void 0),e$Y([s$7()],_$2.prototype,"hasOccludees",void 0),function(e){e[e.VERTEX=0]="VERTEX",e[e.GROUND=1]="GROUND",e[e.SCREEN_DERIVATIVE=2]="SCREEN_DERIVATIVE";}(k$2||(k$2={})),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.OpaqueAndTransparent=2]="OpaqueAndTransparent",e[e.IntegratedMesh=3]="IntegratedMesh";}(V$2||(V$2={}));class B$3 extends r$a{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=n$1t.Back,this.hasSlicePlane=!0;}}e$Y([s$7()],B$3.prototype,"doubleSided",void 0),e$Y([s$7()],B$3.prototype,"cullFace",void 0),e$Y([s$7()],B$3.prototype,"hasSlicePlane",void 0);class L$1 extends r$a{constructor(){super(...arguments),this.externalColor=r$1e(1,1,1,1),this.externalColorMixMode=r$1k.Multiply,this.castShadows=W$1.All;}get transparent(){return this.externalColor[3]<1?W$1.All:W$1.None}get opaqueOverride(){return this.externalColorMixMode===r$1k.Replace&&1===this.externalColor[3]?W$1.All:W$1.None}get visible(){return this.externalColor[3]>0?W$1.All:W$1.None}get type(){return m$b.Uniform}}e$Y([s$7({vectorOps:G$r})],L$1.prototype,"externalColor",void 0),e$Y([s$7()],L$1.prototype,"externalColorMixMode",void 0),e$Y([s$7()],L$1.prototype,"castShadows",void 0),function(e){e[e.All=0]="All",e[e.Some=1]="Some",e[e.None=2]="None";}(W$1||(W$1={}));class G extends r$a{constructor(){super(...arguments),this.texture=null,this.transparent=W$1.None,this.opaqueOverride=W$1.None,this.castShadows=W$1.None;}get type(){return m$b.Varying}}function H(e){switch(e){case o$d.Color:return o$19.Color;case o$d.Alpha:return o$19.Alpha;case o$d.Depth:return o$19.Depth;case o$d.Normal:return o$19.Normal}}function U$2(e){return 0!==e.overlays.length&&r$W(e.overlays[T$p.INNER].getValidTexture(H$e.Highlight))}function X(e){return 0!==e.overlays.length&&r$W(e.overlays[T$p.INNER].getColorTextureNoRasterImage())}e$Y([s$7()],G.prototype,"texture",void 0),e$Y([s$7()],G.prototype,"transparent",void 0),e$Y([s$7()],G.prototype,"opaqueOverride",void 0),e$Y([s$7()],G.prototype,"castShadows",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class e$7{constructor(e){this.maxCount=e,this._nextIndex=0,this.recycledIndices=[];}get activeCount(){return this._nextIndex-this.recycledIndices.length}get availableCount(){return this.recycledIndices.length+this.maxCount-this._nextIndex}acquire(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this.recycledIndices.push(e);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class a$b{constructor(a,u=1){this.rctx=a,this.fieldCount=u,this.textureWidth=4096,this.dirty=!0,this.texture=new u$X(this.rctx,{target:M$v.TEXTURE_2D,pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,samplingMode:L$C.NEAREST,wrapMode:D$q.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this.data=new x$P(new ArrayBuffer(4*this.textureWidth));}dispose(){this.texture.dispose(),this.texture=void 0,this.data=void 0;}setData(t,e,i,s,r,h){const d=t*this.fieldCount+e;this.dirty=!0,this.data.set(d,0,i),this.data.set(d,1,s),this.data.set(d,2,r),this.data.set(d,3,h);}setDataElement(t,e,i,s){const r=t*this.fieldCount+e;this.dirty=!0,this.data.set(r,i,s);}resizeToFit(e){const i=e*this.fieldCount;if(i>=this.data.count){const e=Math.ceil((i+1)/this.textureWidth)*this.textureWidth,s=new x$P(new ArrayBuffer(4*e));s.typedBuffer.set(this.data.typedBuffer),this.data=s;}}updateTexture(){if(!this.dirty)return;const t=this.texture.descriptor.width,e=this.texture.descriptor.height;this.data.count>t*e&&this.texture.resize(t,this.data.count/t),this.texture.setData(this.data.typedBuffer),this.dirty=!1;}bind(t,e,i){t.bindTexture(e,this.texture),t.setUniform2f(i,1/this.texture.descriptor.width,1/this.texture.descriptor.height);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const r$9=65536;class i$9{constructor(i,a=1){this.textureBuffer=new a$b(i,a),this.indexManager=new e$7(r$9);}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0;}get availableCount(){return this.indexManager.availableCount}get activeCount(){return this.indexManager.activeCount}acquireIndex(){const e=this.indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this.indexManager.release(e);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class r$8{constructor(t,e=1){this.rctx=t,this.fieldCount=e,this.buffers=[];}garbageCollect(){this.buffers=this.buffers.filter((t=>0!==t.activeCount||(t.dispose(),!1)));}destroy(){this.buffers.forEach((t=>t.dispose())),this.buffers=[];}getBuffer(r){for(const t of this.buffers)if(t.availableCount>=r)return t;if(r>r$9)return null;const s=new i$9(this.rctx,this.fieldCount);return this.buffers.push(s),s}updateTextures(){for(const t of this.buffers)t.textureBuffer.updateTexture();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const K$1=s$17.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class Q{constructor(e,t){this._renderManager=e,this._viewingMode=t,this._objects=[new n$1l,new n$1l],this._renderSubmit=new e$9(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new r$8(e.rctx,2);}dispose(){e$18(0===this._objects[t$7.Hidden].length&&0===this._objects[t$7.Visible].length,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy();}createObject(e){const t=new s$b;return t.toMapSpace=e.toMapSpace,t.transform=e.transform,t.obb=F$3(e.obb),t.components=new a$f(this._componentBufferManager,e.geometry.componentOffsets),t.renderable=this._createRenderable(e,t.components),t.intersectionGeometry=new _$3(e.geometry.positionData,t.components),this._objects[t.visible].push(t),t}destroyObject(e){const t=e;this._objects[t.visible].removeUnordered(t),t.dispose(),this._notifyDirty();}setObjectVisibility(e,t){const o=e;t!==o.visible&&(this._objects[o.visible].removeUnordered(o),this._objects[t].push(o),o.visible=t,this._notifyDirty());}preSubmit(e){const t=e.camera.eye;this.visibleObjects.forAll((e=>e.renderable.meta.cameraDepthSquared=p$$(t,e.obb.center)));}getMaterial(e){return e.renderable.material}updateMaterial(e,t){const o=e.renderable.material;t(o),o.dirty&&this._notifyDirty();}setAllComponentVisibilities(e,t){const o=e;o.components.visibility.reset(t),o.components.visibilityDirty(),this._notifyDirty();}forEachVisibleComponent(e,t){return e.components.visibility.forEachComponent(t)}getComponentCount(e){const t=e,o=t.components.visibility.componentCount();return {visible:o,invisible:t.components.count-o}}setComponentData(e,n){const r=e,i=r.renderable.material,s=r.components,a=s.materialDataBuffer,c=s.materialDataIndices,m={castShadows:!0,pickable:!0,externalColor:n$1F(),externalColorMixMode:r$1k.Multiply,elevationOffset:0},l=a.textureBuffer,f=new Uint8Array(4),p=new Uint32Array(f.buffer);let h=0,b=0,g=0,d=s.verticalOffsets,_=1/0,w=-1/0,M=!1,x=!1,O=0;for(let u=0;u<s.count;u++)n(u,m),h+=+(m.externalColor[3]<1),b+=+(m.externalColorMixMode===r$1k.Replace&&1===m.externalColor[3]),g+=+m.castShadows,o$1n(m.externalColor,m.externalColorMixMode,f),f[2]=254&f[2]|+m.castShadows,l.setData(c[u],0,f[0],f[1],f[2],f[3]),M||(M=u>0&&O!==p[0]),O=p[0],x||(x=0!==m.elevationOffset),x&&t$V(d)&&(d=new Array(u).fill(0)),r$W(d)&&(d[u]=m.elevationOffset),_=Math.min(_,m.elevationOffset),w=Math.max(w,m.elevationOffset),s$9(m.elevationOffset,f),l.setData(c[u],1,f[0],f[1],f[2],f[3]),m.pickable!==n$c(s.pickability,u)&&(s.pickability=t$6(s.pickability,s.count,u,m.pickable));s.verticalOffsets=x?d:null,r.offsetObb=x?Pe(r.obb,_,w,this._viewingMode,r$W(r.offsetObb)?r.offsetObb:F$3(r.obb)):null,M||x?(i.componentParameters=new G,i.componentParameters.castShadows=$(g,s.count),i.componentParameters.transparent=$(h,s.count),i.componentParameters.opaqueOverride=$(b,s.count),i.componentParameters.texture=l,l.updateTexture()):(i.componentParameters=new L$1,i.componentParameters.castShadows=m.castShadows?W$1.All:W$1.None,i.componentParameters.externalColor=m.externalColor,i.componentParameters.externalColorMixMode=m.externalColorMixMode),this._notifyDirty();}getComponentAabb(e,o,r,i=!1){e.intersectionGeometry.getComponentAabb(o,r);const s=e,a=s.components.verticalOffsets;if(i||t$V(a))return r;const c=a[o];if(this._viewingMode===l$O.Local||0===c)return r[2]+=c,r[5]+=c,r;const m=e$X(V$u(c));return m.localOrigin=s.transform.position,m.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,t,o){return e.intersectionGeometry.getComponentPositions(t,o)}intersect(e,t,n,r,i,c){const m=e;r$W(i)&&(i.localOrigin=m.transform.position);const p=u$18(ee,m.transform.rotationScale);J$g(te,t,m.transform.position),J$g(oe$2,n,m.transform.position),O$K(te,te,p),O$K(oe$2,oe$2,p);const h=o$14(ee,p);return m.intersectionGeometry.intersect(te,oe$2,r,h,i,m.components.verticalOffsets,c)}addEdges(e,t,o,n){const r=e,{indices:i,positions:s}=r.intersectionGeometry,a=r.components.offsets;return t.addComponentObject(e,r.transform,{center:r.obb.center,radius:W$2(r.obb)},s,i,a,o,n)}async extractEdgeInformation(e,t,o){const n=e,r=n.components.visibility;if(r.allInvisible())return {buffer:y$K.createBuffer(0),origin:[0,0,0]};const{indices:i,positions:s}=n.intersectionGeometry,a=n.components.offsets,c=A$S.createBuffer(s.count);e$1t(c.position,s),r$1d(c.position,c.position,n.transform.rotationScale),this._setComponentIndices(c.componentIndex,i,a);const m=c.count,l=this._computeVisibilityIndices(i,r,a,m);return {origin:t$12(n.transform.position),buffer:await t.extractComponentsEdgeLocations({indices:l,indicesLength:l.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},o)}}_setComponentIndices(e,t,o){let n=0;for(let r=0;r<o.length-1;r++){const i=o[r],s=o[r+1];for(let o=i;o<s;o++){const r=t?t[o]:o;e.set(r,n);}n++;}}_computeVisibilityIndices(e,t,o,n){if(e&&t.allVisible())return e;let r=0;t.forEachComponentRange(((e,t)=>(r+=o[t]-o[e],!0)));const i=2===e?.BYTES_PER_ELEMENT||n<=65536?new Uint16Array(r):new Uint32Array(r);let s=0;return t.forEachComponentRange(((t,n)=>{const r=o[t],a=o[n];for(let o=r;o<a;o++)i[s++]=e?e[o]:o;return !0})),i}addComponentHighlight(e,o){const n=e.components;t$V(n.highlightCounts)&&(n.highlightCounts=new Uint32Array(n.count+1));0===n.highlightCounts[o]++&&(n.highlightsDirty(),this._notifyDirty()),n.highlightCounts[n.count]++;}removeComponentHighlight(e,o){const n=e.components;if(t$V(n.highlightCounts))return void K$1.warn("Removing non-existing highlight.");const r=n.highlightCounts[o],i=n.highlightCounts[n.count];if(0!==r){if(r>1)return n.highlightCounts[o]=r-1,void(n.highlightCounts[n.count]=i-1);n.highlightCounts[o]=0,n.highlightsDirty(),this._notifyDirty(),1===i?n.highlightCounts=null:n.highlightCounts[n.count]=i-1;}else K$1.warn("Removing non-existing highlight.");}clearHighlights(e){const t=e.components;r$W(t.highlightCounts)&&(t.highlightCounts=null,t.highlightsDirty(),this._notifyDirty());}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[t$7.Visible]}_createRenderable(e,t){const i=this._renderManager.rctx,s=e.geometry,a=s.vertices.layoutParameters,c=c$13.createVertex(i,F$r.STATIC_DRAW,s.vertices.data),m=o$1m(s.indices,(e=>c$13.createIndex(i,F$r.STATIC_DRAW,e))),l=o$13(o$9(a)),f=new Uint16Array(s.vertices.count);for(let n=0;n<t.count;n++){const e=t.offsets[n],r=t.offsets[n+1],i=t.materialDataIndices[n];if(r$W(s.indices))for(let t=e;t<r;t++){f[s.indices[t]]=i;}else for(let t=e;t<r;t++)f[t]=i;}const p=c$13.createVertex(i,F$r.STATIC_DRAW,f.buffer),h=new _$2(e.transform,e.toMapSpace),u=new f$U(i,h.attributeLocations,{data:l,componentIndices:Z},{data:c,componentIndices:p},e$X(m)),b=new o$a(u,E$F.TRIANGLES,a,r$W(m)),g={cameraDepthSquared:.5,gpuMemoryEstimate:c.byteSize+p.byteSize+(r$W(m)?m.byteSize:0)};return new s$a(h,b,g)}_notifyDirty(){this._renderManager.notifyDirty();}}const Z=o$13(T$C().u16(O$J.COMPONENTINDEX));function $(e,t){return e===t?W$1.All:0===e?W$1.None:W$1.Some}const ee=e$1u(),te=n$16(),oe$2=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class d$7 extends t$Y{constructor(){super(...arguments),this.overlayIndex=0,this.opacity=1;}}function u$a(t){const d=new i$_;d.include(o$M);const u=d.fragment;switch(t.function){case n$B.Standard:u.uniforms.add(new c$11("tex",(e=>e.texture))),t.hasOpacityFactor?(u.uniforms.add(new o$_("opacity",(e=>e.opacity))),u.code.add(n$19`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):u.code.add(n$19`void main() {
gl_FragColor = texture2D(tex, uv);
}`);break;case n$B.OverlayWithTransparency:u.uniforms.add(new c$11("tex",(e=>e.texture))),u.uniforms.add(new e$1n("overlayIdx",(e=>e.overlayIndex))),t.hasOpacityFactor&&u.uniforms.add(new o$_("opacity",(e=>e.opacity))),u.code.add(n$19`
        void main() {
          vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
          gl_FragColor = texture2D(tex, overlayUV) ${t.hasOpacityFactor?"* opacity":""};
        }`);break;case n$B.TransparentToHUDVisibility:u.uniforms.add(new c$11("tex",(e=>e.texture))),u.code.add(n$19`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);break;case n$B.Transparency:u.uniforms.add([new c$11("colorTexture",(e=>e.colorTexture)),new c$11("alphaTexture",(e=>e.alphaTexture)),new c$11("frontFaceTexture",(e=>e.frontFaceTexture))]),u.code.add(n$19`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);break;case n$B.COUNT:break;default:n$1i(t.function);}return d}const l$4=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:d$7,build:u$a},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class g$8 extends e$11{initializeProgram(r){const i=g$8.shader.get().build(this.configuration);return new o$Z(r.rctx,i,E$E)}initializePipeline(){if(this.configuration.function===n$B.TransparentToHUDVisibility)return W$h({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case o$r.None:return W$h({colorWrite:c$10});case o$r.Alpha:return W$h({blending:l$P(R$u.SRC_ALPHA,R$u.ONE,R$u.ONE_MINUS_SRC_ALPHA,R$u.ONE_MINUS_SRC_ALPHA),colorWrite:c$10});default:return W$h({blending:s$1e(R$u.ONE,R$u.ONE_MINUS_SRC_ALPHA),colorWrite:c$10})}}}g$8.shader=new t$W(l$4,(()=>import('./Compositing.glsl-d2bb939d.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class _$1{constructor(s,t){this._rctx=s,this._techniqueRepository=t,this._configuration=new i$s,this._passParameters=new d$7;}dispose(){this._vao=s$1a(this._vao);}compositeTransparent(s,t,i,r,e=1){this._configuration.alphaMode=o$r.Alpha,this._configuration.function=n$B.Transparency,this._configuration.hasOpacityFactor=1!==e,this._passParameters.colorTexture=t,this._passParameters.alphaTexture=i,this._passParameters.frontFaceTexture=r;const o=this._rctx,_=this._techniqueRepository.acquire(g$8,this._configuration);o.bindTechnique(_,this._passParameters,s);const m=this._ensureVAO();o.bindVAO(m),o.drawArrays(E$F.TRIANGLE_STRIP,0,n$1d(m,"geometry")),_.release();}composite(s,t,r=o$r.None,e=1,o=n$B.Standard,_=T$p.INNER){const m=this._rctx;this._configuration.alphaMode=r,this._configuration.function=o,this._configuration.hasOpacityFactor=1!==e,this._passParameters.overlayIndex=_,this._passParameters.texture=t,this._passParameters.opacity=e;const u=this._techniqueRepository.acquire(g$8,this._configuration);m.bindTechnique(u,this._passParameters,s);const f=this._ensureVAO();m.bindVAO(f),m.drawArrays(E$F.TRIANGLE_STRIP,0,n$1d(f,"geometry")),u.release();}_ensureVAO(){return t$V(this._vao)&&(this._vao=u$V(this._rctx)),this._vao}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const R$2=1e4,B$2=100,v$3=500,j$2=500,C$1=.1;function A$2(t,r,i){return r$1m(r,t)*(i[1]-i[0])+i[0]}function M$1(e,t,r){if(t.size<R$2)return K.compute(e,t);const i=n$b();return r.forAll((t=>{t.isVisible&&t$5(i,O$1(e,t));})),i}function O$1(e,r){if(!r.isVisible)return;const i=n$b(),n=r.getSpatialQueryAccelerator();return r$W(n)?T$4(i,e,n):D$1(i,e,r.objects),i}function T$4(e,t,r){const i=t.eye,n=t.viewForward,s=t.frustum,a=e=>e.isVisible,o=r.objectCount;if(o<v$3)a$e(W,t.near,Math.min(e.near,t.far)),r.forEachInDepthRange(i,n,G$q.DepthOrder.FRONT_TO_BACK,W,((r,i)=>{S$1(e,t,r),W.far=e.near,i.setRange(W);}),s,a),a$e(W,Math.max(e.far,t.near),t.far),r.forEachInDepthRange(i,n,G$q.DepthOrder.BACK_TO_FRONT,W,((r,i)=>{S$1(e,t,r),W.near=e.far,i.setRange(W);}),s,a);else {const i=Math.max(Math.min(o,j$2),Math.ceil(o*C$1)),h=r.findClosest(n,G$q.DepthOrder.FRONT_TO_BACK,s,a,i),f=r.findClosest(n,G$q.DepthOrder.BACK_TO_FRONT,s,a,i);h&&f&&(F$1(e,t,h.boundingVolumeWorldSpace.bounds),F$1(e,t,f.boundingVolumeWorldSpace.bounds));}}function D$1(e,t,r){k$1.clear(),r.forAll((e=>{e.isVisible&&0!==e.geometryRecords.length&&k$1.add(e);})),k$1.empty||(k$1.sort(t),a$e(W,t.near,Math.min(e.near,t.far)),k$1.forEachInDepthRange(W,G$q.DepthOrder.FRONT_TO_BACK,((r,i)=>{i<e.near&&S$1(e,t,r);})),a$e(W,Math.max(e.far,t.near),t.far),k$1.forEachInDepthRange(W,G$q.DepthOrder.BACK_TO_FRONT,((t,r,i)=>{e.far=Math.max(e.far,i);})));}function S$1(e,t,r){if(!r.isVisible)return;if(!P$z(t.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,s=E$4;r.geometryRecords.forEach((r=>{u$Z(s,i,r.getShaderTransformation());const a=l$10(s);y$3(e,t,r.geometry.boundingInfo,s,a);}));}function y$3(e,t,i,n,s){if(t$V(i))return;const a=t.eye,h=t.viewForward;L$E(V$1,i.center,n);const f=h[0]*(V$1[0]-a[0])+h[1]*(V$1[1]-a[1])+h[2]*(V$1[2]-a[2]);if(V$1[3]=i.radius*s,!(f-V$1[3]>e.near&&f+V$1[3]<e.far)&&P$z(t.frustum,V$1))if(i.radius>B$2&&i.getChildren()){const r=i.getChildren();for(let i=0;i<8;++i)r[i]&&y$3(e,t,r[i],n,s);}else U$1.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,n,i.bbMin,i.bbMax);}function F$1(e,t,r){const i=t.eye,n=t.viewForward,s=(r[0]-i[0])*n[0]+(r[1]-i[1])*n[1]+(r[2]-i[2])*n[2];e.near=Math.min(e.near,s-r[3]),e.far=Math.max(e.far,s+r[3]);}class I$3{constructor(){this._items=new n$1l({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)});}get length(){return this._items.length}get empty(){return 0===this._items.length}clear(){this._items.clear();}add(e){this._items.pushNew().obj=e;}sort(e){const t=e.eye,r=e.viewForward;this._items.forAll((e=>{const i=e.obj.boundingVolumeWorldSpace.bounds,n=(i[0]-t[0])*r[0]+(i[1]-t[1])*r[1]+(i[2]-t[2])*r[2];e.distance=n,e.near=n-i[3],e.far=n+i[3];})),this._items.sort(((e,t)=>e.distance-t.distance));}forEachInDepthRange(e,t,r){if(t===G$q.DepthOrder.FRONT_TO_BACK)for(let i=0;i<this._items.length;++i){const t=this._items.data[i];t.far<e.near||t.near>e.far||r(t.obj,t.near,t.far);}else for(let i=this._items.length-1;i>=0;--i){const t=this._items.data[i];t.far<e.near||t.near>e.far||r(t.obj,t.near,t.far);}}}class P$1{constructor(){this.view=e$10(),this.viewProj=e$10(),this.frustum=H$o(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0};}compute(e,t){this._reset(),n$15(this.view,e.viewMatrix),u$Z(this.viewProj,e.projectionMatrix,this.view),i$11(this.frustum,e.frustum);const r=this.view,i=r[2],a=r[6],o=r[10],h=r[14],f=this.range;let c=0;if(t.forEach((e=>{if(!e.instanceParameters.visible)return;if(!e.castShadow)return;let t;e.hasShaderTransformation?(e.computeBoundingSphere(e.getShaderTransformation(),V$1,1),t=V$1):t=e.boundingSphere;const r=i*t[0]+a*t[1]+o*t[2]+h,n=r-t[3],s=r+t[3];this.geometries[c]=e,this.near[c]=-s,this.far[c]=-n,++c;})),0===this.geometries.length)return f;for(let n=0;n<this.geometries.length;++n)this.near[n]>f.far&&(f.far=this.near[n]),this.near[n]>2&&this.far[n]<f.near&&(f.near=this.far[n]);const l=this.looseRange;l.near=Math.max(.5*f.near,2),l.far=2*f.far;let d=0,g=0;for(let n=0;n<this.geometries.length;++n)this.near[n]<f.near&&(this.near[n]>=l.near?f.near=this.near[n]:this.nearCandidates[d++]=n),this.far[n]>f.far&&(this.far[n]<=l.far?f.far=this.far[n]:this.farCandidates[g++]=n);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return f;this.nearCandidates.sort(((e,t)=>this.near[e]<this.near[t]?-1:this.near[e]>this.near[t]?1:0)),this.farCandidates.sort(((e,t)=>this.far[e]<this.far[t]?1:this.far[e]>this.far[t]?-1:0));for(let n=0;n<this.nearCandidates.length;++n){const e=this.nearCandidates[n];if(this.near[e]<f.near){const t=this.geometries[e],r=t.boundingInfo;this._includeNearBoundingInfoRec(r,t.getShaderTransformation());}}for(let n=0;n<this.farCandidates.length;++n){const e=this.farCandidates[n];if(this.far[e]>f.far){const t=this.geometries[e],r=t.boundingInfo;this._includeFarBoundingInfoRec(r,t.getShaderTransformation());}}return f}_reset(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE;}_includeNearBoundingInfoRec(e,t){if(t$V(e))return;const i=e.getCenter();L$E(V$1,i,t);const n=l$10(t),s=V$1[0],a=V$1[1],h=V$1[2],f=e.getBSRadius()*n,c=this.frustum;if(c[0][0]*s+c[0][1]*a+c[0][2]*h+c[0][3]>f||c[1][0]*s+c[1][1]*a+c[1][2]*h+c[1][3]>f||c[2][0]*s+c[2][1]*a+c[2][2]*h+c[2][3]>f||c[3][0]*s+c[3][1]*a+c[3][2]*h+c[3][3]>f)return;const l=this.view[2]*s+this.view[6]*a+this.view[10]*h+this.view[14],u=l+f;if(!(-(l-f)<2||-u>=this.range.near))if(-u>this.looseRange.near)this.range.near=-u;else {if(f>B$2){const r=e.getChildren();if(void 0!==r){for(let e=0;e<8;++e)void 0!==r[e]&&this._includeNearBoundingInfoRec(r[e],t);return}}U$1.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax());}}_includeFarBoundingInfoRec(e,t){if(t$V(e))return;let i=e.getBSRadius();const n=e.getCenter();L$E(V$1,n,t);const s=l$10(t),a=V$1[0],h=V$1[1],f=V$1[2];i*=s;const c=this.frustum;if(c[0][0]*a+c[0][1]*h+c[0][2]*f+c[0][3]>i||c[1][0]*a+c[1][1]*h+c[1][2]*f+c[1][3]>i||c[2][0]*a+c[2][1]*h+c[2][2]*f+c[2][3]>i||c[3][0]*a+c[3][1]*h+c[3][2]*f+c[3][3]>i)return;const l=this.view[2]*a+this.view[6]*h+this.view[10]*f+this.view[14]-i;if(!(-l<=this.range.far))if(-l<this.looseRange.far)this.range.far=-l;else {if(i>B$2){const r=e.getChildren();if(void 0!==r){for(let e=0;e<8;++e)void 0!==r[e]&&this._includeFarBoundingInfoRec(r[e],t);return}}U$1.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax());}}}class x$4{constructor(){this.modelViewProj=e$10(),this.clipPosition=[n$1a(),n$1a(),n$1a(),n$1a(),n$1a(),n$1a(),n$1a(),n$1a()];}unionDepthRangeWithAABB(e,t,r,i,s){const a=this.modelViewProj;u$Z(a,t,r);let o=!1;for(let n=0;n<8;++n){const e=this.clipPosition[n],t=0===n||3===n||4===n||7===n?i[0]:s[0],r=0===n||1===n||4===n||5===n?i[1]:s[1],o=n<4?i[2]:s[2];e[0]=a[0]*t+a[4]*r+a[8]*o+a[12],e[1]=a[1]*t+a[5]*r+a[9]*o+a[13],e[2]=a[2]*t+a[6]*r+a[10]*o+a[14],e[3]=a[3]*t+a[7]*r+a[11]*o+a[15];}for(let n=0;n<12;++n){const t=this.clipPosition[N$3[n][0]],r=this.clipPosition[N$3[n][1]],i=this.clipPosition[N$3[n][2]],s=this._clipTriangle(t,r,i);let a=!0;for(let e=0;e<s.length;++e){if(s[e][3]>=2){a=!1;break}}if(!a){o=!0;for(let t=0;t<s.length;++t){const r=s[t][3];r<e.near&&(e.near=r),r>e.far&&(e.far=r);}}}return o}_inside(e,t){return 0===t?e[0]>=-e[3]:1===t?e[1]>=-e[3]:2===t?e[0]<=e[3]:3===t?e[1]<=e[3]:void e$18(!1)}_intersect(e,t,r){let i=0;return 0===r?i=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):1===r?i=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):2===r?i=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):3===r&&(i=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),j$S(n$1a(),e,t,i)}_clipTriangle(e,t,r){let i=[e,t,r];for(let n=0;n<4;++n){const e=i;i=[];for(let t=0;t<e.length;++t){const r=e[t],s=e[(t+1)%e.length];this._inside(s,n)?(this._inside(r,n)||i.push(this._intersect(r,s,n)),i.push(s)):this._inside(r,n)&&i.push(this._intersect(r,s,n));}}return i}}const N$3=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],V$1=_$x(),E$4=e$10(),W=n$b(),k$1=new I$3,K=new P$1,U$1=new x$4;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class d$6 extends t$Y{constructor(){super(...arguments),this.maskEnabled=!1,this.overlayEnabled=!1;}}function i$8(){const o=new i$_;return o.attributes.add(O$J.POSITION,"vec2"),o.vertex.uniforms.add(new o$P("drawPosition")),o.varyings.add("vUV","vec2"),o.vertex.code.add(n$19`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),o.fragment.uniforms.add(new s$10("textureInput")),o.fragment.uniforms.add(new s$10("textureMask")),o.fragment.uniforms.add(new s$10("textureOverlay")),o.fragment.uniforms.add(new s$1d("maskEnabled",(e=>e.maskEnabled))),o.fragment.uniforms.add(new s$1d("overlayEnabled",(e=>e.overlayEnabled))),o.fragment.code.add(n$19`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),o}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let N$2=class extends y$F{constructor(){super(...arguments),this._handles=new u$U,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new d$6,this.events=new n$17,this.attributeLocations=new Map([[O$J.POSITION,0]]),this.tmpScreenPoint=i$12(),this.tmpRenderPoint=s$1w();}get updating(){return t$V(this._imageSources)&&r$W(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const s=()=>{this._updateResourceLoading(),this.events.emit("request-render");};r$W(this._magnifier)&&this._handles.add(l$M((()=>o$1m(this._magnifier,(e=>e.version))),s)),s();}get enabled(){return r$W(this._validMagnifier)}get _validMagnifier(){return r$W(this._magnifier)&&this._magnifier.visible&&r$W(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get factor(){return r$W(this._magnifier)&&this._magnifier.factor||1}dispose(){this._magnifier=null,this._handles.destroy(),r$W(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources();}render(e,s){const r=this._validMagnifier;if(t$V(r))return;const t=s.camera.pixelRatio,o=Math.ceil(t*r.size);if(this._updateResources(e,o),t$V(this._resources))return;this._passParameters.maskEnabled=r.maskEnabled,this._passParameters.overlayEnabled=r.overlayEnabled;const n=this._resources.program;e.useProgram(n),n.bindPass(this._passParameters,s);const m=this._resources.textures,u=Math.ceil(1/this.factor*o);m.input.resize(u,u);const l=s.camera.fullWidth,p=s.camera.fullHeight;d$V(r.position,this.tmpScreenPoint);const c=s.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint),_=.5*u,d=.5*u;c[0]=o$X(c[0],_,l-_-1),c[1]=o$X(c[1],d,p-d-1);const g=Math.floor(c[0]-_),f=Math.floor(c[1]-d);n.bindTexture("textureInput",m.input),e.gl.copyTexImage2D(m.input.descriptor.target,0,m.input.descriptor.pixelFormat,g,f,u,u,0);const T=r.offset.x*t,v=r.offset.y*t,y=(c[0]+T)/l*2-1,k=(c[1]-v)/p*2-1,R=o/l*2,L=o/p*2;e.bindVAO(this._resources.vao),n.bindTexture("textureOverlay",m.overlay),n.bindTexture("textureMask",m.mask),n.setUniform4f("drawPosition",y,k,R,L),e.setPipelineState(this._resources.pipelineState),e.drawArrays(E$F.TRIANGLE_STRIP,0,4);}_updateResourceLoading(){const e=this._validMagnifier;if(t$V(e))return;const s=e.maskUrl,r=e.overlayUrl;!r$W(this._imageLoadTask)||this._imageLoadTask.maskUrl===s&&this._imageLoadTask.overlayUrl===r||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),r$W(this._imageSources)||r$W(this._imageLoadTask)||(this._imageLoadTask={maskUrl:s,overlayUrl:r,task:O$I((async e=>{const t=t$V(s)||t$V(r)?s$1x(e):null,i=r$W(s)?t$10(s,{signal:e}):t.then((e=>e.mask)),n=r$W(r)?t$10(r,{signal:e}):t.then((e=>e.overlay));this._imageSources={mask:await i,overlay:await n},this._disposeResources(),this.events.emit("request-render");}))},this._imageLoadTask.task.promise.then((()=>this.notifyChange("updating")),(()=>this.notifyChange("updating"))));}_updateResources(e,s){if(!this.enabled)return void this._disposeResources();if(r$W(this._resources)){if(this._resources.textures.size!==s){const r=this._createTextureResources(e,s);if(t$V(r))return void this._disposeResources();this._disposeTextureResources(this._resources.textures),this._resources.textures=r;}return}const r=this._createTextureResources(e,s);t$V(r)||(this._resources={textures:r,program:this._createProgram(e),vao:u$V(e,t$1s,this.attributeLocations,0,1),pipelineState:W$h({blending:s$1e(R$u.ONE,R$u.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:c$10})});}_disposeResources(){t$V(this._resources)||(this._disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null);}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose();}_createTextureResources(e,s){if(t$V(this._imageSources))return null;this._imageSources.overlay.width=s,this._imageSources.overlay.height=s,this._imageSources.mask.width=s,this._imageSources.mask.height=s;const r=new u$X(e,{target:M$v.TEXTURE_2D,pixelFormat:P$w.RGBA,internalFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,wrapMode:D$q.CLAMP_TO_EDGE,samplingMode:L$C.LINEAR,flipped:!0,preMultiplyAlpha:!It$1(this._imageSources.overlay.src)||!e.driverTest.svgAlwaysPremultipliesAlpha},this._imageSources.overlay),t=new u$X(e,{target:M$v.TEXTURE_2D,pixelFormat:P$w.ALPHA,internalFormat:P$w.ALPHA,dataType:G$m.UNSIGNED_BYTE,wrapMode:D$q.CLAMP_TO_EDGE,samplingMode:L$C.LINEAR,flipped:!0},this._imageSources.mask);return {input:new u$X(e,{target:M$v.TEXTURE_2D,pixelFormat:P$w.RGBA,internalFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,wrapMode:D$q.CLAMP_TO_EDGE,samplingMode:L$C.LINEAR,flipped:!1}),mask:t,overlay:r,size:s}}_createProgram(e){return new o$Z(e,i$8(),this.attributeLocations)}};e$Y([d$R()],N$2.prototype,"_imageSources",void 0),e$Y([d$R()],N$2.prototype,"_imageLoadTask",void 0),e$Y([d$R({readOnly:!0})],N$2.prototype,"updating",null),N$2=e$Y([n$18("esri/views/3d/webgl-engine/lib/MagnifierHelper")],N$2);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const e$6=.5,r$7=n$1e(1e3/30);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var s$6;!function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront";}(s$6||(s$6={}));class o$7{constructor(e,r,i=s$6.FrontToBack){this._rctx=e,this._techniqueRepository=r,this._sorting=i,this._draws=new n$1l({initialSize:32,allocator:e=>e||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map;}submitDraw(t,r,i,s){const o=this._draws.pushNew();o.geometry=r,o.geometryRanges=i,o.material=t,o.depthSquaredHint=s,o.indexType=r.indexed?e$X(r.vao.indexBuffer).indexType:0;}dispatch(e,t){const i=this._rctx;this._previouslyBoundDraw.clear();let s=null;const o=this._draws.map((r=>r.material.prepareTechnique(this._techniqueRepository,e,t,r.geometry.parameters))),n=this._draws.length;for(let c=0;c<n;c++){const n=o[c];n===s&&n.configuration.transparencyPassType===O$L.NONE||(i.bindTechnique(n,e,t),s=n);const d=this._draws.data[c],l=d.geometry;i.bindVAO(l.vao),this._previouslyBoundDraw.get(n)!==d.material&&(n.bindDraw(d.material,t),this._previouslyBoundDraw.set(n,d.material));const p=d.geometryRanges,m=p.length;if(0!==d.indexType){const e=a$a.get(d.indexType);for(let t=0;t<m;t+=2){const r=p[t],s=p[t+1];i.drawElements(l.primitiveType,s,d.indexType,r*e);}}else for(let e=0;e<m;e+=2){const t=p[e],r=p[e+1];i.drawArrays(l.primitiveType,t,r);}}}prepareSubmit(){this._draws.clear();}finishSubmit(){const e=this._sorting===s$6.FrontToBack?1:-1;this._draws.sort(((t,r)=>{const i=e*(t.depthSquaredHint-r.depthSquaredHint);return 0!==i?i:t.geometry.vao.size-r.geometry.vao.size}));}get count(){return this._draws.length}}const a$a=new Map;a$a.set(C$B.UNSIGNED_BYTE,1),a$a.set(C$B.UNSIGNED_SHORT,2),a$a.set(C$B.UNSIGNED_INT,4);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class M{constructor(s,a){this.rctx=s,this.shaderTechniqueRepository=a,this.canRender=!0,this._materialPassParameters=new l$8,this._shadowPassParameters=new n$h,this._highlightPassParameters=new h$8,this._systems=new Set,this._passes={materialOpaque:new o$7(s,a),materialTransparent:new o$7(s,a,s$6.BackToFront),materialIntegratedMesh:new o$7(s,a),shadowMap:new o$7(s,a),highlight:new o$7(s,a),highlightIntegratedMesh:new o$7(s,a),highlightShadowMap:new o$7(s,a),defaultShadowMap:new o$7(s,a)};}register(s){this._systems.add(s);}prepareRender(s){if(0!==this._systems.size){for(const s of Object.values(this._passes))s.prepareSubmit();this._systems.forEach((a=>a.submit(this._passes,s.bindParameters)));for(const s of Object.values(this._passes))s.finishSubmit();this.shaderTechniqueRepository.frameUpdate();}}render(s){if(0!==this._systems.size)switch(this._configure(s),s.bindParameters.slot){case E$G.OPAQUE_MATERIAL:switch(s.pass){case A$D.MATERIAL:return this._materialPassParameters.subPass=o$d.Color,this._passes.materialOpaque.dispatch(this._materialPassParameters,s.bindParameters);case A$D.MATERIAL_DEPTH:return this._materialPassParameters.subPass=o$d.Depth,this._passes.materialOpaque.dispatch(this._materialPassParameters,s.bindParameters);case A$D.MATERIAL_NORMAL:return this._materialPassParameters.subPass=o$d.Normal,this._passes.materialOpaque.dispatch(this._materialPassParameters,s.bindParameters);case A$D.MATERIAL_HIGHLIGHT:return this._passes.highlight.dispatch(this._highlightPassParameters,s.bindParameters);case A$D.MATERIAL_DEPTH_SHADOWMAP_ALL:return this._passes.shadowMap.dispatch(this._shadowPassParameters,s.bindParameters);case A$D.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,s.bindParameters);case A$D.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,s.bindParameters)}return;case E$G.TRANSPARENT_MATERIAL:switch(s.pass){case A$D.MATERIAL:return this._materialPassParameters.subPass=o$d.Color,this._passes.materialTransparent.dispatch(this._materialPassParameters,s.bindParameters);case A$D.MATERIAL_ALPHA:return this._materialPassParameters.subPass=o$d.Alpha,this._passes.materialTransparent.dispatch(this._materialPassParameters,s.bindParameters);case A$D.MATERIAL_DEPTH:return this._materialPassParameters.subPass=o$d.Depth,this._passes.materialTransparent.dispatch(this._materialPassParameters,s.bindParameters);case A$D.MATERIAL_NORMAL:return this._materialPassParameters.subPass=o$d.Normal,this._passes.materialTransparent.dispatch(this._materialPassParameters,s.bindParameters)}return;case E$G.INTEGRATED_MESH:switch(s.pass){case A$D.MATERIAL:return this._materialPassParameters.subPass=o$d.Color,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,s.bindParameters);case A$D.MATERIAL_DEPTH:return this._materialPassParameters.subPass=o$d.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,s.bindParameters);case A$D.MATERIAL_NORMAL:return this._materialPassParameters.subPass=o$d.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,s.bindParameters);case A$D.MATERIAL_HIGHLIGHT:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,s.bindParameters)}return}}notifyDirty(){this._context.requestRender();}slots(){return [E$G.OPAQUE_MATERIAL,E$G.TRANSPARENT_MATERIAL,E$G.INTEGRATED_MESH]}initializeRenderContext(s){this._context=s;}uninitializeRenderContext(){}queryDepthRange(a){const e={near:1/0,far:-1/0};return this._systems.forEach((t=>{const r=t.queryShadowCasterDepthRange(a);r$W(r)&&t$5(e,r,e);})),e}_configure(s){const a=s.pass===A$D.MATERIAL_DEPTH_SHADOWMAP_ALL||s.pass===A$D.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||s.pass===A$D.MATERIAL_DEPTH_SHADOWMAP_DEFAULT?this._shadowPassParameters:s.pass===A$D.MATERIAL_HIGHLIGHT?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(s,a);}_updateParameters(s,r){const n=s.bindParameters.camera,P=n.viewInverseTransposeMatrix;o$W(E$3,P[3],P[7],P[11]),g$7.set(E$3),r$V(r.transformWorldFromViewTH,g$7.high),r$V(r.transformWorldFromViewTL,g$7.low),r$V(r.slicePlaneLocalOrigin,E$3),a$13(r.transformViewFromCameraRelativeRS,n.viewMatrix),n$15(r.transformProjFromView,n.projectionMatrix),r.identifier===a$i.Material&&(this._materialPassParameters.transparent=s.bindParameters.slot===E$G.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=s.bindParameters.slot===E$G.INTEGRATED_MESH,o$14(I$2,r.transformViewFromCameraRelativeRS),u$18(r.transformNormalViewFromGlobal,I$2));}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}}const E$3=n$16(),I$2=e$16(),g$7=new c$8;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const a$9=8.6,s$5=.4;function u$9(){const o=new i$_,{vertex:u,fragment:c}=o,f=u.code,g=c.code;return o.attributes.add(O$J.POSITION,"vec2"),o.varyings.add("uv","vec2"),o.attributes.add(O$J.UV0,"vec2"),u.uniforms.add(new c$11("coverageTex",(e=>e.coverageTexture))),f.add(n$19`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),c.uniforms.add(new c$11("tex",(e=>e.blurColorTexture))),c.uniforms.add(new c$11("origin",(e=>e.highlightColorTexture))),c.uniforms.add(new e$19("uColor",(e=>e.color))),c.uniforms.add(new e$19("haloColor",(e=>e.haloColor))),c.uniforms.add(new e$19("opacities",(o=>r$17(d$5,o.haloOpacity,o.haloOpacityOccluded,o.fillOpacity,o.fillOpacityOccluded)))),c.constants.add("outlineSize","float",a$9),c.constants.add("blurSize","float",s$5),g.add(n$19`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),o}const d$5=n$1a(),c$7=Object.freeze(Object.defineProperty({__proto__:null,build:u$9},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class a$8 extends e$11{initializeProgram(e){const r=a$8.shader.get().build();return new o$Z(e.rctx,r,E$E)}initializePipeline(){return W$h({blending:l$P(R$u.SRC_ALPHA,R$u.ONE,R$u.ONE_MINUS_SRC_ALPHA,R$u.ONE_MINUS_SRC_ALPHA),colorWrite:c$10})}}a$8.shader=new t$W(c$7,(()=>import('./HighlightApply.glsl-6d22e443.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class a$7 extends t$Y{constructor(){super(...arguments),this.blurSize=n$1b();}}function d$4(){const e=new i$_,{vertex:o,fragment:a}=e,d=o.code,l=a.code;return e.attributes.add(O$J.POSITION,"vec2"),e.attributes.add(O$J.UV0,"vec2"),e.varyings.add("blurCoordinate","vec3"),o.uniforms.add(new c$11("coverageTex",(e=>e.coverageTexture))),a.uniforms.add(new o$1x("blurSize",(e=>e.blurSize))),d.add(n$19`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),a.uniforms.add(new c$1q("tex",(e=>e.blurInputTexture))),l.add(n$19`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),e}const l$3=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:a$7,build:d$4},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class a$6 extends e$11{initializeProgram(r){const e=a$6.shader.get().build();return new o$Z(r.rctx,e,E$E)}initializePipeline(){return W$h({colorWrite:c$10})}}a$6.shader=new t$W(l$3,(()=>import('./HighlightBlur.glsl-0428d62a.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$4 extends t$Y{constructor(){super(...arguments),this.invFramebufferDim=n$1b();}}function d$3(){const e=new i$_,{vertex:o,fragment:s}=e,d=o.code,m=s.code;return e.attributes.add(O$J.POSITION,"vec2"),d.add(n$19`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),s.uniforms.add(new c$1q("tex",(e=>e.inputTexture))),s.uniforms.add(new o$1x("invFramebufferDim",(e=>e.invFramebufferDim))),m.add(n$19`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),e}const m$9=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:s$4,build:d$3},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class a$5 extends e$11{initializeProgram(e){const r=a$5.shader.get().build();return new o$Z(e.rctx,r,E$E)}initializePipeline(){return W$h({colorWrite:c$10})}}a$5.shader=new t$W(m$9,(()=>import('./HighlightDownsample.glsl-14fa6272.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class c$6 extends t$Y{constructor(){super(...arguments),this.color=r$1e(1,0,1,1),this.haloColor=r$1e(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=r$Z(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const D=32;class O{constructor(e,t){this._techniqueRep=e,this._rctx=t,this.viewportToRestore=n$1a(),this._passParameters=new c$6,this._downsampleDrawParameters=new s$4,this._blurDrawParameters=new a$7,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};}_assertResources(){if(this.quadVAO)return;this.quadVAO=u$V(this._rctx);const e={colorTarget:Y$d.TEXTURE,depthStencilTarget:V$q.NONE,width:0,height:0},t={target:M$v.TEXTURE_2D,pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,samplingMode:L$C.LINEAR,wrapMode:D$q.CLAMP_TO_EDGE,width:0,height:0};this.blur0Fbo=new D$p(this._rctx,e,t),this.blur1Fbo=new D$p(this._rctx,e,t);const i=new t$X;this._blurTechnique=this._techniqueRep.acquire(a$6,i),this._downsampleTechnique=this._techniqueRep.acquire(a$5,i),this._applyTechnique=this._techniqueRep.acquire(a$8,i);}dispose(){if(this._blurTechnique=p$X(this._blurTechnique),this._downsampleTechnique=p$X(this._downsampleTechnique),this._applyTechnique=p$X(this._applyTechnique),this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null),this.blur0Fbo=s$1a(this.blur0Fbo),this.blur1Fbo=s$1a(this.blur1Fbo);}setDefaultOptions(e){this._passParameters={...new c$6,...e};}render(e,t,i){this._passParameters.highlightColorTexture=t.colorTexture,this._assertResources();const a=e.camera;a$15(this.viewportToRestore,a.fullViewport);const o=a.fullWidth,h=a.fullHeight,l=a.pixelRatio,p=Math.ceil(o/l),u=Math.ceil(h/l);this.blur0Fbo.resize(p,u),this.blur1Fbo.resize(p,u);const m=this._rctx;m.bindVAO(this.quadVAO);let c=null;this._gridUpdateResources(t,D),this._gridComputeMipmap(e),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,c=this._grid.vao;const n=m.bindTechnique(this._blurTechnique,this._passParameters,e);m.bindVAO(c),m.bindFramebuffer(this.blur0Fbo),m.setViewport(0,0,p,u),m.setClearColor(0,0,0,0),m.clear(_$z.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=t.colorTexture,r$Y(this._blurDrawParameters.blurSize,1/p,0),n.bindDraw(this._blurDrawParameters,e),m.drawArrays(this._blurTechnique.primitiveType,0,n$1d(c,"geometry")),m.bindFramebuffer(this.blur1Fbo),m.clear(_$z.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this.blur0Fbo.colorTexture,r$Y(this._blurDrawParameters.blurSize,0,1/u),n.bindDraw(this._blurDrawParameters,e),m.drawArrays(this._blurTechnique.primitiveType,0,n$1d(c,"geometry")),m.bindFramebuffer(i),m.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),this._passParameters.blurColorTexture=this.blur1Fbo.colorTexture,m.bindTechnique(this._applyTechnique,this._passParameters,e),m.drawArrays(this._applyTechnique.primitiveType,0,n$1d(c,"geometry")),m.bindVAO(null);}_gridUpdateResources(e,t){const i=this._rctx,r=this._grid;let s=!1;if(null===r.coverageMipmap&&(r.coverageMipmap=[e],s=!0),r.viewportWidth===e.width&&r.viewportHeight===e.height||(s=!0,r.viewportWidth=e.width,r.viewportHeight=e.height),r.coverageMipmap[0]=e,r.cellPixelSize!==t&&(r.cellPixelSize=t,s=!0),s){for(let e=1;e<r.coverageMipmap.length;e++)r.coverageMipmap[e].dispose();r.mipmapLevels=Math.ceil(Math.log(r.cellPixelSize)*Math.LOG2E),r.coverageMipmap.length=r.mipmapLevels+1;for(let e=0;e<r.mipmapLevels;e++){const t=r.coverageMipmap[e],s={target:M$v.TEXTURE_2D,pixelFormat:P$w.RGB,dataType:G$m.UNSIGNED_SHORT_5_6_5,samplingMode:L$C.LINEAR,wrapMode:D$q.CLAMP_TO_EDGE,width:Math.ceil(t.width/2),height:Math.ceil(t.height/2)},a={colorTarget:Y$d.TEXTURE,depthStencilTarget:V$q.NONE,width:Math.ceil(t.width/2),height:Math.ceil(t.height/2)};r.coverageMipmap[e+1]=new D$p(i,a,s);}}const a=Math.ceil(e.height/r.cellPixelSize),o=Math.ceil(e.width/r.cellPixelSize);if(!r.vao||r.verticalCellCount!==a||r.horizontalCellCount!==o){r.verticalCellCount=a,r.horizontalCellCount=o;const e=a+1,t=o+1,s=1/a,p=1/o,u=6,m=4,c=new Float32Array(u*m*e*t);let n=0;for(let i=0;i<e;i++)for(let e=0;e<t;e++)c[n+0]=(e-.5)*p*2-1,c[n+1]=(i-.5)*s*2-1,c[n+2]=e*p,c[n+3]=i*s,c[n+4]=(e+.5)*p*2-1,c[n+5]=(i-.5)*s*2-1,c[n+6]=e*p,c[n+7]=i*s,c[n+8]=(e-.5)*p*2-1,c[n+9]=(i+.5)*s*2-1,c[n+10]=e*p,c[n+11]=i*s,c[n+12]=(e-.5)*p*2-1,c[n+13]=(i+.5)*s*2-1,c[n+14]=e*p,c[n+15]=i*s,c[n+16]=(e+.5)*p*2-1,c[n+17]=(i-.5)*s*2-1,c[n+18]=e*p,c[n+19]=i*s,c[n+20]=(e+.5)*p*2-1,c[n+21]=(i+.5)*s*2-1,c[n+22]=e*p,c[n+23]=i*s,n+=u*m;r.vao&&r.vao.dispose(!0),r.vao=new f$U(i,E$E,{geometry:A$B},{geometry:c$13.createVertex(i,F$r.STATIC_DRAW,c)});}}_gridComputeMipmap(e){const t=this._rctx,i=this._grid,s=t.bindTechnique(this._downsampleTechnique,this._passParameters,e);t.bindVAO(this.quadVAO);for(let a=0;a<i.mipmapLevels;a++){t.bindFramebuffer(i.coverageMipmap[a+1]);const o=i.coverageMipmap[a+1].width,h=i.coverageMipmap[a+1].height;this._downsampleDrawParameters.inputTexture=i.coverageMipmap[a].colorTexture,r$Y(this._downsampleDrawParameters.invFramebufferDim,1/o,1/h),s.bindDraw(this._downsampleDrawParameters,e),t.setViewport(0,0,o,h),t.drawArrays(E$F.TRIANGLE_STRIP,0,n$1d(this.quadVAO,"geometry"));}}get gpuMemoryUsage(){let e=(r$W(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(r$W(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const t of this._grid.coverageMipmap)e+=t.gpuMemoryUsage;return e}get test(){return {coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const l$2={dataType:G$m.UNSIGNED_BYTE,internalFormat:P$w.RGBA},g$6={};class n$9{constructor(e){this.rctx=e,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=e.capabilities.depthTexture;}dispose(){this._depthBuffers.forEach((e=>e.dispose())),this._depthBuffers.clear(),this._depthTextures.forEach((e=>e.dispose())),this._depthTextures.clear(),this._colorTextures.forEach((e=>e.dispose())),this._colorTextures.clear(),this._framebuffers.forEach((e=>e.dispose())),this._framebuffers.clear(),this._activeTargets.clear();}disposeTargetResource(e){const t=e.id;this._activeTargets.has(t)&&(this._activeTargets.delete(t),this._disposeWithFramebuffers(this._depthTextures,t),this._disposeWithFramebuffers(this._depthBuffers,t),this._disposeWithFramebuffers(this._colorTextures,t));}_disposeWithFramebuffers(e,t){const r=e.get(t);r&&(this._framebuffers.forEach(((e,t)=>{e.colorAttachment!==r&&e.depthStencilAttachment!==r||(e.detachAll(),e.dispose(),this._framebuffers.delete(t));})),r.dispose(),e.delete(t));}getDepthTexture(e,t){if(!this.depthTextureSupported)return null;let d=this._depthTextures.get(e.id);return !d||d.descriptor.width===t.width&&d.descriptor.height===t.height||(d.dispose(),d=null),d||(d=new u$X(this.rctx,{target:M$v.TEXTURE_2D,pixelFormat:P$w.DEPTH_STENCIL,dataType:G$m.UNSIGNED_INT_24_8,samplingMode:L$C.NEAREST,wrapMode:D$q.CLAMP_TO_EDGE,width:t.width,height:t.height}),this._depthTextures.set(e.id,d),this._activeTargets.add(e.id)),d}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getDepthBuffer(e,t){if(this.depthTextureSupported)return null;let r=this._depthBuffers.get(e.id);return r?r.descriptor.width===t.width&&r.descriptor.height===t.height||r.resize(t.width,t.height):(r=new r$1n(this.rctx,{internalFormat:B$x.DEPTH_STENCIL,...t}),this._depthBuffers.set(e.id,r),this._activeTargets.add(e.id)),r}getColorTexture(e,t){let r=this._colorTextures.get(e.id);return r&&(r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=null)),r||(r=new u$X(this.rctx,{target:M$v.TEXTURE_2D,pixelFormat:P$w.RGBA,internalFormat:e.internalFormat,dataType:e.dataType,samplingMode:null!=e.samplingMode?e.samplingMode:L$C.LINEAR,wrapMode:D$q.CLAMP_TO_EDGE,width:t.width,height:t.height}),this._colorTextures.set(e.id,r),this._activeTargets.add(e.id)),r}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return {id:e$1e(),...g$6,...e}}registerColorTarget(e={}){return {id:e$1e(),...l$2,...e}}getFramebuffer(t,r,i){const s=this._getKey(r,i);let h=this._framebuffers.get(s);const o=this.getColorTexture(r,t);if(this.depthTextureSupported){const r=i?this.getDepthTexture(i,t):void 0;if(!h)return h=r$W(i)?new D$p(this.rctx,{colorTarget:Y$d.TEXTURE,depthStencilTarget:V$q.DEPTH_STENCIL_TEXTURE},o,r):new D$p(this.rctx,{colorTarget:Y$d.TEXTURE,depthStencilTarget:V$q.NONE},o),this._framebuffers.set(s,h),h;return (h.width!==t.width||h.height!==t.height||h.colorTexture!==o||h.depthStencilTexture!==r)&&(h.detachAll(),h.resize(t.width,t.height),h.attachColorTexture(o),h.attachDepthStencilTexture(r)),h}const d=i?this.getDepthBuffer(i,t):void 0;if(!h)return h=new D$p(this.rctx,{colorTarget:Y$d.TEXTURE,depthStencilTarget:i?V$q.DEPTH_STENCIL_RENDER_BUFFER:V$q.NONE},o,d),this._framebuffers.set(s,h),h;return (h.width!==t.width||h.height!==t.height||h.colorTexture!==o)&&(h.detachAll(),h.resize(t.width,t.height),h.attachColorTexture(o),h.attachDepthStencilBuffer(d)),h}_getKey(e,t){return `${e.id}_${t?t.id:"X"}_${e.name}${t?"_"+t.name:""}`}get gpuMemoryUsage(){let e=0;const t=new Set,r=r=>{t.has(r)||(t.add(r),e+=u$14(r));};return this._depthTextures.forEach(r),this._colorTextures.forEach(r),this._depthBuffers.forEach(r),e}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class T$3{constructor(e,t){this._rctx=e,this._compositingHelper=t,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._needLastFrameColorTexture=!1,this._background={type:"color",color:[0,0,0,1]};const i=e.type===o$1y.WEBGL2;this._renderTargetHelper=new n$9(e);const o=this._renderTargetHelper;this.mainColorTargets=[o.registerColorTarget({name:"mainColorTarget0"}),o.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=o.registerColorTarget({name:"frontFaceTarget"});const g=e=>o.registerColorTarget({name:e,dataType:G$m.FLOAT,internalFormat:i?U$C.RGBA32F:P$w.RGBA,samplingMode:L$C.NEAREST});this.colorFloatTarget=g("colorFloatTarget"),this.alphaFloatTarget=g("alphaFloatTarget"),this.mainDepth=o.registerDepthTarget({name:"mainDepth"}),this.linearDepth=o.registerColorTarget({name:"linearDepth",samplingMode:L$C.NEAREST}),this.terrainLinearDepth=o.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=o.registerColorTarget({name:"geometryLinearDepth"}),this.normal=o.registerColorTarget({name:"normal"}),this.highlight=o.registerColorTarget({name:"highlight",internalFormat:i?U$C.RGBA4:P$w.RGBA,dataType:G$m.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=o.registerColorTarget({name:"hudVisibility",internalFormat:i?U$C.RGBA4:P$w.RGBA,dataType:G$m.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=o.registerColorTarget({name:"tmpColor"}),this.tmpDepth=o.registerDepthTarget({name:"tmpDepth"}),this.hudColor=o.registerColorTarget({name:"hudColor"});}dispose(){this._renderTargetHelper.dispose();}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(e){this._background=e;}get background(){return this._background}get currentColorTarget(){return this.mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this.mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,t){return this._renderTargetHelper.getFramebuffer(this._dimensions,e,t)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}advanceCurrentRenderTarget(){this._mainColorTarget=0===this._mainColorTarget&&this._needLastFrameColorTexture?1:0;}initializeFrame(e){const t=this._rctx;this._dimensions.width=e.fullWidth,this._dimensions.height=e.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),t.setClearStencil(0);const r=this._background.color;t.setClearColor(r[0]*r[3],r[1]*r[3],r[2]*r[3],r[3]),t.clearSafe(_$z.COLOR_BUFFER_BIT|_$z.DEPTH_BUFFER_BIT|_$z.STENCIL_BUFFER_BIT);}composite(t){r$W(this.colorTexture)&&this._compositingHelper.composite(t,this.colorTexture,o$r.None);}renderTmpAndCompositeToMain(e,t,r,i=!1){this.renderToTargets(e,this.tmpColor,i?this.tmpDepth:this.mainDepth,m$8),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),r);}renderHUDVisibility(e,t=!1){this.renderToTargets(e,this.hudVisibility,t?this.tmpDepth:this.mainDepth,p$5);}compositeTransparentTerrainOntoHUDVisibility(e){this.renderToTargets((()=>this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),o$r.None,1,n$B.TransparentToHUDVisibility)),this.hudVisibility,this.tmpDepth);}renderOITPass(e,r,i){let o,s;switch(r){case O$L.Color:o=this.colorFloatTarget,s=[0,0,0,0];break;case O$L.Alpha:o=this.alphaFloatTarget,s=[1,1,1,1];break;case O$L.FrontFace:o=this.frontFaceTarget,s=[0,0,0,0];}i?this.renderToTargets(e,o,this.tmpDepth,s,!0,!0):this.renderToTargets(e,o,this.mainDepth,s,!1);}compositeTransparentTerrainOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),o$r.PremultipliedAlpha);}compositeOccludedOntoMain(e,t){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),o$r.PremultipliedAlpha,t);}compositeTransparentOntoOpaque(e,t){t?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(_$z.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeTransparent(e,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget));}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer);}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth);}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e);}set needLastFrameColorTexture(e){!e&&this._needLastFrameColorTexture&&(this._mainColorTarget=0,this.disposeTarget(this.mainColorTargets[1])),this._needLastFrameColorTexture=e;}get needLastFrameColorTexture(){return this._needLastFrameColorTexture}renderToTargets(e,t,r,i,o=!1,s=!1){const a=this._rctx,h=this.bindTarget(t,r);let n=0;if(i){const e=1e-13,t=Math.max(e,i[3]);a.setClearColor(i[0],i[1],i[2],t),n|=_$z.COLOR_BUFFER_BIT;}return o&&(n|=_$z.DEPTH_BUFFER_BIT),!1===s?s=0:(!0===s&&(s=255),n|=_$z.STENCIL_BUFFER_BIT),n&&a.clearSafe(n,s),e(),a.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth),h}bindTarget(e,t){const r=this._renderTargetHelper.getFramebuffer(this._dimensions,e,t);return this._rctx.bindFramebuffer(r),r}_getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this._dimensions)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}}const m$8=[0,0,0,0],p$5=[0,1,0,1];

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class i$7{constructor(t){this.context=t,this._renderPlugins=new n$1l,this.slots=[];for(let e=0;e<E$G.MAX_SLOTS;++e)this.slots[e]=[];}add(e,n,s){const i=()=>{if(s?.aborted)throw n.uninitializeRenderContext(),m$L();this._renderPlugins.push(n);for(const t of e)this.slots[t].push(n);this.context.requestRender();},o=n.initializeRenderContext(this.context,s);if(k$F(o))return o.then(i);i();}remove(e){if(null!=this._renderPlugins.removeUnordered(e)){for(let t=0;t<this.slots.length;++t)this.slots[t]=this.slots[t].filter((t=>t!==e));e.uninitializeRenderContext(),this.context.requestRender();}}prepareRender(){this._renderPlugins.forAll((e=>{e.prepareRender&&e.prepareRender(this.context.renderContext);}));}updateAnimation(e){let t=!1;return this._renderPlugins.forAll((r=>{r.updateAnimation&&(t=r.updateAnimation(e)||t);})),t}render(){const e=this.slots[this.context.renderContext.bindParameters.slot],t=new Array;e.filter((e=>{if(!e.canRender)return !1;if(o$6(e)){const r=e.prepareTechnique(this.context.renderContext);return !!r&&(t.push(r),!0)}return t.push(null),!0})).forEach(((e,r)=>e.render(this.context.renderContext,t[r])));}queryDepthRange(e){const t=d$2;return t.near=1/0,t.far=-1/0,this._renderPlugins.forAll((r=>{if(r.queryDepthRange){const s=r.queryDepthRange(e);s&&t$5(t,s,t);}})),t}get needsTransparentPass(){return this._renderPlugins.some((e=>e.needsTransparentPass))}get needsHighlight(){return this._renderPlugins.some((e=>e.needsHighlight))}get needsLinearDepth(){return this._renderPlugins.some((e=>e.needsLinearDepth))}get needsLaserlineWithContrastControl(){const e=this.slots[E$G.LASERLINES_CONTRAST_CONTROL];return !!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce(((e,t)=>e|t.renderOccludedFlags),0)}}function o$6(e){return "prepareTechnique"in e}const d$2={near:0,far:0};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class w$4 extends n$1G{}const u$8=255,g$5=1/u$8;function v$2(){const r=new i$_,i=r.fragment;return i.include(a$10),i.include(a$Y),r.include(n$D),r.include(o$M),r.include(h$18,{receiveShadows:!0}),i.uniforms.add([new c$11("depthMap",(e=>e.linearDepthTexture)),new e$Z("inverseViewMatrix",((r,o)=>h$U(f$3,c$17(f$3,o.camera.viewMatrix,o.camera.center)))),new e$$("nearFar",((e,a)=>a.camera.nearFar))]),i.constants.add("sampleValue","float",g$5),i.code.add(n$19`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),r}const f$3=e$10(),x$3=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:w$4,shadowCastMaxSamples:u$8,build:v$2},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var t$2;!function(o){o[o.Gradient=0]="Gradient",o[o.Threshold=1]="Threshold",o[o.COUNT=2]="COUNT";}(t$2||(t$2={}));class r$6 extends t$X{constructor(){super(...arguments),this.visualization=t$2.Gradient,this.bandsEnabled=!1;}}e$Y([e$12({count:t$2.COUNT})],r$6.prototype,"visualization",void 0),e$Y([e$12()],r$6.prototype,"bandsEnabled",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function m$7(m){const g=new i$_,u=g.fragment;u.include(a$10),u.include(a$Y),g.include(n$D),g.include(o$M);const{visualization:p,bandsEnabled:w}=m;u.constants.add("inverseSampleValue","float",u$8),u.uniforms.add([new c$11("shadowCastMap",(e=>e.shadowCastMap)),new o$_("sampleScale",(e=>e.sampleScale)),new o$_("opacityFromElevation",(e=>e.opacityFromElevation)),new e$19("uColor",(e=>e.color))]);const h=p===t$2.Gradient,f=p===t$2.Threshold;return h&&w?u.uniforms.add(new o$_("bandSize",(e=>e.bandSize))):f&&u.uniforms.add(new o$_("threshold",(e=>e.threshold))),u.code.add(n$19`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${f?n$19`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${h&&w?n$19`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${h?n$19`* strength`:""});
      }
    `),g}const g$4=Object.freeze(Object.defineProperty({__proto__:null,build:m$7},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class m$6 extends e$11{constructor(e,r){super(e,r,(()=>this.destroy()));}initializeProgram(e){const r=m$6.shader.get().build(this.configuration);return new o$Z(e.rctx,r,E$E)}initializePipeline(){return W$h({blending:c$1c,colorWrite:c$10,depthTest:null,depthWrite:null})}get primitiveType(){return E$F.TRIANGLE_STRIP}}m$6.shader=new t$W(g$4,(()=>import('./ShadowCastVisualize.glsl-2f8728c5.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const c$5=r$Z(.01,0,.25,1),p$4=4e4,m$5=5e4,b$1=1/512;let q=class extends y$F{constructor(e,t,s,i){super({}),this._techniqueRepository=e,this._rctx=t,this._shadowAccumulator=s,this._requestRender=i,this._passParameters={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:c$5,threshold:.5,bandSize:.1,opacityFromElevation:1,__tagStrict:"NoParameters"},this._techniqueConfig=new r$6,this._enabled=!1,this._vao=u$V(t),this._techniqueConfig.visualization=t$2.Gradient;}normalizeCtorArgs(){return {}}dispose(){this._stop(),this._vao=s$1a(this._vao),this._techniqueRepository.release(this._technique),this._technique=null,this._shadowAccumulator=null;}get visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(m$6,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._isRenderingVisualization)return;this._passParameters.sampleScale=1/this._computedSamples;const t=this.visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,this._passParameters,e),this._rctx.drawArrays(t.primitiveType,0,n$1d(this._vao,"geometry"));}setOptions(e){void 0!==e.enabled&&this._setEnabled(e.enabled),void 0!==e.color&&this._setColor(e.color),void 0!==e.threshold&&(this._threshold=e.threshold),void 0!==e.visualization&&(this._visualization=e.visualization),void 0!==e.bandSize&&(this._bandSize=e.bandSize),void 0!==e.bandsEnabled&&(this._bandsEnabled=e.bandsEnabled);}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"));}get _isRenderingVisualization(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>b$1}get _computedSamples(){return this._shadowAccumulator.computedSamples}get _shadowCastTexture(){return this._shadowAccumulator.shadowCastTexture}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning());}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning());}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning());}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning());}_setColor(e){const t=this._passParameters.color;D$r(e,t)||(a$15(this._passParameters.color,e),this._requestRenderIfRunning());}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop());}_requestRenderIfRunning(){this._enabled&&this._requestRender();}_start(){this._enabled=!0,this._requestRender();}_stop(){this._enabled=!1,this._requestRender();}};e$Y([d$R()],q.prototype,"opacityFromElevation",null),q=e$Y([n$18("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],q);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class u$7 extends e$11{constructor(e,r){super(e,r,(()=>this.destroy()));}initializeProgram(e){const r=u$7.shader.get().build();return new o$Z(e.rctx,r,E$E)}initializePipeline(){return W$h({blending:l$P(R$u.ONE,R$u.ONE,R$u.ONE,R$u.ONE),colorWrite:c$10,depthTest:null,depthWrite:null})}get primitiveType(){return E$F.TRIANGLE_STRIP}}u$7.shader=new t$W(x$3,(()=>import('./ShadowCastAccumulate.glsl-1458214d.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var I$1;let N$1=I$1=class extends y$F{constructor(e,t,i,s,a,n){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=s,this._renderToShadowMap=a,this._requestRender=n,this._progress=0,this._sampleCount=0,this._passParameters=new w$4,this._enabled=!1,this._cachedLightDirections=[],this._depthRange=f$5,this._previewing=!1,this._handles=new u$U,this._cameraForcedForScreenshot=!1,this._bindParameters=new h$L(new Q$a(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._bindParameters.camera=new K$h,this._vao=u$V(e);const _={colorTarget:Y$d.TEXTURE,depthStencilTarget:V$q.NONE,width:0,height:0},u={target:M$v.TEXTURE_2D,pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,samplingMode:L$C.LINEAR,wrapMode:D$q.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new D$p(e,_,u),this._accumulationRenderer=new q(t,e,this,n);const l=this._stage.resourceController.scheduler;this._handles.add(l.registerTask(L$D.SHADOW_ACCUMULATOR,this)),this._handles.add(l$M((()=>i.renderView),(e=>{this._handles.remove(I$1.renderViewHandleKey),t$V(e)||this._handles.add(e.events.on("force-camera-for-screenshot",(()=>this._cameraForcedForScreenshot=!0)),I$1.renderViewHandleKey);}),w$x));}normalizeCtorArgs(){return {}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get accumulationTechnique(){if(t$V(this._accumulationTechnique)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechnique=new u$7(e,new t$X);}return this._accumulationTechnique}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabled&&this._sampleCount>0}get canAccumulate(){return null!==this._passParameters.linearDepthTexture&&this._depthRange!==f$5&&this._opacityFromElevation>b$1}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const t=this._cachedLightDirections;if(i$1n(t,e,G$l))return;const r=e.length;t.length=r,this._sampleCount=Math.min(u$8,r);for(let i=0;i<r;++i){const r=e[i],s=t[i]||n$16();r$V(s,r),t[i]=s;}this._invalidate();}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e;}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender();}renderAccumulation(e,t,i,r){if(this._passParameters.linearDepthTexture=e,this._depthRange=t,this._updateCamera(i),this._bindParameters.contentCamera=r,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(I$1.previewSamples,this._sampleCount-this._progress);for(let o=0;o<s;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1;}render(e){this._accumulationRenderer.render(e);}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=s$1a(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=s$1a(this._fbo),this._vao=s$1a(this._vao),this._accumulationTechnique=p$X(this._accumulationTechnique),this._cachedLightDirections.length=0,this._sampleCount=0;}setOptions(e){void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.previewing&&(this.previewing=e.previewing),void 0!==e.lightDirections&&(this.lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e);}set previewing(e){this._previewing!==e&&(this._previewing=e,this._requestRenderIfEnabled());}set lightDirections(e){this._lightDirections=e;}readAccumulatedShadow(e,t){if(!this._isActive||this._progress<1||e<0||e>this._fbo.width||t<0||t>this._fbo.height)return 0;const i=k;return this._fbo.readPixels(e,t,1,1,P$w.RGBA,G$m.UNSIGNED_BYTE,i),i[0]/this._progress}_start(){this._progress=0,this._enabled=!0;}_stop(){this._enabled=!1;}_invalidate(){this._progress=0,this._requestRenderIfEnabled();}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(_$z.COLOR_BUFFER_BIT),this._progress=0;}_accumulateShadow(){const e=this._lightDirections[this._progress];this._renderToShadowMap(this._bindParameters,e,this._depthRange),this._passParameters.origin=this._bindParameters.camera.center,this._rctx.bindFramebuffer(this._fbo);const t=this.accumulationTechnique;this._rctx.bindTechnique(t,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(t.primitiveType,0,n$1d(this._vao,"geometry")),this._progress++;}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-I$z(p$4,m$5,e.relativeElevation));}set enabled(e){e!==this._enabled&&(e?this._start():this._stop());}_requestRenderIfEnabled(){this._enabled&&this._requestRender();}get test(){const e=this;return {lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};N$1.previewSamples=6,N$1.renderViewHandleKey="renderView",e$Y([d$R()],N$1.prototype,"_progress",void 0),e$Y([d$R()],N$1.prototype,"_sampleCount",void 0),e$Y([d$R()],N$1.prototype,"_enabled",void 0),e$Y([d$R()],N$1.prototype,"_depthRange",void 0),e$Y([d$R()],N$1.prototype,"_previewing",void 0),e$Y([d$R()],N$1.prototype,"_accumulationRenderer",void 0),e$Y([d$R()],N$1.prototype,"_isRefining",null),e$Y([d$R()],N$1.prototype,"_isActive",null),e$Y([d$R()],N$1.prototype,"canAccumulate",null),e$Y([d$R()],N$1.prototype,"_isDoneAccumulating",null),e$Y([d$R()],N$1.prototype,"_opacityFromElevation",null),e$Y([d$R()],N$1.prototype,"running",null),N$1=I$1=e$Y([n$18("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],N$1);const k=new Uint8Array(4);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const F={highlightedThreshold:.99999,selfShadowThreshold:.025};function y$2(){const i=new i$_;i.include(c$1e,{receiveShadows:!0});const l=i.fragment;return l.include(a$10),l.include(a$Y),i.include(n$D),i.include(o$M),l.uniforms.add([new c$11("defaultDepthTex",((e,o)=>o.shadowMap.getSnapshot(J$a.Default))),new c$11("highlightDepthTex",((e,o)=>o.shadowMap.getSnapshot(J$a.Highlight))),new c$11("depthMap",((e,o)=>o.linearDepthTexture)),new c$11("highlightMap",((e,o)=>o.highlightColorTexture)),new e$19("uColor",(e=>e.shadowColor)),new e$$("nearFar",((e,o)=>o.camera.nearFar)),new o$_("opacity",(e=>e.shadowOpacity)),new o$_("occludedOpacity",(e=>e.occludedShadowOpacity)),new o$_("terminationFactor",(e=>e.opacityElevation*e.dayNightTerminator)),new e$_("lightingMainDirectionView",((e,o)=>z$s(z,L$E(z,o.lighting.lightingMainDirection,o.camera.viewInverseTransposeMatrix)))),new e$$("texelSize",((o,r)=>r$W(r.linearDepthTexture)?r$Y(T$2,1/r.linearDepthTexture.descriptor.width,1/r.linearDepthTexture.descriptor.height):f$S)),new e$Z("inverseViewMatrix",((e,i)=>h$U(j$1,c$17(j$1,i.camera.viewMatrix,i.camera.center))))]),l.constants.add("unoccludedHighlightFlag","vec4",g$16).add("highlightedThreshold","float",F.highlightedThreshold).add("selfShadowThreshold","float",F.selfShadowThreshold),l.code.add(n$19`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),l.code.add(n$19`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),i}const j$1=e$10(),z=n$16(),T$2=n$1b(),C=Object.freeze(Object.defineProperty({__proto__:null,build:y$2},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class m$4 extends t$Y{constructor(){super(...arguments),this.shadowColor=r$Z(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1;}}class u$6 extends e$11{constructor(e){super(e,null,(()=>this.destroy()));}initializeProgram(e){const r=u$6.shader.get().build();return new o$Z(e.rctx,r,E$E)}initializePipeline(){return W$h({blending:l$P(R$u.SRC_ALPHA,R$u.ONE,R$u.ONE_MINUS_SRC_ALPHA,R$u.ONE_MINUS_SRC_ALPHA),colorWrite:c$10,depthTest:null,depthWrite:null})}get primitiveType(){return E$F.TRIANGLE_STRIP}}u$6.shader=new t$W(C,(()=>import('./ShadowHighlight.glsl-22287086.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const l$1=.001953125,g$3=4e4,w$3=5e4;class v$1{constructor(t,s){this._rctx=t,this._viewingMode=s,this._maxOpacity=1,this._passParameters=new m$4,this._drawParameters=new n$1G,this._vao=u$V(this._rctx);}get technique(){return t$V(this._technique)&&(this._technique=new u$6({rctx:this._rctx,viewingMode:this._viewingMode})),this._technique}render(t,s){if(!t.shadowMap.enabled||!t.linearDepthTexture||!this.isVisible)return;const e=this.technique;this._drawParameters.origin=t.camera.center,this._rctx.bindFramebuffer(s),this._rctx.bindTechnique(e,this._passParameters,t).bindDraw(this._drawParameters,t),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,n$1d(this._vao,"geometry"));}get gpuMemoryUsage(){return this._vao?.size??0}setDefaultOptions(t){this._passParameters={...this._passParameters,...t},this._updateMaxOpacity();}updateParameters(e,i){this._passParameters.opacityElevation=1-I$z(g$3,w$3,e.relativeElevation);const a=this._viewingMode===l$O.Global?z$s(y$1,e.center):o$W(y$1,0,0,1),c=P$u(a,i);this._passParameters.dayNightTerminator=I$z(0,1,o$X(30*c,0,1));}dispose(){this._vao=s$1a(this._vao),this._technique=p$X(this._technique);}get isVisible(){const{opacityElevation:t,dayNightTerminator:s}=this._passParameters;return this._maxOpacity*t*s>=l$1}_updateMaxOpacity(){const t=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=t*this._passParameters.shadowColor[3];}}const y$1=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const t$1=G$n();class n$8{constructor(){this._plane=G$n();}get isEnabled(){return !fs(this.plane,t$1)}get plane(){return this._plane}set plane(e){X$c(e||t$1,this._plane);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var r$5;!function(e){e[e.EdgeDetector=0]="EdgeDetector",e[e.BlendWeight=1]="BlendWeight",e[e.Blur=2]="Blur",e[e.COUNT=3]="COUNT";}(r$5||(r$5={}));class u$5 extends t$X{constructor(){super(...arguments),this.output=r$5.EdgeDetector;}}e$Y([e$12({count:r$5.COUNT})],u$5.prototype,"output",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const a$4={threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16};function x$2(x){const c=new i$_;return x.output===r$5.EdgeDetector&&(c.attributes.add(O$J.POSITION,"vec2"),c.vertex.uniforms.add(new o$P("resolution")),c.varyings.add("fTexCoord","vec2"),c.varyings.add("fOffset[3]","vec4"),c.vertex.code.add(n$19`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),c.fragment.uniforms.add(new s$10("tColor")),c.fragment.code.add(n$19`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${n$19.float(a$4.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${n$19.float(a$4.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `)),x.output===r$5.BlendWeight&&(c.attributes.add(O$J.POSITION,"vec2"),c.vertex.uniforms.add(new o$P("resolution")),c.varyings.add("fTexCoord","vec2"),c.varyings.add("fOffset[3]","vec4"),c.varyings.add("fPixCoord","vec2"),c.vertex.code.add(n$19`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${n$19.int(a$4.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),c.fragment.uniforms.add(new s$10("tEdges")),c.fragment.uniforms.add(new s$10("tArea")),c.fragment.uniforms.add(new s$10("tSearch")),c.fragment.uniforms.add(new s$10("tColor")),c.fragment.uniforms.add(new o$P("resolution")),c.fragment.code.add(n$19`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${n$19.int(a$4.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${n$19.int(a$4.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${n$19.int(a$4.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${n$19.int(a$4.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${n$19.int(a$4.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `)),x.output===r$5.Blur&&(c.attributes.add(O$J.POSITION,"vec2"),c.vertex.uniforms.add(new o$P("resolution")),c.varyings.add("fTexCoord","vec2"),c.varyings.add("fOffset[2]","vec4"),c.vertex.code.add(n$19`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),c.fragment.uniforms.add(new s$10("tBlendWeights")),c.fragment.uniforms.add(new s$10("tColor")),c.fragment.uniforms.add(new o$P("resolution")),c.fragment.code.add(n$19`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`)),c}const c$4=Object.freeze(Object.defineProperty({__proto__:null,build:x$2},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class n$7 extends e$11{initializeProgram(e){const r=n$7.shader.get().build(this.configuration);return new o$Z(e.rctx,r,E$E)}initializePipeline(){return W$h({colorWrite:c$10})}}n$7.shader=new t$W(c$4,(()=>import('./SMAA.glsl-c94163c1.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let R$1=class extends y$F{constructor(e,t){super({}),this.rctx=e,this._techniqueRep=t,this._isEnabled=!1;}normalizeCtorArgs(){return {}}dispose(){this._abortController=h$T(this._abortController),this.disable();}_loadResources(e){if(r$W(this._abortController))return !1;if(r$W(this._searchTexture))return !0;this._abortController=new AbortController;const t=this._abortController.signal;return import('./SmaaRenderPassData-2b7fe303.js').then((e=>this._loadTextures(e,t))).then((()=>e())).finally((()=>this._abortController=null)),!1}_loadTextures(e,t){return f$V(t),Promise.all([this._loadTextureFromBase64(e.areaTexture,L$C.LINEAR,P$w.RGB),this._loadTextureFromBase64(e.searchTexure,L$C.NEAREST,P$w.LUMINANCE)]).then((([e,r])=>{p$V(t)?(e.dispose(),r.dispose(),f$V(t)):(this._areaTexture=e,this._searchTexture=r);}))}get updating(){return r$W(this._abortController)}enable(e){if(this._isEnabled)return !0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const e=new u$5,t=(e,t)=>this._techniqueRep.releaseAndAcquire(n$7,e,t);e.output=r$5.EdgeDetector,this._edgeDetectTechnique=t(e,this._edgeDetectTechnique),e.output=r$5.BlendWeight,this._blendWeightsTechnique=t(e,this._blendWeightsTechnique),e.output=r$5.Blur,this._blurTechnique=t(e,this._blurTechnique);}return !!this._loadResources(e)&&(this._vao=g$17(this.rctx),this._edges=new D$p(this.rctx,{colorTarget:Y$d.TEXTURE,depthStencilTarget:V$q.NONE},{target:M$v.TEXTURE_2D,pixelFormat:P$w.RGB,dataType:G$m.UNSIGNED_BYTE,samplingMode:L$C.LINEAR,wrapMode:D$q.CLAMP_TO_EDGE,width:4,height:4}),this._blend=new D$p(this.rctx,{colorTarget:Y$d.TEXTURE,depthStencilTarget:V$q.NONE},{target:M$v.TEXTURE_2D,pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,samplingMode:L$C.LINEAR,wrapMode:D$q.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=s$1a(this._vao),this._areaTexture=s$1a(this._areaTexture),this._searchTexture=s$1a(this._searchTexture),this._blend=s$1a(this._blend),this._edges=s$1a(this._edges),this._isEnabled=!1);}render(e){if(!this._isEnabled)return;const t=this.rctx,r=t.getBoundFramebufferObject(),i={x:0,y:0,width:e.descriptor.width,height:e.descriptor.height};t.bindVAO(this._vao),t.setViewport(i.x,i.y,i.width,i.height),this._edges.resize(i.width,i.height),t.bindFramebuffer(this._edges),t.setClearColor(0,0,0,1),t.clear(_$z.COLOR_BUFFER_BIT);const s=t.bindTechnique(this._edgeDetectTechnique);s.bindTexture("tColor",e),s.setUniform4f("resolution",1/i.width,1/i.height,i.width,i.height),t.drawArrays(E$F.TRIANGLES,0,3),this._blend.resize(i.width,i.height),t.bindFramebuffer(this._blend),t.setClearColor(0,0,1,1),t.clear(_$z.COLOR_BUFFER_BIT);const o=t.bindTechnique(this._blendWeightsTechnique);o.setUniform4f("resolution",1/i.width,1/i.height,i.width,i.height),o.bindTexture("tSearch",this._searchTexture),o.bindTexture("tArea",this._areaTexture),o.bindTexture("tEdges",this._edges.colorTexture),t.drawArrays(E$F.TRIANGLES,0,3),t.bindFramebuffer(r),t.setClearColor(0,1,0,1),t.clear(_$z.COLOR_BUFFER_BIT);const h=t.bindTechnique(this._blurTechnique);h.setUniform4f("resolution",1/i.width,1/i.height,i.width,i.height),h.bindTexture("tColor",e),h.bindTexture("tBlendWeights",this._blend.colorTexture),t.drawArrays(E$F.TRIANGLES,0,3);}_loadTextureFromBase64(e,t,r){return t$10(e).then((e=>new u$X(this.rctx,{pixelFormat:r,dataType:G$m.UNSIGNED_BYTE,wrapMode:D$q.CLAMP_TO_EDGE,width:e.width,height:e.height,samplingMode:t},e)))}};e$Y([d$R()],R$1.prototype,"_abortController",void 0),e$Y([d$R({readOnly:!0})],R$1.prototype,"updating",null),R$1=e$Y([n$18("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],R$1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function n$6(n,o){const t=o,c=-n[0],f=-n[1],i=-n[2],s=t[3],u=t[7],e=t[11],p=t[15];t[0]+=s*c,t[1]+=s*f,t[2]+=s*i,t[4]+=u*c,t[5]+=u*f,t[6]+=u*i,t[8]+=e*c,t[9]+=e*f,t[10]+=e*i,t[12]+=p*c,t[13]+=p*f,t[14]+=p*i;}function o$5(n,o){const t=o,c=n[0],f=n[1],i=n[2];t[12]+=c*t[0]+f*t[4]+i*t[8],t[13]+=c*t[1]+f*t[5]+i*t[9],t[14]+=c*t[2]+f*t[6]+i*t[10],t[14]+=c*t[3]+f*t[7]+i*t[11];}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class e$5{constructor(i){this.factory=i,this.originData=new Map;}acquire(i){return this.register(this.factory.getOrigin(i))}register(i){const r=this.originData.get(i.id);return r?(r.refCount++,r.origin):(this.originData.set(i.id,{refCount:1,viewMatrix:e$10(),origin:i}),i)}release(i){const t=this.originData.get(i.id);t&&(t.refCount--,0===t.refCount&&this.originData.delete(i.id));}updateViewMatrices(t){this.originData.forEach((e=>{n$15(e.viewMatrix,t),o$5(e.origin.vec3,e.viewMatrix);}));}getViewMatrix(i){return this.originData.get(i.id).viewMatrix}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class a$3 extends c$1r{constructor(s,o,t){super(),this.distanceFalloffFactor=s,this.minimumEdgeLength=o,this.transparency=t,this.transformNormalViewFromGlobal=e$16();}}class e$4 extends W$j{constructor(){super(...arguments),this.transformNormalViewFromGlobal=e$16(),this.slicePlaneLocalOrigin=n$16(),this.transformNormalGlobalFromModel=e$16();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function o$4(o){const e=n$19`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;o.code.add(e);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const i$6=r$13(.5,-4e-4);function c$3(o,c){const f=o.vertex;f.include(o$4),f.constants.add("depthBias","vec2",i$6),f.uniforms.add(new e$$("inverseViewport",((o,r)=>r.inverseViewport))),c.legacy?(f.uniforms.add(new o$12("localView")),f.uniforms.add(new e$Z("proj",((o,r)=>r.camera.projectionMatrix))),f.code.add(n$19`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(f.uniforms.add(new e$1v("transformNormalViewFromGlobal",(o=>o.transformNormalViewFromGlobal))),f.uniforms.add(new e$Z("transformProjFromView",(o=>o.transformProjFromView))),f.code.add(n$19`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),f.code.add(n$19`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function a$2(a,r){const d=a.fragment;d.constants.add("coverageTestThreshold","float",.01),r.antialiasing?d.code.add(n$19`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):d.code.add(n$19`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function o$3(o,r){const l=o.vertex;r.silhouette?(l.code.add(n$19`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),r.legacy?l.code.add(n$19`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):l.code.add(n$19`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):l.code.add(n$19`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function u$4(u,v){const p=u.vertex;p.include(a$10),p.uniforms.add(new o$_("distanceFalloffFactor",(o=>o.distanceFalloffFactor))),p.code.add(n$19`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),p.uniforms.add(new s$10("componentDataTex")),p.uniforms.add(new o$R("componentDataTexInvDim")),u.attributes.add(O$J.COMPONENTINDEX,"float"),p.constants.add("componentColorFieldOffset","float",0),p.constants.add("componentOtherFieldOffset","float",1),p.constants.add("componentVerticalOffsetFieldOffset","float",2),p.constants.add("componentFieldCount","float",3),p.constants.add("lineWidthFractionFactor","float",8),p.constants.add("extensionLengthOffset","float",128),p.constants.add("componentTexWidth","float",4096),p.constants.add("verticalOffsetScale","float",2*x$6),p.code.add(n$19`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * componentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texture2D(componentDataTex, colorIndex);
vec4 otherValue = texture2D(componentDataTex, otherIndex);
float verticalOffset = (rgba2float(texture2D(componentDataTex, verticalOffsetIndex)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),v.legacy?p.code.add(n$19`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(p.uniforms.add(new o$10("transformNormalGlobalFromModel",(o=>o.transformNormalGlobalFromModel))),p.code.add(n$19`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),v.silhouette?(u.attributes.add(O$J.NORMALA,"vec3"),u.attributes.add(O$J.NORMALB,"vec3"),p.code.add(n$19`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(u.attributes.add(O$J.NORMAL,"vec3"),p.code.add(n$19`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),v.legacy?p.code.add(n$19`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(p.include(i$1r,v),p.include(i$1r,v),p.uniforms.add([new e$1v("transformViewFromCameraRelativeRS",(o=>o.transformViewFromCameraRelativeRS)),new o$10("transformWorldFromModelRS",(o=>o.transformWorldFromModelRS)),new o$1v("transformWorldFromModelTL",(o=>o.transformWorldFromModelTL)),new o$1v("transformWorldFromModelTH",(o=>o.transformWorldFromModelTH)),new e$_("transformWorldFromViewTL",(o=>o.transformWorldFromViewTL)),new e$_("transformWorldFromViewTH",(o=>o.transformWorldFromViewTH))]),p.code.add(n$19`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${v.spherical?n$19`normalize(transformWorldFromModelTL + rotatedModelPosition);`:n$19`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),p.uniforms.add(new e$Z("transformProjFromView",((o,e)=>e.camera.projectionMatrix))),p.code.add(n$19`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),p.code.add(n$19`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`);}function v(o){return o.mode===x$1.SKETCH||o.mode===x$1.MIXED}function p$3(o){return o.mode===x$1.SOLID||o.mode===x$1.MIXED}var x$1;!function(o){o[o.SOLID=0]="SOLID",o[o.SKETCH=1]="SKETCH",o[o.MIXED=2]="MIXED",o[o.COUNT=3]="COUNT";}(x$1||(x$1={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function i$5(i,d){const s=i.vertex;switch(d.mode){case x$1.SKETCH:s.code.add(n$19`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case x$1.MIXED:s.code.add(n$19`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case x$1.SOLID:s.code.add(n$19`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function i$4(i,o){const d=i.vertex;switch(i.attributes.add(O$J.SIDENESS,"vec2"),o.mode===x$1.MIXED?d.code.add(n$19`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):d.code.add(n$19`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),o.mode){case x$1.MIXED:d.code.add(n$19`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case x$1.SKETCH:d.code.add(n$19`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case x$1.SOLID:d.code.add(n$19`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case x$1.COUNT:break;default:n$1i(o.mode);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function d$1(d,u){const i=d.vertex;switch(d.include(i$4,u),v(u)&&i.uniforms.add(new r$R("strokesAmplitude")),u.mode){case x$1.SOLID:i.code.add(n$19`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case x$1.SKETCH:i.code.add(n$19`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case x$1.MIXED:i.code.add(n$19`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function u$3(u,n){const i=u.vertex;u.include(i$4,n);const d=u.fragment;switch(v(n)&&(i.uniforms.add(new o$R("strokesTextureScale")),i.uniforms.add(new r$R("strokesLog2Resolution")),i.uniforms.add(new r$R("strokeVariants")),u.varyings.add("vStrokeUV","vec2"),d.uniforms.add(new s$10("strokesTexture")),d.uniforms.add(new r$R("strokesNormalizationScale")),i.code.add(n$19`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * strokesTextureScale;
vStrokeUV.x += variantOffset;
}`),u.fragment.include(a$10),d.code.add(n$19`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),n.mode){case x$1.SOLID:i.code.add(n$19`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),d.code.add(n$19`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case x$1.SKETCH:i.code.add(n$19`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),d.code.add(n$19`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case x$1.MIXED:u.varyings.add("vType","float"),i.code.add(n$19`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),d.code.add(n$19`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function w$2(i){const w=new i$_,A=w.vertex,L=w.fragment;return i.legacy&&A.uniforms.add(new o$12("model")),i.antialiasing&&(A.code.add(n$19`#define ANTIALIASING 1`),L.code.add(n$19`#define ANTIALIASING 1`)),w.include(c$3,i),w.include(u$4,i),w.include(d$1,i),w.include(i$4,i),w.include(u$3,i),w.include(u$$,i),w.include(o$3,i),w.include(a$2,i),w.include(i$5,i),w.include(n$1q,i),w.varyings.add("vColor","vec4"),w.varyings.add("vRadius","float"),w.varyings.add("vPosition","vec3"),w.varyings.add("vWorldPosition","vec3"),w.varyings.add("vViewPos","vec3"),w.varyings.add("vLineLengthPixels","float"),w.varyings.add("vSizeFalloffFactor","float"),A.uniforms.add(new e$$("pixelToNDC",((i,o)=>r$Y(h$2,2/o.camera.fullViewport[2],2/o.camera.fullViewport[3])))),A.uniforms.add(new e$19("viewport",((e,i)=>i.camera.fullViewport))),A.uniforms.add(new o$_("pixelRatio",((e,i)=>i.camera.pixelRatio))),w.attributes.add(O$J.POSITION0,"vec3"),w.attributes.add(O$J.POSITION1,"vec3"),w.attributes.add(O$J.VARIANTOFFSET,"float"),w.attributes.add(O$J.VARIANTSTROKE,"float"),w.attributes.add(O$J.VARIANTEXTENSION,"float"),A.code.add(n$19`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 ndcToPixel = viewport.zw * 0.5;
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`),w.fragment.code.add(n$19`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${i.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `),w}const h$2=n$1b(),A$1=Object.freeze(Object.defineProperty({__proto__:null,build:w$2},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class c$2 extends e$11{initializeProgram(e){const r=c$2.shader.get().build(this.configuration);return new o$Z(e.rctx,r,o$1z)}initializePipeline(e){return e.blendMinMax?W$h({blending:l$P(R$u.ONE,R$u.ONE,R$u.ZERO,R$u.ONE,T$I.ADD,e.blendMinMax.MAX),depthTest:{func:I$y.LEQUAL},colorWrite:c$10}):W$h({depthTest:{func:I$y.LEQUAL},depthWrite:a$1a,colorWrite:c$10})}}c$2.shader=new t$W(A$1,(()=>import('./EdgeShader.glsl-4fccc71b.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class s$3 extends i$17{constructor(){super(...arguments),this.mode=x$1.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1;}}e$Y([e$12({count:x$1.COUNT})],s$3.prototype,"mode",void 0),e$Y([e$12()],s$3.prototype,"hasSlicePlane",void 0),e$Y([e$12()],s$3.prototype,"silhouette",void 0),e$Y([e$12()],s$3.prototype,"legacy",void 0),e$Y([e$12()],s$3.prototype,"antialiasing",void 0),e$Y([e$12()],s$3.prototype,"doublePrecisionRequiresObfuscation",void 0),e$Y([e$12()],s$3.prototype,"hasMultipassTerrain",void 0),e$Y([e$12()],s$3.prototype,"cullAboveGround",void 0),e$Y([e$12()],s$3.prototype,"spherical",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const T$1=8,_=128,R={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0};class p$2{constructor(){this._value=0;}get value(){return this._value}increment(){this._value++;}decrement(){this._value--;}}const A={solid:x$1.SOLID,sketch:x$1.SKETCH,uber:x$1.MIXED};class P{constructor(e,r,s){this.rctx=e,this.shaderTechniqueRepository=r,this._configuration=new s$3,this.refCount=new p$2,this.renderables=new Set,this.sortedRenderables={[A$m.TRANSPARENT]:{[A$m.TRANSPARENT]:new n$1l,[A$m.OPAQUE]:new n$1l},[A$m.OPAQUE]:{[A$m.TRANSPARENT]:new n$1l,[A$m.OPAQUE]:new n$1l}},this._renderablesDirty=!1,this._drawParameters=new e$4,this._settings={...R,...s},this.key=P.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const i=this._settings.strokesTexture.variants;this.writerSettings={variants:i,reducedPrecision:t$E.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=A[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this.rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=r$1c(e),this._configuration.spherical=s.spherical;}dispose(){this._technique=p$X(this._technique);}addRenderable(e){this.renderables.add(e),this._renderablesDirty=!0;}removeRenderable(e){this.renderables.delete(e),this._renderablesDirty=!0;}setRenderablesDirty(){this._renderablesDirty=!0;}forEachRenderable(e,r){this._renderablesDirty&&this._sortRenderables(),this.sortedRenderables[r][A$m.TRANSPARENT].forAll(e),this.sortedRenderables[r][A$m.OPAQUE].forAll(e);}updateTechnique(e,r){return this._configuration.hasMultipassTerrain=!!e.multipassTerrain.enabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this.shaderTechniqueRepository.releaseAndAcquire(c$2,this._configuration,this._technique),this._technique}bindRegularEdges(e,r){return this.rctx.bindTechnique(this.updateTechnique(r,!1),e,r)}bindSilhouetteEdges(e,r){return this.rctx.bindTechnique(this.updateTechnique(r,!0),e,r)}renderRegularEdges(e,r,t,s,i){this._render(e,r,r.regular.vao,t,s,i);}renderSilhouetteEdges(e,r,t,s,i){this._render(e,r,r.silhouette.vao,t,s,i);}_render(e,r,t,s,i,n){this._bindDraw(e,r,s,n),this.rctx.bindVAO(t),this.rctx.capabilities.instancing.drawArraysInstanced(E$F.TRIANGLE_FAN,0,4,i);}_bindDraw(e,r,t,n){if(r.components.buffer.textureBuffer.bind(e,E$2,S),"origin"in r.transform)e.setUniformMatrix4fv("localView",n),e.setUniformMatrix4fv("model",r.transform.modelMatrix),r$V(this._drawParameters.slicePlaneLocalOrigin,r.transform.origin.vec3);else {const e=new c$8(r.transform.position),n=o$14(N,u$18(N,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=e.low,this._drawParameters.transformWorldFromModelTH=e.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=n;const o=t.camera.viewInverseTransposeMatrix;o$W(this._drawParameters.slicePlaneLocalOrigin,o[3],o[7],o[11]);}e.bindDraw(this._drawParameters,t),"uber"!==this._settings.type&&"sketch"!==this._settings.type||this._setSketchUniforms(e);}_setSketchUniforms(e){const t=this._settings.strokesTexture,s=t.texture;t$V(s)||(e.bindTexture("strokesTexture",s),e.setUniform2f("strokesTextureScale",1/s.descriptor.width,1/s.descriptor.height),e.setUniform1f("strokesLog2Resolution",Math.log2(t.resolution)),e.setUniform1f("strokesNormalizationScale",t.normalizationScale),e.setUniform1f("strokesAmplitude",t.amplitude),e.setUniform1f("strokeVariants",t.variants));}_sortRenderables(){this._renderablesDirty=!1,this.sortedRenderables[A$m.TRANSPARENT][A$m.TRANSPARENT].clear(),this.sortedRenderables[A$m.TRANSPARENT][A$m.OPAQUE].clear(),this.sortedRenderables[A$m.OPAQUE][A$m.TRANSPARENT].clear(),this.sortedRenderables[A$m.OPAQUE][A$m.OPAQUE].clear(),this.renderables.forEach((e=>{e.objectTransparency!==A$m.INVISIBLE&&e.edgeTransparency!==A$m.INVISIBLE&&this.sortedRenderables[e.objectTransparency][e.edgeTransparency].push(e);}));const e=(e,r)=>"origin"in e.transform&&"origin"in r.transform?e.transform.origin.id<r.transform.origin.id?-1:e.transform.origin.id>r.transform.origin.id?1:0:0;this.sortedRenderables[A$m.TRANSPARENT][A$m.TRANSPARENT].sort(e),this.sortedRenderables[A$m.TRANSPARENT][A$m.OPAQUE].sort(e),this.sortedRenderables[A$m.OPAQUE][A$m.TRANSPARENT].sort(e),this.sortedRenderables[A$m.OPAQUE][A$m.OPAQUE].sort(e);}static getKey(e,r,t){return `edges-t:${e}:${r}:${t}`}}const E$2="componentDataTex",S="componentDataTexInvDim",N=e$1u();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class n$5 extends n$1H{constructor(t){super("EdgeProcessingWorker","extract",{extract:t=>[t.dataBuffer],extractComponentsEdgeLocations:t=>[t.dataBuffer],extractEdgeLocations:t=>[t.dataBuffer]},t);}async process(t,e,r){if(r)return f$1b(t);const n=this._packInput(t),s=await this.invoke(n,e);return this._unpackOutput(s)}async extractEdgeLocations(t,e){const a=this._packInput(t),n=await this.invokeMethod("extractEdgeLocations",a,e);return D$t(n)}async extractComponentsEdgeLocations(t,e){const a=this._packInput(t),n=await this.invokeMethod("extractComponentsEdgeLocations",a,e);return D$t(n)}_packInput(e){return {dataBuffer:e.data.buffer,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate,indicesBuffer:e.indices.buffer,indicesType:s$1y(e.indices)?"Uint32Array":"Uint16Array",indicesLength:e.indicesLength}}_unpackOutput(t){return {regular:{instancesData:D$t(t.regular.instancesData),lodInfo:{lengths:new Float32Array(t.regular.lodInfo.lengths)}},silhouette:{instancesData:D$t(t.silhouette.instancesData),lodInfo:{lengths:new Float32Array(t.silhouette.lodInfo.lengths)}},averageEdgeLength:t.averageEdgeLength}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function a$1(e){const r=4,a=E$1.resolution,c=a/2,h=new Uint8Array(r*a*a),m=r*a*c,d=E$1.amplitude,S=2*d,g=r*a,R=Math.log2(a)+1,A=E$1.strokes.length;let w=(R-1)*A*g;for(const{distance:s,pressure:o}of E$1.strokes){let e=s,n=o,i=w;for(let s=0;s<R;s++){0!==s&&(e=u$2(e,p$1.DISTANCE),n=u$2(n,p$1.PRESSURE));for(let s=0;s<E$1.resolution;s++){const o=.5+(e?e[s%e.length]/S:0),l=n?n[s%n.length]:1;o$18(o,h,i),o$18(l,h,i+m),i+=r;}i-=g*(A+1);}w+=g;}const M=new u$X(e,{pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:L$C.LINEAR,width:a,height:a,wrapMode:D$q.REPEAT},h);return new f$2(a,S,d,A,M)}function c$1(){const t=4,r=E$1.resolution,s=Math.log2(r)+1,o=E$1.strokes.length,n=E$1.amplitude,i=1,l=Math.ceil(2*n+i/2),a=6,c=(()=>{let t=0,e=r;for(;e>=1;)t+=e,e/=2;return t})()+a*(s+1),h=o*l,m=new Uint8ClampedArray(t*c*h),f=t*c;m.fill(255);let d=a*t;for(const{distance:S,pressure:g}of E$1.strokes){let r=S,o=g,c=d;for(let h=0;h<s;h++){0!==h&&(r=u$2(r,p$1.DISTANCE),o=u$2(o,p$1.PRESSURE));for(let s=0;s<r.length;s++){const a=r?r[s]:0,u=o?o$X(o[s],0,1):1;let p=c;for(let t=-n;t<l-n;t++){const r=Math.abs(t-a+.5)-i/2*u,s=255-255*o$X(1-r,0,1);m[p+0]=s,m[p+1]=s,m[p+2]=s,m[p+3]=255,p+=f;}c+=t;}c+=a*t;}d+=l*f;}return new ImageData(m,c,h)}function u$2(t,e){if(!t)return null;const r=t.length/2,s=h$1*r,o=new Array(r);let n=0;const i=e===p$1.PRESSURE;for(let l=0;l<t.length;l+=2){const e=(t[l]+t[l+1])/2;o[n++]=i?Math.min(s,1-(1-e)*m$3):Math.min(s,e*m$3);}return o}var p$1;!function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE";}(p$1||(p$1={}));const h$1=.1,m$3=.5;class f$2{constructor(t,e,r,s,o){this.resolution=t,this.normalizationScale=e,this.amplitude=r,this.variants=s,this.texture=o;}dispose(){this.texture=s$1a(this.texture);}}const E$1={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function o$2(t){let n=null;for(const e of t){const t=e.type;if(u$1(e))if(t$V(n))n=t;else if(n!==t)return "uber"}return r$W(n)?n:"uber"}function i$3(t){let r=A$m.INVISIBLE;for(const{material:e}of t)if(f$1(e)){if(e.color[3]*e.opacity<1)return A$m.TRANSPARENT;r=A$m.OPAQUE;}return r}function c(t){let r=A$m.INVISIBLE;for(const{material:e}of t)if(f$1(e)){switch(e.objectTransparency){case A$m.TRANSPARENT:case A$m.INVISIBLE:return A$m.TRANSPARENT;case A$m.OPAQUE:if(e.opacity<1)return A$m.TRANSPARENT}r=A$m.OPAQUE;}return r}function f$1(t){return t.size*t.color[3]*t.opacity>0}function u$1(t){return t.size*t.color[3]>0}function s$2(t,r,e,n){return e*(n/t)*2*Math.tan(.5*r)}function l(r,e){const n=M$z(r,e,!0);return -1===n?e<r[0]?0:r.length:n}function a(t,r,e){return t.length-l(t,r*e.minimumEdgeLength)}function m$2(t,r,e,n){for(let o=0;o<t.length;o++){const i=t[o].index,c=r[o],f=r[o+1];if(n)for(let t=c;t<f;t++){const r=n[t];e.set(r,i);}else for(let t=c;t<f;t++)e.set(t,i);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const oe$1=s$17.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");let ne=class extends y$F{constructor(e){super(e),this.updatingHandles=new c$14,this.perObjectData=new Map,this.perObjectDataEvictionCache=new Set,this.renderers=new Map,this.numberOfRenderedEdges={[A$m.TRANSPARENT]:0,[A$m.OPAQUE]:0},this.gpuMemoryUsage=0,this.workerAbort=new AbortController,this.tmpModelPosition=n$16(),this.localOrigins=new e$5(new j$r(e.renderSR));}initialize(){this.worker=new n$5(this.schedule),this.componentColorManager=new r$8(this.rctx,3);const e=e$1w.createBuffer(4);for(let t=0;t<4;t++)e.sideness.set(t,0,0===t||3===t?0:1),e.sideness.set(t,1,0===t||1===t?0:1);this.verticesBufferObject=c$13.createVertex(this.rctx,F$r.STATIC_DRAW,e.buffer);}destroy(){this.destroyed||(this.perObjectData.forEach((e=>this._discardObjectEntry(e))),this.perObjectData.clear(),this.strokesTexture=s$1a(this.strokesTexture),this.componentColorManager=l$N(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=s$1a(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy());}get updating(){return this.updatingHandles.updating}get usedMemory(){return this.gpuMemoryUsage}get numberOfRenderedPrimitives(){return this.numberOfRenderedEdges[A$m.TRANSPARENT]+this.numberOfRenderedEdges[A$m.OPAQUE]}shouldRender(){return this.renderers.size>0}async addComponentObject(e,t,r,s,o,n,i,a){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let c;const d=new ce$1(new Promise((e=>c=e)),r.center,r.radius);this.perObjectData.set(e,d);const l=await this.updatingHandles.addPromise(this._addComponentGeometry(t,d,s,o,n,i,a));return this.setNeedsRender(),c(),l}async addOrUpdateObject3D(e,t,r,s){if(this.destroyed)return void oe$1.warn("Attempt to add an object to a destroyed instance");const o=this.perObjectData.get(e);let n;o?.renderables.length>0&&this.perObjectDataEvictionCache.add(o);const i=e.boundingVolumeWorldSpace.bounds,a=new ce$1(new Promise((e=>n=e)),E$K(i),k$H(i));this.perObjectData.set(e,a);const c=new Array;if(r.mergeGeometries&&e.geometries.length>1&&ae(e))c.push(this._addObjectMergedGeometries(e,a,t,r,s));else for(let d=0;d<e.geometries.length;d++){const o=e.geometryRecords[d];if(!o.material.supportsEdges)continue;const n=e.geometries[d];c.push(this._addGeometry(e,a,n,o,t[0],r,s));}await this.updatingHandles.addPromise(Promise.all(c)),this.perObjectDataEvictionCache.delete(a),this._discardObjectEntry(o),this.setNeedsRender(),n();}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach((e=>this._removeRenderable(e))),this.setNeedsRender()),e.loaded=null);}hasObject(e){return this.perObjectData.has(e)}async updateAllComponentOpacities(e,t){const r=t instanceof Array?e=>t[e]:()=>t;(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach((e=>{const t=e.components.meta.length;for(let s=0;s<t;s++){const t=r(s),o=e.components.meta[s],n=o.index;o.material.opacity=t,e.components.buffer.textureBuffer.setDataElement(n,1,3,255*t);}this._updateTransparency(e);})),this.setNeedsRender();}async getObjectMemoryUsage(e){return (await this._getObjectEntry(e)).renderables.reduce(((e,t)=>e+t.statistics.gpuMemoryUsage),0)}async updateAllComponentMaterials(e,t,r,s){const o=e instanceof O$t,n=!!r.hasSlicePlane,i=o$2(t),a=P.getKey(i,n,o);(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach((e=>{if(a!==e.rendererKey){const t=this.renderers.get(e.rendererKey),r=this._acquireRenderer(i,n,o);t.removeRenderable(e),t.refCount.decrement(),e.rendererKey=a,r.addRenderable(e);}for(let r=0;r<t.length;r++)e.components.meta[r].material=t[r];s&&this._updateComponentBuffer(e.components),this._updateTransparency(e);})),this.setNeedsRender();}async updateAllVerticalOffsets(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach((e=>{const r=e.components.meta;for(let s=0;s<r.length;s++)e.components.meta[s].verticalOffset=t?.[s]??0;this._updateComponentBuffer(e.components);})),this.setNeedsRender();}async updateObjectVisibility(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach((e=>e.visible=t)),this.setNeedsRender();}removeObject(e){const t=this.perObjectData.get(e);t&&(this.perObjectData.delete(e),this._discardObjectEntry(t));}async _getObjectEntry(e){const t=this.perObjectData.get(e);if(!t)throw "no object";if(await t.loaded,null==t.loaded)throw m$L();return t}removeAll(){this.perObjectData.forEach(((e,t)=>this.removeObject(t)));}render(e,t){if(this.numberOfRenderedEdges[t]=0,t$V(this.componentColorManager))return;this.localOrigins.updateViewMatrices(e.camera.viewMatrix);const r=e.camera.viewInverseTransposeMatrix,s=n$16(),o=new c$8;let n=0,i=0;if(this.renderers.forEach((r=>{0===r.refCount.value?(this.renderers.delete(r.key),r.dispose()):r.forEachRenderable((t=>{t.visible&&(n+=t.statistics.averageEdgeLength,i++,t.regular&&r.updateTechnique(e,!1),t.silhouette&&r.updateTechnique(e,!0));}),t);})),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures(),0===i)return;const c=40*n/i,d=e.camera.perScreenPixelRatio,l=new a$3(c,d,t);o$W(s,r[3],r[7],r[11]),o.set(s),r$V(l.transformWorldFromViewTH,o.high),r$V(l.transformWorldFromViewTL,o.low),a$13(l.transformViewFromCameraRelativeRS,e.camera.viewMatrix),o$14(de,l.transformViewFromCameraRelativeRS),u$18(l.transformNormalViewFromGlobal,de),l.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this.renderers.forEach((t=>{this._renderRegularEdges(t,e,l),this._renderSilhouetteEdges(t,e,l);}));}_updateTransparency(e){const t=i$3(e.components.meta),r=c(e.components.meta);t===e.edgeTransparency&&r===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=r,this.renderers.get(e.rendererKey).setRenderablesDirty());}_computeModelTransformWithLocalOrigin(e,t,r){if(e.getCombinedStaticTransformation(t,r),r$W(t.origin))this.localOrigins.register(t.origin);else {const e=o$W(this.tmpModelPosition,r[12],r[13],r[14]);t.origin=this.localOrigins.acquire(e);}return n$6(t.origin.vec3,r),t.origin}_updateComponentBuffer(e){const{meta:t,buffer:r}=e,s=new Uint8Array(4);for(let n=0;n<t.length;n++){const e=t[n].material,i=t[n].index,a=o$X(Math.round(e.size*T$1),0,255),c=o$X(e.extensionLength,-_,255-_)+_,d="solid"===e.type?u$1g.SOLID:u$1g.SKETCH,l=255*e.opacity,m=e.color,g=255*m[0],u=255*m[1],h=255*m[2],p=255*m[3];r.textureBuffer.setData(i,0,g,u,h,p),r.textureBuffer.setData(i,1,a,c,d,l),s$9(t[n].verticalOffset,s),r.textureBuffer.setData(i,2,s[0],s[1],s[2],s[3]);}}_createComponentBuffers(e){if(t$V(this.componentColorManager))return null;const t=new Array,r=this.componentColorManager.getBuffer(e.length);for(let o=0;o<e.length;o++){const s=e[o],n=r.acquireIndex();t.push({index:n,verticalOffset:0,material:s});}const s={meta:t,buffer:r};return this._updateComponentBuffer(s),s}_extractEdges(e,t,r,s,o,n=o.length){return this.worker.process({data:t,indices:o,indicesLength:n,writerSettings:e,skipDeduplicate:r},this.workerAbort.signal,s)}_createEdgeResources(e){const t={};if(t$V(this.verticesBufferObject))return t;if(e.regular.lodInfo.lengths.length>0){const r=new f$U(this.rctx,o$1z,{vertices:T$J,instances:d$18.glLayout},{vertices:this.verticesBufferObject,instances:c$13.createVertex(this.rctx,F$r.STATIC_DRAW,e.regular.instancesData.buffer)});t.regular={vao:r,lod:e.regular.lodInfo};}if(e.silhouette.lodInfo.lengths.length>0){const r=new f$U(this.rctx,o$1z,{vertices:T$J,instances:w$G.glLayout},{vertices:this.verticesBufferObject,instances:c$13.createVertex(this.rctx,F$r.STATIC_DRAW,e.silhouette.instancesData.buffer)});t.silhouette={vao:r,lod:e.silhouette.lodInfo};}return t}async _addGeometry(e,t,r,s,o,n,i){const a=r.vertexAttributes.get(O$J.POSITION),c=r.indices.get(O$J.POSITION),d=e$10(),l={position:a,indices:c,modelTransform:d,origin:this._computeModelTransformWithLocalOrigin(e,s,d)};return this._addPositionData(t,l,r.edgeIndicesLength,o,n,i)}async _addPositionData(e,t,r,s,o,n=!1){if(null==e.loaded)return;const i=this._createComponentBuffers([s]);if(t$V(i)||r<=0)return;const c$1=this._acquireRenderer(s.type,!!o.hasSlicePlane,!0),{modelTransform:d,origin:l}=t,m=t.indices,g=t.position,u=g.data.length/g.size,h=A$S.createBuffer(u);for(let a=0;a<u;a++)h.position.set(a,0,g.data[a*g.size+0]),h.position.set(a,1,g.data[a*g.size+1]),h.position.set(a,2,g.data[a*g.size+2]);m$2(i.meta,[0,h.componentIndex.count],h.componentIndex);const p=await this.updatingHandles.addPromise(this._extractEdges(c$1.writerSettings,h,!1,n,m,r));if(null==e.loaded)return;const{regular:f,silhouette:b}=this._createEdgeResources(p),y=(f?f.vao.size:0)+(b?b.vao.size:0),j={regular:f,silhouette:b,transform:{modelMatrix:d,origin:l},statistics:{gpuMemoryUsage:y,externalMemoryUsage:!1,averageEdgeLength:p.averageEdgeLength},components:i,visible:!0,edgeTransparency:i$3(i.meta),objectTransparency:c(i.meta),distanceToCamera:0,rendererKey:c$1.key};e.renderables.push(j),c$1.addRenderable(j),this.gpuMemoryUsage+=y;}async _addComponentGeometry(e,t,r,s,o,n,i){if(null==t.loaded)return 0;const c$1=this._createComponentBuffers(n);if(t$V(c$1))return 0;const d=o$2(n),l=this._acquireRenderer(d,i.hasSlicePlane||!1,!1),m=A$S.createBuffer(r.count);e$1t(m.position,r),m$2(c$1.meta,o,m.componentIndex,s);const g=!0,u=l.writerSettings,h=await this.updatingHandles.addPromise(this._extractEdges(u,m,g,!1,s));if(null==t.loaded)return 0;const{regular:p,silhouette:f}=this._createEdgeResources(h),b=(p?p.vao.size:0)+(f?f.vao.size:0),y={regular:p,silhouette:f,transform:e,statistics:{gpuMemoryUsage:b,externalMemoryUsage:!0,averageEdgeLength:h.averageEdgeLength},components:c$1,visible:!0,edgeTransparency:i$3(c$1.meta),objectTransparency:c(c$1.meta),distanceToCamera:0,rendererKey:l.key};return t.renderables.push(y),l.addRenderable(y),b}async _addObjectMergedGeometries(e,t,r,s,o){const n=new Map;let i=0,a=null,c=0;for(let b=0;b<e.geometries.length;b++){const t=e.geometries[b],r=e.geometryRecords[b];if(!r.material.supportsEdges)continue;!a&&r.origin&&(a=r);const s=t.vertexAttributes.get(O$J.POSITION);c+=s.data.length/s.size,i+=t.edgeIndicesLength;}const d=c>=65536?Uint32Array:Uint16Array,l=i?new d(i):null,m=[];let g=0;for(let b=0;b<e.geometries.length;b++){const t=e.geometries[b];if(!e.geometryRecords[b].material.supportsEdges)continue;const r=t.vertexAttributes.get(O$J.POSITION),s=t.indices.get(O$J.POSITION);let o=n.get(r.data);if(null==o){o=m.length/3;for(let e=0;e<r.data.length;e+=r.size)m.push(r.data[e+0]),m.push(r.data[e+1]),m.push(r.data[e+2]);n.set(r.data,o);}if(s)for(let e=0;e<t.edgeIndicesLength;e++)l[g++]=o+s[e];}const u=a||e.geometryRecords[0],h=e$10(),p=this._computeModelTransformWithLocalOrigin(e,u,h);for(let b=0;b<e.geometryRecords.length;b++)e.geometryRecords[b].origin=p;const f={position:{data:m,size:3},indices:l,modelTransform:h,origin:p};await this.updatingHandles.addPromise(this._addPositionData(t,f,l.length,r[0],s,o));}_acquireRenderer(e,t,r){const s=P.getKey(e,t,r);let o=this.renderers.get(s);return t$V(this.strokesTexture)&&(this.strokesTexture=a$1(this.rctx)),o||(o=new P(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:t,strokesTexture:this.strokesTexture,legacy:r,spherical:this.viewingMode===l$O.Global}),this.renderers.set(s,o)),o.refCount.increment(),o}_removeRenderable(e){ie(e);const t=this.renderers.get(e.rendererKey);if(t){t.removeRenderable(e),t.refCount.decrement(),"origin"in e.transform&&this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const t of e.components.meta)e.components.buffer.releaseIndex(t.index);}}_updateObjectCameraDistances(e){const t=e.camera.eye,r=e.camera.viewForward,s=n$16(),o=e=>{const{center:o,radius:n}=e;J$g(s,o,t);const i=P$u(s,r),a=i<-n?1/0:i<n?0:i-n;e.renderables.forEach((e=>e.distanceToCamera=a));};this.perObjectData.forEach(o),this.perObjectDataEvictionCache.forEach(o);}_renderRegularEdges(e,t,r){const s=e.bindRegularEdges(r,t),o=r.transparency;e.forEachRenderable((n=>{if(!n.visible||!n.regular)return;const i=a(n.regular.lod.lengths,n.distanceToCamera,r),a$1="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):o$1g;e.renderRegularEdges(s,n,t,i,a$1),this.numberOfRenderedEdges[o]+=i;}),o);}_renderSilhouetteEdges(e,t,r){const s=e.bindSilhouetteEdges(r,t),o=r.transparency;e.forEachRenderable((n=>{if(!n.visible||!n.silhouette)return;const i=a(n.silhouette.lod.lengths,n.distanceToCamera,r),a$1="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):o$1g;e.renderSilhouetteEdges(s,n,t,i,a$1),this.numberOfRenderedEdges[o]+=i;}),o);}};function ie(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null);}function ae(e){let t=null,s=null;for(let o=0;o<e.geometries.length;o++){const n=e.geometryRecords[o];if(n.material.supportsEdges){if(t){if(!i$1n(t,n.transformation))return !1}else t=n.transformation;if(!s&&r$W(n.origin))s=n;else if(r$W(s?.origin)&&r$W(n.origin)&&s.origin.id!==n.origin.id)return !1}}return !0}e$Y([d$R({constructOnly:!0})],ne.prototype,"rctx",void 0),e$Y([d$R({constructOnly:!0})],ne.prototype,"renderSR",void 0),e$Y([d$R({constructOnly:!0})],ne.prototype,"viewingMode",void 0),e$Y([d$R({constructOnly:!0})],ne.prototype,"techniqueRepository",void 0),e$Y([d$R({constructOnly:!0})],ne.prototype,"setNeedsRender",void 0),e$Y([d$R({constructOnly:!0})],ne.prototype,"schedule",void 0),e$Y([d$R({readOnly:!0})],ne.prototype,"updatingHandles",void 0),e$Y([d$R({readOnly:!0})],ne.prototype,"updating",null),ne=e$Y([n$18("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],ne);class ce$1{constructor(e,t,r){this.center=t,this.radius=r,this.renderables=new Array,this.loaded=e,this.loaded.then((()=>{null!=this.loaded&&(this.loaded=!0);}));}}const de=e$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function e$3(e){const u=e.capabilities.disjointTimerQuery;return t$V(u)?null:u.timestampBits()>0?new i$2(u):r$4?null:new s$1(u)}class i$2{constructor(t){this.timer=t,this.start=t.createQuery(),t.createTimestamp(this.start);}stop(t,e=50){this.end=this.timer.createQuery(),this.timer.createTimestamp(this.end),this._checkQueryResult(t,e);}_checkQueryResult(t,e){if(!this.timer.resultAvailable(this.end))return void setTimeout((()=>this._checkQueryResult(t,e)),e);if(this.timer.disjoint())return void t(null);const i=this.timer.getResult(this.start),s=this.timer.getResult(this.end);t((s-i)/1e6);}}class s$1{constructor(t){this.timer=t,this.query=t.createQuery(),r$4=!0,this.timer.beginTimeElapsed(this.query);}stop(t,e=50){this.timer.endTimeElapsed(),r$4=!1,this._checkQueryResult(t,e);}_checkQueryResult(t,e){const i=this.timer.resultAvailable(this.query),s=this.timer.disjoint();if(!i||s)s?t(null):setTimeout((()=>this._checkQueryResult(t,e)),e);else {const e=this.timer.getResult(this.query);t(e/1e6);}}}let r$4=!1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var i$1;!function(e){e[e.Prepare=0]="Prepare",e[e.Shadowmap=1]="Shadowmap",e[e.Lineardepth=2]="Lineardepth",e[e.Normals=3]="Normals",e[e.SSAO=4]="SSAO",e[e.Opaque=5]="Opaque",e[e.OpaqueEdges=6]="OpaqueEdges",e[e.Transparent=7]="Transparent",e[e.TransparentEdges=8]="TransparentEdges",e[e.Hudvisibility=9]="Hudvisibility",e[e.TransparentTerrain=10]="TransparentTerrain",e[e.Atmosphere=11]="Atmosphere",e[e.Laserline=12]="Laserline",e[e.Occluded=13]="Occluded",e[e.Antialiasing=14]="Antialiasing",e[e.Highlights=15]="Highlights",e[e.HudOccluded=16]="HudOccluded",e[e.HudNotoccluded=17]="HudNotoccluded";}(i$1||(i$1={}));const n$4=["prepare","shadowmap","lineardepth","normals","ssao","opaque","opaque edges","transparent","transparent edges","hudvisibility","transparent terrain","atmosphere","laserline","occluded","antialiasing","highlights","hudOccluded","hudNotoccluded"];class o$1 extends e$1x{constructor(){super("total"),this.total=0,this.frameCount=0;}}class m$1{constructor(){this._startTime=n$1e(0),this._lastSample=n$1e(0),this._enableGPUTimer=0,this.totalTime=new o$1,this.gpuTime=new e$1x("gpu",9),this.renderPassTimings=n$4.map((e=>new e$1x(e)));}get elapsedTime(){return n$1e(performance.now()-this._startTime)}enableGPUTimer(){return ++this._enableGPUTimer,{remove:h$19((()=>--this._enableGPUTimer))}}prerender(e){this._startTime=this._lastSample=n$1e(performance.now()),this._enableGPUTimer&&(this._gpuTimer=e$3(e));}advance(e){const r=n$1e(performance.now());this.renderPassTimings[e].record(r-this._lastSample),this._lastSample=r;}postrender(){r$W(this._gpuTimer)&&(this._gpuTimer.stop((r=>r$W(r)&&this.gpuTime.record(r)),16),this._gpuTimer=null);const r=performance.now()-this._startTime;this.totalTime.record(r),this.totalTime.total+=r,this.totalTime.frameCount++;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const oe=.9;let _e=class extends y$F{constructor(e,r,t,i,n,a,h,d,o){super({}),this._materialRepository=e,this._shaderTechniqueRepository=t,this._rctx=i,this._compositingHelper=n,this._magnifierHelper=a,this._requestRender=h,this._stage=o,this._materialRenderers=new Map,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this.performanceInfo=new m$1,this._antialiasing=e$1y.SMAA,this._oitEnabled=!1,this._multipassTerrain=!0,this._transparentTerrain=!1,this._hasAnimations=!1,this._animationTimestep=n$1e(0),this._handles=new u$U,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new R$1(this._rctx,t),this._oitEnabled=this._hasOITSupport,this._requestRender(),this._offscreenRendering=new T$3(this._rctx,this._compositingHelper),this._sliceHelper=new n$8,this._shadowMap=new Q$a(this._rctx,o.viewingMode,2),this._ssaoHelper=new x$m(t,this._rctx,(()=>this._requestRender())),this._highlight=new O(t,this._rctx),this._shadowHighlight=new v$1(this._rctx,o.viewingMode),this._shadowAccumulator=new N$1(this._rctx,t,o,(e=>{const r=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureCameraBindParameters(e.camera,e.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=r;}),((e,r,t)=>{e.shadowMap.start(e.camera,r,t),this._renderShadowCascades(A$D.MATERIAL_DEPTH_SHADOWMAP_ALL,e.shadowMap),e.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(e.camera,e.contentCamera);}),(()=>this._requestRender())),this._renderContext=new c$x(this._rctx,this._offscreenRendering,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new i$7({renderContext:this._renderContext,shaderTechniqueRepository:t,textureRep:r,materialRep:this._materialRepository,requestRender:this._requestRender,schedule:d}),this.renderPassManager=new M(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([l$M((()=>this._stage.state.camera),(()=>this._requestRender()),w$x),l$M((()=>t$E.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES),(e=>{this._renderHiddenTransparentEdges=e?()=>this._renderEdges(A$m.TRANSPARENT):()=>{},this._requestRender();}),h$V)]);}get _bindParameters(){return this._renderContext.bindParameters}get hasWater(){return this._hasWater||this._hasOverlayWater}get hasWaterReflection(){return this.hasWater&&this._waterReflectionEnabled}normalizeCtorArgs(){return {}}dispose(){this._handles.destroy(),this._smaaPass.dispose(),this._materialRenderers.forEach((e=>e.dispose())),this._materialRenderers.clear(),this._edgeView=l$N(this._edgeView),this._offscreenRendering.dispose(),this._fallbackDepthStencilTexture=s$1a(this._fallbackDepthStencilTexture),this._shadowMap.enabled=!1,this._shadowMap.dispose(),this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),a$1n.prune(),this._content.clear();}disposeOffscreenBuffers(){this._offscreenRendering.dispose(),this._shadowMap.dispose(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers();}get updating(){return this._antialiasing===e$1y.SMAA&&this._smaaPass.updating||r$W(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return t$V(this._edgeView)&&(this._edgeView=new ne({rctx:this._rctx,renderSR:this._stage.renderSR,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:e=>this._stage.resourceController.schedule(e)}),this._handles.add(l$M((()=>o$1m(this._edgeView,(e=>e.updating))),(()=>this._requestRender()),U$s)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return C$C(this._bindParameters.ssr.reprojectionMatrix,o$1g)}set _reprojectionMatrix(e){c$1s(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal");}get shadowsEnabled(){return !!this._shadowMap?.enabled}setRenderParameters(e){const{_shadowMap:r,_ssaoHelper:t,_bindParameters:s}=this;if(void 0!==e.screenSpaceReflectionsEnabled&&s.ssr.enabled!==e.screenSpaceReflectionsEnabled&&(s.ssr.enabled=e.screenSpaceReflectionsEnabled,this._requestRender()),void 0!==e.shadowMap&&r.enabled!==e.shadowMap&&(r.enabled=e.shadowMap,this._requestRender()),void 0!==e.shadowMapMaxCascades&&r.maxCascades!==e.shadowMapMaxCascades&&(r.maxCascades=e.shadowMapMaxCascades,this._requestRender()),r$W(e.environment)){r$W(e.environment.weather)&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=e.weatherVisible,this._renderContext.bindParameters.weather=e.environment.weather,this._renderContext.bindParameters.weatherVisible=e.weatherVisible),void 0!==e.environment.lighting.ambientOcclusionEnabled&&t.enabled!==e.environment.lighting.ambientOcclusionEnabled&&(t.enabled=e.environment.lighting.ambientOcclusionEnabled,this._requestRender()),void 0!==e.environment.lighting.waterReflectionEnabled&&this._waterReflectionEnabled!==e.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=e.environment.lighting.waterReflectionEnabled,this._requestRender());const r="sun"===e.environment.lighting.type;s.enableFillLights!==r&&(s.enableFillLights=r,this._requestRender());}e.background&&this._offscreenRendering.background!==e.background&&(this._offscreenRendering.background=e.background,this._requestRender());const i=e.antialiasingEnabled?e$1y.SMAA:e$1y.NONE;void 0!==e.antialiasingEnabled&&this._antialiasing!==i&&(this._antialiasing=i,this._requestRender()),void 0!==e.highQualityTransparency&&this._multipassTerrain!==e.highQualityTransparency&&(this._multipassTerrain=e.highQualityTransparency,this._oitEnabled=e.highQualityTransparency&&this._hasOITSupport,this._requestRender()),void 0!==e.defaultHighlightOptions&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),void 0!==e.overlays&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),void 0!==e.slicePlane&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e$X(e.slicePlane),this._requestRender()),void 0!==e.transparentTerrain&&this._transparentTerrain!==e.transparentTerrain&&(this._transparentTerrain=e.transparentTerrain,this._requestRender()),void 0!==e.hasOverlayWater&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),void 0!==e.shadowCastOptions&&this._shadowAccumulator.setOptions(e.shadowCastOptions);}get hasSlicePlane(){return !!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlendWorking}modify(e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:t,updates:s}=e;if(0===r.length&&0===t.length&&0===s.length)return;t.forAll((({id:e})=>this._content.delete(e))),r.forAll((e=>this._content.set(e.id,e)));const n=r$B(e);let a=!1;n.forEach(((e,r)=>{let t=this._materialRenderers.get(r);if(!t){if(!(e.adds.length>0))return;t=new A$i(this._rctx,this._materialRepository,r),this._materialRenderers.set(r,t);}t.modify(e),t.isEmpty&&(a=!0);})),a&&this._materialRenderers.forEach(((e,r)=>{e.isEmpty&&(this._materialRenderers.delete(r),e.dispose());})),this._hasHighlights=n$1m(this._materialRenderers,(e=>e.hasHighlights)),this._bindParameters.hasOccludees=n$1m(this._materialRenderers,(e=>e.hasOccludees)),this._hasWater=n$1m(this._materialRenderers,(e=>e.hasWater)),this._needsTransparentPass=n$1m(this._materialRenderers,(e=>e.requiresSlot(E$G.TRANSPARENT_MATERIAL,A$D.MATERIAL))),this._hasHUDElements=n$1m(this._materialRenderers,(e=>e.requiresSlot(E$G.LINE_CALLOUTS_HUD_DEPTH,A$D.MATERIAL)||e.requiresSlot(E$G.HUD_MATERIAL,A$D.MATERIAL)||e.requiresSlot(E$G.LABEL_MATERIAL,A$D.MATERIAL))),this._requestRender();}updateAnimation(e){return this._hasAnimations=!1,this._materialRenderers.forEach((r=>this._hasAnimations=r.updateAnimation(e)||this._hasAnimations)),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations}get animationTimestep(){return this._animationTimestep}updateLightSources(e,r,t){this._bindParameters.lighting.groundLightingFactor=r,this._bindParameters.lighting.globalFactor=t,this._bindParameters.lighting.set(e);}render(e,r,t,s){this._isRendering=!0,this.performanceInfo.prerender(this._rctx),this._bindParameters.transparencyPassType=O$L.NONE;const i=this._offscreenRendering;i.needLastFrameColorTexture=this.hasWaterReflection,i.advanceCurrentRenderTarget();const n=G$n(this._sliceHelper.plane);s===D$u.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),r.setGLViewport(this._rctx),this._ensureCameraBindParameters(r,t),this._renderPlugins.prepareRender(),this.performanceInfo.advance(i$1.Prepare);const a=this._computeDepthRange(r);this._renderShadowMap(e,r,this._bindParameters.lighting.lightingMainDirection,a),this.performanceInfo.advance(i$1.Shadowmap),i.initializeFrame(r),this._ensureBindParameters(r,t),this._renderLinearDepth(),this.performanceInfo.advance(i$1.Lineardepth),this._accumulateShadows(a,r,t),this._renderNormal(),this.performanceInfo.advance(i$1.Normals),this._ensureBindParametersSSR(),this._ssaoHelper.computeSSAO(this._bindParameters,i.linearDepthTexture,i.normalTexture),this.performanceInfo.advance(i$1.SSAO),this._renderContext.pass=A$D.MATERIAL,i.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(i$1.Opaque);const o=this._multipassTerrain&&this._transparentTerrain;this._renderTerrainLinearDepth(o),this._setMultipassEnabled(o),this._setTerrainCulling(o),this._renderEdges(A$m.OPAQUE),this.performanceInfo.advance(i$1.OpaqueEdges),this._offscreenRendering.bindTarget(this._offscreenRendering.currentColorTarget,this._offscreenRendering.mainDepth),this._renderSlot(E$G.VOXEL),this._renderHiddenTransparentEdges();const _=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;_&&(this._oitEnabled?this._renderOrderIndependentTransparency((()=>this._renderTransparentGeometry()),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(i$1.Transparent),this._renderGeometryLinearDepth(o);const l=this._renderHUDVisibility();o||this._renderInternalSlot(E$G.LINE_CALLOUTS),this.performanceInfo.advance(i$1.Hudvisibility),this._renderEdges(A$m.TRANSPARENT,o),this.performanceInfo.advance(i$1.TransparentEdges),this._renderTransparentTerrain(),this._transparentTerrain&&l&&(o?this._renderLineCallouts(c$G.Occluded):i.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(c$G.Occluded,i.framebuffer),this.performanceInfo.advance(i$1.HudOccluded)),this.performanceInfo.advance(i$1.TransparentTerrain),this._setTerrainCulling(!1),this._transparentTerrain&&(i.compositeTransparentTerrainOntoMain(this._bindParameters),o&&(this._renderEdges(A$m.OPAQUE),this.performanceInfo.advance(i$1.OpaqueEdges),_&&(this._oitEnabled?this._renderOrderIndependentTransparency((()=>this._renderTransparentGeometry()),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(i$1.Transparent),this._renderEdges(A$m.TRANSPARENT),this.performanceInfo.advance(i$1.TransparentEdges))),o&&this._renderLineCallouts(c$G.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),i.renderToTargets((()=>{this._renderInternalSlot(E$G.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(E$G.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(E$G.LASERLINES);}),i.currentColorTarget,i.mainDepth),this.performanceInfo.advance(i$1.Atmosphere),this._renderPlugins.needsLaserlineWithContrastControl&&i.renderTmpAndCompositeToMain((()=>this._renderSlot(E$G.LASERLINES_CONTRAST_CONTROL)),this._bindParameters,o$r.PremultipliedAlpha),this.performanceInfo.advance(i$1.Laserline),this._renderOccluded(),this.performanceInfo.advance(i$1.Occluded);const c=s===D$u.ON&&this._magnifierHelper.enabled,p=c&&t$V(e)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):e;this._rctx.bindFramebuffer(p);const m=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(this._antialiasing,m)&&r$W(m)&&this._compositingHelper.composite(this._bindParameters,m,o$r.None),this.performanceInfo.advance(i$1.Antialiasing),this._renderHUD(c$G.NotOccluded,p),this.performanceInfo.advance(i$1.HudNotoccluded),this._renderHighlights(p,this._bindParameters),this.performanceInfo.advance(i$1.Highlights),c&&this._magnifierHelper.render(this._rctx,this._bindParameters),p!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.tmpColorTexture,o$r.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=n,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.postrender();}finish(e){if(this._hasAnimations||(this._animationTimestep=n$1e(0)),e===t$1n.BACKGROUND){this._rctx.gl.getError();const e=this.performanceInfo.elapsedTime/e$6;this._animationTimestep=n$1e(Math.max(this._animationTimestep*oe+e*(1-oe),r$7));}}readDepthPixels(e,r,t){const s=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const r=_$z.COLOR_BUFFER_BIT|_$z.DEPTH_BUFFER_BIT|_$z.STENCIL_BUFFER_BIT;this._rctx.clearSafe(r),this._renderGeometryAndTransparentTerrainPass(A$D.MATERIAL_DEPTH);}s.readPixels(r[0],r[1],r[2],r[3],P$w.RGBA,G$m.UNSIGNED_BYTE,t);}readHUDVisibility(e,r,t,s,i){this._offscreenRendering.bindTarget(this._offscreenRendering.hudVisibility).readPixels(e,r,t,s,P$w.RGBA,G$m.UNSIGNED_BYTE,i);}readAccumulatedShadow(e,r){return this._shadowAccumulator.readAccumulatedShadow(e,r)}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e;}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e;}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render();}_renderEdges(e,r=!1){const t=this._edgeView;r$W(t)&&t.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain((()=>t.render(this._bindParameters,e)),this._bindParameters,o$r.Alpha,r);}_renderShadowMap(e,r,t,s){const i=this._shadowMap;i.enabled&&(i.start(r,t,s),this._shadowHighlight.updateParameters(r,t),this.needsShadowHighlight?(this._renderShadowCascades(A$D.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,this._shadowMap,(e=>i.takeCascadeSnapshotTo(e,J$a.Highlight))),i.clear(),this._renderShadowCascades(A$D.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,this._shadowMap,(e=>{i.takeCascadeSnapshotTo(e,J$a.Default),this._renderGeometryAndTransparentTerrainPass(A$D.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT);}))):this._renderShadowCascades(A$D.MATERIAL_DEPTH_SHADOWMAP_ALL),i.finish(e),r.setGLViewport(this._rctx));}_renderShadowCascades(e,r=this._shadowMap,t=(e=>{})){for(const s of r.getCascades())s.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(s.camera,s.camera),this._renderGeometryAndTransparentTerrainPass(e),t(s);}get _needsLinearDepth(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreenRendering.renderToTargets((()=>this._renderGeometryAndTransparentTerrainPass(A$D.MATERIAL_DEPTH)),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth),this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture;}_renderTerrainLinearDepth(e){if(e){const e=this._renderContext.pass;this._renderContext.pass=A$D.MATERIAL_DEPTH,this._offscreenRendering.renderToTargets((()=>this._renderTransparentTerrain()),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.pass=e;}else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture;}_renderGeometryLinearDepth(e){if(e){const e=this._renderContext.pass;this._offscreenRendering.renderToTargets((()=>this._renderGeometryPass(A$D.MATERIAL_DEPTH)),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=e;}else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture;}get needsNormal(){return this._ssaoHelper.enabled}_renderNormal(){this.needsNormal?this._offscreenRendering.renderToTargets((()=>{this._renderGeometryAndTransparentTerrainPass(A$D.MATERIAL_NORMAL);}),this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal);}get needsDepthRange(){return this._shadowMap.enabled||this.needsShadowCast}_computeDepthRange(e){if(!this.needsDepthRange)return f$5;const r=M$1(e,this._content,this._stage.layers);return t$5(r,this.renderPlugins.queryDepthRange(e)),r.near=Math.max(e.near,r.near),r.far=Math.min(e.far,r.far),r}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.pass=e,this._renderGeometryPass(e),this._renderTransparentTerrain();}_renderGeometryPass(e){this._renderContext.pass=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry();}_renderOpaqueGeometry(){this._renderSlot(E$G.INTEGRATED_MESH),this._renderSlot(E$G.OPAQUE_TERRAIN),this._renderInternalSlot(E$G.OPAQUE_MATERIAL),this._renderSlot(E$G.OPAQUE_MATERIAL),this._renderSlot(E$G.POSTPROCESSING_ENVIRONMENT_OPAQUE);}_renderTransparentGeometry(){this._renderInternalSlot(E$G.TRANSPARENT_MATERIAL),this._renderSlot(E$G.TRANSPARENT_MATERIAL);}_renderTransparentTerrain(){this._renderSlot(E$G.TRANSPARENT_TERRAIN);}_renderHUDVisibility(){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility((()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(E$G.OCCLUSION_PIXELS);}),this._multipassTerrain&&this._transparentTerrain),e}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===c$G.Occluded?this._offscreenRendering.renderToTargets((()=>this._renderInternalSlot(E$G.LINE_CALLOUTS)),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(E$G.LINE_CALLOUTS);}_renderHUD(e,r){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency((()=>this._renderHUDElements(e)),!0),this._rctx.bindFramebuffer(r),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.hudColorTexture,o$r.PremultipliedAlpha)):e===c$G.Occluded?this._offscreenRendering.renderToTargets((()=>this._renderHUDElements(c$G.Occluded)),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(e));}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(E$G.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(E$G.HUD_MATERIAL),this._renderInternalSlot(E$G.LABEL_MATERIAL);}get needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this.needsHighlight}_renderHighlights(e,r){if(!this.needsHighlight)return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const t=this._highlight,s=this._offscreenRendering.renderToTargets((()=>{this._renderGeometryAndTransparentTerrainPass(A$D.MATERIAL_HIGHLIGHT),this._rctx.clearSafe(_$z.DEPTH_BUFFER_BIT),this._renderHUDElements(c$G.Both);}),this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=s.colorTexture,this.needsShadowHighlight&&this._shadowHighlight.render(r,e),t.render(this._bindParameters,s,e);}get needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,r,t){this.needsShadowCast&&this._shadowAccumulator.renderAccumulation(this._offscreenRendering.linearDepthTexture,e,r,t);}_renderOrderIndependentTransparency(e,r){const t=t=>{this._bindParameters.transparencyPassType=t,this._offscreenRendering.renderOITPass((()=>e()),t,r);},s=this._renderContext.pass;this._renderContext.pass=A$D.MATERIAL_ALPHA,t(O$L.Alpha),this._renderContext.pass=A$D.MATERIAL,t(O$L.Color),t(O$L.FrontFace),this._offscreenRendering.compositeTransparentOntoOpaque(this._bindParameters,r),this._bindParameters.transparencyPassType=O$L.NONE,this._renderContext.pass=s,this._oitUsed=!0;}_disposeOITBuffers(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget)),this._oitUsed=!1;}_renderOccluded(){let e=0;this._materialRenderers.forEach(((r,t)=>{t&&t.isVisible()&&t.renderOccluded===h$Z.OccludeAndTransparentStencil&&(e|=t.renderOccluded,pe.push(t));}));const r=this._offscreenRendering,t=(t,s,i,n,a)=>{0!=(e&s)&&(r.renderToTargets(i,r.tmpColor,r.mainDepth,[0,0,0,0],n,a),r.compositeOccludedOntoMain(this._bindParameters,t));};0!==pe.length&&(this._renderInternalSlot(E$G.OCCLUDER_MATERIAL,pe),t(.5,h$Z.OccludeAndTransparentStencil,(()=>this._renderInternalSlot(E$G.TRANSPARENT_OCCLUDER_MATERIAL,pe)),!1,!1),pe.length=0),this._materialRenderers.forEach(((r,t)=>{t&&t.isVisible()&&(t.renderOccluded===h$Z.OccludeAndTransparent||t.renderOccluded===h$Z.Transparent||t.renderOccluded===h$Z.Opaque)&&(e|=t.renderOccluded,ce.push(t));}));const s=this._renderPlugins.renderOccludedFlags;if(e|=s,!e)return;const i=e=>{this._renderContext.renderOccludedMask=e,s>h$Z.Occlude&&this._renderSlot(E$G.OCCLUDED_TERRAIN),this._renderInternalSlot(E$G.OPAQUE_MATERIAL,ce),this._renderInternalSlot(E$G.TRANSPARENT_MATERIAL,ce),this._renderInternalSlot(E$G.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,ce),this._renderContext.resetRenderOccludedMask();};this._renderContext.pass=A$D.MATERIAL,t(.5,h$Z.OccludeAndTransparent,(()=>i(h$Z.OccludeAndTransparent)),!0,a$1l.OutlineVisualElementMask),t(.5,h$Z.Transparent,(()=>i(h$Z.Transparent)),!0,a$1l.OutlineVisualElementMask),t(1,h$Z.Opaque,(()=>i(h$Z.Opaque)),!0,a$1l.OutlineVisualElementMask),ce.length=0;}_renderAntiAliasing(e,r){if(e===e$1y.SMAA){if(this._smaaPass.enable((()=>this._requestRender()))&&r$W(r))return this._smaaPass.render(r),!0}else this._smaaPass.disable();return !1}_ensureCameraBindParameters(e,r){this._bindParameters.camera=e,this._bindParameters.contentCamera=r;}_ensureBindParameters(e,r){this._ensureCameraBindParameters(e,r);const t=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=t.hudVisibilityTexture,this._bindParameters.highlightDepthTexture=t.depthTexture??this._getFallbackDepthTexture();}_ensureBindParametersSSR(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=o$1g:(h$U(ge,this._bindParameters.camera.viewMatrix),h$U(me,this._bindParameters.camera.projectionMatrix),u$Z(ue,ge,me),u$Z(ue,this._renderContext.lastFrameCamera.viewMatrix,ue),u$Z(ue,this._renderContext.lastFrameCamera.projectionMatrix,ue),this._reprojectionMatrix=ue),this._bindParameters.ssr.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._bindParameters.ssr.lastFrameColorTexture=null,this._bindParameters.ssr.enabled=this.hasWaterReflection;}_renderInternalSlot(e,r){let t=!1;return this._bindParameters.slot=e,r$W(r)?r.forEach((e=>{if(!e.shouldRender(this._renderContext))return;const r=this._materialRenderers.get(e);r$W(r)&&(t=r.render(this._renderContext.pass,this._bindParameters)||t);})):this._materialRenderers.forEach(((e,r)=>{r.shouldRender(this._renderContext)&&e.render(this._renderContext.pass,this._bindParameters)&&(t=!0);})),t}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=p$12(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){return {offscreen:this._offscreenRendering?.gpuMemoryUsage??0,highlights:(this._highlight?.gpuMemoryUsage??0)+(this._shadowHighlight?.gpuMemoryUsage??0),shadows:this._shadowMap?.gpuMemoryUsage??0,ssao:this._ssaoHelper?.gpuMemoryUsage??0}}get test(){const e=this;return {offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,getFramebufferTexture:r=>{switch(r){case le.Color:return e._offscreenRendering.colorTexture;case le.LinearDepth:return e._offscreenRendering.linearDepthTexture;case le.Normals:return e._offscreenRendering.normalTexture;case le.ShadowMap:return e._shadowMap.depthTexture;case le.HudVisibility:return e._offscreenRendering.hudVisibilityTexture;case le.Highlight:return e._offscreenRendering.highlightTexture}}}}};var le;e$Y([d$R()],_e.prototype,"_shadowAccumulator",void 0),e$Y([d$R()],_e.prototype,"_smaaPass",void 0),e$Y([d$R()],_e.prototype,"_antialiasing",void 0),e$Y([d$R()],_e.prototype,"_edgeView",void 0),e$Y([d$R()],_e.prototype,"updating",null),e$Y([d$R()],_e.prototype,"isCameraFinal",null),_e=e$Y([n$18("esri.views.3d.webgl-engine.lib.Renderer")],_e),function(e){e[e.Color=0]="Color",e[e.LinearDepth=1]="LinearDepth",e[e.Normals=2]="Normals",e[e.ShadowMap=3]="ShadowMap",e[e.HudVisibility=4]="HudVisibility",e[e.Highlight=5]="Highlight";}(le||(le={}));const ce=[],pe=[],me=e$10(),ge=e$10(),ue=e$10();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class r$3 extends y$L{constructor(e,t,r){super(e,t),this.newCache=r,this._refCount=1;}dispose(){--this._refCount>0||super.dispose();}ref(){++this._refCount;}bindTechnique(t,r,s,n){this.useProgram(t.program);const o=r$W(s)?s.slot:null;return t.bindPipelineState(this,o,n),r$W(r)&&r$W(s)&&t.bindPass(r,s),t.program}get test(){return this.programCache.test}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const g$2=s$17.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");let T=class extends y$F{constructor(e,t,s){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=s,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new n$17,this._frameTask=e.resourceController.scheduler.registerTask(L$D.TEXTURE_UNLOAD);}normalizeCtorArgs(){return {}}dispose(){this._frameTask.remove(),this._stage.forEachOfType(e$1g.Texture,(e=>e.unload()));}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return t$V(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(m$r,new r$x)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),c$$(t.loadingPromise,t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach((t=>{const r=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);r>=0&&r!==t.previousToken&&(t.previousToken=r,e=!0);})),e&&this.events.emit("changed",t$1n.BACKGROUND);}_createNewRef(e){const t=this._stage.getObject(e);if(t$V(t))return e$18(void 0!==t),null;const r=t.events.on("unloaded",(()=>{r.remove(),this._onTextureUnloaded(e);})),s=new x(e,(()=>{this._frameTask.schedule((()=>{s.isUnreferenced&&t.unload();}));}));return this._textures.set(e,s),s.ref(),r$W(t.glTexture)?(this._updateGLTexture(s,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule((()=>{const r=t.load(this._rctx,(()=>this.textureTechnique)),o=r=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,r),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),s),i=e=>(this._loadingCount--,s.loadingPromise=null,g$T(e)||g$2.error(e),null);return k$F(r)?r.then(o,i):o(r)})),s.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",t$1n.UPDATE);}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e);}};e$Y([d$R()],T.prototype,"_loadingCount",void 0),e$Y([d$R()],T.prototype,"_frameTask",void 0),e$Y([d$R()],T.prototype,"updating",null),T=e$Y([n$18("esri.views.3d.webgl-engine.lib.TextureRepository")],T);class x{constructor(e,t){this.id=e,this._release=t,this._refCount=0;}get isUnreferenced(){return 0===this._refCount}ref(){++this._refCount;}release(){--this._refCount,this._refCount>0||(0!==this._refCount?(g$2.error("Cannot dereference texture that has no references!"),this._refCount=0):this._release());}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const u=s$17.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");let g$1=class extends y$F{constructor(){super(...arguments),this._data=new Array,this._state=i$1a.NOT_LOADED;}dispose(){this._state=i$1a.NOT_LOADED,this._data.forEach((t=>t.dispose())),this._data.length=0;}get updating(){return this._state===i$1a.LOADING}get resourceState(){return this._state}loadTextures(t){const r=[a$1o("esri/images/materials/water/normals.jpg"),a$1o("esri/images/materials/water/perturbation.jpg")];this._state=i$1a.LOADING,Promise.all(r.map((t=>t$10(t)))).then((e=>{e.forEach((e=>this._data.push(new u$X(t,{target:M$v.TEXTURE_2D,pixelFormat:P$w.RGBA,dataType:G$m.UNSIGNED_BYTE,wrapMode:D$q.REPEAT,samplingMode:L$C.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8,width:e.width,height:e.height},e)))),this._state=i$1a.LOADED;})).catch((t=>{u.error("Failed to load textures for water material.",t),this._state=i$1a.NOT_LOADED;}));}bind(t){this._state===i$1a.LOADED&&(t.bindTexture("texWaveNormal",this._data[0]),t.bindTexture("texWavePerturbation",this._data[1]));}};e$Y([d$R()],g$1.prototype,"_state",void 0),e$Y([d$R({type:Boolean,readOnly:!0})],g$1.prototype,"updating",null),g$1=e$Y([n$18("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],g$1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const n$3=new Map;function t(){return n$3}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
class g extends e$C{constructor(e,t,r,s,i,o){super(),this._rctx=e,this._renderScene=t,this._requestRenderScene=r,this._renderOverlay=s,this._forceCameraHook=i,this._disposeOffscreenBuffers=o,this.supersample=!0,this._screenshotQueue=new Array;}dispose(){this._rctx=null;}takeScreenshot(e){this._requestRenderScene(t$1n.BACKGROUND);const t=D$o();return this._screenshotQueue.push({settings:e,resolver:t}),t.promise}update(e){for(const t of this._screenshotQueue){if(this.isDisposed){t.resolver.reject();continue}const r={...t.settings,pixelRatio:t.settings.pixelRatio*e.viewCamera.pixelRatio},s=this._renderScreenshot(e,r);t.resolver(s);}this._screenshotQueue.length=0;}_renderScreenshotOverlay(t,r,s){if(t$V(this._renderOverlay))return r;t.width=r.width,t.height=r.height;const i=t.getContext("2d"),o=s.pixelRatio;return i.save(),i.translate(0,r.height),i.scale(1,-1),s.region&&i.translate(-s.region.x,-s.region.y),i.scale(o,o),r=this._renderOverlay(t,r),i.restore(),r}_readbackScreenshot(e,t){return e.resample?this._readbackScreenshotResampled(e,t):this._readbackScreenshotImmediate(e,t)}_readbackScreenshotResampled(e,t){const{framebufferWidth:r,framebufferHeight:s,region:i,resample:o}=e,n=this._ensureScreenshotEncodeCanvas();let d=m$12(r,s,n);this._rctx.gl.readPixels(0,0,r,s,P$w.RGBA,C$B.UNSIGNED_BYTE,new Uint8Array(d.data.buffer)),t(),d=this._renderScreenshotOverlay(n,d,{...e,region:null});const f=m$12(i.width,i.height,n);return p$1e(d,f,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,t){const{framebufferHeight:r,region:s}=e,i=this._ensureScreenshotEncodeCanvas(),o=m$12(s.width,s.height,i);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,P$w.RGBA,C$B.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),t(),this._renderScreenshotOverlay(i,o,e)}_renderScreenshot(e,r){let i=null;const o=e.viewCamera,{framebufferWidth:a,framebufferHeight:h}=r;let c=!1;const l=r.disableDecorations&&e.frameHasDecorations,g=a!==o.fullWidth||h!==o.fullHeight,_=r.ignorePadding&&o.pixelRatio!==r.pixelRatio,m=g||l||_;if(m){const e=o.clone();if(r.ignorePadding){const t=t$1a(e.padding);for(let s=0;s<4;s++)t[s]=Math.round(t[s]/e.pixelRatio*r.pixelRatio);e.padding=t;}e.fullWidth=a,e.fullHeight=h,e.pixelRatio=r.pixelRatio;const t=o.fovX-e.fovX,l=o.fovY-e.fovY;t<0&&t<l?e.fovX=o.fovX:l<0&&l<t&&(e.fovY=o.fovY),this._forceCameraHook(e),c=!0,i=new D$p(this._rctx,{width:e.fullWidth,height:e.fullHeight,colorTarget:Y$d.TEXTURE,depthStencilTarget:V$q.DEPTH_STENCIL_RENDER_BUFFER}),this._renderScene(i,e,r.disableDecorations?D$u.OFF:D$u.ON),this._disposeOffscreenBuffers();}const p=()=>{this._rctx.bindFramebuffer(null),s$1a(i);},v=this._readbackScreenshot(r,p);if(p(),m&&!this._rctx.contextAttributes.alpha)for(let t=3;t<v.data.length;t+=4)v.data[t]=255;return c&&this._forceCameraHook(o),v}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const o={enabled:!1,disposeContextCache:()=>{const o=t();o.forEach((e=>e.dispose())),o.clear();}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const B$1=s$17.getLogger("esri.views.3d.webgl-engine.parts.View");let E=class extends(s$G(y$F)){constructor(e){super({}),this.events=new n$17,this.waterTextureRepository=new g$1,this._magnifierHelper=new N$2,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),l$M((()=>this.waterTextureRepository?.updating),(()=>this.requestRender()),h$V),this._magnifierHelper.events.on("request-render",(()=>this.requestRender())),this._stippleTextureRepository=new c$v(this._rctx),this._shaderTechniqueRepository=new s$H({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new T(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",(e=>this.requestRender(e))),this._materialRepository=new l$u(this._textureRepository,this._shaderTechniqueRepository,(()=>this.requestRender()),(()=>this.requestRender())),this._compositingHelper=new _$1(this._rctx,this._shaderTechniqueRepository),this._renderer=new _e(this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,(e=>this.requestRender(e)),((t,r)=>e.schedule(t,r)),e),this._screenshotManager=new g(this._rctx,((e,t,r)=>this._renderer.render(e,t,t,r)),(e=>this.requestRender(e)),e.options.screenshot.renderOverlay,(e=>this.events.emit("force-camera-for-screenshot",e)),(()=>this._renderer.disposeOffscreenBuffers())),this._registerFrameTask(e);}normalizeCtorArgs(){return {}}dispose(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=a$W(this._frameTask),this._shaderTechniqueRepository=s$1a(this._shaderTechniqueRepository),super.dispose(),this._tmpDepthBuffer=null,this._rctx=null;}get performanceInfo(){const e=this._rctx.gl;return {renderer:this._renderer.performanceInfo,textureMemory:void 0!==e.getUsedTextureMemory?e.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==e.getUsedRenderbufferMemory?e.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==e.getUsedVBOMemory?e.getUsedVBOMemory():void 0}}requestRender(e=t$1n.UPDATE){e===t$1n.UPDATE?this._needsUpdate=!0:this._needsRender=!0;}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}ensureEdgeView(){return this._renderer.ensureEdgeView()}get edgeView(){return this._renderer.edgeView}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e;}updateLightSources(e,t,r){this._renderer.updateLightSources(e,t,r),this.requestRender();}setRenderParameters(e){void 0!==e.idleSuspend&&this._idleSuspend!==!!e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend,this.requestRender()),this._renderer.setRenderParameters(e);}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}modify(e){this._renderer.modify(e),e.clear();}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e)}getAlpha(){return this._rctx.contextAttributes.alpha}get shadowsEnabled(){return this._renderer.shadowsEnabled}readAccumulatedShadow(e){return this._renderer.readAccumulatedShadow(e[0],e[1])}readHUDVisibility(e,t,r,i,s){this._renderer.readHUDVisibility(e,t,r,i,s);}getMinimalDepthForArea(e,t,r,i,s,o=s){const n=i.constrainWindowSize(t,r,s*i.pixelRatio,o*i.pixelRatio),p=this._ensureDepthBuffer(n);this._renderer.readDepthPixels(i,n,p);let d=Number.MAX_VALUE;for(let a=0;a<n[2]*n[3];a++){const e=A$2(4*a,p,i.nearFar);d>e&&e!==i.nearFar[0]&&e!==i.nearFar[1]&&(d=e);}if(r$W(e)){const s=e.pickDepth(t*i.pixelRatio,r*i.pixelRatio,i);r$W(s)&&d>s&&s!==i.nearFar[0]&&s!==i.nearFar[1]&&(d=s);}return d===Number.MAX_VALUE?void 0:d}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return (t$V(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}get renderPlugins(){return this._renderer.renderPlugins}get test(){return {renderer:this._renderer}}get gpuMemoryUsage(){return this._renderer.gpuMemoryUsage}async reloadShaders(){e$k(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender();}get animationTimestep(){return this._renderer.animationTimestep}_registerFrameTask(e){const t=e.state,r={viewCamera:t.camera,frameHasDecorations:!1};let i=!1,s=t$1n.BACKGROUND,o=!1;const n={preRender:r=>{i=this.updating,s=this._needsUpdate?t$1n.UPDATE:t$1n.BACKGROUND,e.processSyncLayers();const o=n$1e(r.time-this._lastAnimationUpdate);(o>this.animationTimestep||r$W(this.forcedAnimationTime)||i||this._needsRender)&&(this._renderer.updateAnimation({camera:t.camera,dt:o,forcedTime:this.forcedAnimationTime})&&this.requestRender(t$1n.BACKGROUND),this._lastAnimationUpdate=r.time);},render:()=>{if((this._needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const e=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this._renderer.render(null,t.camera,t.contentCamera,D$u.ON),o=!0,e&&this._renderer.hasWaterReflection&&(this.requestRender(t$1n.BACKGROUND),this._needsWaterReflectionUpdate=!0);}},update:()=>{r.viewCamera=t.camera,r.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled,this._textureRepository.update(),this._screenshotManager.update(r);},finish:()=>{o&&(this._renderer.finish(s),o=!1);}};this._frameTask=A$L(n);}_initializeContext(e){const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==t.stencil||t.stencil,powerPreference:"high-performance",preserveDrawingBuffer:t.preserveDrawingBuffer??!1},s=n$1I("3d",this._canvas,r);if(t$V(s)){const e=a$12("esri-force-webgl");B$1.error(e);}else this._rctx=this._newRenderingContext(s,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&B$1.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&a$12("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas);}_newRenderingContext(e,t){const r={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8},i=(e,r)=>t.resourceController.memoryController.newCache(e,r);if(o.enabled){let t=L.get(e);return t?(t.configure(r),t.newCache=i,t.ref(),t):(t=new r$3(e,r,i),L.set(e,t),t.ref(),t)}return new r$3(e,r,i)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat");}get componentObjectCollection(){return t$V(this._componentObjectCollection)&&(this._componentObjectCollection=new Q(this._renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e;}};e$Y([d$R({type:Boolean,readOnly:!0})],E.prototype,"updating",null),e$Y([i$B()],E.prototype,"_rctx",void 0),e$Y([i$B()],E.prototype,"_container",void 0),e$Y([i$B()],E.prototype,"_canvas",void 0),e$Y([i$B()],E.prototype,"_stippleTextureRepository",void 0),e$Y([i$B(),d$R()],E.prototype,"waterTextureRepository",void 0),e$Y([i$B(),d$R()],E.prototype,"_magnifierHelper",void 0),e$Y([i$B(),d$R()],E.prototype,"_textureRepository",void 0),e$Y([i$B()],E.prototype,"_compositingHelper",void 0),e$Y([i$B()],E.prototype,"_renderer",void 0),e$Y([i$B()],E.prototype,"_screenshotManager",void 0),e$Y([i$B()],E.prototype,"componentObjectCollection",null),e$Y([i$B()],E.prototype,"_componentObjectCollection",void 0),e$Y([d$R()],E.prototype,"_needsUpdate",void 0),e$Y([d$R()],E.prototype,"_needsWaterReflectionUpdate",void 0),E=e$Y([n$18("esri.views.3d.webgl-engine.parts.RenderView")],E);const L=t();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
var f;let w$1=f=class extends(s$G(y$F)){constructor(e){super(e),this._handles=new u$U,this._model=new h$5,this._layers=new n$1l,this._changeSet=new r$C,this._layerSyncSet=new Set;}initialize(){this._set("renderView",new E(this)),this._frameTask=this.resourceController.scheduler.registerTask(L$D.STAGE,this),this._handles.add(this._frameTask);}destroy(){o$y.pool.prune(0),this._handles.destroy(),this.dispose();}get viewingMode(){return this.state.viewingMode}get updating(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}add(e){this._model.add(e),y$q(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender();}remove(e){t$V(e)||(this.renderView.requestRender(),this._model.remove(e),y$q(e)&&(this._removeLayer(e),e.detachStage()));}addMany(e){r$W(e)&&(this._model.addMany(e),this.renderView.requestRender());}removeMany(e){r$W(e)&&(this._model.removeMany(e),this.renderView.requestRender());}async load(e){t$V(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter((e=>t$V(e.glTexture))).map((e=>this.schedule((()=>this._model.has(e)?e.load(this.renderView.renderingContext,(()=>this.renderView.textureRepository.textureTechnique)):null))))));}loadImmediate(e){return e.load(this.renderView.renderingContext,(()=>this.renderView.textureRepository.textureTechnique))}forEachOfType(e,t){this._model.forEachOfType(e,t);}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender());}get running(){return this._model.dirtySet.dirty}runTask(e){this._frameTask.processQueue(e),e.done||this._commit();}_commit(){const e=this._model.dirtySet;f.DebugSettings.logDirtySet&&console.log("Dirty set: "+e.formatDebugInfo()),e.commit(this._changeSet),f.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map((e=>e.id))),console.log("RGs remove: "+this._changeSet.removes.map((e=>e.id)))),this._layerSyncSet.clear(),this.renderView.modify(this._changeSet),this.renderView.requestRender();}schedule(e,t){return this._frameTask.schedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender();}processSyncLayers(){const e=this._model.dirtySet;this._layers.forAll((t=>{(this._layerSyncSet.has(t.id)||t.updatePolicy===o$1j.SYNC)&&(e.commitLayer(t.id,this._changeSet),this._layerSyncSet.delete(t.id));}));for(const t of this._layerSyncSet)e.commitLayer(t,this._changeSet);this._layerSyncSet.clear(),this.renderView.modify(this._changeSet);}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e);}_removeLayer(e){this._commit(),null!=this._layers.removeUnordered(e)&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._changeSet.removes),this.renderView.modify(this._changeSet));}addRenderPlugin(e,t,r){const s=this.renderView.renderPlugins.add(e,t,r),o=()=>{F$9(t)&&this.sceneIntersectionHelper.addIntersectionHandler(t);};if(k$F(s))return s.then(o);o();}removeRenderPlugin(e){F$9(e)&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderView.renderPlugins.remove(e);}get performanceInfo(){return {renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return {getCount:t=>e._model.test.content.filter((e=>e.type===t)).length,model:e._model}}};w$1.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},e$Y([d$R({constructOnly:!0})],w$1.prototype,"resourceController",void 0),e$Y([d$R({constructOnly:!0})],w$1.prototype,"options",void 0),e$Y([d$R({constructOnly:!0})],w$1.prototype,"state",void 0),e$Y([d$R({constructOnly:!0})],w$1.prototype,"sceneIntersectionHelper",void 0),e$Y([d$R({readOnly:!0})],w$1.prototype,"viewingMode",null),e$Y([d$R({constructOnly:!0})],w$1.prototype,"container",void 0),e$Y([d$R({constructOnly:!0})],w$1.prototype,"renderSR",void 0),e$Y([d$R({constructOnly:!0})],w$1.prototype,"_handles",void 0),e$Y([d$R({readOnly:!0})],w$1.prototype,"updating",null),e$Y([d$R({constructOnly:!0})],w$1.prototype,"_model",void 0),e$Y([i$B(),d$R()],w$1.prototype,"renderView",void 0),w$1=f=e$Y([n$18("esri.views.3d.webgl-engine.Stage")],w$1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function r$2(r){return c$1o(r)&&r.intersector===i$1e.PCL&&!!r.target}function n$2(r){return c$1o(r)&&r.intersector===i$1e.I3S&&!!r.target}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function r$1(r){return c$1o(r)&&r.intersector===i$1e.TERRAIN&&!!r.target}function n$1(r){return c$1o(r)&&r.intersector===i$1e.OVERLAY&&!!r.target}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function e$2(e){return c$1o(e)&&e.intersector===i$1e.LOD&&!!e.target}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
function m(r,t){return i$1s(r)||u$1h(r)?B(r.target.object.metadata,t):r$1(r)?t.map?.ground:r$2(r)||n$2(r)||n$1(r)?B(r.target,t):null}function d(t,e){const n=h(t,e);return r$W(n)&&"graphic"===n.type?n.graphic:null}function h(r,e){if(t$V(r))return null;if(i$1s(r)||u$1h(r))return y(r.target.object.metadata,e);if(r$2(r)){const t=r.target.createGraphic();return {type:"graphic",graphic:t,layer:t.layer}}return n$1(r)||e$2(r)?y(r.target,e):n$2(r)?j(r.target,e):null}function y(r,e){if(t$V(r)||t$V(r.graphicUid))return null;const n=B(r,e);if(t$V(n))return null;if(n===e.graphics)return t$V(e.graphicsView)||"number"!=typeof r.graphicUid?null:e.graphicsView.getHit(r.graphicUid);const i=e.allLayerViews.find((r=>r.layer===n));return !i||i.suspended||t$V(r.graphicUid)?null:"getHit"in i?i.getHit(r.graphicUid):null}function j(r,e){const n=B(r,e);if(t$V(n))return null;const i=e.allLayerViews.find((r=>r.layer===n));return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?b(i.getGraphicFromIntersectorTarget(r)):null}function U(r,e){const n=B(r,e);if(t$V(n))return null;const i=e.allLayerViews.find((r=>r.layer===n));return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(r):null}function b(t){return r$W(t)?{type:"graphic",graphic:t,layer:t.layer}:null}function B(e,n){return t$V(e.layerUid)?null:r$W(n.graphicsView)&&e.layerUid===n.graphicsView.processor.layer.id?n.graphics:n.map.findLayerByUid(e.layerUid)}function V(r,t){if(i$1s(r)||u$1h(r))return k$H(r.target.object.boundingVolumeWorldSpace.bounds);if(e$2(r)){v$_(I,r.transformation);const t=Math.max(I[0],I[1],I[2]);return r.target.baseBoundingSphere.radius*t}return n$2(r)?o$1m(U(r.target,t),(r=>.5*g$_(r))):null}function w(r){return !i$1s(r)&&!u$1h(r)&&(e$2(r)?r.target.numLodLevels>1:!!n$2(r))}const I=n$16();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
async function n(n,r){if("2d"===n.type)return n.hitTest(r);const s=await n.hitTest(r);if(0===s.results.length)return s;const i=s.results[0],u=r$W(i.distance)?i.distance*(1+e$1):i.distance,c=s.results.findIndex((t=>t.distance>u));return -1!==c&&(s.results=s.results.slice(0,c)),s}const e$1=.05;function r(n){return r$W(n)&&"graphic"===n.type}function s(t){return t.find(r)??null}function i(t){return t.filter(r)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
let e=class extends _$F{constructor(o){super(o),this.components=["attribution","zoom","navigation-toggle","compass"];}};e$Y([d$R()],e.prototype,"components",void 0),e=e$Y([n$18("esri.views.ui.3d.DefaultUI3D")],e);const p=e;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
const ot=s$17.getLogger("esri.views.SceneView");let lt=class extends(w$H(g$18(p$1f(G$s)))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this.propertiesPool=new o$1s({slicePlane:z$w},this),this._resourceController=f$e(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new _$n({view:this}),this.labeler=new F$b({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new n$1J,this.basemapTerrain=null,this.elevationProvider=null,this.camera=null,this.canvas=null,this.center=null,this.constraints=new c$X,this.environmentManager=new L$w,this.extent=null,this.floors=new j$F,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new D$l({view:this}),this.groundView=null,this.navigating=!1,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new _$d,this.scale=null,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new p,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.viewpoint=null,this.zoom=null,this.highlightOptions=new l$k,this.voxelWasm=null,this.voxelWasmPromise=null,c$1t(),e&&e.environment||(this._defaults.environment=new b$A,this.environment=this._defaults.environment);const t=(e=null)=>{r$W(e)&&e.type===E$R.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach((async e=>{try{await e.when();}catch{}this._updatingChanged();})));};this.handles.add([a$Z((()=>this.map?.allLayers),"after-changes",(e=>t(e)),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",(e=>this._updateUpdatingMonitors(e))),l$M((()=>this.map),(e=>{e&&"load"in e&&e.load&&e.load().catch((()=>{}));}))]),this.inputManager=new C$r({view:this}),this.stateManager=new J$5({view:this});}initialize(){this.groundView=new h$Q({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.handles.add(a$Z((()=>this.map?.allLayers),"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add((()=>this.qualitySettings.memoryLimit),(e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e);}),h$V),this.updatingHandles.add((()=>this.qualitySettings.additionalCacheMemory),(e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e);}),h$V),this.updatingHandles.add((()=>this.qualitySettings.frameRate),(e=>F$x(e>0?1e3/Math.ceil(e):0)),h$V),this.updatingHandles.add((()=>this.map?.ground),e,w$x),this.updatingHandles.add((()=>this.map?.ground?.opacity),(()=>this._updateDefaultHitTestOptions()),w$x),this.handles.add(l$M((()=>this.spatialReference),(()=>this.notifyChange("clippingArea")),U$s));}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=l$N(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=l$N(this._resourceController),this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=l$N(this.groundView));}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get clippingArea(){if("global"===this.viewingMode)return null;let e=this._userClippingArea||this.get("map.clippingArea");return !(!!this._userClippingArea||this.get("map.clippingEnabled"))||t$V(e)?(this._clippingArea=null,null):e instanceof M$u?this.spatialReference&&(e=dt(e,this.spatialReference),t$V(e))?(ot.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),t$V(e.intersection(this.groundAndLayersExtent))&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(ot.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&"global"===this.viewingMode&&r$W(e)?ot.error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e;}get renderDataExtent(){if(this.state.viewingMode===l$O.Global)return null;const e=this.renderSpatialReference,t=this.dataExtent;return t$V(t)||t$V(e)||t.spatialReference.equals(e)?t:dt(t,e)}get dataExtent(){let e=this.groundAndLayersExtent;const t=this.spatialReference||k$z.WGS84,i=dt(this.clippingArea,t);r$W(i)&&(e=r$W(e)?e.intersection(i):i);const r=this._get("dataExtent");return r$W(e)&&e.equals(r)?r:e}get groundAndLayersExtent(){const e=this.spatialReference||k$z.WGS84;let t;const i=i=>{const r=dt(i,e);t$V(r)||(r$W(t)?t.union(r):t=r.clone());},r=this.basemapTerrain;if(r?.spatialReference){const e=r.groundExtent;i(new M$u({xmin:e[0],ymin:e[1],zmin:0,xmax:e[2],ymax:e[3],zmax:0,spatialReference:r.spatialReference}));}if(this.map){const e=e=>{!r$W(e.fullExtent)||"graphics"===e.type&&e.internal||i(e.fullExtent);};this.map.allLayers.forEach((t=>e(t)));}if(t$V(t))return null;t.hasZ?(t.zmin=Math.min(0,t.zmin),t.zmax=Math.max(0,t.zmax)):(t.zmin=0,t.zmax=0);const s=this._get("groundAndLayersExtent");return t.equals(s)?s:t}set environment(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e);}castEnvironment(e){return e?e instanceof b$A?e:e instanceof y$G?null!=this.environment?this.environment.cloneWithWebsceneEnvironment(e):b$A.fromWebsceneEnvironment(e):b$L(b$A,e):new b$A}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return {required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||r$W(this.activeTool)}get stationary(){return !this.animation&&!this.resizing&&(t$V(this.state)||this.state.stationary)}set qualityProfile(e){o$k.isValidProfile(e)&&(o$k.apply(e,this.qualitySettings),this._set("qualityProfile",e));}get qualityProfile(){return this._get("qualityProfile")||o$k.getDefaultProfile()}set slicePlane(e){if(r$W(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:e}),t$V(e))return void this._set("slicePlane",null);const t=this.propertiesPool.get("slicePlane");X$c(e,t),this._set("slicePlane",t);}get typeSpecificPreconditionsReady(){return !!this.viewingMode}get resolution(){return null!=this.spatialReference?i$1t(this.scale,this.spatialReference):0}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return null!=e?v$$.deriveUnitFromSR(e,this.spatialReference):null}get updating(){if(this.destroyed)return !1;let e=0,t=this.layerViewManager.updating,i=t?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach((r=>{if(r.isFulfilled()){if(r.updating){if(t=!0,r.suspended||x$a(r))return;++i,e+=r.updatingProgress;}}else ++i;}));for(const r of [this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager,this.analysisViewManager])if(r$W(r)&&r.updating){const t=.1;i+=t,e+=.5*t;}for(const r of [this.deconflictor,this.labeler,this.basemapTerrain])r$W(r)&&r.updating&&(++i,e+=r.updatingProgress);if(t=!!(t||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||this.inputManager?.hasPendingInputs||this.map?.allLayers?.some((e=>!e.isFulfilled()))),t?(this._numUpdating=Math.max(i,this._numUpdating),e+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=t?0:1,this._get("updatingProgress")!==e){const i=performance.now();if(e<1){const t=Math.min((i-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-t)+e*t;}this._set("updatingProgress",e),this._lastUpdateTime=t&&e<1?i:0;}return t}get viewingMode(){const e=this._predeterminedViewingMode;if(r$W(e))return a$1p(e);const t=this.spatialReference;return t?r$W(this.defaultsFromMap?.viewingMode)&&t.equals(this.defaultsFromMap.spatialReference)?a$1p(this.defaultsFromMap.viewingMode):r$1f(t,l$O.Global)?"global":"local":"global"}set viewingMode(e){this.ready?ot.error("#viewingMode","viewingMode cannot be set once view is ready"):e?this._override("viewingMode",e):void 0===e&&this._clearOverride("viewingMode");}get resourceController(){return this._resourceController}get performanceInfo(){return new a$l(this)}forceAnimationTime(e){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=e;}on(e,t,i,r){const s=this.viewEvents.on(e,t,i,r);return s||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return ot.error("#toMap()","Scene view cannot be used before it is ready"),null;const i=t?this.externalToInternalIntersectOptions(t):this._defaultToMapOptions,r=r$W(i.graphics)&&(r$W(i.graphics.include)||r$W(i.graphics.exclude)),s=o$1A(e)?r$1o(this,e):e,n=d$V(s);i.enableDraped=i.include&&!i.include.has(j$H)||i.exclude&&i.exclude.has(j$H);const a=this.sceneIntersectionHelper,o=x$K(this.state.viewingMode);if(o.options.selectionMode=!0,o.options.store=r?t$1g.ALL:t$1g.MIN,a.intersectIntersectorScreen(n,o,i),r){for(const e of o.results.all){const t=h(e,this);if(t$V(t))return this._intersectResultToMapPoint(e);if("graphic"!==t.type||this._testGraphicUidFilter(i.graphics,t.graphic))return this._intersectResultToMapPoint(e)}return null}return this._intersectResultToMapPoint(o.results.min)}toScreen(e){if(!this.ready)return ot.error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=c$$(null==e.z&&i$18(this.elevationProvider,e),0);return Hn(e,ut,this.renderSpatialReference,t),this.state.camera.projectToScreen(ut,gt),c$1n(gt[0],gt[1])}pixelSizeAt(e){return this.ready?e?(Hn(e,ut,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(ut)):0:(ot.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e):1}hitTest(e,t){if(!this.ready)return ot.error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=o$1A(e)?r$1o(this,e):e,r=i$12(i.x,i.y),s=t?this.externalToInternalIntersectOptions(t):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=x$K(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=t$1g.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,n,s);const a=this._intersectResultsToHits(n.results.all,s.graphics),o=n.results.ground,l=m(o,this),p=r$W(l)&&"type"in l&&"integrated-mesh"===l.type?l:null,h={screenPoint:i,results:a,ground:{mapPoint:this._intersectResultToMapPoint(o),distance:c$1o(o)?o.distanceInRenderSpace:0,layer:p}};return t$E.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(e){const{results:t,ground:i}=await n(this,e);let r=null;return !(0===t.length||Math.abs(c$$(t[0].distance,0)-i.distance)<1e-5)||i.layer&&"integrated-mesh"===i.layer.type||(r=i.mapPoint),{results:t,screenPoint:e,mapPoint:r}}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(t$V(e.parent))throw new s$16("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});if("line-of-sight"===e.parent.type){return (await this.whenLayerView(e.parent)).whenAnalysisView()}return this.analysisViewManager.whenAnalysisView(e)}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return r$1p(i,t,this._pixelFormat())}async _takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return l$1b(i,this._pixelFormat())}_completeSettings(e){const t=a$1q(e,this);return t.pixelRatio/=this.state.pixelRatio,y$M(t,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return {flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return {takeScreenshot:e=>this._takeScreenshot(e)}}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return l$L.importLayerView(e)}hasLayerViewModule(e){return l$L.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle();}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map?.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let e=i$1u(this.type);if(a$12("safari")&&a$12("safari")<9&&(e=new s$16("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:a$12("safari")})),r$W(e))throw ot.warn("#validate()",e.message),e}get _predeterminedViewingMode(){const e=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return r$W(e)?o$1B(e):null}getSpatialReferenceSupport({spatialReference:e,layer:t}){const i=this._predeterminedViewingMode;if(r$W(i))return this._validateSpatialReferenceForViewingMode(e,t,i)?{constraints:this._makeSpatialReferenceConstraints(e,t,i)}:null;const r=this._validateSpatialReferenceForViewingMode(e,t,l$O.Local),s=this._validateSpatialReferenceForViewingMode(e,t,l$O.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:r?{constraints:this._makeSpatialReferenceConstraints(e,t,l$O.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,l$O.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,i){return !!r$1f(e,i)&&(!!t$V(t)||(!!r$1q(t)||(!t$1m(t)||!t$V(C$a(t,e,i)))&&(!n$1K(t)||i!==l$O.Global)))}_makeSpatialReferenceConstraints(e,t,i){if(t$V(t))return [{spatialReference:e,viewingMode:i}];const r=e.isWebMercator,s=e.isWGS84;if(r$1q(t)&&(r||s)){return !s||i===l$O.Local||null===L$b(t.tileInfo,t.fullExtent,e,l$O.Global)?[{spatialReference:e,viewingMode:i},{spatialReference:k$z.WebMercator,viewingMode:i}]:[{spatialReference:r?k$z.WGS84:k$z.WebMercator,viewingMode:i}]}return t$1m(t)||n$1K(t)||!r&&!s?t$1m(t)&&r&&i!==l$O.Global?[{spatialReference:e,viewingMode:i},{spatialReference:k$z.WGS84,viewingMode:l$O.Local}]:[{spatialReference:e,viewingMode:i}]:[{spatialReference:e,viewingMode:i},{spatialReference:r?k$z.WGS84:k$z.WebMercator,viewingMode:i}]}_validateSpatialReference(e){const t=r$W(this.getSpatialReferenceSupport({spatialReference:e})),i=this._predeterminedViewingMode;return t||(r$W(i)?ot.warnOnce(`Spatial reference defined on view not supported in ${a$1p(i)} viewing mode.`):e.isGeographic&&ot.warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise((e=>{this.ready?e(this):this._resolveWhenReady.push(e);}))}computeMapPointFromVec3d(e,t){let i=this.spatialReference||k$z.WGS84;return Bn(e,this.renderSpatialReference,e,i)||(i=k$z.WGS84,Bn(e,this.renderSpatialReference,e,i)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=i):t=new j$P(e,i),t}trackGraphicState(e){if(!e.graphic)return ot.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let i=null,r=!1;const s=t=>{!r&&r$W(t)&&"processor"in t&&"graphics-3d"===t.processor?.type&&t.processor.graphicsCore&&(i=t.processor.graphicsCore.trackGraphicState(e));};return r$W(t)?s(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then((e=>s(e)),(()=>{})).catch((()=>{})),{remove:()=>{r=!0,r$W(i)&&(i.remove(),i=null);}}}highlight(e){if(Array.isArray(e))return r$1r(e.map((e=>this.highlight(e))));if(j$F.isCollection(e))return r$1r(e.toArray().map((e=>this.highlight(e))));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):n$1A()}maskOccludee(e){if(!e)return ot.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let i=null,r=!1;const s=t=>{!r&&r$W(t)&&t$1t(t)&&(i=t.maskOccludee(e));};return r$W(t)?s(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then((e=>s(e)),(()=>{})).catch((()=>{})),{remove:()=>{r=!0,r$W(i)&&(i.remove(),i=null);}}}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find((t=>t.layer===e.layer)):null}graphicChanged(e){r$W(this.graphicsView)&&this.graphicsView.graphicChanged(e);}async whenViewForGraphic(e,t){if(e.layer===this)return await j$O((()=>this.graphicsView)),this.graphicsView;if(!e.layer||!this.map)throw new s$16("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise(((t,i)=>{const r=this.map.allLayers.on("change",(s=>{s.added.includes(e.layer)&&(r.remove(),this.whenLayerView(e.layer).then(t,i));}));})):this.whenLayerView(e.layer)}externalToInternalIntersectOptions(e){const t=this._externalToInternalRenderItems(e.include,ct.INCLUDE),i=this._externalToInternalRenderItems(e.exclude,ct.EXCLUDE);return {include:t.layerUids,exclude:i.layerUids,graphics:{include:t.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(e,t){return e.getIntersectionPoint(ut)?(t=this.computeMapPointFromVec3d(ut,t),e.intersector===i$1e.TERRAIN&&this.basemapTerrain&&(t.z=c$$(i$18(this.basemapTerrain,t),0)),t):null}_intersectResultsToHits(e,t){const i=new Array;let r=null;for(let s=0;s<e.length;s++){const n=e[s],a=m(n,this);if(r$W(a)&&(a===this.map.ground||"type"in a&&"integrated-mesh"===a.type))break;const o=h(n,this);if(t$V(o))continue;if("graphic"===o.type){if(t$V(r)&&s!==e.length-1&&(r=new Set),r$W(r)){const e=this._getGraphicFilterUid(o.graphic);if(r.has(e))continue;r.add(e);}if(!this._testGraphicUidFilter(t,o.graphic))continue}const l=this._intersectResultToMapPoint(n),p=n.distanceInRenderSpace;i.push({...o,mapPoint:l,distance:p});}return i}_getGraphicFilterUid(e){if(e.layer&&"objectIdField"in e.layer){const t=e.attributes[e.layer.objectIdField];if(t)return `o-${e.layer.id}-${t}`}return `u-${e.uid}`}_testGraphicUidFilter(e,t){const i=this._getGraphicFilterUid(t);return t$V(e)||(t$V(e.include)||e.include.has(i))&&(t$V(e.exclude)||!e.exclude.has(i))}_externalToInternalRenderItems(e,t,r={layerUids:null,graphicUids:null}){if(!e)return r;if(e instanceof g$Y)ht(r,this._getGraphicFilterUid(e)),t===ct.INCLUDE&&(r$W(this.graphicsView)&&e.layer===this?pt(r,this.graphicsView.processor.layer.id):e.layer&&pt(r,e.layer.uid));else if(t$1u(e))for(const i of e)i===this.graphics&&r$W(this.graphicsView)?pt(r,this.graphicsView.processor.layer.id):i===this.map.ground?pt(r,j$H):this._externalToInternalRenderItems(i,t,r);else "uid"in e&&pt(r,e.uid);return r}_initBasemapTerrain(){this._set("basemapTerrain",new $e$1({view:this})),this._set("elevationProvider",new u$l({view:this})),this.elevationProvider.register("ground",this.basemapTerrain);}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null));}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new E$c({view:this})),this._set("featureTiles",new j$d({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{const e=this.basemapTerrain?.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const e=r$W(this.basemapTerrain.extent)?rn(f$P(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;r$W(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(e):this.featureTiles.filterExtent=e;}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null;};this.handles.add([this.updatingHandles.add((()=>t$E.FEATURE_TILE_TREE_SHOW_TILES),(e=>{e&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(import('./FeatureTileTree3DDebugger-34bd30d6.js')).then((({FeatureTileTree3DDebugger:e})=>{!this.featureTreeDebugger&&t$E.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new e({view:this}));})):e||!this.featureTreeDebugger||t$E.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null);}),w$x),this.updatingHandles.add((()=>this.clippingArea),e,w$x),this.updatingHandles.add((()=>this.basemapTerrain.extent),e,w$x)],"feature-tiles"),this.stateManager.init();}_exitGlobe(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem());}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new a$o(this.map,e));const t=this.state.isGlobal,i=H$m(t,e);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",x$c.create(this.state.viewingMode,i)),t||this.handles.add(l$M((()=>this.basemapTerrain?.extent),(e=>{const t=this.renderCoordsHelper.spatialReference;e&&(0!==e[0]||0!==e[1]||0!==e[2]||0!==e[3])&&zn(e,this.basemapTerrain.spatialReference,mt,t)&&(this.renderCoordsHelper.extent=mt);}),U$s),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(A$M/this.renderCoordsHelper.unitInMeters));}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null);}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null));}_updatingChanged(){this.notifyChange("updating");}_updateUpdatingMonitors(e=null){r$W(e)&&e.type===E$R.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach((e=>{e.destroyed||(this.handles.add(l$M((()=>[e.updating,e.updatingProgress]),(()=>this._updatingChanged()),U$s),"updatingMonitors"),e.when((()=>this._updatingChanged()),(()=>this._updatingChanged())));})),this._updatingChanged());}_renderScreenshotOverlay(e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const i=e.getContext("2d");return i.putImageData(t,0,0),this.overlay.renderCanvas(e),i.getImageData(0,0,t.width,t.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(e,t)=>this._renderScreenshotOverlay(e,t)}},t=new H$6(this.state.viewingMode,(e=>this._stage.layers.forAll(e)),this);this._set("sceneIntersectionHelper",t);const i=e$1z(this.surface),{resourceController:r,state:s,renderSpatialReference:l}=this;this._stage=new w$1({options:e,container:i,resourceController:r,state:s,sceneIntersectionHelper:t,renderSR:l}),this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=r$1s(this._stage.renderView.canvas,"webglcontextlost",(()=>this.fatalError=new s$16("webgl-context-lost"))),this.handles.add([this.updatingHandles.add((()=>this.qualitySettings.antialiasingEnabled),(()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled})),h$V),this.updatingHandles.add((()=>this.qualitySettings.highQualityTransparency),(()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency})),h$V),l$M((()=>this.magnifier),(e=>this._stage.renderView.magnifier=e),w$x)],"stage");const p=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:l$k.toEngineOptions(this.highlightOptions)});};this.handles.add(this.updatingHandles.add((()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference]),p),"stage"),p(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(A$M/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas);}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage.destroy(),this._stage=null,this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null,this.handles.remove("stage"),this._set("canvas",null);}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new h$g({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new c$n});}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage());}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController)return;if(0===this.graphics.length)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged();};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged();}async _createGraphicsViewAsync(e){const t=(await import('./GraphicsView3D-f5addd41.js')).default;f$V(e),await j$O((()=>this.basemapTerrain?.ready),e),this._set("graphicsView",new t({view:this}));}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),r$W(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null));}_startup(){const e=o$1B(this.viewingMode);if(e===l$O.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.handles.add(a$Z((()=>this.graphics),"after-changes",(()=>this._createGraphicsViewIfNeeded())),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const e=this.get("map.initialViewProperties.environment");e&&(this.environment=e);}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const t=this._resolveWhenReady;this._resolveWhenReady=[],t.forEach((e=>e(this)));}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1);}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(j$H);for(const e of this.map.allLayers.items)"integrated-mesh"===e.type&&this._defaultToMapOptions.include.add(e.uid);}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(j$H);for(const e of this.map.allLayers.items)"integrated-mesh"===e.type&&e.opacity<1&&this._defaultToMapOptions.exclude.add(e.uid);}}addVoxelLayerViewToWasm(e){return t$V(this.voxelWasm)?(t$V(this.voxelWasmPromise)&&(this.voxelWasmPromise=import('./VoxelWasmPerSceneView-243b1a89.js').then((e=>(this.voxelWasm=new e.default(this),this.voxelWasm)))),this.voxelWasmPromise.then((t=>t.addVoxelLayer(e)))):this.voxelWasm.addVoxelLayer(e)}removeVoxelLayerViewFromWasm(e){if(r$W(this.voxelWasm)){this.voxelWasm.removeVoxelLayer(e)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null);}}};function pt(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t);}function ht(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t);}function dt(e,t){return r$W(e)&&An(e.spatialReference,t)?rn(e,t):null}var ct;lt.type="3d",e$Y([d$R()],lt.prototype,"_userClippingArea",void 0),e$Y([d$R()],lt.prototype,"_resourceController",void 0),e$Y([d$R()],lt.prototype,"_stage",void 0),e$Y([d$R({readOnly:!0})],lt.prototype,"deconflictor",void 0),e$Y([d$R({readOnly:!0})],lt.prototype,"labeler",void 0),e$Y([d$R(a$1r(n$1J,"analyses"))],lt.prototype,"analyses",void 0),e$Y([d$R({type:n$1j,readOnly:!0,aliasOf:"state.animation"})],lt.prototype,"animation",void 0),e$Y([d$R({readOnly:!0})],lt.prototype,"basemapTerrain",void 0),e$Y([d$R({readOnly:!0})],lt.prototype,"elevationProvider",void 0),e$Y([d$R({type:d$14,aliasOf:"stateManager.camera"})],lt.prototype,"camera",void 0),e$Y([d$R({type:d$14,aliasOf:"stateManager.contentCamera"})],lt.prototype,"contentCamera",void 0),e$Y([d$R({readOnly:!0})],lt.prototype,"canvas",void 0),e$Y([d$R({type:j$P,aliasOf:"stateManager.center"})],lt.prototype,"center",void 0),e$Y([d$R({type:M$u})],lt.prototype,"clippingArea",null),e$Y([d$R({type:c$X})],lt.prototype,"constraints",void 0),e$Y([d$R({type:M$u,readOnly:!0})],lt.prototype,"renderDataExtent",null),e$Y([d$R({type:M$u,readOnly:!0})],lt.prototype,"dataExtent",null),e$Y([d$R({type:M$u,readOnly:!0})],lt.prototype,"groundAndLayersExtent",null),e$Y([d$R({value:null,type:b$A})],lt.prototype,"environment",null),e$Y([s$19("environment")],lt.prototype,"castEnvironment",null),e$Y([d$R({readOnly:!0})],lt.prototype,"environmentManager",void 0),e$Y([d$R({type:M$u,aliasOf:"stateManager.extent"})],lt.prototype,"extent",void 0),e$Y([d$R()],lt.prototype,"floors",void 0),e$Y([d$R({readOnly:!0,aliasOf:"stateManager.screenCenter"})],lt.prototype,"screenCenter",void 0),e$Y([d$R({aliasOf:"stateManager.frustum"})],lt.prototype,"frustum",void 0),e$Y([d$R({type:Number,readOnly:!0})],lt.prototype,"fullOpacity",void 0),e$Y([d$R({readOnly:!0})],lt.prototype,"graphicsView",void 0),e$Y([d$R({readOnly:!0})],lt.prototype,"analysisViewManager",void 0),e$Y([d$R()],lt.prototype,"groundView",void 0),e$Y([d$R({type:Boolean})],lt.prototype,"initialExtentRequired",null),e$Y([d$R()],lt.prototype,"_defaultsFromMapSettings",null),e$Y([d$R({type:Boolean,readOnly:!0})],lt.prototype,"interacting",null),e$Y([d$R()],lt.prototype,"stationary",null),e$Y([d$R({aliasOf:"state.navigating"})],lt.prototype,"navigating",void 0),e$Y([d$R()],lt.prototype,"map",void 0),e$Y([d$R({readOnly:!0})],lt.prototype,"mapCoordsHelper",void 0),e$Y([d$R({aliasOf:"stateManager.padding"})],lt.prototype,"padding",void 0),e$Y([d$R({type:E$c,readOnly:!0})],lt.prototype,"pointsOfInterest",void 0),e$Y([d$R({type:j$d,readOnly:!0})],lt.prototype,"featureTiles",void 0),e$Y([d$R()],lt.prototype,"featureTreeDebugger",void 0),e$Y([d$R({type:Boolean})],lt.prototype,"screenSizePerspectiveEnabled",void 0),e$Y([d$R({constructOnly:!0})],lt.prototype,"deactivatedWebGLExtensions",void 0),e$Y([d$R({constructOnly:!0})],lt.prototype,"debugWebGLExtensions",void 0),e$Y([d$R({constructOnly:!0})],lt.prototype,"renderCanvas",void 0),e$Y([d$R({constructOnly:!0})],lt.prototype,"state",void 0),e$Y([d$R({readOnly:!0})],lt.prototype,"inputManager",void 0),e$Y([d$R({readOnly:!0})],lt.prototype,"stateManager",void 0),e$Y([d$R({type:["low","medium","high"]})],lt.prototype,"qualityProfile",null),e$Y([d$R({type:c$j,get(){let e=this._get("qualitySettings");return e||(e=new c$j,o$k.apply(this.qualityProfile,e)),e}})],lt.prototype,"qualitySettings",void 0),e$Y([d$R()],lt.prototype,"slicePlane",null),e$Y([d$R({readOnly:!0})],lt.prototype,"typeSpecificPreconditionsReady",null),e$Y([d$R({readOnly:!0})],lt.prototype,"renderCoordsHelper",void 0),e$Y([d$R({readOnly:!0})],lt.prototype,"sceneIntersectionHelper",void 0),e$Y([d$R({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],lt.prototype,"resolution",null),e$Y([d$R({type:Number,aliasOf:"stateManager.scale"})],lt.prototype,"scale",void 0),e$Y([d$R()],lt.prototype,"heightModelInfo",null),e$Y([d$R()],lt.prototype,"spatialReference",void 0),e$Y([d$R({type:Boolean,constructOnly:!0})],lt.prototype,"alphaCompositingEnabled",void 0),e$Y([d$R({constructOnly:!0})],lt.prototype,"preserveDrawingBufferEnabled",void 0),e$Y([d$R({type:Boolean})],lt.prototype,"supersampleScreenshotsEnabled",void 0),e$Y([d$R({readOnly:!0})],lt.prototype,"type",void 0),e$Y([d$R({type:p})],lt.prototype,"ui",void 0),e$Y([d$R({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating"]})],lt.prototype,"updating",null),e$Y([d$R({type:Number,readOnly:!0,dependsOn:["updating"]})],lt.prototype,"updatingProgress",void 0),e$Y([d$R({type:["global","local"]})],lt.prototype,"viewingMode",null),e$Y([d$R({type:u$1b,aliasOf:"stateManager.viewpoint"})],lt.prototype,"viewpoint",void 0),e$Y([d$R({type:Number,aliasOf:"stateManager.zoom"})],lt.prototype,"zoom",void 0),e$Y([d$R({type:l$k})],lt.prototype,"highlightOptions",void 0),lt=e$Y([n$18("esri.views.SceneView")],lt),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE";}(ct||(ct={}));const ut=n$16(),gt=i$12(),mt=u$T(),ft=lt;

const SceneView = /*#__PURE__*/Object.freeze({
  __proto__: null,
  'default': ft
});

export { it as $, T$p as A, T$l as B, C$q as C, i$A as D, E$v as E, i$w as F, o$t as G, H$m as H, p$r as I, ye as J, ve as K, L$b as L, je as M, st as N, P$3 as O, P$k as P, ct$1 as Q, Fe as R, Ne as S, T$z as T, ke as U, xe as V, o$9 as W, Se as X, a$h as Y, E$6 as Z, _$e as _, a$A as a, s$10 as a$, h$4 as a0, F$3 as a1, t$7 as a2, ce$2 as a3, Me as a4, me$1 as a5, he as a6, Le as a7, Ke as a8, A$m as a9, J$1 as aA, D$3 as aB, r$G as aC, o$R as aD, o$Q as aE, L$2 as aF, N$5 as aG, x$d as aH, Ue as aI, _e$1 as aJ, ze as aK, ie$1 as aL, H$2 as aM, _$6 as aN, M$5 as aO, V$7 as aP, r$t as aQ, O$t as aR, H$d as aS, O$o as aT, P$g as aU, n$5 as aV, Z$9 as aW, K$h as aX, s$R as aY, m$l as aZ, n$D as a_, Oe as aa, B$k as ab, ue$1 as ac, le$1 as ad, ft$1 as ae, lt$1 as af, a$c as ag, h$x as ah, o$z as ai, m$x as aj, Be as ak, Pe as al, O$3 as am, A$b as an, Re as ao, se as ap, I$b as aq, f$D as ar, p$a as as, M$s as at, o$M as au, y$p as av, _e$8 as aw, t$y as ax, G$3 as ay, K$3 as az, e$E as b, SceneView as b$, o$P as b0, r$R as b1, o$A as b2, J$c as b3, a$G as b4, n$2 as b5, r$1 as b6, d as b7, w as b8, V as b9, O$9 as bA, w$a as bB, L$7 as bC, x$n as bD, b$n as bE, I$4 as bF, G$1 as bG, U$3 as bH, u$9 as bI, a$7 as bJ, d$4 as bK, s$4 as bL, d$3 as bM, w$4 as bN, v$2 as bO, u$8 as bP, y$2 as bQ, x$2 as bR, L$k as bS, m$7 as bT, w$2 as bU, b$j as bV, m$o as bW, S$e as bX, j$j as bY, f$j as bZ, s$o as b_, u$I as ba, W$b as bb, N$b as bc, N$7 as bd, $$2 as be, v$J as bf, u$O as bg, p$N as bh, g$N as bi, g$L as bj, f$K as bk, p$L as bl, d$L as bm, c$N as bn, B$l as bo, L$o as bp, s$y as bq, g$f as br, c$c as bs, m$e as bt, d$7 as bu, u$a as bv, p$M as bw, S$r as bx, u$t as by, z$4 as bz, c$D as c, d$k as d, e$D as e, a$F as f, e$H as g, r$F as h, i$E as i, j$r as j, k$k as k, l$t as l, e$r as m, n$q as n, e$I as o, e$q as p, d$i as q, r$w as r, s$J as s, t$i as t, e$m as u, t$E as v, w$p as w, x$c as x, y$s as y, E$p as z };
